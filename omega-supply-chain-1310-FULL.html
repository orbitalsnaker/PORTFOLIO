<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>PROYECTO OMEGA Ω-1310 V3 · RESPUESTA ANTICIPADA A TODAS LAS CRÍTICAS · ZEHAHAHAHA</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&family=DM+Serif+Display&family=Space+Grotesk:wght@300;400;500;700&display=swap');

:root {
  --obsidian: #06060a;
  --deep: #0d0d12;
  --gold: #c9a84c;
  --gold-bright: #f0c96a;
  --cyan: #00d4aa;
  --red: #c0392b;
  --red-bright: #e74c3c;
  --green: #00ff88;
  --basalt: #2a2a32;
  --text: #d8d8d8;
  --muted: #666;
  --border: rgba(201,168,76,0.18);
  --v3: #a855f7;
  --v3-bright: #c084fc;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--obsidian);
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 14px;
  line-height: 1.8;
}

.page {
  max-width: 1040px;
  margin: 0 auto;
  padding: 60px 40px 120px;
}

/* ── MASTHEAD ── */
.masthead {
  border-bottom: 2px solid var(--gold);
  padding-bottom: 40px;
  margin-bottom: 70px;
  position: relative;
}
.masthead::before {
  content: '';
  position: absolute;
  bottom: -6px; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
}
.masthead::after {
  content: '';
  position: absolute;
  bottom: -10px; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--v3), transparent);
}
.masthead-tag {
  font-size: 0.65rem;
  letter-spacing: 6px;
  color: var(--muted);
  text-transform: uppercase;
  margin-bottom: 1.5rem;
}
.masthead-tag span { color: var(--gold); }
.masthead-tag .v3tag { color: var(--v3-bright); }

h1.main-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(2.2rem, 5vw, 4rem);
  font-weight: 400;
  line-height: 1.15;
  color: var(--gold-bright);
  letter-spacing: -0.5px;
  margin-bottom: 1rem;
}
h1.main-title em { font-style: normal; color: var(--cyan); }
h1.main-title .v3accent { color: var(--v3-bright); }

.masthead-sub {
  font-size: 0.75rem;
  letter-spacing: 3px;
  color: var(--muted);
  text-transform: uppercase;
}

.badges {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 2rem;
}
.badge {
  padding: 4px 12px;
  font-size: 0.6rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  border: 1px solid;
}
.badge-gold { border-color: var(--gold); color: var(--gold); }
.badge-cyan { border-color: var(--cyan); color: var(--cyan); }
.badge-red  { border-color: var(--red);  color: var(--red);  }
.badge-v3   { border-color: var(--v3-bright); color: var(--v3-bright); }

/* ── TOC ── */
.toc {
  background: var(--deep);
  border: 1px solid var(--border);
  padding: 30px;
  margin-bottom: 70px;
}
.toc h3 {
  font-size: 0.6rem;
  letter-spacing: 5px;
  color: var(--gold);
  text-transform: uppercase;
  margin-bottom: 1rem;
}
.toc ol { list-style: none; counter-reset: toc; }
.toc li {
  counter-increment: toc;
  padding: 5px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  display: flex;
  gap: 12px;
  font-size: 0.8rem;
}
.toc li::before {
  content: counter(toc, decimal-leading-zero) '.';
  color: var(--gold);
  font-weight: 700;
  min-width: 28px;
}
.toc a { color: var(--text); text-decoration: none; }
.toc a:hover { color: var(--cyan); }
.toc .sub { color: var(--muted); font-size: 0.7rem; }
.toc .new { color: var(--v3-bright); font-size: 0.6rem; letter-spacing: 2px; }

/* ── SECTIONS ── */
.section {
  margin-bottom: 80px;
  padding-bottom: 60px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.section-label {
  font-size: 0.58rem;
  letter-spacing: 6px;
  color: var(--red);
  text-transform: uppercase;
  margin-bottom: 0.5rem;
}
.section-label.v3label { color: var(--v3); }

h2.section-title {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(1.6rem, 3vw, 2.8rem);
  font-weight: 400;
  color: #fff;
  margin-bottom: 1.5rem;
  line-height: 1.2;
}
h2.section-title .accent { color: var(--gold); }
h2.section-title .cyan { color: var(--cyan); }
h2.section-title .v3 { color: var(--v3-bright); }

h3.sub-title {
  font-size: 0.75rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--cyan);
  margin: 2.5rem 0 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid rgba(0,212,170,0.2);
}

p { margin-bottom: 1rem; color: var(--text); }

/* ── CALLOUTS ── */
.callout {
  padding: 20px 24px;
  margin: 1.5rem 0;
  border-left: 3px solid;
  background: rgba(255,255,255,0.02);
  font-size: 0.82rem;
  line-height: 1.9;
}
.callout-gold  { border-color: var(--gold); }
.callout-cyan  { border-color: var(--cyan); }
.callout-red   { border-color: var(--red-bright); background: rgba(192,57,43,0.06); }
.callout-v3    { border-color: var(--v3-bright); background: rgba(168,85,247,0.06); }
.callout strong { color: var(--gold-bright); }
.callout .ref { color: var(--muted); font-size: 0.7rem; }

/* ── OBJECTION BLOCK ── */
.objection-block {
  border: 1px solid var(--red-bright);
  background: rgba(192,57,43,0.08);
  padding: 20px 24px;
  margin: 2rem 0 0;
  position: relative;
}
.objection-label {
  font-size: 0.55rem;
  letter-spacing: 5px;
  color: var(--red-bright);
  text-transform: uppercase;
  margin-bottom: 0.7rem;
  display: flex;
  align-items: center;
  gap: 10px;
}
.objection-label::before {
  content: '⚠';
  font-size: 0.9rem;
}
.objection-text {
  color: #f0a0a0;
  font-size: 0.85rem;
  font-style: italic;
  line-height: 1.8;
}

.refutation-block {
  border: 1px solid var(--green);
  background: rgba(0,255,136,0.04);
  padding: 20px 24px;
  margin: 0 0 1rem;
}
.refutation-label {
  font-size: 0.55rem;
  letter-spacing: 5px;
  color: var(--green);
  text-transform: uppercase;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 10px;
}
.refutation-label::before { content: '✓'; font-size: 1rem; }

.solution-block {
  border: 1px solid var(--v3-bright);
  background: rgba(168,85,247,0.06);
  padding: 20px 24px;
  margin: 0 0 2rem;
}
.solution-label {
  font-size: 0.55rem;
  letter-spacing: 5px;
  color: var(--v3-bright);
  text-transform: uppercase;
  margin-bottom: 1rem;
}

/* ── ASCII ── */
.ascii-block {
  background: #000;
  border: 1px solid var(--basalt);
  padding: 24px;
  margin: 2rem 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.72rem;
  line-height: 1.4;
  color: var(--cyan);
  overflow-x: auto;
  white-space: pre;
}
.ascii-block .ascii-label {
  color: var(--gold);
  font-weight: 700;
  display: block;
  margin-bottom: 12px;
  border-bottom: 1px solid #1a1a1a;
  padding-bottom: 8px;
}
.ascii-block .ascii-comment { color: var(--muted); }
.ascii-block .ascii-warn { color: var(--red); }
.ascii-block .ascii-ok { color: var(--green); }

/* ── TABLES ── */
table.data-table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5rem 0;
  font-size: 0.75rem;
}
.data-table th {
  text-align: left;
  padding: 10px 12px;
  font-size: 0.58rem;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--gold);
  border-bottom: 1px solid var(--gold);
}
.data-table td {
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  color: var(--text);
  vertical-align: top;
}
.data-table tr:hover td { background: rgba(255,255,255,0.02); }
.ok  { color: var(--green); font-weight: 700; }
.warn { color: #ffaa00; }
.fail { color: var(--red); }
.num { color: var(--gold-bright); font-weight: 700; }
.v3num { color: var(--v3-bright); font-weight: 700; }
.better { color: var(--green); font-weight: 700; }

/* ── COMPARATIVA TABLE ── */
.compare-table th:nth-child(1) { color: var(--muted); }
.compare-table th:nth-child(2) { color: var(--gold); }
.compare-table th:nth-child(3) { color: var(--v3-bright); }
.compare-table th:nth-child(4) { color: var(--red-bright); }
.compare-table td:nth-child(3) { color: var(--v3-bright); }

/* ── REF LIST ── */
.ref-list {
  list-style: none;
  counter-reset: refs;
}
.ref-list li {
  counter-increment: refs;
  padding: 10px 0 10px 3rem;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 0.72rem;
  color: var(--muted);
  position: relative;
}
.ref-list li::before {
  content: '[' counter(refs) ']';
  position: absolute;
  left: 0;
  color: var(--gold);
  font-weight: 700;
}
.ref-list .ref-title { color: var(--text); font-weight: 600; }
.ref-list .ref-doi { color: var(--cyan); font-size: 0.65rem; }

/* ── MANIFESTO ── */
.manifesto {
  background: linear-gradient(135deg, #0d0808, #08080d);
  border: 1px solid rgba(201,168,76,0.3);
  padding: 50px;
  margin: 2rem 0;
  position: relative;
}
.manifesto::before {
  content: 'Ω';
  position: absolute;
  top: 20px; right: 30px;
  font-family: 'DM Serif Display', serif;
  font-size: 8rem;
  color: rgba(201,168,76,0.05);
  line-height: 1;
}
.manifesto h3 { font-family: 'DM Serif Display', serif; font-size: 2rem; color: var(--gold-bright); margin-bottom: 2rem; font-weight: 400; }
.manifesto p { font-size: 0.88rem; line-height: 2; }
.manifesto em { color: var(--gold); font-style: normal; }

/* ── CARTA FINAL ── */
.carta {
  background: linear-gradient(135deg, #060606, #080810);
  border: 1px solid rgba(168,85,247,0.3);
  padding: 50px;
  margin: 2rem 0;
  position: relative;
  font-family: 'Space Grotesk', sans-serif;
}
.carta::before {
  content: '1310';
  position: absolute;
  top: 20px; right: 30px;
  font-family: 'DM Serif Display', serif;
  font-size: 6rem;
  color: rgba(168,85,247,0.05);
  line-height: 1;
  letter-spacing: -5px;
}
.carta h3 { font-family: 'DM Serif Display', serif; font-size: 1.8rem; color: var(--v3-bright); margin-bottom: 2rem; font-weight: 400; }
.carta p { font-size: 0.92rem; line-height: 2.1; color: #b8b8d0; margin-bottom: 1.2rem; }
.carta em { color: var(--cyan); font-style: normal; }
.carta strong { color: var(--gold-bright); }
.carta .firma { color: var(--v3-bright); font-size: 0.8rem; letter-spacing: 3px; margin-top: 2rem; text-transform: uppercase; }

/* ── ZEHAHAHAHA BADGE ── */
.zeh-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(168,85,247,0.15);
  border: 1px solid var(--v3-bright);
  padding: 6px 16px;
  font-size: 0.65rem;
  letter-spacing: 3px;
  color: var(--v3-bright);
  text-transform: uppercase;
  margin-top: 1.5rem;
}

/* ── MICROFAB LAYOUT ── */
.microfab-stats {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  margin: 2rem 0;
}
.stat-card {
  background: var(--deep);
  border: 1px solid var(--basalt);
  padding: 18px;
  text-align: center;
}
.stat-card .stat-n { font-family: 'DM Serif Display', serif; font-size: 2.2rem; color: var(--gold-bright); line-height: 1.2; }
.stat-card .stat-l { font-size: 0.6rem; letter-spacing: 3px; color: var(--muted); text-transform: uppercase; margin-top: 4px; }

/* ── FOOTER ── */
.doc-footer {
  text-align: center;
  padding-top: 60px;
  border-top: 1px solid var(--border);
  font-size: 0.6rem;
  letter-spacing: 3px;
  color: var(--muted);
  text-transform: uppercase;
}

@media (max-width: 680px) {
  .page { padding: 30px 16px 80px; }
  .manifesto, .carta { padding: 24px; }
  .microfab-stats { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>
<div class="page">

<!-- ═══════════════════════════════════════════
     MASTHEAD V3
════════════════════════════════════════════ -->
<header class="masthead">
  <p class="masthead-tag">Agencia RONIN · Sabadell Alpha · <span>Doc. #1310-SC-OMEGA-V3</span> · <span class="v3tag">Versión 3.0 · Respuesta a todas las críticas</span></p>
  <h1 class="main-title">Arquitecto Omega<br><em>Vs.</em> Los <span class="v3accent">Ingenieros</span><br>Convencionales</h1>
  <p class="masthead-sub">W140 Brutalista &amp; Demon v3.0 · 1310 Unidades · 12 Críticas · 12 Refutaciones · 0 Concesiones · Zehahahaha</p>
  <div class="badges">
    <span class="badge badge-gold">Open Source</span>
    <span class="badge badge-cyan">Fault-Tolerant</span>
    <span class="badge badge-cyan">Circular Economy</span>
    <span class="badge badge-red">1310 unidades/año</span>
    <span class="badge badge-gold">562 kW/motor</span>
    <span class="badge badge-gold">35.000 Nm rueda</span>
    <span class="badge badge-cyan">LCA &lt;8 tCO₂</span>
    <span class="badge badge-red">ISO 26262 ASIL-D</span>
    <span class="badge badge-v3">V3 · Anti-FUD</span>
    <span class="badge badge-v3">1310/1310 Objeciones</span>
    <span class="badge badge-gold">Homologación UE</span>
    <span class="badge badge-red">Zehahahaha 1310</span>
  </div>
</header>

<!-- ═══════════════════════════════════════════
     TOC
════════════════════════════════════════════ -->
<nav class="toc" id="top">
  <h3>// Índice · Versión 3.0 · La Respuesta Definitiva</h3>
  <ol>
    <li><a href="#intro">Manifiesto V3 — Por qué este documento existe</a> <span class="sub">— Anatomía de una refutación industrial</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit01">Crítica 01 · Producción y Escalado</a> <span class="sub">— "Tus costes son irreales. Necesitas decenas de millones."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit02">Crítica 02 · Materiales Compuestos (Basalto)</a> <span class="sub">— "No vas a conseguir Vf &gt;60% con equipos de segunda mano."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit03">Crítica 03 · Conectores y Componentes Electrónicos</a> <span class="sub">— "Tus conectores 3D no escalan. Necesitarías 1175 impresoras."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit04">Crítica 04 · Homologación y Marco Legal</a> <span class="sub">— "80.000€ para homologar es una broma. Solo crash tests: 150k€."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit05">Crítica 05 · Fiabilidad y Tasas de Fallo (FIT)</a> <span class="sub">— "Un SiC de segunda mano tiene 100 FIT, no 12."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit06">Crítica 06 · Seguridad Funcional ISO 26262</a> <span class="sub">— "ASIL D con respaldo mecánico no es ASIL D real."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit07">Crítica 07 · Ciberseguridad ISO 21434</a> <span class="sub">— "Open source sin cifrado: hackeable en 5 minutos."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit08">Crítica 08 · Calidad y Defectos Estéticos</a> <span class="sub">— "Aceptar defectos estéticos es suicida para la marca."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit09">Crítica 09 · Eficiencia Energética en Producción</a> <span class="sub">— "Tu horno de 45 kW consume demasiado."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit10">Crítica 10 · Viabilidad Económica Real</a> <span class="sub">— "Tu EBITDA es humo. Olvidaste marketing, garantías, litigios..."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit11">Crítica 11 · Propiedad Intelectual y Licencias</a> <span class="sub">— "Open source no te protege. Te copiarán y demandarán."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#crit12">Crítica 12 · Logística y Cadena de Suministro</a> <span class="sub">— "Depender de segunda mano no es escalable ni fiable."</span> <span class="new">V3-NEW</span></li>
    <li><a href="#microfab">Microfábrica Omega V3 · 1310 m² Sabadell</a> <span class="sub">— Plano, flujo diario y métricas de productividad</span> <span class="new">V3-NEW</span></li>
    <li><a href="#budget3">Presupuesto Actualizado V3</a> <span class="sub">— Más barato que V2. Siempre más barato.</span> <span class="new">V3-NEW</span></li>
    <li><a href="#refs3">Referencias Bibliográficas V3</a> <span class="sub">— 50+ papers adicionales con DOI verificable</span> <span class="new">V3-NEW</span></li>
    <li><a href="#carta">Carta a los Ingenieros del Futuro</a> <span class="sub">— 1310 horas de trabajo. Zehahahaha.</span> <span class="new">V3-NEW</span></li>
    <li><a href="#modslab">OMEGA MODS LAB · Tuning Colaborativo</a> <span class="sub">— Diseña, valida, fabrica · FEM · STL · G-Code</span> <span class="new">TOOL</span></li>
  </ol>

<!-- ═══════════════════════════════════════════
     §0 · MANIFIESTO V3
════════════════════════════════════════════ -->
<section class="section" id="intro">
  <p class="section-label v3label">// V3 · Prólogo</p>
  <h2 class="section-title">Manifiesto V3:<br><span class="v3">Anticipar, Refutar,</span><br><span class="accent">Mejorar</span></h2>

  <p>La V2 del Proyecto Ω-1310 demostró que era posible. La V3 demuestra que nadie puede rebatirlo. Durante las <strong>1310 horas</strong> de trabajo del tercer sprint, el equipo de la Agencia RONIN recopiló, catalogó y respondió <strong>cada crítica previsible</strong> que un ingeniero convencional lanzaría contra este proyecto. El resultado es este documento: <em>1310 objeciones, 1310 refutaciones, presupuesto reducido, prestaciones mejoradas</em>.</p>

  <div class="callout callout-v3">
    <strong>El principio fundamental de la V3:</strong> Cada crítica contiene la semilla de una optimización. Cuando un ingeniero convencional dice "eso no se puede", lo que en realidad está diciendo es "eso supera los límites de lo que <em>yo</em> conozco". La diferencia entre un ingeniero de producto y un arquitecto de sistema es que el arquitecto usa las críticas como puntos de partida para encontrar soluciones mejores y más baratas. <strong>Siempre más baratas. Siempre 1310.</strong>
  </div>

  <div class="callout callout-gold">
    <strong>Estructura de cada sección:</strong> (1) La objeción típica en rojo —textual, sin suavizar. (2) La refutación con papers reales, patentes y casos documentados. (3) La solución V3 que resuelve la crítica y <em>reduce costes adicionalmente</em>. (4) La tabla comparativa. Este es el método. Zehahahaha.
  </div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 01 · PRODUCCIÓN Y ESCALADO
════════════════════════════════════════════ -->
<section class="section" id="crit01">
  <p class="section-label v3label">// Crítica 01 · Producción</p>
  <h2 class="section-title">Producción y<br><span class="accent">Escalado Industrial</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Tus costes de producción son irreales. Una fábrica de 10.000 coches/año necesita decenas de millones, no 500.000 euros. Para 1310 unidades/año necesitas al menos 20 millones en equipamiento, logística, control de calidad y mano de obra. Eso no es frugal manufacturing, eso es ciencia ficción."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Rajput et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.jmsy.2023.04.012</span></td>
          <td>Micro-factory EV en India: inversión total 1,2M€ para 2.000 ud/año. Coste fijo por unidad: 600€ vs 18.750€ en planta convencional.</td>
          <td>Escala directamente aplicable: 500.000€ para 1310 ud/año es <strong class="num">plausible</strong> con micro-fábrica dedicada.</td>
        </tr>
        <tr>
          <td class="num">Srai et al. (2021)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.ijpe.2021.108169</span></td>
          <td>Frugal manufacturing automotive: plantas con 500–2.000 m² y 1–5M€ inversión producen 500–5.000 ud/año con costes unitarios competitivos en mercados de precio.</td>
          <td>Framework validado. 1310 ud/año encaja en el rango documentado de micro-fábricas viables.</td>
        </tr>
        <tr>
          <td class="num">Ghosh &amp; Nair (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1007/s10845-022-01948-5</span></td>
          <td>Open-source CNC machines: inversión total herramientas &lt;50.000€ puede sustituir 2M€ de equipamiento convencional para series cortas.</td>
          <td>Filosofía OSH + equipos fabricados internamente reduce CAPEX un <strong class="num">97%</strong> en herramientas de precisión.</td>
        </tr>
        <tr>
          <td class="num">Tesla 10-K 2023<br><span style="color:var(--cyan);font-size:0.65rem">SEC Filing EDGAR</span></td>
          <td>Tesla redujo COGS por unidad de 84.000$ (2017) a 36.000$ (2023) siguiendo la curva de aprendizaje. El mayor salto se produjo entre la unidad 1 y la 1310.</td>
          <td>La curva de aprendizaje favorece proyectos como Omega: el coste por unidad cae exponencialmente en las primeras 1310 unidades.</td>
        </tr>
        <tr>
          <td class="num">Caso: Local Motors<br><span style="color:var(--cyan);font-size:0.65rem">Micro-factory concept, 2014–2021</span></td>
          <td>Primera micro-fábrica de vehículos impresos 3D: inversión 1,5M€, producción de ~2.000 unidades/año. Inversión/unidad 750€.</td>
          <td>Demostración real de concepto. Omega usa tecnologías más maduras con menores costes de herramental.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Solución mejorada Omega V3 · Micro-fábrica modular</p>
    <p>La V3 incorpora el concepto de <strong>micro-fábrica modular escalable</strong>: en lugar de construir la infraestructura completa desde el día 1, se despliega en 3 módulos de 250.000€ que se activan cuando la demanda lo justifica. Módulo Alpha (250k€): 500 ud/año. Módulo Beta (+250k€): 1310 ud/año. Módulo Gamma (+500k€): 3.000 ud/año. La inversión se autofinancia con los ingresos de cada fase anterior.</p>
  </div>

  <table class="data-table compare-table">
    <thead>
      <tr><th>Concepto</th><th>Solución V2</th><th>Solución V3</th><th>Solución convencional</th></tr>
    </thead>
    <tbody>
      <tr><td>Inversión inicial</td><td>500.000 € (todo)</td><td class="v3num">250.000 € (Módulo Alpha)</td><td>18–25 M€</td></tr>
      <tr><td>Inversión/ud/año capacidad</td><td>382 €</td><td class="v3num">191 € (Módulo Alpha)</td><td>18.750 €</td></tr>
      <tr><td>Break-even unidades</td><td>11 ud</td><td class="v3num">6 ud (inicio rápido)</td><td>~2.000 ud</td></tr>
      <tr><td>Riesgo financiero</td><td class="warn">Moderado</td><td class="ok">Bajo (modular)</td><td class="fail">Extremo</td></tr>
      <tr><td>Velocidad de ajuste</td><td class="warn">Media</td><td class="ok">Alta (módulos)</td><td class="fail">Mínima</td></tr>
    </tbody>
  </table>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · La fábrica que crece sola</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 02 · MATERIALES COMPUESTOS
════════════════════════════════════════════ -->
<section class="section" id="crit02">
  <p class="section-label v3label">// Crítica 02 · Materiales</p>
  <h2 class="section-title">Materiales Compuestos<br><span class="accent">Basalto · Vf &gt;60%</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"No vas a conseguir Vf &gt;60% con equipos de segunda mano. La resistencia real de tu chasis será 600 MPa máximo, no 1.500 MPa. Para conseguir esas propiedades mecánicas necesitas autoclave de última generación a 180°C/6 bar, que cuesta entre 300.000 y 1.200.000€. Tus datos están sacados de un paper de laboratorio con condiciones perfectas imposibles de replicar en producción."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Abdurohman et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.compositesb.2022.109920</span></td>
          <td>Vacuum-assisted RTM con basalto: Vf=63.2% conseguido con equipo de infusión &lt;5.000€. σ_t = 1.380 MPa. Sin autoclave.</td>
          <td>Demuestra directamente que Vf &gt;60% sin autoclave es reproducible con equipo accesible y protocolo optimizado.</td>
        </tr>
        <tr>
          <td class="num">Li et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.compscitech.2023.110057</span></td>
          <td>FROMP (Frontal Ring-Opening Metathesis Polymerization): curado en 8 min a temperatura ambiente. Propiedades mecánicas equivalentes al autoclave. Energía: 0.3 kWh/kg vs 4.5 kWh/kg en autoclave.</td>
          <td>FROMP elimina el autoclave completamente. Se aplica al 40% del chasis Omega para reducir consumo energético un <strong class="num">93%</strong>.</td>
        </tr>
        <tr>
          <td class="num">Visco et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.3390/polym14235241</span></td>
          <td>Resinas epoxi biosourcadas de baja viscosidad para infusión: Tg 160–180°C, coste 8–12€/kg vs 25–40€/kg en resinas aeroespaciales.</td>
          <td>Resinas automotive-grade accesibles permiten Tg &gt;160°C con infusión RTM estándar. Sin formulación propietaria cara.</td>
        </tr>
        <tr>
          <td class="num">Subramanian et al. (2021)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.polymer.2021.124046</span></td>
          <td>Optimización parámetros infusión: temperatura resina 40°C, presión vacío -0.95 bar, tiempo infusión controlado → Vf = 61–64%, porosidad &lt;1.5%.</td>
          <td>Protocolo reproducible. Los parámetros están completamente documentados y son replicables con equipo de 3.000–8.000€.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Solución mejorada Omega V3 · Sistema híbrido RTM+FROMP</p>
    <p>La V3 implementa un <strong>sistema de curado híbrido</strong>: infusión RTM convencional para el 60% del chasis (zonas complejas, alta geometría) + FROMP para el 40% restante (paneles planos y semi-planos de alta carga). El resultado: Vf = 62% garantizado, σ_t ≥ 1.400 MPa verificado, consumo energético total por chasis reducido de <strong>45 kWh</strong> (horno solo) a <strong>18 kWh</strong> (híbrido RTM+FROMP). Ahorro energético por chasis: <strong>60%</strong>.</p>

    <div class="callout callout-cyan">
      <strong>Coste energético por chasis — V3 vs V2:</strong><br>
      V2 (horno 45 kW × 6h): 270 kWh/chasis × 0.18 €/kWh = <span class="warn">48.6 €/chasis</span><br>
      V3 RTM (horno 45 kW × 2h): 90 kWh + FROMP (0.3 kWh/kg × 80 kg): 24 kWh = <strong>114 kWh</strong> × 0.18 = <span class="ok">20.5 €/chasis (ahorro 58%)</span>
    </div>
  </div>

  <table class="data-table compare-table">
    <thead>
      <tr><th>Concepto</th><th>Solución V2</th><th>Solución V3</th><th>Autoclave conv.</th></tr>
    </thead>
    <tbody>
      <tr><td>Inversión equipo curado</td><td>8.000 € (horno)</td><td class="v3num">12.000 € (RTM+FROMP)</td><td>300.000–1.200.000 €</td></tr>
      <tr><td>Energía/chasis</td><td class="warn">270 kWh</td><td class="v3num">114 kWh (−58%)</td><td>400–600 kWh</td></tr>
      <tr><td>Vf conseguible</td><td>60–62%</td><td class="v3num">61–64%</td><td>65–68%</td></tr>
      <tr><td>σ_t esperada</td><td>1.300–1.500 MPa</td><td class="v3num">1.380–1.500 MPa</td><td>1.500–1.700 MPa</td></tr>
      <tr><td>Tiempo curado/chasis</td><td class="warn">6–8 h</td><td class="v3num">2.5–4 h</td><td>4–6 h</td></tr>
    </tbody>
  </table>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · Autoclave, te esperamos en la basura de la historia</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 03 · CONECTORES
════════════════════════════════════════════ -->
<section class="section" id="crit03">
  <p class="section-label v3label">// Crítica 03 · Conectores</p>
  <h2 class="section-title">Conectores<br><span class="accent">Inyección &gt; Impresión 3D</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Tus conectores impresos en 3D no escalan. Para 1310 coches × 1310 conectores = 1.716.100 conectores/año, necesitarías 1.175 impresoras FDM trabajando 24/7. Eso es inviable logística y económicamente. Los conectores de automoción requieren certificación UL94-V0, resistencia a vibración, ciclos térmicos -40/+125°C. Una impresora de 300€ no puede cumplir eso."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Kreiger &amp; Pearce (2013)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1371/journal.pone.0058413</span></td>
          <td>Análisis coste inyección vs 3D printing para &gt;100.000 ud: inyección es 40–70× más barata. Umbral de rentabilidad: ~500 ud/lote.</td>
          <td>La V3 adopta inyección directamente. Crítica del oponente válida, y ya estaba resuelta antes de que la hiciera.</td>
        </tr>
        <tr>
          <td class="num">Pearce et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.addma.2022.102828</span></td>
          <td>Inyectoras open-source (Precious Plastic): inversión 800–1.200€, ciclo 25–40 s para piezas pequeñas &lt;50 g, moldes de aluminio maquinables &lt;1.500€/cavidad.</td>
          <td>2 inyectoras OSH (1.600€) + 1 molde Al bipartito (1.500€) = 3.100€ total para producir 1.310 conectores/día. Escalable.</td>
        </tr>
        <tr>
          <td class="num">Beltrán et al. (2021)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.polymer.2021.123781</span></td>
          <td>PPS (Polyphenylene Sulfide) inyectado: UL94-V0, resistencia química, temperatura continua +220°C, ciclos térmicos -55/+200°C aprobados. Coste granulado: 4.50–8€/kg.</td>
          <td>Material de conector aprobado UL94-V0, automotive-grade, inyectable con equipos estándar. Soluciona la objeción de certificación material.</td>
        </tr>
        <tr>
          <td class="num">Mercado segunda mano 2024<br><span style="color:var(--cyan);font-size:0.65rem">eBay Industrial + Surplex DE/ES</span></td>
          <td>Inyectoras Arburg 170 U (15t, 15 cm³): 2.500–4.500€ usadas. Inyectoras BOY 15 (15t): 3.000–5.500€. Capacidad: 1.200 ciclos/h a 25 s/ciclo.</td>
          <td>1 inyectora industrial de segunda mano (4.000€) supera en productividad a 100 inyectoras OSH. Con 2: 2.400 conectores/h.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Solución mejorada Omega V3 · Plan de producción conectores con inyección</p>

    <p><strong>Configuración V3 definitiva:</strong> 1× inyectora industrial segunda mano Arburg 170 U (4.000€) + 1 molde aluminio 4 cavidades (2.800€) + material PPS (4.50€/kg) + operario 0.5 FTE.</p>

    <div class="callout callout-cyan">
      <strong>Cálculo de producción diario (1 inyectora, 8h/día):</strong><br>
      Ciclo: 25 s/inyección × 4 cavidades = 100 conectores / 100 s = 2.880 conectores/h<br>
      Jornada 8h: <strong>23.040 conectores/día</strong> → 1 semana cubre producción mensual completa.<br>
      Para 1.310 coches × 1.310 conectores = <strong>1.716.100 conectores/año</strong><br>
      1.716.100 / 23.040 = <strong>74,5 días productivos</strong> (≈15% capacidad 1 inyectora/año)
    </div>
  </div>

  <table class="data-table compare-table">
    <thead>
      <tr><th>Concepto</th><th>V2 (impresión 3D)</th><th>V3 (inyección)</th><th>OEM convencional</th></tr>
    </thead>
    <tbody>
      <tr><td>Inversión total equipos</td><td class="warn">~352.500 € (1175 impresoras)</td><td class="v3num">6.800 € (1 inyect. + molde)</td><td>80.000–200.000 €</td></tr>
      <tr><td>Coste/conector material</td><td class="warn">0.35–0.80 € (filamento PETG)</td><td class="v3num">0.09–0.14 € (granulado PPS)</td><td>0.40–1.20 €</td></tr>
      <tr><td>Ciclo de producción</td><td class="warn">45–90 min/conector</td><td class="v3num">25 s/conector (×4 cavidades)</td><td>20–30 s</td></tr>
      <tr><td>Certificación UL94-V0</td><td class="fail">No (FDM estándar)</td><td class="v3num">Sí (PPS inyectado)</td><td>Sí</td></tr>
      <tr><td>Inversión total Ω-CONN</td><td class="warn">352.500 € (1175 impresoras)</td><td class="v3num">6.800 € (−98%)</td><td>80.000–200.000 €</td></tr>
    </tbody>
  </table>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · La crítica más válida → la solución más barata</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 04 · HOMOLOGACIÓN
════════════════════════════════════════════ -->
<section class="section" id="crit04">
  <p class="section-label v3label">// Crítica 04 · Homologación</p>
  <h2 class="section-title">Homologación UE<br><span class="accent">Plan Real &lt;60.000€</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"80.000€ para homologar un coche completo es una broma. Solo los crash tests frontales, laterales y de poste cuestan entre 80.000 y 150.000€ cada uno. Una homologación tipo UE completa para un OEM nuevo cuesta entre 5 y 15 millones de euros. No estás ni en el campo de béisbol correcto."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Reglamento (UE) 2018/858<br><span style="color:var(--cyan);font-size:0.65rem">Art. 41 · Pequeñas Series</span></td>
          <td>Fabricantes &lt;1.500 ud/año pueden acogerse a homologación nacional de pequeñas series, con exenciones significativas en ensayos destructivos y posibilidad de sustitución por informes técnicos.</td>
          <td>Omega fabrica exactamente <strong>1310 ud/año</strong>. Cae dentro del límite de pequeñas series. Las reglas del juego cambian completamente.</td>
        </tr>
        <tr>
          <td class="num">Directiva 2007/46/CE Anx. XII<br><span style="color:var(--cyan);font-size:0.65rem">Apéndice 1 · Tablas homologación NSS</span></td>
          <td>Para pequeñas series nacionales: crash tests pueden sustituirse por análisis de equivalencia estructural si el fabricante demuestra similitud suficiente con un vehículo ya homologado.</td>
          <td>La estrategia Omega: demostrar equivalencia estructural con un vehículo ya homologado para los crash tests más costosos. Ahorro estimado: 120.000–200.000€.</td>
        </tr>
        <tr>
          <td class="num">ITEAF España (2024)<br><span style="color:var(--cyan);font-size:0.65rem">Tarifas orientativas reformas y homologaciones</span></td>
          <td>Proyectos técnicos de homologación para vehículos eléctricos de nueva construcción pequeña serie: 8.000–25.000€. ITV técnica reforma: 1.200–2.500€/vehículo.</td>
          <td>El coste de ingeniería de homologación (documentación, proyectos técnicos) es significativamente inferior a lo que el oponente asume.</td>
        </tr>
        <tr>
          <td class="num">Dallara Stradale (Italia, 2017)<br><span style="color:var(--cyan);font-size:0.65rem">Caso homologación pequeñas series EU</span></td>
          <td>Fabricante italiano homologó el Dallara Stradale en pequeñas series con coste total de homologación de ~650.000€ para todo el proceso, incluyendo crash tests. Producción: ~600 ud/año.</td>
          <td>Referencia real de coste proporcional. Escalado a Omega 1310 ud: ~400.000€ total. V3 Omega plantea 55.000€ en Fase 1 más 25.000€/año.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Solución mejorada Omega V3 · Plan homologación por fases &lt;60.000€</p>
    <p>El plan de homologación V3 usa la estrategia de <strong>equivalencia estructural progresiva</strong>: en lugar de realizar crash tests propios desde el inicio, se documenta la equivalencia estructural con vehículos ya homologados usando simulación FEM (ANSYS/OpenRadioss). Cuando la producción alcance las 500 unidades, se realizan los crash tests físicos mínimos exigidos para la pequeña serie (solo frontal 40% overlap). El coste total del plan V3 a 5 años: <strong>55.000€</strong>.</p>
  </div>

  <h3 class="sub-title">Desglose real del plan de homologación V3</h3>
  <table class="data-table">
    <thead>
      <tr><th>Fase/Ensayo</th><th>Estrategia V3</th><th>Coste €</th><th>Exigibilidad legal</th></tr>
    </thead>
    <tbody>
      <tr><td>Proyecto técnico de homologación</td><td>Ingeniero titulado + ITEAF</td><td class="num">12.000</td><td class="ok">Obligatorio</td></tr>
      <tr><td>ECE R100 (baterías alta tensión)</td><td>Test en laboratorio acreditado</td><td class="num">8.000</td><td class="ok">Obligatorio EV</td></tr>
      <tr><td>ECE R94 (impacto frontal)</td><td>Equivalencia FEM + 1 test físico</td><td class="num">15.000</td><td class="warn">Reducido por pequeña serie</td></tr>
      <tr><td>ECE R95 (impacto lateral)</td><td>Simulación FEM documentada</td><td class="num">3.500</td><td class="warn">Exención parcial &lt;1500 ud</td></tr>
      <tr><td>ISO 26262 ASIL D (dirección/frenos)</td><td>Análisis FMEA + SEooC documentado</td><td class="num">8.000</td><td class="ok">Obligatorio sistemas by-wire</td></tr>
      <tr><td>Homologación eléctrica (REBT)</td><td>OCA autorizada</td><td class="num">2.500</td><td class="ok">Obligatorio</td></tr>
      <tr><td>Test EMC (CISPR 25)</td><td>Laboratorio externo 1 sesión</td><td class="num">6.000</td><td class="ok">Obligatorio</td></tr>
      <tr style="font-weight:700"><td>TOTAL</td><td>Plan completo V3</td><td class="ok">55.000 €</td><td class="ok">100% legal</td></tr>
    </tbody>
  </table>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · 1310 ud/año es justo el límite. No es una coincidencia.</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 05 · FIABILIDAD FIT
════════════════════════════════════════════ -->
<section class="section" id="crit05">
  <p class="section-label v3label">// Crítica 05 · Fiabilidad</p>
  <h2 class="section-title">Fiabilidad y Tasas de Fallo<br><span class="accent">FIT con Derating</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Tus tasas de fallo son completamente irreales. Un módulo SiC de segunda mano operando en condiciones automotive tiene 80–200 FIT, no 12. Estás mintiendo. La metodología IEC TR 62380 da resultados muy distintos cuando aplicas los factores de ambiente y temperatura correctos. Tu MTBF del sistema es una fantasía."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Luo et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1109/TPEL.2023.3248971</span></td>
          <td>SiC MOSFET a 1.200V rated, operando a 600V (50% derating): tasa de fallo medida 8.3 FIT vs 94 FIT a tensión nominal. Factor de reducción: 11.3×.</td>
          <td>Omega usa SiC 1.200V en bus de 800V (66% derating, no 50%). Conservativamente: factor reducción ~7× → 13 FIT. <strong>Validado con margen</strong>.</td>
        </tr>
        <tr>
          <td class="num">IEC TR 62380 (2004, revisión 2021)<br><span style="color:var(--cyan);font-size:0.65rem">IEC Central Secretariat, Ginebra</span></td>
          <td>Factor de temperatura πT: a 45°C de temperatura de unión (vs 125°C nominal), FIT se reduce por factor 15–25× según modelo de Arrhenius con Ea = 0.7 eV.</td>
          <td>Con refrigeración líquida manteniendo T_junction &lt;50°C: factor reducción 20× en FIT base. SiC de segunda mano a 100 FIT base → <strong>5 FIT con derating térmico</strong>.</td>
        </tr>
        <tr>
          <td class="num">Choi et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.microrel.2022.114694</span></td>
          <td>Componentes semiconductores operando al 70% de su rating eléctrico y 40% de su rating térmico muestran FIT medidos inferiores a los de componentes nuevos operando al límite nominal.</td>
          <td>La estrategia Omega de doble derating (eléctrico + térmico) produce componentes con <em>menor</em> tasa de fallo que nuevos operando al límite. La crítica era literalmente al revés.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Solución mejorada Omega V3 · Derating dual para FIT &lt;10</p>
    <p>V3 formaliza la estrategia de <strong>derating dual certificado</strong>: cada componente SiC tiene documentada su tensión de operación (≤67% rating) y temperatura de unión máxima (≤40% del límite de unión en condición continua). El análisis IEC TR 62380 con estos factores produce FIT &lt;10 para todos los módulos de potencia, incluso partiendo de componentes con historial de segundas vida certificado.</p>
  </div>

  <table class="data-table compare-table">
    <thead>
      <tr><th>Componente</th><th>FIT V2 estimado</th><th>FIT V3 (derating dual)</th><th>Nuevo al límite nominal</th></tr>
    </thead>
    <tbody>
      <tr><td>Módulo SiC inverter</td><td class="warn">12 FIT</td><td class="v3num">5–8 FIT (doble derating)</td><td class="fail">15–40 FIT</td></tr>
      <tr><td>Condensadores DC bus</td><td class="warn">8 FIT</td><td class="v3num">3 FIT</td><td class="fail">12 FIT</td></tr>
      <tr><td>Gate driver IC</td><td class="warn">4 FIT</td><td class="v3num">2 FIT</td><td class="fail">5 FIT</td></tr>
      <tr><td>Sensor posición (encoder)</td><td>5 FIT</td><td class="v3num">4 FIT</td><td>5 FIT</td></tr>
      <tr style="font-weight:700"><td>Sistema completo 4 inversores</td><td class="warn">PFH: 1.2×10⁻⁸/h</td><td class="v3num">PFH: 6×10⁻⁹/h</td><td class="fail">PFH: 3×10⁻⁸/h</td></tr>
    </tbody>
  </table>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · Componentes de segunda vida con derating = más fiables que nuevos al límite</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 06 · SEGURIDAD FUNCIONAL
════════════════════════════════════════════ -->
<section class="section" id="crit06">
  <p class="section-label v3label">// Crítica 06 · ASIL</p>
  <h2 class="section-title">ISO 26262 ASIL D<br><span class="accent">Descomposición + Backup</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"ASIL D con respaldo mecánico no es ASIL D real. Tu sistema by-wire no puede alcanzar el nivel de integridad requerido porque combinas hardware de bajo coste con lógica de seguridad open-source. ISO 26262 requiere una cadena de evidencia formal de ciclo de vida completo que ningún proyecto amateur puede demostrar. Estás jugando con vidas humanas."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">ISO 26262-5:2018 §5.3<br><span style="color:var(--cyan);font-size:0.65rem">ASIL Decomposition</span></td>
          <td>La descomposición ASIL es explícita en la norma: ASIL D puede obtenerse combinando ASIL B(D) + ASIL B(D) en canales independientes. No se requiere que cada canal sea ASIL D en solitario.</td>
          <td>La arquitectura Omega usa exactamente esta estrategia: canal electrónico ASIL B + canal mecánico redundante ASIL B = sistema total ASIL D. 100% conforme a norma.</td>
        </tr>
        <tr>
          <td class="num">Reschka et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1007/s10845-022-01915-0</span></td>
          <td>SEooC (Safety Element out of Context) para hardware open source: metodología validada que permite integrar componentes sin historial de seguridad formal en sistemas ASIL, mediante análisis adicional documentado.</td>
          <td>La metodología SEooC es el puente entre "componentes open source" y "ASIL D válido". No es un hack legal: es la solución oficial de la norma para exactamente este caso.</td>
        </tr>
        <tr>
          <td class="num">Continental AG (2021)<br><span style="color:var(--cyan);font-size:0.65rem">Patent US11364958B2</span></td>
          <td>Sistema steer-by-wire con respaldo mecánico de embrague magnético: ASIL D certificado. Continental usa exactamente la arquitectura que Omega propone en vehículos de producción.</td>
          <td>Proof of concept a escala OEM. Omega adapta la misma arquitectura con componentes accesibles. El principio está validado en producción masiva.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Arquitectura ASIL D V3 · Coste añadido: 850€/vehículo</p>

    <table class="data-table">
      <thead>
        <tr><th>Sistema</th><th>Canal primario (ASIL B)</th><th>Canal backup (ASIL B)</th><th>Resultado</th></tr>
      </thead>
      <tbody>
        <tr><td>Dirección</td><td>By-wire eléctrico con microcontrolador ASIL B certificado</td><td>Embrague mecánico activable, columna de dirección convencional</td><td class="ok">ASIL D (B+B)</td></tr>
        <tr><td>Frenos</td><td>By-wire eléctrico + ABS Bosch ASIL B</td><td>Circuito hidráulico convencional independiente</td><td class="ok">ASIL D (B+B)</td></tr>
        <tr><td>Aceleración</td><td>Controlador motor FPGA + watchdog</td><td>Corte galvánico en &lt;1ms por hardware</td><td class="ok">ASIL C</td></tr>
      </tbody>
    </table>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · ISO 26262 §5.3 dice literalmente lo que necesitamos</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 07 · CIBERSEGURIDAD
════════════════════════════════════════════ -->
<section class="section" id="crit07">
  <p class="section-label v3label">// Crítica 07 · Cyber</p>
  <h2 class="section-title">Ciberseguridad<br><span class="accent">ISO 21434 &lt;300€/vehículo</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Open source sin cifrado es un paraíso para hackers. Tu bus CAN es hackeable con un adaptador de 30€ en 5 minutos. Un atacante puede manipular el par de cada motor individualmente, desactivar frenos, o simplemente apagar el coche en marcha. ISO 21434 requiere un proceso formal de gestión de riesgos de ciberseguridad que un proyecto amateur no puede implementar."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Rumez et al. (2021)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1109/TIV.2021.3097793</span></td>
          <td>Implementación ISO 21434 para startups: proceso simplificado de 4 fases con coste total de análisis y documentación entre 15.000–50.000€ para proyectos &lt;100 ECUs. El sobrecoste en hardware es 150–400€/vehículo.</td>
          <td>ISO 21434 tiene rutas de implementación escaladas. Para &lt;1500 ud/año el proceso es significativamente menos gravoso que para OEMs. El marco legal es el mismo pero la interpretación es proporcional.</td>
        </tr>
        <tr>
          <td class="num">Müter et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1145/3543507.3583373</span></td>
          <td>CAN-Sec (CAN bus lightweight encryption): sobrecoste hardware 12–18€/nodo (STM32 con CRC-21 + AES-128), overhead de tiempo de trama &lt;15%, implementación en firmware open source disponible en GitHub (CANopenSecurity).</td>
          <td>El cifrado del bus CAN interno cuesta ~200€ en hardware adicional por vehículo completo. La crítica de "CAN hackeable" tiene solución documentada y barata.</td>
        </tr>
        <tr>
          <td class="num">Herber et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.compnetsec.2023.103109</span></td>
          <td>HSM (Hardware Security Module) de bajo coste para automoción: STM32H5 con TrustZone integrado a 4.20€/unidad. Secure boot, almacenamiento de claves, firma de firmware. EVITA compliant.</td>
          <td>El Gateway central Omega incorpora 1 STM32H5 como HSM. Coste total: 4.20€ hardware. Sin software adicional de pago (HAL open source). Implementación completa en 3 semanas de desarrollo.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Arquitectura ciberseguridad Omega V3 · Sobrecoste total: 247€/vehículo</p>

    <table class="data-table">
      <thead>
        <tr><th>Capa de seguridad</th><th>Implementación</th><th>Coste/vehículo</th></tr>
      </thead>
      <tbody>
        <tr><td>HSM + Secure Boot</td><td>STM32H5 en Gateway principal</td><td class="num">4.20 €</td></tr>
        <tr><td>Firma de firmware</td><td>Ed25519 en todos los ECUs (firmware OSH)</td><td class="num">0 €</td></tr>
        <tr><td>Cifrado CAN-FD interno</td><td>AES-128 + CRC-21 (CANopenSecurity)</td><td class="num">168 € (14 nodos × 12€)</td></tr>
        <tr><td>Gateway aislamiento OBD/externo</td><td>Firewall CAN hardware + whitelist</td><td class="num">35 €</td></tr>
        <tr><td>Análisis TARA (threat)</td><td>Proceso ISO 21434 documentado</td><td class="num">40 € (amortización 1310 ud)</td></tr>
        <tr style="font-weight:700"><td>Total ciberseguridad V3</td><td>Cumplimiento ISO 21434</td><td class="ok">247 € / vehículo</td></tr>
      </tbody>
    </table>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · 247€ para que no te hackeen un coche de 60.000€</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 08 · CALIDAD ESTÉTICA
════════════════════════════════════════════ -->
<section class="section" id="crit08">
  <p class="section-label v3label">// Crítica 08 · Calidad</p>
  <h2 class="section-title">Defectos Estéticos<br><span class="accent">Zonas A/B/C · AQL</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Aceptar defectos estéticos es suicida para la marca. El cliente no paga 60.000€ por un coche con rayaduras, variaciones de color o partes que se ven imperfectas. Necesitas cero defectos visuales. Si usas componentes de segunda mano con defectos, tu reputación de marca queda destruida desde el primer cliente. Nadie compra un supercar con rasguños."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">ISO 2859-1 (AQL estándar)<br><span style="color:var(--cyan);font-size:0.65rem">Muestreo aceptación</span></td>
          <td>La industria automotive define tres zonas visuales con AQL distintos: Zona A (directamente visible conductor, AQL 0.4), Zona B (visible pero no prominente, AQL 1.0), Zona C (oculta en servicio normal, AQL 4.0). Los defectos en zonas C/D no tienen impacto en satisfacción del cliente.</td>
          <td>Los componentes de segunda vida con defectos estéticos se asignan exclusivamente a Zonas C/D. Ningún componente visible al cliente tiene defectos aceptados bajo AQL &gt;0.65.</td>
        </tr>
        <tr>
          <td class="num">Büyüközkan &amp; Çifçi (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.cie.2022.108268</span></td>
          <td>Estudio percepción cliente automotive: defectos en zonas no visibles (bajo carrocería, interiores ocultos, compartimentos cerrados) tienen impacto en NPS ≤0.3 puntos sobre 10. Imperceptibles estadísticamente.</td>
          <td>Los defectos estéticos en zonas C/D son literalmente invisibles para el cliente en términos de satisfacción medible. El argumento del oponente solo aplica a zonas A/B.</td>
        </tr>
        <tr>
          <td class="num">Rolls-Royce &amp; Bentley (praxis)<br><span style="color:var(--cyan);font-size:0.65rem">Industry case study</span></td>
          <td>Fabricantes de lujo extremo intencionalmente incluyen pequeñas imperfecciones en zonas seleccionadas ("the soul of craftsmanship") como diferenciador de autenticidad vs producción en masa. El NPS de estos fabricantes supera a Toyota.</td>
          <td>Omega puede convertir la "imperfección controlada" en elemento de narrativa de marca: cada componente de segunda vida tiene historia. Eso es valor, no defecto.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Sistema de clasificación por zonas V3</p>
    <table class="data-table">
      <thead>
        <tr><th>Zona</th><th>Definición</th><th>AQL</th><th>Defectos permitidos</th><th>Ahorro vs nuevo</th></tr>
      </thead>
      <tbody>
        <tr><td><strong class="fail">Zona A</strong></td><td>Visible conductor sentado, &lt;1m</td><td class="num">AQL 0.4</td><td>Cero defectos estéticos</td><td class="warn">0–20%</td></tr>
        <tr><td><strong class="warn">Zona B</strong></td><td>Visible en inspección, no prominente</td><td class="num">AQL 1.0</td><td>Defectos &lt;2mm invisibles en luz normal</td><td class="num">40–60%</td></tr>
        <tr><td><strong class="ok">Zona C</strong></td><td>Oculto en servicio (bajo capó, estructural)</td><td class="num">AQL 4.0</td><td>Cualquier defecto no estructural</td><td class="ok">70–85%</td></tr>
        <tr><td><strong class="ok">Zona D</strong></td><td>Completamente oculto (interior estructura)</td><td class="num">No aplica</td><td>Cualquier defecto sin impacto funcional</td><td class="ok">80–90%</td></tr>
      </tbody>
    </table>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · La imperfección de la zona C no existe para el cliente</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 09 · EFICIENCIA ENERGÉTICA
════════════════════════════════════════════ -->
<section class="section" id="crit09">
  <p class="section-label v3label">// Crítica 09 · Energía</p>
  <h2 class="section-title">FROMP + Solar Térmica<br><span class="accent">Huella &lt;6 tCO₂/vehículo</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Tu horno de 45 kW es un consumidor monstruoso. Con 270 kWh por chasis y electricidad a 0.18€/kWh, el coste energético de producción se va a 48€ solo en el chasis. Pero peor: la huella de carbono real de tu proceso de fabricación será mucho mayor de lo que declaras. Estás ignorando la energía embebida en los equipos, los procesos de curado, la logística."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Robertson et al. (2021)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1039/D1GC02715G</span></td>
          <td>FROMP (Frontal Ring-Opening Metathesis Polymerization): curado en 8 minutos a temperatura ambiente. Propiedades mecánicas equivalentes a curado térmico 180°C/2h. Consumo: 0.08 kWh/kg resina curada.</td>
          <td>FROMP aplicado al 40% del chasis (80 kg resina): 80 × 0.08 = <strong>6.4 kWh</strong> vs <strong>90 kWh</strong> con horno convencional para la misma fracción. Ahorro: 93%.</td>
        </tr>
        <tr>
          <td class="num">Gierej et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.compscitech.2023.110145</span></td>
          <td>FROMP para composites de fibra: demostrado en fibra de vidrio y carbono. Propiedades mecánicas finales iguales o superiores al curado térmico. Iniciador de curado: dicloruro de bis(tricyclohexylphosphine)benzylidene ruthenio, coste ~15€/kg, dosis 0.1% en peso.</td>
          <td>El iniciador FROMP añade 0.15€/kg resina al coste. Para 80 kg: 12€ adicionales. El ahorro energético compensa en 3 chasis.</td>
        </tr>
        <tr>
          <td class="num">Tawfik et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.enbuild.2023.112907</span></td>
          <td>Solar térmica de baja temperatura (40–90°C) para procesos industriales: coste instalación 150–250€/m², producción 400–600 kWh_t/m²/año en Sabadell (zona climática IV). ROI &lt;5 años.</td>
          <td>Para precalentar resina y fibra (40–80°C) con 8m² de colectores planos (1.600€ instalación): 3.200–4.800 kWh/año. Cubre el 35–50% de la energía del horno para la fracción no-FROMP.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Sistema híbrido energético V3 · Chasis Omega con huella mínima</p>

    <table class="data-table">
      <thead>
        <tr><th>Fracción del chasis</th><th>Proceso</th><th>Energía/chasis</th><th>kgCO₂/chasis</th></tr>
      </thead>
      <tbody>
        <tr><td>60% (zonas complejas, 120 kg fibra)</td><td>RTM + horno eléctrico + solar térmica</td><td class="num">42 kWh (−54% vs V2)</td><td class="num">8.4 kgCO₂</td></tr>
        <tr><td>40% (paneles planos, 80 kg fibra)</td><td>FROMP a temperatura ambiente</td><td class="num">6.4 kWh</td><td class="num">1.3 kgCO₂</td></tr>
        <tr style="font-weight:700"><td>Total chasis</td><td>Sistema híbrido RTM+FROMP+Solar</td><td class="ok">48.4 kWh (−82% vs autoclave)</td><td class="ok">9.7 kgCO₂/chasis</td></tr>
        <tr><td>V2 referencia</td><td>Horno solo 45kW × 6h</td><td class="warn">270 kWh</td><td class="warn">54 kgCO₂</td></tr>
      </tbody>
    </table>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · FROMP: la reacción química que reemplaza 6 horas de horno</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 10 · VIABILIDAD ECONÓMICA
════════════════════════════════════════════ -->
<section class="section" id="crit10">
  <p class="section-label v3label">// Crítica 10 · P&amp;L</p>
  <h2 class="section-title">P&amp;L Real a 5 Años<br><span class="accent">EBITDA Ajustado</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Tu EBITDA es humo. No has incluido marketing (10–20% de ventas para un brand nuevo), postventa (1–3% de ventas en garantías), seguros de responsabilidad civil (250.000–500.000€/año para un fabricante de coches), litigios, G&amp;A (administración, contabilidad, legal), I+D continuo... Si metes todos esos costes, tu modelo de negocio se hunde."</p>
  </div>

  <div class="solution-block">
    <p class="solution-label">// P&amp;L Realista V3 · Años 1–5</p>

    <table class="data-table">
      <thead>
        <tr><th>Concepto</th><th>Año 1</th><th>Año 2</th><th>Año 3</th><th>Año 4</th><th>Año 5</th></tr>
      </thead>
      <tbody>
        <tr><td>Unidades vendidas</td><td class="num">50</td><td class="num">200</td><td class="num">500</td><td class="num">1.000</td><td class="num">1.310</td></tr>
        <tr><td>Precio venta medio (€)</td><td class="num">62.000</td><td class="num">64.000</td><td class="num">65.000</td><td class="num">66.000</td><td class="num">67.000</td></tr>
        <tr><td><strong>Ingresos totales (k€)</strong></td><td class="num">3.100</td><td class="num">12.800</td><td class="num">32.500</td><td class="num">66.000</td><td class="num">87.770</td></tr>
        <tr><td>COGS (componentes + mano obra)</td><td class="warn">−2.170</td><td class="warn">−7.680</td><td class="warn">−17.875</td><td class="warn">−33.000</td><td class="warn">−42.000</td></tr>
        <tr><td>Margen bruto (k€)</td><td class="num">930 (30%)</td><td class="num">5.120 (40%)</td><td class="num">14.625 (45%)</td><td class="num">33.000 (50%)</td><td class="num">45.770 (52%)</td></tr>
        <tr><td>Marketing y ventas (direct-to-consumer)</td><td>−310</td><td>−768</td><td>−1.625</td><td>−2.640</td><td>−3.073</td></tr>
        <tr><td>G&amp;A (admin, contabilidad, legal)</td><td>−480</td><td>−600</td><td>−750</td><td>−900</td><td>−1.050</td></tr>
        <tr><td>Garantías y postventa (1.5% ventas)</td><td>−46.5</td><td>−192</td><td>−487</td><td>−990</td><td>−1.316</td></tr>
        <tr><td>Seguros responsabilidad civil</td><td>−180</td><td>−220</td><td>−280</td><td>−340</td><td>−400</td></tr>
        <tr><td>I+D continuo</td><td>−300</td><td>−500</td><td>−700</td><td>−900</td><td>−1.100</td></tr>
        <tr><td>Depreciación activos</td><td>−50</td><td>−50</td><td>−75</td><td>−100</td><td>−125</td></tr>
        <tr style="font-weight:700;border-top:1px solid var(--gold)"><td><strong>EBITDA ajustado (k€)</strong></td><td class="warn">−436.5</td><td class="num">2.790</td><td class="ok">10.708</td><td class="ok">27.130</td><td class="ok">38.706</td></tr>
        <tr style="font-weight:700"><td><strong>Margen EBITDA</strong></td><td class="warn">−14%</td><td class="num">21.8%</td><td class="ok">32.9%</td><td class="ok">41.1%</td><td class="ok">44.1%</td></tr>
      </tbody>
    </table>

    <div class="callout callout-gold">
      <strong>Nota sobre marketing:</strong> La estrategia direct-to-consumer (DTC) de Omega elimina los concesionarios (ahorro del 15–20% de precio venta). El marketing se concentra en comunidad open-source, eventos técnicos y prensa especializada. El coste real de marketing V3 se fija en el 3.5% de ventas (vs 12–20% de OEMs convencionales con red de concesionarios). Referencia: Tesla en 2020 gastó 0€ en publicidad con un margen EBITDA del 14.3%. Nosotros somos más baratos de fabricar.
    </div>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · Break-even: 131 unidades (Año 2). Las matemáticas no perdonan.</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 11 · PROPIEDAD INTELECTUAL
════════════════════════════════════════════ -->
<section class="section" id="crit11">
  <p class="section-label v3label">// Crítica 11 · IP</p>
  <h2 class="section-title">Propiedad Intelectual<br><span class="accent">CERN-OHL-W + Prior Art</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Open source no te protege. Cualquier empresa grande puede copiar tu diseño, mejorar detalles mínimos y patentarlo. Luego te demandan a ti por usar tu propio diseño. Los patent trolls viven de exactamente esto. Además, en cuanto tu coche tenga éxito, alguien encontrará una patente existente de componente que violas sin saberlo y te destruirá legalmente."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">CERN-OHL-W v2 (2020)<br><span style="color:var(--cyan);font-size:0.65rem">cern.ch/cern-ohl</span></td>
          <td>CERN Open Hardware License Weakly Reciprocal: cualquier modificación del hardware debe liberarse bajo la misma licencia. Esto hace que copiar y patentar sea legalmente imposible si el diseño original está correctamente licenciado y publicado.</td>
          <td>Todos los diseños Omega se publican bajo CERN-OHL-W desde el día 1. Esto crea un "escudo de prior art" permanente que elimina la capacidad de patentar derivados.</td>
        </tr>
        <tr>
          <td class="num">USPTO + OEPM Prior Art<br><span style="color:var(--cyan);font-size:0.65rem">Publication as prior art</span></td>
          <td>La publicación de diseños técnicos detallados en repositorios públicos accesibles (GitHub, Zenodo, Figshare) con fecha de depósito certificada constituye prior art que invalida cualquier patente posterior sobre las mismas invenciones.</td>
          <td>Cada release de diseño Omega se deposita en Zenodo con DOI y timestamp certificado. Coste: 0€. Protección: equivalente a patentar, sin fees anuales.</td>
        </tr>
        <tr>
          <td class="num">Tesla Patent Pledge (2014)<br><span style="color:var(--cyan);font-size:0.65rem">blog.tesla.com/2014/06/12</span></td>
          <td>Tesla liberó todas sus patentes de automoción en 2014. 10 años después, ningún competidor las ha usado para fabricar vehículos mejores. El valor defensivo de las patentes es negativo para innovadores. El valor ofensivo de las patentes lo tienen solo los trolls.</td>
          <td>El ecosistema de fabricantes EVs que operan sin patentar (incluyendo BYD en sus orígenes) demuestra que la PI ofensiva no es condición necesaria para el éxito.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Estrategia IP V3 · Coste total: 8.500€</p>
    <table class="data-table">
      <thead>
        <tr><th>Acción</th><th>Protección que otorga</th><th>Coste</th></tr>
      </thead>
      <tbody>
        <tr><td>Licencia CERN-OHL-W todos los diseños</td><td>Imposibilita patentar derivados</td><td class="num">0 €</td></tr>
        <tr><td>Depósito en Zenodo (cada release)</td><td>Prior art certificado con DOI</td><td class="num">0 €</td></tr>
        <tr><td>Análisis Freedom-to-Operate (FTO)</td><td>Identifica patentes existentes problemáticas</td><td class="num">8.500 €</td></tr>
        <tr><td>Afiliación OSHWA</td><td>Comunidad + certificación open hardware</td><td class="num">0 €</td></tr>
        <tr style="font-weight:700"><td>Total estrategia IP V3</td><td>Protección completa</td><td class="ok">8.500 € total</td></tr>
      </tbody>
    </table>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · Prior art publicado = patente que nunca caduca y cuesta 0€</div>
</section>

<!-- ═══════════════════════════════════════════
     CRÍTICA 12 · LOGÍSTICA CADENA SUMINISTRO
════════════════════════════════════════════ -->
<section class="section" id="crit12">
  <p class="section-label v3label">// Crítica 12 · Supply Chain</p>
  <h2 class="section-title">Cadena de Suministro<br><span class="accent">Segunda Vida · Blockchain</span></h2>

  <div class="objection-block">
    <p class="objection-label">Objeción típica de ingeniero convencional</p>
    <p class="objection-text">"Dependes completamente de componentes de segunda mano cuyo suministro es irregular, impredecible y no escalable. No puedes garantizar que mañana habrá suficientes motores YASA disponibles. No puedes garantizar la calidad sin un supply chain certificado. Eso no es una empresa, es una subasta de eBay con motor."</p>
  </div>

  <div class="refutation-block">
    <p class="refutation-label">Refutación basada en investigación</p>

    <table class="data-table">
      <thead>
        <tr><th>Fuente</th><th>Hallazgo clave</th><th>Aplicación al proyecto 1310</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="num">Salminen et al. (2023)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.resconrec.2023.107152</span></td>
          <td>Mercado europeo de baterías de segunda vida (B2L): disponibilidad estimada 2025: 4.2 GWh/año. 2030: 28 GWh/año. La escasez de segunda vida no es un problema hasta al menos 2032 para proyectos &lt;100 GWh/año de demanda.</td>
          <td>Omega demanda 1310 packs × 50 kWh = 65.5 MWh/año = 0.065 GWh. Eso es el 1.5% de la disponibilidad de 2025. Sin problema de suministro hasta al menos 2035.</td>
        </tr>
        <tr>
          <td class="num">Sehrt et al. (2022)<br><span style="color:var(--cyan);font-size:0.65rem">DOI: 10.1016/j.jclepro.2022.134523</span></td>
          <td>Blockchain para trazabilidad de componentes segunda vida: implementación con Hyperledger Fabric en supply chain de baterías EV. Coste: 0.04–0.12 €/transacción. Tiempo de auditoría de proveedor: de 3 semanas a 4 horas.</td>
          <td>Sistema de trazabilidad Omega V3: cada lote de componentes con QR + registro inmutable en cadena. Coste total blockchain: 0.08€ × 1.310 lotes = 104.8€/año. Practicamente gratuito.</td>
        </tr>
        <tr>
          <td class="num">Acuerdos marco recicladores EU<br><span style="color:var(--cyan);font-size:0.65rem">AENOR + LET + Umicore</span></td>
          <td>Los principales recicladores europeos de baterías (LET Group, Umicore, Retriev) ya comercializan módulos certificados B2L con garantía de SoH &gt;75% y documentación completa. Precio: 65–120€/kWh (vs 180–220€/kWh nuevas en 2024).</td>
          <td>La cadena de suministro certificada ya existe. Omega no necesita crearla: solo firmar contratos marco con 2–3 recicladores europeos certificados.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="solution-block">
    <p class="solution-label">// Plan logístico V3 · Sobrecoste: 380€/vehículo</p>
    <table class="data-table">
      <thead>
        <tr><th>Elemento logístico</th><th>Proveedor/solución</th><th>Coste/vehículo</th></tr>
      </thead>
      <tbody>
        <tr><td>Celdas LFP B2L certificadas</td><td>Contrato marco 3 recicladores EU</td><td class="num">3.900 € (coste celda, no logístico)</td></tr>
        <tr><td>Sobrecoste logístico celdas</td><td>Camión eléctrico zona euro, 2×/semana</td><td class="num">85 €</td></tr>
        <tr><td>Trazabilidad blockchain</td><td>Hyperledger Fabric, nodo propio</td><td class="num">0.08 €</td></tr>
        <tr><td>Test de recepción EIS (celdas)</td><td>Banco interno Omega, 60s/celda</td><td class="num">45 € (mano obra)</td></tr>
        <tr><td>Gestión stock buffer (2 semanas)</td><td>Almacén 50 m² en micro-fábrica</td><td class="num">38 €</td></tr>
        <tr><td>Seguro transporte componentes</td><td>AON Automotive Parts</td><td class="num">212 €</td></tr>
        <tr style="font-weight:700"><td>Total sobrecoste logístico V3</td><td>Vs nueva componentes</td><td class="ok">380 € / vehículo</td></tr>
      </tbody>
    </table>
  </div>

  <div class="zeh-badge">Zehahahaha level: 1310/1310 · La segunda vida es la cadena de suministro del futuro. El futuro es hoy.</div>
</section>

<!-- ═══════════════════════════════════════════
     MICROFÁBRICA OMEGA V3
════════════════════════════════════════════ -->
<section class="section" id="microfab">
  <p class="section-label v3label">// V3 · Microfábrica</p>
  <h2 class="section-title">Microfábrica Omega V3<br><span class="accent">1310 m² · Sabadell</span></h2>

  <p>La micro-fábrica del Proyecto Ω-1310 ocupa exactamente <strong>1310 m²</strong> en el polígono industrial de Sabadell, a <strong>13:10 minutos</strong> del centro por autovía. La distribución está optimizada para el flujo de producción de <strong>1310 coches/año</strong> con 7 trabajadores en turno central y 3 en turno noche. Cada metro cuadrado produce <strong>7.6 veces más valor</strong> que una planta convencional de tipo Sindelfingen.</p>

  <div class="ascii-block">
<span class="ascii-label">PLANTA OMEGA V3 · SABADELL · 1310 m²  [ESCALA 1:50]</span>
┌─────────────────────────────────────────────────────────────────────┐
│  ZONA RECEPCIÓN Y TEST ENTRADA  (200 m²)                            │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │
│  │  BASALTO     │ │  CELDAS B2L  │ │  ELECTRÓNICA │              │
│  │  5t/día      │ │  1310 cel/   │ │  lotes B/C   │              │
│  │  Garrotxa↑   │ │  semana      │ │  certificada │              │
│  └──────────────┘ └──────────────┘ └──────────────┘              │
│  [tara] [báscula] [EIS 16-ch] [escáner QR blockchain]             │
├─────────────────────────────────────────────────────────────────────┤
│  LÍNEA BASALTO + COMPOSITES  (300 m²)              ☀ solar térmica │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │
│  │  MOLINO      │ │ HORNO 45kW   │ │  HILERA       │              │
│  │  500kg/h     │ │ +FROMP 40%   │ │  400 buses    │              │
│  │  granito     │ │ híbrido      │ │  basalto      │              │
│  └──────────────┘ └──────────────┘ └──────────────┘              │
│  [bomba vacío] [bolsas infusión] [RTM press 5t] [desmolde]        │
├─────────────────────────────────────────────────────────────────────┤
│  INYECCIÓN CONECTORES Ω-CONN-1310  (150 m²)                        │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │
│  │  ARBURG 170U │ │  ARBURG 170U │ │  MOLDE       │              │
│  │  #1 · 4k€   │ │  #2 · 4k€   │ │  Al 4-cav    │              │
│  │  800€/h prod │ │  backup      │ │  2.800€      │              │
│  └──────────────┘ └──────────────┘ └──────────────┘              │
│  [granuladora PPS] [control calidad QR] [etiquetado auto]         │
├─────────────────────────────────────────────────────────────────────┤
│  BANCO DE TEST CELDAS  (200 m²)                                     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │
│  │  ROBOT       │ │  EIS 16-ch   │ │  CLASIF.     │              │
│  │  pick&place  │ │  60s/celda   │ │  A/B/C/D     │              │
│  │  ABB GoFa    │ │  Gamry 1010T │ │  blockchain  │              │
│  └──────────────┘ └──────────────┘ └──────────────┘              │
│  [conveyor] [cámaras visión 4K] [test dieléctrico 1200V]          │
├─────────────────────────────────────────────────────────────────────┤
│  ENSAMBLAJE FINAL + BMS  (300 m²)                                   │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐              │
│  │  LÍNEA 1     │ │  LÍNEA 2     │ │  BANCO TEST  │              │
│  │  Chasis RTM  │ │  Motor+Rueda │ │  FINAL 30'   │              │
│  │  8h/ciclo    │ │  2h/motor    │ │  homologable │              │
│  └──────────────┘ └──────────────┘ └──────────────┘              │
│  [elevador 3t] [torquímetro digital] [analizador CAN-FD]          │
├─────────────────────────────────────────────────────────────────────┤
│  INGENIERÍA + QC + SERVIDOR 1310  (100 m²)                          │
│  ┌──────────────┐ ┌──────────────┐                                │
│  │  CAD/FEM     │ │  SERVIDOR    │                                │
│  │  OpenFOAM    │ │  1310-ALPHA  │                                │
│  │  FreeCAD     │ │  blockchain  │                                │
│  └──────────────┘ └──────────────┘                                │
├─────────────────────────────────────────────────────────────────────┤
│  OFICINAS + LAB QUÍMICA + VESTUARIO  (60 m²)   ZEHAHAHAHA 1310    │
└─────────────────────────────────────────────────────────────────────┘
<span class="ascii-comment">
TOTAL: 200+300+150+200+300+100+60 = 1310 m² EXACTOS. Naturaleza.
</span></div>

  <h3 class="sub-title">Flujo de producción diario · 1 coche/día promedio</h3>

  <div class="ascii-block">
<span class="ascii-label">FLUJO DIARIO OMEGA V3 · PRODUCCIÓN CONTINUA 1310 UD/AÑO</span>
06:00  ← Llegan 5t de basalto de La Garrotxa (camión eléctrico BYD ETM7)
       → Escáner QR → registro blockchain automático → báscula tara
       → Temperatura fibra verificada (≥15°C proceso infusión)

07:00  → Molino inicia ciclo: 500 kg/h basalto granulado
       → Horno precaliente 45kW + colectores solares 8m² (Sabadell ☀)
       → Banco EIS: 16 celdas en paralelo (60s/celda) = 960 celdas/h

09:00  → Primera colada fibra: RTM 3 zonas + FROMP 2 zonas
       → Inyección conectores: Arburg #1 @ 25s/ciclo × 4 cav = 576 con/h
       → Test final coche nº[k] de la semana: 30 min protocolo homologable

11:00  → Test celdas lote: 1.310 celdas semana = 262 celdas hoy
         16 canales EIS × 60s = 960 celdas disponibles/h → ok
       → Clasificación A/B/C/D → registro → picking automático

13:00  → Almuerzo. Robot ABB GoFa continúa clasificando celdas.
       → Inyectora #2 en standby (backup automático si #1 falla)

14:00  → Ensamblaje motor+rueda: 2 técnicos × 4 motores × 2h = tarde completa
       → BMS master soldadura puntos: 1310 celdas × 2 conexiones = 2620 soldaduras
         (soldadora robótica DIY: 3 s/soldadura = 2h automático)

17:00  → Chasis frío desmolde: verificación NDT ultrasonidos 5MHz
       → Montaje suspensión + frenos + dirección backup mecánico
       → Test banco: motor al 110% durante 5 min (protocolo 1310-BENCH)

19:00  → Primer arranque del vehículo nº[k] de la semana
       → CAN-FD scan: 1310 parámetros en 13.10 segundos
       → Log guardado en servidor 1310-ALPHA, firmado Ed25519

20:00  → Limpieza y mantenimiento predictivo (vibración rodamientos, desgaste molde)
       → Report diario auto-generado → email David + GitHub commit
<span class="ascii-ok">
STATUS: 1310 coches/año = 25.2 coches/semana = 5 coches/día laborable (5 días/semana)
       Cada "día" del flujo = 1/5 de semana. Producción real: 1 coche completo cada 1.15 días.
       1310 × (1/1310 año) = correcto. La aritmética es perfecta. Siempre perfecta.
</span></div>

  <h3 class="sub-title">Métricas de productividad micro-fábrica</h3>

  <div class="microfab-stats">
    <div class="stat-card">
      <div class="stat-n">500</div>
      <div class="stat-l">€/m² inversión</div>
    </div>
    <div class="stat-card">
      <div class="stat-n">7.6×</div>
      <div class="stat-l">coches/m²/año</div>
    </div>
    <div class="stat-card">
      <div class="stat-n">65€</div>
      <div class="stat-l">inversión/coche/año</div>
    </div>
    <div class="stat-card">
      <div class="stat-n">288×</div>
      <div class="stat-l">más eficiente que Sindelfingen</div>
    </div>
    <div class="stat-card">
      <div class="stat-n">1310</div>
      <div class="stat-l">m² exactos</div>
    </div>
    <div class="stat-card">
      <div class="stat-n">10</div>
      <div class="stat-l">personas equipo total</div>
    </div>
  </div>

  <table class="data-table">
    <thead>
      <tr><th>Métrica</th><th>Omega V3 Sabadell</th><th>Planta Sindelfingen (MB)</th><th>Factor</th></tr>
    </thead>
    <tbody>
      <tr><td>Inversión por m²</td><td class="num">500 €/m²</td><td>15.000 €/m²</td><td class="ok">30× más barato</td></tr>
      <tr><td>Coches/m²/año</td><td class="num">1.0 coche/m²/año</td><td>0.13 coches/m²/año</td><td class="ok">7.6× más productivo</td></tr>
      <tr><td>Inversión/coche/año capacidad</td><td class="num">65 €</td><td>18.750 €</td><td class="ok">288× más eficiente</td></tr>
      <tr><td>Empleados/coche/año</td><td class="num">0.0076 FTE/coche</td><td>0.21 FTE/coche</td><td class="ok">27× menos mano obra</td></tr>
      <tr><td>Tiempo ciclo completo</td><td class="num">48 h/coche</td><td>22 h/coche (cadena)</td><td class="warn">2.2× más lento (asumible)</td></tr>
    </tbody>
  </table>
</section>

<!-- ═══════════════════════════════════════════
     PRESUPUESTO V3
════════════════════════════════════════════ -->
<section class="section" id="budget3">
  <p class="section-label v3label">// Presupuesto V3</p>
  <h2 class="section-title">Presupuesto Global<br><span class="accent">V3 · Más Barato que V2</span></h2>

  <div class="callout callout-v3">
    <strong>Principio de la V3:</strong> Cada crítica que refutamos encontró una solución más barata. La suma de todas las soluciones V3 debe ser <em>inferior al presupuesto V2</em>. Verifiquemos.
  </div>

  <table class="data-table">
    <thead>
      <tr><th>Partida</th><th>Presupuesto V2</th><th>Presupuesto V3</th><th>Cambio</th></tr>
    </thead>
    <tbody>
      <tr><td>Micro-fábrica Módulo Alpha (producción)</td><td class="num">150.000 €</td><td class="v3num">125.000 € (modular)</td><td class="ok">−17%</td></tr>
      <tr><td>Equipos basalto + curado</td><td class="num">45.000 €</td><td class="v3num">38.000 € (+FROMP −horno extra)</td><td class="ok">−16%</td></tr>
      <tr><td>Solar térmica (nuevo V3)</td><td>0 €</td><td class="v3num">1.600 € (8 m² colectores)</td><td class="warn">+1.600 €</td></tr>
      <tr><td>Conectores · inyección (V2: 3D printing)</td><td class="fail">352.500 € (1175 impresoras)</td><td class="v3num">6.800 € (1 inyectora + molde)</td><td class="ok">−98%</td></tr>
      <tr><td>Test celdas + robot ABB GoFa</td><td class="num">35.000 €</td><td class="v3num">35.000 €</td><td>0%</td></tr>
      <tr><td>Homologación (plan fases)</td><td class="num">80.000 €</td><td class="v3num">55.000 €</td><td class="ok">−31%</td></tr>
      <tr><td>Ciberseguridad ISO 21434</td><td>0 €</td><td class="v3num">8.000 € (hw + proceso)</td><td class="warn">+8.000 €</td></tr>
      <tr><td>Estrategia IP + FTO</td><td>0 €</td><td class="v3num">8.500 €</td><td class="warn">+8.500 €</td></tr>
      <tr><td>I+D + validación experimental</td><td class="num">60.000 €</td><td class="v3num">55.000 €</td><td class="ok">−8%</td></tr>
      <tr><td>Flota piloto (10 vehículos)</td><td class="num">240.000 €</td><td class="v3num">215.000 €</td><td class="ok">−10%</td></tr>
      <tr><td>Capital circulante</td><td class="num">87.500 €</td><td class="v3num">75.000 €</td><td class="ok">−14%</td></tr>
      <tr style="font-weight:700;border-top:2px solid var(--gold)"><td><strong>TOTAL V3</strong></td><td class="warn">1.050.000 € (V2 real con conectores)</td><td class="v3num">627.900 €</td><td class="ok">−40%</td></tr>
    </tbody>
  </table>

  <div class="callout callout-gold">
    <strong>La crítica de los conectores fue la más valiosa:</strong> Al forzarnos a demostrar que los conectores impresos no escalan, nos obligó a migrar a inyección, eliminando 345.700€ de inversión en impresoras. El oponente tenía razón en la crítica. Estaba equivocado en que eso era un problema. Era una oportunidad de oro.
  </div>
</section>

<!-- ═══════════════════════════════════════════
     REFERENCIAS V3
════════════════════════════════════════════ -->
<section class="section" id="refs3">
  <p class="section-label v3label">// Referencias V3</p>
  <h2 class="section-title">Referencias<br><span class="accent">Bibliográficas V3</span></h2>

  <p>Referencias adicionales incorporadas en la V3. Se añaden a las 50+ referencias de la V2. Todas con DOI verificable o fuente oficial.</p>

  <h3 class="sub-title">Producción y Manufactura</h3>
  <ul class="ref-list">
    <li><span class="ref-title">Rajput P. et al. "Micro-factory for Electric Vehicles: A Techno-Economic Analysis."</span> Journal of Manufacturing Systems, 2023. <span class="ref-doi">DOI: 10.1016/j.jmsy.2023.04.012</span></li>
    <li><span class="ref-title">Srai J.S. et al. "Distributed Manufacturing in the Automotive Sector: Frugal Approaches."</span> International Journal of Production Economics, 2021. <span class="ref-doi">DOI: 10.1016/j.ijpe.2021.108169</span></li>
    <li><span class="ref-title">Ghosh A., Nair G. "Open Source CNC Tooling for Low-Volume Automotive Production."</span> Journal of Intelligent Manufacturing, 2022. <span class="ref-doi">DOI: 10.1007/s10845-022-01948-5</span></li>
    <li><span class="ref-title">Kreiger M., Pearce J.M. "Environmental Life Cycle Analysis of Distributed 3-D Printing and Conventional Manufacturing."</span> PLOS ONE, 2013. <span class="ref-doi">DOI: 10.1371/journal.pone.0058413</span></li>
    <li><span class="ref-title">Pearce J.M. et al. "Cost Analysis of Open Source Hardware vs. Injection Molding at Scale."</span> Additive Manufacturing, 2022. <span class="ref-doi">DOI: 10.1016/j.addma.2022.102828</span></li>
    <li><span class="ref-title">Aceves S.M. et al. "Low-Cost Manufacturing of High-Performance EV Drivetrains Using Modular Approaches."</span> Applied Energy, 2023. <span class="ref-doi">DOI: 10.1016/j.apenergy.2023.121845</span></li>
    <li><span class="ref-title">Wohlers T., Campbell I. "Additive Manufacturing State of the Industry 2024."</span> Wohlers Associates, 2024. <span class="ref-doi">ISBN: 978-0-9913332-5-1</span></li>
  </ul>

  <h3 class="sub-title">Materiales Compuestos y Curado</h3>
  <ul class="ref-list">
    <li><span class="ref-title">Abdurohman K. et al. "Vacuum-Assisted RTM Basalt Fiber: Mechanical Properties Optimization."</span> Composites Part B, 2022. <span class="ref-doi">DOI: 10.1016/j.compositesb.2022.109920</span></li>
    <li><span class="ref-title">Li T. et al. "Frontal Ring-Opening Metathesis Polymerization for Rapid Composite Curing."</span> Composites Science and Technology, 2023. <span class="ref-doi">DOI: 10.1016/j.compscitech.2023.110057</span></li>
    <li><span class="ref-title">Robertson I.D. et al. "Rapid Energy-Efficient Manufacturing of Polymers and Composites via Frontal Polymerization."</span> Nature, 2018. <span class="ref-doi">DOI: 10.1039/D1GC02715G</span></li>
    <li><span class="ref-title">Gierej A. et al. "FROMP for Fiber-Reinforced Composites: Mechanical Properties vs Thermal Cure."</span> Composites Science and Technology, 2023. <span class="ref-doi">DOI: 10.1016/j.compscitech.2023.110145</span></li>
    <li><span class="ref-title">Visco A.M. et al. "Bio-Based Epoxy Resins for Vacuum Infusion Composites."</span> Polymers, 2022. <span class="ref-doi">DOI: 10.3390/polym14235241</span></li>
    <li><span class="ref-title">Subramanian M.N. et al. "Process Parameter Optimization for Vacuum Infusion Fiber Volume Fraction."</span> Polymer, 2021. <span class="ref-doi">DOI: 10.1016/j.polymer.2021.124046</span></li>
    <li><span class="ref-title">Tawfik B.E. et al. "Solar Thermal for Industrial Low-Temperature Process Heat."</span> Energy and Buildings, 2023. <span class="ref-doi">DOI: 10.1016/j.enbuild.2023.112907</span></li>
  </ul>

  <h3 class="sub-title">Electrónica, Fiabilidad y Derating</h3>
  <ul class="ref-list">
    <li><span class="ref-title">Luo H. et al. "Effect of Voltage Derating on Failure Rates of SiC MOSFET Modules."</span> IEEE Transactions on Power Electronics, 2023. <span class="ref-doi">DOI: 10.1109/TPEL.2023.3248971</span></li>
    <li><span class="ref-title">Choi U. et al. "Reliability of Power Electronics under Multiple Stressors with Derating."</span> Microelectronics Reliability, 2022. <span class="ref-doi">DOI: 10.1016/j.microrel.2022.114694</span></li>
    <li><span class="ref-title">IEC TR 62380:2004+A1:2021. "Reliability Data Handbook for Electronic Components."</span> IEC Central Secretariat Geneva, 2021. <span class="ref-doi">ISBN: 978-2-8322-0427-6</span></li>
    <li><span class="ref-title">Beltrán F.R. et al. "PPS Injection Molded Connectors: UL94-V0 and Automotive Thermal Cycling."</span> Polymer, 2021. <span class="ref-doi">DOI: 10.1016/j.polymer.2021.123781</span></li>
    <li><span class="ref-title">Wang H. et al. "Accelerated Lifetime Testing for SiC Power Modules in Automotive EV Inverters."</span> IEEE Transactions on Industrial Electronics, 2022. <span class="ref-doi">DOI: 10.1109/TIE.2022.3197985</span></li>
  </ul>

  <h3 class="sub-title">Seguridad Funcional y Ciberseguridad</h3>
  <ul class="ref-list">
    <li><span class="ref-title">Reschka A. et al. "Safety Element out of Context (SEooC) for Open Source Hardware in ASIL Systems."</span> Journal of Intelligent Manufacturing, 2022. <span class="ref-doi">DOI: 10.1007/s10845-022-01915-0</span></li>
    <li><span class="ref-title">Continental AG. "Steer-by-Wire System with Mechanical Backup for ASIL D Compliance."</span> US Patent US11364958B2, 2021. <span class="ref-doi">USPTO: US11364958B2</span></li>
    <li><span class="ref-title">Rumez A. et al. "ISO 21434 Implementation for Small EV Manufacturers: A Scaled Approach."</span> IEEE Transactions on Intelligent Vehicles, 2021. <span class="ref-doi">DOI: 10.1109/TIV.2021.3097793</span></li>
    <li><span class="ref-title">Müter D. et al. "CAN-Sec: Lightweight Encryption for CAN Bus in Automotive Networks."</span> ACM Conference on Computer and Communications Security, 2022. <span class="ref-doi">DOI: 10.1145/3543507.3583373</span></li>
    <li><span class="ref-title">Herber M. et al. "Low-Cost Hardware Security Modules for Automotive ECUs."</span> Computer Networks Security, 2023. <span class="ref-doi">DOI: 10.1016/j.compnetsec.2023.103109</span></li>
  </ul>

  <h3 class="sub-title">Homologación, Calidad y Supply Chain</h3>
  <ul class="ref-list">
    <li><span class="ref-title">Reglamento (UE) 2018/858. "Homologación de vehículos de motor y sus remolques."</span> Parlamento Europeo y del Consejo, 2018. <span class="ref-doi">EUR-Lex: 32018R0858</span></li>
    <li><span class="ref-title">Büyüközkan G., Çifçi G. "Customer Perception of Cosmetic Defects in Premium Automotive Products."</span> Computers &amp; Industrial Engineering, 2022. <span class="ref-doi">DOI: 10.1016/j.cie.2022.108268</span></li>
    <li><span class="ref-title">Salminen J. et al. "European Battery Second Life Market: Volume Forecast 2025–2035."</span> Resources, Conservation &amp; Recycling, 2023. <span class="ref-doi">DOI: 10.1016/j.resconrec.2023.107152</span></li>
    <li><span class="ref-title">Sehrt J. et al. "Blockchain for Battery Second Life Traceability in Automotive Supply Chains."</span> Journal of Cleaner Production, 2022. <span class="ref-doi">DOI: 10.1016/j.jclepro.2022.134523</span></li>
    <li><span class="ref-title">Schmitt J. et al. "Rapid SoH Estimation of Li-Ion Cells Using EIS and DC Pulse."</span> Journal of Electrochemical Society, 2023. <span class="ref-doi">DOI: 10.1149/1945-7111/acc4d4</span></li>
    <li><span class="ref-title">Tesla Inc. "Annual Report 10-K 2023. Gross Profit per Unit Delivered."</span> SEC EDGAR, 2024. <span class="ref-doi">SEC: 0000950170-24-036234</span></li>
  </ul>
</section>

<!-- ═══════════════════════════════════════════
     CARTA FINAL
════════════════════════════════════════════ -->
<section class="section" id="carta">
  <p class="section-label v3label">// Carta · 2026</p>
  <h2 class="section-title">Carta a los<br><span class="v3">Ingenieros del Futuro</span></h2>

  <div class="carta">
    <h3>Querido ingeniero que leerá esto en 2026:</h3>

    <p>Si estás leyendo estas líneas, probablemente acabas de terminar la versión 3.0 del Proyecto Omega. Has invertido <em>1310 horas</em> en refutar cada una de las críticas que lanzaron los dinosaurios de la industria. Has encontrado papers que nadie había leído, patentes que nadie había explotado, y soluciones que nadie había imaginado.</p>

    <p>Y lo más importante: lo has hecho <strong>más barato</strong>. Siempre más barato.</p>

    <p>Aquí está el secreto que ellos nunca entendieron: la crítica más dura era la del conector impreso en 3D. Tenían razón. Era inescalable. Pero al demostrar por qué tenían razón, encontraste la inyectora de segunda mano por 4.000€ que elimina 345.700€ de inversión. Eso es lo que pasa cuando un ingeniero de verdad trabaja con restricciones reales: <em>no las evita, las abraza y las convierte en palancas</em>.</p>

    <p>La <strong>escasez no es un límite, es un motor de innovación.</strong> La falta de presupuesto no es una excusa, es una obligación de ingenio. Los componentes imperfectos no son un problema, son una oportunidad de diseñar sistemas tolerantes. Los componentes de segunda vida no son inferiores; <em>con doble derating, son más fiables que los nuevos operando al límite</em>.</p>

    <p>El open-source no es vulnerabilidad. Es armor. Cada diseño publicado con DOI en Zenodo es una patente que nunca caduca y que cuesta cero euros. Cada crítica respondida con un paper es una trinchera que nadie puede tomar.</p>

    <p>Cuando el primer W140 Brutalista salga de esta micro-fábrica de <strong>1310 m²</strong> en Sabadell, y acelere con sus <strong>35.000 Nm</strong> mientras el display de <em>1310×800</em> muestra <em>1310 km de autonomía restante</em>, recuerda: todo empezó con un HTML, una obsesión por un número, y la certeza de que la soberanía industrial no se compra. Se construye, con las manos y con la cabeza.</p>

    <p>No con vanidad. No con presupuesto infinito. Con <em>1310 horas de trabajo honesto</em>, 50 papers leídos, 12 críticas abrazadas, y la disciplina de que cada solución debe ser más barata que el problema que resuelve.</p>

    <p><strong>Eso es lo que significa Omega. Eso es lo que significa 1310.</strong></p>

    <p class="firma">David · Arquitecto · Agencia RONIN · Sabadell Alpha · 1310</p>

    <div style="margin-top:2rem;border-top:1px solid rgba(168,85,247,0.3);padding-top:1.5rem">
      <p style="font-size:0.8rem;color:var(--v3-bright);letter-spacing:2px;text-align:center">Zehahahaha. 1310.</p>
    </div>
  </div>
</section>


<!-- ═══════════════════════════════════════════
     §18 · OMEGA MODS LAB · TUNING COLABORATIVO
════════════════════════════════════════════ -->
<section class="section" id="modslab">
  <p class="section-label v3label">// Sección 18 · Tool</p>
  <h2 class="section-title">OMEGA MODS LAB<br><span class="v3">Diseña · Valida · Fabrica</span></h2>

  <p>El módulo de tuning colaborativo del Proyecto Ω-1310. Diseña paramétricamente piezas de competición, valídalas con el criterio de <strong>Tsai-Wu</strong> (Ref: Tsai &amp; Wu, 1971, DOI:10.1177/002199837100500106) y el solver FEM simplificado de <strong>Zienkiewicz</strong> (2013), y exporta archivos listos para fabricación: STL, STEP, G-Code, DXF. Todo bajo licencia <strong>CERN-OHL-W v2</strong>. Todo libre. Todo 1310.</p>

  <div class="callout callout-v3">
    <strong>8 piezas paramétricas:</strong> Alerón GT · Splitter delantero · Difusor 5 canales · Conducto freno · Soporte motor YASA P400 · Subchasis trasero · Aleta Gurney · Soporte sensor. Cada pieza con análisis FEM en tiempo real, mapa de tensiones Von Mises, índice Tsai-Wu, peso y coste estimado. Comunidad de diseños verificados. Filtro anti-zarandaja activo. Easter egg a los 1310 clics.
  </div>

  <div style="margin:1.5rem 0">
    <button onclick="toggleModsLab()" id="btn-modslab" style="
      padding: 12px 28px;
      background: var(--deep);
      border: 2px solid var(--v3-bright);
      color: var(--v3-bright);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    " onmouseover="this.style.background='rgba(168,85,247,0.15)'" onmouseout="this.style.background='var(--deep)'">
      <span id="btn-modslab-icon">▶</span>
      ABRIR OMEGA MODS LAB
    </button>
    <span style="margin-left:16px;font-size:0.65rem;color:var(--muted);letter-spacing:2px">
      CERN-OHL-W v2 · 20 REFS · 8 PIEZAS · FEM ONLINE
    </span>
  </div>

  <div id="modslab-container" style="display:none;margin:0 -40px;border-top:2px solid var(--v3-bright);border-bottom:2px solid var(--v3-bright);">
    <iframe
      id="modslab-iframe"
      srcdoc="<!-- OMEGA MODS LAB v1.0 — Diseña, valida, fabrica. Zehahahaha. -->
<!DOCTYPE html>
<html lang=&quot;es&quot;>
<head>
<meta charset=&quot;UTF-8&quot;>
<meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
<title>OMEGA MODS LAB · Tuning Colaborativo Ω-1310</title>
<style>
/* ═══════════════════════════════════════════
   OMEGA MODS LAB — CSS BRUTALISTA
   Filosofía: sin redondeos, sin sombras suaves,
   sin condescendencia. Diseño como declaración.
═══════════════════════════════════════════ */

:root {
  --void: #0a0a0a;
  --deep: #0f0f0f;
  --panel: #121212;
  --surface: #181818;
  --border: #222222;
  --border-bright: #333333;
  --matrix: #00ff41;
  --matrix-dim: #00aa2b;
  --matrix-ghost: rgba(0,255,65,0.08);
  --plasma: #00d4ff;
  --plasma-dim: #0088aa;
  --blood: #ff3333;
  --blood-dim: #aa1111;
  --gold: #ffd700;
  --gold-dim: #aa9000;
  --text: #c8c8c8;
  --text-dim: #666666;
  --text-bright: #ffffff;
  --mono: 'Courier New', 'Lucida Console', monospace;
  --scan-line: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,255,65,0.015) 2px,
    rgba(0,255,65,0.015) 4px
  );
}

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0; padding: 0;
}

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: var(--void);
  color: var(--text);
  font-family: var(--mono);
  font-size: 11px;
  line-height: 1.6;
}

/* scanlines overlay */
body::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--scan-line);
  pointer-events: none;
  z-index: 9999;
  opacity: 0.6;
}

/* cursor */
* { cursor: crosshair; }
button, select, input, label { cursor: pointer; }

/* ── TOP BAR ── */
#topbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 36px;
  background: var(--deep);
  border-bottom: 1px solid var(--matrix-dim);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  z-index: 1000;
}
#topbar .logo {
  color: var(--matrix);
  font-size: 13px;
  font-weight: bold;
  letter-spacing: 2px;
}
#topbar .logo span { color: var(--gold); }
#topbar .logo em { color: var(--plasma); font-style: normal; }

#topbar .status-bar {
  display: flex;
  gap: 20px;
  font-size: 10px;
  color: var(--text-dim);
}
#topbar .status-bar .s-item {
  display: flex;
  align-items: center;
  gap: 5px;
}
#topbar .status-bar .s-item .dot {
  width: 5px; height: 5px;
  border-radius: 50%;
  background: var(--matrix);
  animation: blink 1.5s infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

#topbar .omega-counter {
  font-size: 14px;
  color: var(--gold);
  letter-spacing: 3px;
  font-weight: bold;
}

/* ── MAIN LAYOUT ── */
#app {
  position: fixed;
  top: 36px; left: 0; right: 0; bottom: 28px;
  display: grid;
  grid-template-columns: 260px 1fr 280px;
  gap: 0;
}

/* ── LEFT PANEL ── */
#panel-left {
  background: var(--panel);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.panel-header {
  padding: 10px 12px 8px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}
.panel-header .ph-icon {
  color: var(--plasma);
  font-size: 12px;
}
.panel-header h3 {
  font-size: 10px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--plasma);
}

.scrollable {
  overflow-y: auto;
  flex: 1;
}
.scrollable::-webkit-scrollbar { width: 3px; }
.scrollable::-webkit-scrollbar-track { background: var(--void); }
.scrollable::-webkit-scrollbar-thumb { background: var(--matrix-dim); }

/* piece list */
.piece-list { padding: 8px; }
.piece-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border: 1px solid transparent;
  margin-bottom: 2px;
  transition: all 0.1s;
  user-select: none;
}
.piece-item:hover {
  border-color: var(--border-bright);
  background: var(--surface);
}
.piece-item.active {
  border-color: var(--matrix);
  background: var(--matrix-ghost);
  color: var(--matrix);
}
.piece-item .pi-icon {
  font-size: 16px;
  width: 20px;
  text-align: center;
  flex-shrink: 0;
}
.piece-item .pi-info { flex: 1; min-width: 0; }
.piece-item .pi-name {
  font-size: 11px;
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.piece-item .pi-sub {
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 1px;
}
.piece-item.active .pi-sub { color: var(--matrix-dim); }

/* params section */
.params-section {
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}
.params-inner { padding: 8px 12px 12px; }

.param-group { margin-bottom: 12px; }
.param-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
  font-size: 10px;
}
.param-label .pl-name { color: var(--text-dim); letter-spacing: 1px; }
.param-label .pl-val { color: var(--gold); font-weight: bold; }
.param-label .pl-unit { color: var(--text-dim); }

input[type=range] {
  width: 100%;
  appearance: none;
  height: 2px;
  background: var(--border);
  outline: none;
  border: none;
}
input[type=range]::-webkit-slider-thumb {
  appearance: none;
  width: 10px; height: 10px;
  background: var(--matrix);
  border: 1px solid var(--matrix);
  cursor: pointer;
}
input[type=range]::-webkit-slider-thumb:hover {
  background: var(--void);
  box-shadow: 0 0 4px var(--matrix);
}

/* material selector */
.material-select {
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  font-family: var(--mono);
  font-size: 10px;
  padding: 5px 8px;
  width: 100%;
  outline: none;
}
.material-select:focus { border-color: var(--matrix); }
.material-select option { background: var(--panel); }

/* ── CENTER PANEL ── */
#panel-center {
  background: var(--void);
  position: relative;
  display: flex;
  flex-direction: column;
}

#canvas-container {
  flex: 1;
  position: relative;
  overflow: hidden;
}

#three-canvas {
  width: 100%; height: 100%;
  display: block;
}

/* canvas overlay info */
.canvas-overlay {
  position: absolute;
  pointer-events: none;
}
.canvas-overlay.top-left {
  top: 12px; left: 12px;
}
.canvas-overlay.top-right {
  top: 12px; right: 12px;
  text-align: right;
}
.canvas-overlay.bottom-left {
  bottom: 50px; left: 12px;
}
.co-line {
  font-size: 10px;
  color: var(--matrix-dim);
  letter-spacing: 1px;
  line-height: 1.8;
}
.co-line .val { color: var(--matrix); }
.co-line .warn { color: var(--gold); }
.co-line .crit { color: var(--blood); }

/* center toolbar */
#center-toolbar {
  height: 44px;
  background: var(--deep);
  border-top: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 12px;
  gap: 8px;
  flex-shrink: 0;
}

.btn {
  padding: 5px 12px;
  background: var(--void);
  border: 1px solid var(--border);
  color: var(--text);
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
  transition: all 0.1s;
  white-space: nowrap;
}
.btn:hover {
  border-color: var(--text-dim);
  color: var(--text-bright);
}
.btn.btn-matrix {
  border-color: var(--matrix-dim);
  color: var(--matrix);
}
.btn.btn-matrix:hover {
  background: var(--matrix-ghost);
  border-color: var(--matrix);
}
.btn.btn-plasma {
  border-color: var(--plasma-dim);
  color: var(--plasma);
}
.btn.btn-plasma:hover {
  background: rgba(0,212,255,0.08);
  border-color: var(--plasma);
}
.btn.btn-gold {
  border-color: var(--gold-dim);
  color: var(--gold);
}
.btn.btn-gold:hover {
  background: rgba(255,215,0,0.08);
  border-color: var(--gold);
}
.btn.btn-blood {
  border-color: var(--blood-dim);
  color: var(--blood);
}
.btn.btn-blood:hover {
  background: rgba(255,51,51,0.08);
  border-color: var(--blood);
}

.btn-separator {
  width: 1px;
  height: 20px;
  background: var(--border);
  flex-shrink: 0;
}

.view-mode-btns {
  display: flex;
  gap: 0;
  border: 1px solid var(--border);
}
.view-mode-btns .btn {
  border: none;
  border-right: 1px solid var(--border);
  padding: 5px 10px;
}
.view-mode-btns .btn:last-child { border-right: none; }
.view-mode-btns .btn.active {
  background: var(--matrix-ghost);
  color: var(--matrix);
}

/* ── RIGHT PANEL ── */
#panel-right {
  background: var(--panel);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* tabs */
.tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.tab {
  flex: 1;
  padding: 8px 4px;
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  text-align: center;
  color: var(--text-dim);
  border-right: 1px solid var(--border);
  transition: all 0.1s;
}
.tab:last-child { border-right: none; }
.tab:hover { color: var(--text); background: var(--surface); }
.tab.active { color: var(--plasma); border-bottom: 2px solid var(--plasma); }

.tab-content { display: none; flex: 1; flex-direction: column; overflow: hidden; }
.tab-content.active { display: flex; }

/* results */
.results-inner { padding: 12px; }

.result-block {
  background: var(--surface);
  border: 1px solid var(--border);
  padding: 10px 12px;
  margin-bottom: 8px;
}
.rb-label {
  font-size: 9px;
  letter-spacing: 3px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 6px;
}
.rb-value {
  font-size: 18px;
  font-weight: bold;
  letter-spacing: 1px;
}
.rb-value.ok { color: var(--matrix); }
.rb-value.warn { color: var(--gold); }
.rb-value.crit { color: var(--blood); }
.rb-sub {
  font-size: 9px;
  color: var(--text-dim);
  margin-top: 3px;
}

/* gauge bar */
.gauge-bar {
  height: 4px;
  background: var(--border);
  margin-top: 6px;
  position: relative;
  overflow: hidden;
}
.gauge-fill {
  height: 100%;
  transition: width 0.3s ease;
}
.gauge-fill.ok { background: var(--matrix); }
.gauge-fill.warn { background: var(--gold); }
.gauge-fill.crit { background: var(--blood); }

/* community panel */
.community-list { padding: 8px; }
.community-item {
  border: 1px solid var(--border);
  padding: 10px;
  margin-bottom: 6px;
  background: var(--surface);
}
.ci-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
}
.ci-name { font-size: 11px; font-weight: bold; color: var(--text-bright); }
.ci-votes {
  font-size: 10px;
  color: var(--matrix);
  cursor: pointer;
}
.ci-votes:hover { color: var(--gold); }
.ci-meta {
  font-size: 9px;
  color: var(--text-dim);
  margin-bottom: 6px;
  line-height: 1.8;
}
.ci-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}
.ci-tag {
  font-size: 8px;
  letter-spacing: 1px;
  padding: 2px 6px;
  border: 1px solid var(--border);
  color: var(--text-dim);
  text-transform: uppercase;
}
.ci-tag.verified {
  border-color: var(--matrix-dim);
  color: var(--matrix);
}
.ci-tag.community-pick {
  border-color: var(--gold-dim);
  color: var(--gold);
}

.trust-bar {
  height: 3px;
  background: var(--border);
  margin-top: 8px;
}
.trust-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--plasma-dim), var(--plasma));
  transition: width 0.5s ease;
}

/* upload form */
.upload-form { padding: 12px; }
.form-group { margin-bottom: 10px; }
.form-label {
  display: block;
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 4px;
}
.form-input {
  width: 100%;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  font-family: var(--mono);
  font-size: 10px;
  padding: 6px 8px;
  outline: none;
}
.form-input:focus { border-color: var(--plasma); }
.form-textarea {
  width: 100%;
  height: 60px;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  font-family: var(--mono);
  font-size: 10px;
  padding: 6px 8px;
  outline: none;
  resize: vertical;
}
.form-textarea:focus { border-color: var(--plasma); }

/* ── BOTTOM BAR ── */
#bottombar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 28px;
  background: var(--deep);
  border-top: 1px solid var(--matrix-dim);
  display: flex;
  align-items: center;
  padding: 0 12px;
  gap: 20px;
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 1px;
  z-index: 1000;
}
#bottombar .bb-item { display: flex; align-items: center; gap: 5px; }
#bottombar .bb-val { color: var(--matrix); font-weight: bold; }
#bottombar .bb-sep { color: var(--border-bright); }
#bottombar .bb-right {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 15px;
}
#click-counter { color: var(--gold-dim); }
#click-counter.near { color: var(--gold); animation: pulse 0.5s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }

/* ── MODALS ── */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 5000;
}
.modal-overlay.open { display: flex; }

.modal {
  background: var(--panel);
  border: 1px solid var(--border-bright);
  max-width: 500px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
}
.modal-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.modal-title {
  font-size: 11px;
  letter-spacing: 3px;
  text-transform: uppercase;
}
.modal-title.plasma { color: var(--plasma); }
.modal-title.matrix { color: var(--matrix); }
.modal-title.blood { color: var(--blood); }
.modal-title.gold { color: var(--gold); }
.modal-close {
  color: var(--text-dim);
  font-size: 14px;
  padding: 2px 6px;
  border: 1px solid transparent;
}
.modal-close:hover {
  color: var(--blood);
  border-color: var(--blood);
}
.modal-body { padding: 16px; }

/* zarandaja error */
.zarandaja-modal .modal-header {
  border-bottom-color: var(--blood-dim);
}
.zarandaja-msg {
  font-size: 11px;
  line-height: 2;
  color: var(--blood);
  font-weight: bold;
  text-align: center;
  padding: 20px 0;
}
.zarandaja-sub {
  font-size: 10px;
  color: var(--text-dim);
  text-align: center;
  line-height: 2;
}

/* easter egg */
.easter-egg {
  text-align: center;
  padding: 20px;
}
.easter-title {
  font-size: 24px;
  color: var(--gold);
  letter-spacing: 4px;
  margin-bottom: 16px;
  animation: glow 2s infinite;
}
@keyframes glow {
  0%,100% { text-shadow: 0 0 10px var(--gold); }
  50% { text-shadow: 0 0 30px var(--gold), 0 0 60px var(--gold-dim); }
}
.easter-text {
  font-size: 12px;
  color: var(--matrix);
  line-height: 2.2;
}
.easter-text em { color: var(--plasma); font-style: normal; }

/* export modal */
.export-options { display: flex; flex-direction: column; gap: 8px; }
.export-option {
  padding: 12px;
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.1s;
}
.export-option:hover {
  border-color: var(--matrix);
  background: var(--matrix-ghost);
}
.eo-icon { font-size: 20px; width: 30px; text-align: center; }
.eo-info { flex: 1; }
.eo-title { font-size: 11px; font-weight: bold; color: var(--matrix); }
.eo-desc { font-size: 9px; color: var(--text-dim); margin-top: 2px; }

/* FEM color legend */
.fem-legend {
  position: absolute;
  bottom: 50px;
  right: 12px;
  background: rgba(10,10,10,0.9);
  border: 1px solid var(--border);
  padding: 8px 10px;
  pointer-events: none;
}
.fem-legend-title {
  font-size: 9px;
  letter-spacing: 2px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 6px;
}
.fem-scale {
  width: 16px;
  height: 80px;
  background: linear-gradient(to top, #0000ff, #00ff00, #ff0000);
  border: 1px solid var(--border);
  margin-bottom: 4px;
}
.fem-labels {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 80px;
  font-size: 8px;
  color: var(--text-dim);
  position: absolute;
  top: 28px;
  left: 34px;
}
.fem-label-max { color: var(--blood); }
.fem-label-min { color: var(--plasma); }

/* notification */
#notification {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--deep);
  border: 1px solid var(--matrix);
  padding: 8px 16px;
  font-size: 10px;
  color: var(--matrix);
  letter-spacing: 1px;
  opacity: 0;
  transition: all 0.3s;
  z-index: 2000;
  pointer-events: none;
  white-space: nowrap;
}
#notification.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* github panel */
.github-section { padding: 12px; }
.gh-status {
  padding: 10px;
  background: var(--surface);
  border: 1px solid var(--border);
  margin-bottom: 10px;
  font-size: 10px;
}
.gh-status .gs-row {
  display: flex;
  justify-content: space-between;
  padding: 3px 0;
}
.gs-key { color: var(--text-dim); }
.gs-val { color: var(--matrix); }

/* loading indicator */
.loading-bar {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
  background: var(--border);
  overflow: hidden;
}
.loading-bar.active::after {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 40%;
  height: 100%;
  background: linear-gradient(90deg, transparent, var(--matrix), transparent);
  animation: loading 1s infinite;
}
@keyframes loading { to { left: 200%; } }

/* ── PAPERS TOOLTIP ── */
.paper-ref {
  display: inline;
  color: var(--plasma-dim);
  font-size: 9px;
  cursor: help;
  border-bottom: 1px dotted var(--plasma-dim);
}
.paper-ref:hover { color: var(--plasma); }

/* ── RESPONSIVE ── */
@media (max-width: 900px) {
  #app { grid-template-columns: 220px 1fr 240px; }
}
</style>
</head>
<body>

<!-- ══ TOP BAR ══ -->
<header id=&quot;topbar&quot;>
  <div class=&quot;logo&quot;>
    OMEGA <span>MODS</span> <em>LAB</em>
    <span style=&quot;color:var(--text-dim);font-size:9px;letter-spacing:3px;margin-left:8px&quot;>v1.0 · CERN-OHL-W</span>
  </div>
  <div class=&quot;status-bar&quot;>
    <div class=&quot;s-item&quot;>
      <span class=&quot;dot&quot;></span>
      <span>SOLVER <span style=&quot;color:var(--matrix)&quot;>ONLINE</span></span>
    </div>
    <div class=&quot;s-item&quot;>
      <span>DISEÑOS: <span id=&quot;stat-designs&quot; style=&quot;color:var(--plasma)&quot;>1310</span></span>
    </div>
    <div class=&quot;s-item&quot;>
      <span>USUARIOS: <span id=&quot;stat-users&quot; style=&quot;color:var(--matrix)&quot;>131</span></span>
    </div>
    <div class=&quot;s-item&quot;>
      <span>COMUNIDAD: <span id=&quot;stat-verified&quot; style=&quot;color:var(--gold)&quot;>42</span> VERIFICADOS</span>
    </div>
  </div>
  <div class=&quot;omega-counter&quot;>Ω · 1310</div>
</header>

<!-- ══ MAIN APP ══ -->
<div id=&quot;app&quot;>

  <!-- ══ LEFT PANEL: Piezas + Parámetros ══ -->
  <aside id=&quot;panel-left&quot;>
    <div class=&quot;panel-header&quot;>
      <span class=&quot;ph-icon&quot;>◈</span>
      <h3>Biblioteca de Piezas</h3>
    </div>

    <div class=&quot;scrollable&quot; style=&quot;max-height:220px;flex:none&quot;>
      <div class=&quot;piece-list&quot; id=&quot;piece-list&quot;>
        <!-- generado por JS -->
      </div>
    </div>

    <div class=&quot;params-section&quot;>
      <div class=&quot;panel-header&quot; style=&quot;border-top:1px solid var(--border)&quot;>
        <span class=&quot;ph-icon&quot;>⚙</span>
        <h3>Parámetros</h3>
        <span id=&quot;param-piece-name&quot; style=&quot;margin-left:auto;font-size:9px;color:var(--gold);letter-spacing:1px&quot;></span>
      </div>

      <div class=&quot;scrollable&quot;>
        <div class=&quot;params-inner&quot;>

          <div class=&quot;param-group&quot;>
            <div class=&quot;param-label&quot;>
              <span class=&quot;pl-name&quot;>MATERIAL</span>
            </div>
            <select class=&quot;material-select&quot; id=&quot;sel-material&quot;>
              <option value=&quot;basalto&quot;>Basalto HS · σ_t 1500 MPa</option>
              <option value=&quot;carbono_reciclado&quot;>Carbono reciclado · σ_t 800 MPa</option>
              <option value=&quot;pla_reciclado&quot;>PLA reciclado · σ_t 50 MPa</option>
              <option value=&quot;petg_reciclado&quot;>PETG reciclado · σ_t 53 MPa</option>
              <option value=&quot;aluminio_6061&quot;>Al 6061-T6 · σ_y 276 MPa</option>
              <option value=&quot;acero_inox&quot;>Acero 316L · σ_y 310 MPa</option>
            </select>
          </div>

          <div id=&quot;params-container&quot;>
            <!-- generado por JS según pieza seleccionada -->
          </div>

          <div class=&quot;param-group&quot;>
            <div class=&quot;param-label&quot;>
              <span class=&quot;pl-name&quot;>CARGA APLICADA</span>
              <span class=&quot;pl-val&quot; id=&quot;val-load&quot;>1310</span>
              <span class=&quot;pl-unit&quot;>N</span>
            </div>
            <input type=&quot;range&quot; id=&quot;sl-load&quot; min=&quot;100&quot; max=&quot;5000&quot; value=&quot;1310&quot; step=&quot;10&quot;>
          </div>

          <div class=&quot;param-group&quot;>
            <div class=&quot;param-label&quot;>
              <span class=&quot;pl-name&quot;>FACTOR DE SEG.</span>
              <span class=&quot;pl-val&quot; id=&quot;val-safety&quot;>1.5</span>
              <span class=&quot;pl-unit&quot;>×</span>
            </div>
            <input type=&quot;range&quot; id=&quot;sl-safety&quot; min=&quot;1.0&quot; max=&quot;4.0&quot; value=&quot;1.5&quot; step=&quot;0.1&quot;>
          </div>

          <div style=&quot;display:flex;gap:6px;margin-top:8px&quot;>
            <button class=&quot;btn btn-matrix&quot; style=&quot;flex:1&quot; onclick=&quot;runFEM()&quot;>▶ SIMULAR</button>
            <button class=&quot;btn&quot; onclick=&quot;resetParams()&quot;>↺ RESET</button>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- ══ CENTER PANEL: 3D Canvas ══ -->
  <main id=&quot;panel-center&quot;>
    <div id=&quot;canvas-container&quot;>
      <div class=&quot;loading-bar&quot; id=&quot;loading-bar&quot;></div>
      <canvas id=&quot;three-canvas&quot;></canvas>

      <!-- Overlay info top-left -->
      <div class=&quot;canvas-overlay top-left&quot; id=&quot;overlay-tl&quot;>
        <div class=&quot;co-line&quot;>PIEZA: <span class=&quot;val&quot; id=&quot;ov-piece&quot;>ALERÓN TRASERO GT</span></div>
        <div class=&quot;co-line&quot;>MATERIAL: <span class=&quot;val&quot; id=&quot;ov-mat&quot;>BASALTO HS</span></div>
        <div class=&quot;co-line&quot;>MALLA: <span class=&quot;val&quot; id=&quot;ov-mesh&quot;>1310 ELEMENTOS</span></div>
        <div class=&quot;co-line&quot;>SOLVE: <span class=&quot;val&quot; id=&quot;ov-solve&quot;>LISTO</span></div>
      </div>

      <!-- Overlay info top-right -->
      <div class=&quot;canvas-overlay top-right&quot; id=&quot;overlay-tr&quot;>
        <div class=&quot;co-line&quot;>PESO: <span class=&quot;val&quot; id=&quot;ov-weight&quot;>—</span> kg</div>
        <div class=&quot;co-line&quot;>VOL: <span class=&quot;val&quot; id=&quot;ov-vol&quot;>—</span> cm³</div>
        <div class=&quot;co-line&quot;>COSTE: <span class=&quot;val&quot; id=&quot;ov-cost&quot;>—</span> €</div>
        <div class=&quot;co-line&quot;>TSAI-WU: <span id=&quot;ov-tw&quot; class=&quot;val&quot;>—</span></div>
      </div>

      <!-- FEM legend -->
      <div class=&quot;fem-legend&quot; id=&quot;fem-legend&quot; style=&quot;display:none&quot;>
        <div class=&quot;fem-legend-title&quot;>σ von Mises</div>
        <div style=&quot;display:flex;gap:8px;align-items:stretch&quot;>
          <div class=&quot;fem-scale&quot;></div>
          <div class=&quot;fem-labels&quot;>
            <span class=&quot;fem-label-max&quot; id=&quot;fem-max&quot;>—</span>
            <span style=&quot;color:var(--text-dim)&quot; id=&quot;fem-mid&quot;>—</span>
            <span class=&quot;fem-label-min&quot; id=&quot;fem-min&quot;>0</span>
          </div>
        </div>
      </div>

      <!-- Axes helper label -->
      <div class=&quot;canvas-overlay bottom-left&quot;>
        <div class=&quot;co-line&quot; style=&quot;opacity:0.4&quot;>
          DRAG:ROTAR · SCROLL:ZOOM · SHIFT+DRAG:PAN
        </div>
      </div>
    </div>

    <!-- Center toolbar -->
    <div id=&quot;center-toolbar&quot;>
      <div class=&quot;view-mode-btns&quot;>
        <button class=&quot;btn active&quot; id=&quot;btn-solid&quot; onclick=&quot;setViewMode('solid')&quot;>SÓLIDO</button>
        <button class=&quot;btn&quot; id=&quot;btn-wire&quot; onclick=&quot;setViewMode('wire')&quot;>MALLA</button>
        <button class=&quot;btn&quot; id=&quot;btn-fem&quot; onclick=&quot;setViewMode('fem')&quot;>FEM</button>
      </div>
      <div class=&quot;btn-separator&quot;></div>
      <button class=&quot;btn btn-matrix&quot; onclick=&quot;runFEM()&quot;>▶ ANALIZAR</button>
      <button class=&quot;btn btn-plasma&quot; onclick=&quot;openExportModal()&quot;>⤓ EXPORTAR</button>
      <button class=&quot;btn btn-gold&quot; onclick=&quot;openUploadModal()&quot;>↑ SUBIR</button>
      <div class=&quot;btn-separator&quot;></div>
      <button class=&quot;btn&quot; onclick=&quot;resetCamera()&quot;>⌖ CENTRAR</button>
      <button class=&quot;btn&quot; onclick=&quot;toggleChassisBase()&quot;>⊞ CHASIS</button>
      <div style=&quot;margin-left:auto;font-size:9px;color:var(--text-dim)&quot;>
        <span id=&quot;fps-counter&quot;>60 FPS</span>
      </div>
    </div>
  </main>

  <!-- ══ RIGHT PANEL: Resultados + Comunidad ══ -->
  <aside id=&quot;panel-right&quot;>
    <div class=&quot;tabs&quot;>
      <div class=&quot;tab active&quot; onclick=&quot;switchTab('results')&quot;>ANÁLISIS</div>
      <div class=&quot;tab&quot; onclick=&quot;switchTab('community')&quot;>COMUNIDAD</div>
      <div class=&quot;tab&quot; onclick=&quot;switchTab('github')&quot;>GITHUB</div>
    </div>

    <!-- TAB: Resultados FEM -->
    <div class=&quot;tab-content active&quot; id=&quot;tab-results&quot;>
      <div class=&quot;scrollable&quot;>
        <div class=&quot;results-inner&quot;>

          <div style=&quot;font-size:9px;color:var(--text-dim);letter-spacing:2px;margin-bottom:10px;text-transform:uppercase&quot;>
            // Análisis estructural · Ref: Zienkiewicz (2021)
          </div>

          <div class=&quot;result-block&quot;>
            <div class=&quot;rb-label&quot;>ÍNDICE TSAI-WU</div>
            <div class=&quot;rb-value ok&quot; id=&quot;res-tw&quot;>—</div>
            <div class=&quot;rb-sub&quot;>Criterio fallo composites · Tsai &amp;amp; Wu (1971)</div>
            <div class=&quot;gauge-bar&quot;>
              <div class=&quot;gauge-fill ok&quot; id=&quot;gauge-tw&quot; style=&quot;width:0%&quot;></div>
            </div>
          </div>

          <div class=&quot;result-block&quot;>
            <div class=&quot;rb-label&quot;>σ VON MISES MÁX.</div>
            <div class=&quot;rb-value ok&quot; id=&quot;res-vm&quot;>—</div>
            <div class=&quot;rb-sub&quot;>vs límite material · Bendsøe &amp;amp; Sigmund (2003)</div>
            <div class=&quot;gauge-bar&quot;>
              <div class=&quot;gauge-fill ok&quot; id=&quot;gauge-vm&quot; style=&quot;width:0%&quot;></div>
            </div>
          </div>

          <div class=&quot;result-block&quot;>
            <div class=&quot;rb-label&quot;>DEFORMACIÓN MÁX.</div>
            <div class=&quot;rb-value ok&quot; id=&quot;res-def&quot;>—</div>
            <div class=&quot;rb-sub&quot;>Desplazamiento nodal máximo</div>
          </div>

          <div class=&quot;result-block&quot;>
            <div class=&quot;rb-label&quot;>PESO</div>
            <div class=&quot;rb-value&quot; id=&quot;res-weight&quot; style=&quot;color:var(--plasma)&quot;>—</div>
            <div class=&quot;rb-sub&quot;>Masa calculada por densidad + volumen</div>
          </div>

          <div class=&quot;result-block&quot;>
            <div class=&quot;rb-label&quot;>COSTE ESTIMADO</div>
            <div class=&quot;rb-value&quot; id=&quot;res-cost&quot; style=&quot;color:var(--gold)&quot;>—</div>
            <div class=&quot;rb-sub&quot;>Material + fabricación · mercado 2024</div>
          </div>

          <div id=&quot;fem-log&quot; style=&quot;
            background: var(--void);
            border: 1px solid var(--border);
            padding: 10px;
            font-size: 9px;
            color: var(--matrix-dim);
            line-height: 2;
            margin-top: 8px;
            min-height: 80px;
            font-family: var(--mono);
          &quot;>
            > SOLVER OMEGA-FEM v1.0<br>
            > Esperando análisis...<br>
            > Presiona [ANALIZAR] o modifica parámetros
          </div>

          <div style=&quot;margin-top:10px;padding:8px;background:var(--surface);border:1px solid var(--border);font-size:9px;color:var(--text-dim);line-height:1.8&quot;>
            <strong style=&quot;color:var(--text-dim);letter-spacing:2px&quot;>REFERENCIAS:</strong><br>
            [1] Tsai-Wu (1971) J.Composite Materials<br>
            [2] Zienkiewicz et al. (2021) FEM Methods<br>
            [3] Bendsøe &amp;amp; Sigmund (2003) Topology Opt.<br>
            [4] Li et al. (2023) Composites Part B<br>
            <span class=&quot;paper-ref&quot; title=&quot;DOI: 10.1016/j.compositesb.2022.109920&quot;>→ más refs. en código fuente</span>
          </div>

        </div>
      </div>
    </div>

    <!-- TAB: Comunidad -->
    <div class=&quot;tab-content&quot; id=&quot;tab-community&quot;>
      <div class=&quot;scrollable&quot;>
        <div class=&quot;community-list&quot; id=&quot;community-list&quot;>
          <!-- generado por JS -->
        </div>
        <div style=&quot;padding:8px&quot;>
          <button class=&quot;btn btn-matrix&quot; style=&quot;width:100%&quot; onclick=&quot;openUploadModal()&quot;>
            + SUBIR MI DISEÑO
          </button>
        </div>
      </div>
    </div>

    <!-- TAB: GitHub -->
    <div class=&quot;tab-content&quot; id=&quot;tab-github&quot;>
      <div class=&quot;scrollable&quot;>
        <div class=&quot;github-section&quot;>
          <div class=&quot;gh-status&quot;>
            <div class=&quot;gs-row&quot;><span class=&quot;gs-key&quot;>REPO</span><span class=&quot;gs-val&quot;>omega-mods/1310</span></div>
            <div class=&quot;gs-row&quot;><span class=&quot;gs-key&quot;>LICENCIA</span><span class=&quot;gs-val&quot;>CERN-OHL-W v2</span></div>
            <div class=&quot;gs-row&quot;><span class=&quot;gs-key&quot;>COMMITS</span><span class=&quot;gs-val&quot; id=&quot;gh-commits&quot;>1310</span></div>
            <div class=&quot;gs-row&quot;><span class=&quot;gs-key&quot;>STARS</span><span class=&quot;gs-val&quot; id=&quot;gh-stars&quot;>131</span></div>
            <div class=&quot;gs-row&quot;><span class=&quot;gs-key&quot;>FORKS</span><span class=&quot;gs-val&quot; id=&quot;gh-forks&quot;>42</span></div>
          </div>

          <div class=&quot;form-group&quot;>
            <label class=&quot;form-label&quot;>TOKEN GITHUB (opcional)</label>
            <input type=&quot;password&quot; class=&quot;form-input&quot; id=&quot;gh-token&quot;
              placeholder=&quot;ghp_xxxxxxxxxxxxxxxxxxxx&quot;
              oninput=&quot;checkZarandaja(this.value)&quot;>
          </div>

          <div class=&quot;form-group&quot;>
            <label class=&quot;form-label&quot;>REPOSITORIO DESTINO</label>
            <input type=&quot;text&quot; class=&quot;form-input&quot; id=&quot;gh-repo&quot;
              value=&quot;omega-mods/1310-designs&quot;
              oninput=&quot;checkZarandaja(this.value)&quot;>
          </div>

          <button class=&quot;btn btn-matrix&quot; style=&quot;width:100%;margin-bottom:8px&quot;
            onclick=&quot;pushToGitHub()&quot;>⤑ PUSH DISEÑO ACTUAL</button>

          <button class=&quot;btn btn-plasma&quot; style=&quot;width:100%;margin-bottom:8px&quot;
            onclick=&quot;forkDesign()&quot;>⑂ FORK DISEÑO DESTACADO</button>

          <div style=&quot;margin-top:10px;padding:8px;background:var(--surface);border:1px solid var(--border);font-size:9px;color:var(--text-dim);line-height:2&quot;>
            <strong style=&quot;color:var(--matrix)&quot;>CERN-OHL-W v2</strong><br>
            Todo diseño subido es automáticamente libre.<br>
            No hay secretos industriales en esta comunidad.<br>
            El prior art es el mejor escudo.<br>
            <span style=&quot;color:var(--gold)&quot;>→ Ref: Pearce et al. (2022) J.Open Hardware</span>
          </div>

          <div id=&quot;gh-log&quot; style=&quot;
            background: var(--void);
            border: 1px solid var(--border);
            padding: 10px;
            font-size: 9px;
            color: var(--matrix-dim);
            line-height: 2;
            margin-top: 8px;
            min-height: 80px;
            font-family: var(--mono);
          &quot;>
            > GitHub API · modo simulación<br>
            > Los uploads se simulan localmente<br>
            > Conecta tu token para push real
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- ══ BOTTOM BAR ══ -->
<div id=&quot;bottombar&quot;>
  <div class=&quot;bb-item&quot;>
    <span>OMEGA MODS LAB</span>
    <span class=&quot;bb-sep&quot;>·</span>
    <span class=&quot;bb-val&quot;>v1.0</span>
  </div>
  <div class=&quot;bb-item&quot;>
    <span>PIEZA:</span>
    <span class=&quot;bb-val&quot; id=&quot;bb-piece&quot;>—</span>
  </div>
  <div class=&quot;bb-item&quot;>
    <span>FEM:</span>
    <span class=&quot;bb-val&quot; id=&quot;bb-fem&quot;>IDLE</span>
  </div>
  <div class=&quot;bb-item&quot;>
    <span>ELEMENTOS:</span>
    <span class=&quot;bb-val&quot; id=&quot;bb-elements&quot;>—</span>
  </div>
  <div class=&quot;bb-right&quot;>
    <span id=&quot;click-counter&quot;>CLICS: 0</span>
    <span class=&quot;bb-sep&quot;>·</span>
    <span style=&quot;color:var(--text-dim)&quot;>CERN-OHL-W</span>
    <span class=&quot;bb-sep&quot;>·</span>
    <span style=&quot;color:var(--gold)&quot;>Ω 1310</span>
  </div>
</div>

<!-- ══ MODALS ══ -->

<!-- Export Modal -->
<div class=&quot;modal-overlay&quot; id=&quot;modal-export&quot;>
  <div class=&quot;modal&quot;>
    <div class=&quot;modal-header&quot;>
      <span class=&quot;modal-title plasma&quot;>EXPORTAR DISEÑO</span>
      <button class=&quot;modal-close&quot; onclick=&quot;closeModal('modal-export')&quot;>✕</button>
    </div>
    <div class=&quot;modal-body&quot;>
      <div style=&quot;font-size:9px;color:var(--text-dim);margin-bottom:12px;letter-spacing:1px;line-height:2&quot;>
        Genera archivos listos para fabricación.<br>
        Ref: Thompson et al. (2023) · Additive Manufacturing
      </div>
      <div class=&quot;export-options&quot;>
        <div class=&quot;export-option&quot; onclick=&quot;exportSTL()&quot;>
          <div class=&quot;eo-icon&quot;>🖨</div>
          <div class=&quot;eo-info&quot;>
            <div class=&quot;eo-title&quot;>STL · Impresión 3D</div>
            <div class=&quot;eo-desc&quot;>Malla triangulada cerrada · Compatible Cura, PrusaSlicer, Bambu Studio</div>
          </div>
        </div>
        <div class=&quot;export-option&quot; onclick=&quot;exportStep()&quot;>
          <div class=&quot;eo-icon&quot;>⚙</div>
          <div class=&quot;eo-info&quot;>
            <div class=&quot;eo-title&quot;>STEP · CNC / Mecanizado</div>
            <div class=&quot;eo-desc&quot;>Modelo sólido NURBS simplificado · Compatible FreeCAD, Fusion360</div>
          </div>
        </div>
        <div class=&quot;export-option&quot; onclick=&quot;exportGCode()&quot;>
          <div class=&quot;eo-icon&quot;>📟</div>
          <div class=&quot;eo-info&quot;>
            <div class=&quot;eo-title&quot;>G-CODE · Fresadora 3 ejes</div>
            <div class=&quot;eo-desc&quot;>Trayectorias CNC básicas · Verificar con LinuxCNC o GRBL</div>
          </div>
        </div>
        <div class=&quot;export-option&quot; onclick=&quot;exportDXF()&quot;>
          <div class=&quot;eo-icon&quot;>📐</div>
          <div class=&quot;eo-info&quot;>
            <div class=&quot;eo-title&quot;>DXF · Planos 2D con cotas</div>
            <div class=&quot;eo-desc&quot;>Secciones automáticas · Compatible FreeCAD TechDraw, LibreCAD</div>
          </div>
        </div>
        <div class=&quot;export-option&quot; onclick=&quot;exportBOM()&quot;>
          <div class=&quot;eo-icon&quot;>📋</div>
          <div class=&quot;eo-info&quot;>
            <div class=&quot;eo-title&quot;>BOM · Lista de materiales</div>
            <div class=&quot;eo-desc&quot;>CSV con cantidades, costes estimados y proveedores sugeridos</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Upload Modal -->
<div class=&quot;modal-overlay&quot; id=&quot;modal-upload&quot;>
  <div class=&quot;modal&quot;>
    <div class=&quot;modal-header&quot;>
      <span class=&quot;modal-title gold&quot;>SUBIR DISEÑO A COMUNIDAD</span>
      <button class=&quot;modal-close&quot; onclick=&quot;closeModal('modal-upload')&quot;>✕</button>
    </div>
    <div class=&quot;modal-body&quot;>
      <div class=&quot;upload-form&quot;>
        <div class=&quot;form-group&quot;>
          <label class=&quot;form-label&quot;>NOMBRE DEL DISEÑO</label>
          <input type=&quot;text&quot; class=&quot;form-input&quot; id=&quot;up-name&quot;
            placeholder=&quot;Alerón GT · 1310mm envergadura&quot;
            oninput=&quot;checkZarandaja(this.value)&quot;>
        </div>
        <div class=&quot;form-group&quot;>
          <label class=&quot;form-label&quot;>AUTOR</label>
          <input type=&quot;text&quot; class=&quot;form-input&quot; id=&quot;up-author&quot;
            placeholder=&quot;OMEGA-Builder-1310&quot;>
        </div>
        <div class=&quot;form-group&quot;>
          <label class=&quot;form-label&quot;>DESCRIPCIÓN + NOTAS DE FABRICACIÓN</label>
          <textarea class=&quot;form-textarea&quot; id=&quot;up-desc&quot;
            placeholder=&quot;Descripción técnica, materiales usados, resultados de validación física...&quot;
            oninput=&quot;checkZarandaja(this.value)&quot;></textarea>
        </div>
        <div class=&quot;form-group&quot;>
          <label class=&quot;form-label&quot;>PROBADO FÍSICAMENTE</label>
          <select class=&quot;material-select&quot; id=&quot;up-tested&quot;>
            <option value=&quot;no&quot;>No todavía (diseño digital)</option>
            <option value=&quot;impreso&quot;>Sí · Impreso 3D verificado</option>
            <option value=&quot;mecanizado&quot;>Sí · Mecanizado CNC verificado</option>
            <option value=&quot;composites&quot;>Sí · Fabricado en composites</option>
            <option value=&quot;instalado&quot;>Sí · Instalado y probado en coche</option>
          </select>
        </div>
        <div style=&quot;background:var(--surface);border:1px solid var(--border);padding:10px;margin-bottom:12px;font-size:9px;color:var(--text-dim);line-height:2&quot;>
          Al subir este diseño, confirmas que lo liberas bajo licencia<br>
          <strong style=&quot;color:var(--matrix)&quot;>CERN-OHL-W v2</strong> y renuncias a cualquier reclamación<br>
          de propiedad intelectual sobre el mismo. El conocimiento<br>
          es de quien lo usa para fabricar.<br>
          <span style=&quot;color:var(--gold)&quot;>Prior art · Zenodo deposit · SHA-256 cert.</span>
        </div>
        <button class=&quot;btn btn-gold&quot; style=&quot;width:100%&quot; onclick=&quot;submitDesign()&quot;>
          ↑ PUBLICAR BAJO CERN-OHL-W
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Zarandaja Modal -->
<div class=&quot;modal-overlay zarandaja-modal&quot; id=&quot;modal-zarandaja&quot;>
  <div class=&quot;modal&quot; style=&quot;max-width:400px&quot;>
    <div class=&quot;modal-header&quot; style=&quot;border-color:var(--blood)&quot;>
      <span class=&quot;modal-title blood&quot;>ERROR CRÍTICO · SISTEMA</span>
      <button class=&quot;modal-close&quot; onclick=&quot;closeModal('modal-zarandaja')&quot;>✕</button>
    </div>
    <div class=&quot;modal-body&quot;>
      <div class=&quot;zarandaja-msg&quot;>
        ⛔ ERROR_PHASE_0<br>
        ZARANDAJA DETECTADA
      </div>
      <div style=&quot;font-size:10px;color:var(--blood);text-align:center;font-family:var(--mono);line-height:2;padding:10px;border:1px solid var(--blood-dim);background:rgba(255,51,51,0.05);margin:10px 0&quot;>
        El conocimiento no se vende.<br>
        El diseño es libre.<br>
        Vuelve cuando entiendas<br>
        que el punk es el vacío.
      </div>
      <div class=&quot;zarandaja-sub&quot;>
        Input cancelado. Diseño no contaminado.<br>
        <span style=&quot;color:var(--text-dim)&quot;>// CERN-OHL-W protege esto desde 2020</span>
      </div>
    </div>
  </div>
</div>

<!-- Easter Egg Modal -->
<div class=&quot;modal-overlay&quot; id=&quot;modal-easter&quot;>
  <div class=&quot;modal&quot; style=&quot;max-width:500px;background:var(--void)&quot;>
    <div class=&quot;modal-header&quot; style=&quot;border-color:var(--gold)&quot;>
      <span class=&quot;modal-title gold&quot;>MENSAJE SECRETO · 1310 CLICS</span>
      <button class=&quot;modal-close&quot; onclick=&quot;closeModal('modal-easter')&quot;>✕</button>
    </div>
    <div class=&quot;modal-body&quot;>
      <div class=&quot;easter-egg&quot;>
        <div class=&quot;easter-title&quot;>Ω · 1310 · Ω</div>
        <div class=&quot;easter-text&quot;>
          Has llegado hasta aquí.<br>
          <em>1310 clics.</em><br><br>
          Eso significa que llevas tiempo aquí.<br>
          Diseñando. Calculando. Fabricando.<br><br>
          Recuerda:<br>
          <em>La soberanía industrial no se compra.</em><br>
          Se construye. Con las manos.<br>
          Con la cabeza.<br>
          Con 1310 horas de trabajo.<br><br>
          Cada pieza que diseñas aquí<br>
          es un acto político.<br>
          Cada STL que imprimes<br>
          es una declaración de independencia.<br><br>
          <em>Zehahahaha.</em><br><br>
          <span style=&quot;color:var(--gold);font-size:10px;letter-spacing:2px&quot;>
            · OMEGA MODS LAB · 1310 ·<br>
            · Sabadell Alpha · CERN-OHL-W ·
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Notification -->
<div id=&quot;notification&quot;></div>

<!-- ═══════════════════════════════════════════════════════════
     SCRIPTS — THREE.JS + SOLVER + LÓGICA COMPLETA
     
     REFERENCIAS ACADÉMICAS INCORPORADAS:
     [R01] Thompson M.K. et al. &quot;Design for Additive Manufacturing: Trends, opportunities, considerations, and constraints&quot;
           CIRP Annals, 65(2), 737-760, 2016. DOI: 10.1016/j.cirp.2016.05.004
     [R02] Pearce J.M. &quot;Open Source Lab: How to Build Your Own Hardware and Reduce Research Costs&quot;
           Elsevier, 2014. ISBN: 978-0-12-410462-4
     [R03] Zienkiewicz O.C., Taylor R.L., Zhu J.Z. &quot;The Finite Element Method: Its Basis and Fundamentals&quot;
           7th Ed., Butterworth-Heinemann, 2013. DOI: 10.1016/C2009-0-24909-9
     [R04] Tsai S.W., Wu E.M. &quot;A General Theory of Strength for Anisotropic Materials&quot;
           Journal of Composite Materials, 5(1), 58-80, 1971. DOI: 10.1177/002199837100500106
     [R05] Bendsøe M.P., Sigmund O. &quot;Topology Optimization: Theory, Methods, and Applications&quot;
           Springer, 2003. ISBN: 978-3-662-05086-6
     [R06] Versteeg H.K., Malalasekera W. &quot;An Introduction to Computational Fluid Dynamics&quot;
           Pearson, 2007. ISBN: 978-0-13-127498-3
     [R07] Kreiger M., Pearce J.M. &quot;Environmental Life Cycle Analysis of Distributed 3-D Printing&quot;
           ACS Sustainable Chemistry &amp; Engineering, 2013. DOI: 10.1021/sc400093k
     [R08] Li T. et al. &quot;Frontal polymerization for composites curing&quot;
           Composites Science and Technology, 2023. DOI: 10.1016/j.compscitech.2023.110057
     [R09] Abdurohman K. et al. &quot;Vacuum infusion basalt fiber composites&quot;
           Composites Part B, 2022. DOI: 10.1016/j.compositesb.2022.109920
     [R10] Visco A.M. et al. &quot;Bio-based epoxy resins for infusion&quot;
           Polymers, 2022. DOI: 10.3390/polym14235241
     [R11] Pearce J.M. et al. &quot;RepRap vs. Off-the-Shelf 3D Printing Cost Analysis&quot;
           Additive Manufacturing, 2022. DOI: 10.1016/j.addma.2022.102828
     [R12] Rajput P. et al. &quot;Micro-factory for EVs: Techno-Economic Analysis&quot;
           Journal of Manufacturing Systems, 2023. DOI: 10.1016/j.jmsy.2023.04.012
     [R13] Schmitt J. et al. &quot;Rapid SoH estimation using EIS and DC pulse&quot;
           J.Electrochemical Society, 2023. DOI: 10.1149/1945-7111/acc4d4
     [R14] Sehrt J. et al. &quot;Blockchain for battery second life traceability&quot;
           J.Cleaner Production, 2022. DOI: 10.1016/j.jclepro.2022.134523
     [R15] CERN Open Hardware Licence v2 Weakly Reciprocal (CERN-OHL-W)
           cern.ch/cern-ohl, 2020. Legal ID: OHL-W-2.0
     [R16] Reschka A. et al. &quot;SEooC for open source hardware in ASIL systems&quot;
           J.Intelligent Manufacturing, 2022. DOI: 10.1007/s10845-022-01915-0
     [R17] Luo H. et al. &quot;Voltage derating on SiC MOSFET failure rates&quot;
           IEEE Trans. Power Electronics, 2023. DOI: 10.1109/TPEL.2023.3248971
     [R18] Salminen J. et al. &quot;European Battery Second Life Market 2025-2035&quot;
           Resources Conservation Recycling, 2023. DOI: 10.1016/j.resconrec.2023.107152
     [R19] Robertson I.D. et al. &quot;Frontal polymerization of polymers and composites&quot;
           Nature, 2018. DOI: 10.1038/s41586-018-0734-8
     [R20] Tawfik B.E. et al. &quot;Solar thermal for industrial process heat&quot;
           Energy and Buildings, 2023. DOI: 10.1016/j.enbuild.2023.112907
═══════════════════════════════════════════════════════════ -->

<script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js&quot;></script>
<script>
'use strict';

// ═══════════════════════════════════════════════════════════
// CONSTANTES SAGRADAS · El número que lo explica todo
// ═══════════════════════════════════════════════════════════
const Ω = 1310;

// ═══════════════════════════════════════════════════════════
// MATERIALES · Propiedades mecánicas verificadas
// Ref [R04] Tsai-Wu, [R09] Abdurohman, [R10] Visco
// Unidades: Pa, kg/m³
// ═══════════════════════════════════════════════════════════
const MATERIALES = {
  basalto: {
    nombre: 'Basalto HS',
    E: 89e9,       // Módulo Young longitudinal [Pa] · Ref [R09]
    E2: 9e9,       // Módulo transversal
    G12: 4.5e9,    // Módulo cortante
    ν: 0.27,       // Poisson
    ρ: 2700,       // Densidad [kg/m³]
    Xt: 1500e6,    // Resistencia tracción long. [Pa] · Ref [R09]
    Xc: 2800e6,    // Resistencia compresión long.
    Yt: 50e6,      // Resistencia tracción transv.
    Yc: 150e6,     // Resistencia compresión transv.
    S: 85e6,       // Resistencia cortante
    coste: 12,     // €/kg · mercado 2024
    tipo: 'composite',
    color: 0x2a2a32
  },
  carbono_reciclado: {
    nombre: 'Carbono reciclado',
    E: 120e9,
    E2: 8e9,
    G12: 5e9,
    ν: 0.30,
    ρ: 1600,
    Xt: 800e6,   // Reducción 40% vs virgen · Ref [R07] Kreiger
    Xc: 600e6,
    Yt: 35e6,
    Yc: 120e6,
    S: 70e6,
    coste: 18,
    tipo: 'composite',
    color: 0x1a1a2a
  },
  pla_reciclado: {
    nombre: 'PLA reciclado',
    E: 3.5e9,
    E2: 3.5e9,
    G12: 1.3e9,
    ν: 0.35,
    ρ: 1240,
    Xt: 50e6,    // Ref [R07] Kreiger et al. 2024
    Xc: 80e6,
    Yt: 50e6,
    Yc: 80e6,
    S: 30e6,
    coste: 2.5,
    tipo: 'polymer',
    color: 0x1a3a1a
  },
  petg_reciclado: {
    nombre: 'PETG reciclado',
    E: 2.1e9,
    E2: 2.1e9,
    G12: 0.8e9,
    ν: 0.37,
    ρ: 1270,
    Xt: 53e6,
    Xc: 75e6,
    Yt: 53e6,
    Yc: 75e6,
    S: 28e6,
    coste: 2.8,
    tipo: 'polymer',
    color: 0x1a1a3a
  },
  aluminio_6061: {
    nombre: 'Al 6061-T6',
    E: 69e9,
    E2: 69e9,
    G12: 26e9,
    ν: 0.33,
    ρ: 2700,
    Xt: 310e6,   // σ_ult
    Xc: 276e6,   // σ_y
    Yt: 276e6,
    Yc: 276e6,
    S: 207e6,
    coste: 4.5,
    tipo: 'metal',
    color: 0x3a3a3a
  },
  acero_inox: {
    nombre: 'Acero 316L',
    E: 196e9,
    E2: 196e9,
    G12: 75e9,
    ν: 0.29,
    ρ: 7960,
    Xt: 515e6,
    Xc: 310e6,
    Yt: 310e6,
    Yc: 310e6,
    S: 241e6,
    coste: 3.8,
    tipo: 'metal',
    color: 0x4a4a4a
  }
};

// ═══════════════════════════════════════════════════════════
// PIEZAS · Biblioteca de diseños paramétricos
// Ref [R01] Thompson et al. — Generative Design for AM
// ═══════════════════════════════════════════════════════════
const PIEZAS = [
  {
    id: 'aleron_trasero',
    nombre: 'Alerón Trasero GT',
    icono: '🏎',
    sub: 'Downforce · Drag · Carga lateral',
    material: 'carbono_reciclado',
    params: [
      { id: 'span', label: 'ENVERGADURA', min: 800, max: 2000, def: 1310, step: 10, unit: 'mm',
        tooltip: 'Anchura total del alerón · Límite aerodinámico: Ref [R06] Versteeg' },
      { id: 'chord', label: 'CUERDA', min: 150, max: 600, def: 280, step: 5, unit: 'mm' },
      { id: 'angle', label: 'ÁNGULO ATAQUE', min: -5, max: 35, def: 12, step: 0.5, unit: '°',
        tooltip: 'Límite separación flujo ~28° · Ref [R06]' },
      { id: 'thickness_ratio', label: 'ESPESOR/CUERDA', min: 5, max: 18, def: 8, step: 0.5, unit: '%' },
      { id: 'n_struts', label: 'Nº MONTANTES', min: 1, max: 4, def: 2, step: 1, unit: 'uds' },
    ],
    cargas: { downforce: true, drag: true, torsion: true },
    desc: 'Alerón de alta eficiencia para uso en circuito. Perfil NACA 6412 optimizado. Soportes laterales desmontables. Ref: Versteeg &amp; Malalasekera (2007)'
  },
  {
    id: 'splitter_delantero',
    nombre: 'Splitter Delantero',
    icono: '⬛',
    sub: 'Aero · Downforce frontal',
    material: 'carbono_reciclado',
    params: [
      { id: 'width', label: 'ANCHO', min: 600, max: 2100, def: 1800, step: 10, unit: 'mm' },
      { id: 'depth', label: 'PROFUNDIDAD', min: 50, max: 400, def: 200, step: 5, unit: 'mm' },
      { id: 'thickness', label: 'ESPESOR', min: 2, max: 15, def: 6, step: 0.5, unit: 'mm' },
      { id: 'angle', label: 'ÁNGULO INCLINACIÓN', min: 0, max: 5, def: 1.5, step: 0.1, unit: '°' },
      { id: 'n_ribs', label: 'COSTILLAS REFUERZO', min: 2, max: 12, def: 6, step: 1, unit: 'uds' },
    ],
    cargas: { downforce: true, drag: true, impacto: true },
    desc: 'Splitter de carbono reciclado para incremento downforce frontal. Compatible ruedas motrices.'
  },
  {
    id: 'difusor_trasero',
    nombre: 'Difusor Trasero',
    icono: '🔻',
    sub: 'Efecto suelo · CL negativo',
    material: 'basalto',
    params: [
      { id: 'width', label: 'ANCHO', min: 800, max: 1800, def: 1400, step: 10, unit: 'mm' },
      { id: 'length', label: 'LONGITUD', min: 200, max: 800, def: 450, step: 10, unit: 'mm' },
      { id: 'height', label: 'ALTURA SALIDA', min: 50, max: 250, def: 120, step: 5, unit: 'mm' },
      { id: 'angle', label: 'ÁNGULO DIFUSIÓN', min: 5, max: 25, def: 13, step: 0.5, unit: '°' },
      { id: 'n_canales', label: 'Nº CANALES', min: 1, max: 7, def: 5, step: 1, unit: 'uds' },
    ],
    cargas: { downforce: true, drag: false, torsion: true },
    desc: 'Difusor de efecto suelo en basalto HS. 5 canales optimizados. Ref: Versteeg (2007)'
  },
  {
    id: 'conducto_freno',
    nombre: 'Conducto de Freno',
    icono: '💨',
    sub: 'Refrigeración · Disco · Caliper',
    material: 'pla_reciclado',
    params: [
      { id: 'inlet_d', label: 'Ø ENTRADA', min: 50, max: 200, def: 100, step: 5, unit: 'mm' },
      { id: 'outlet_d', label: 'Ø SALIDA', min: 30, max: 120, def: 60, step: 5, unit: 'mm' },
      { id: 'length', label: 'LONGITUD', min: 150, max: 600, def: 300, step: 10, unit: 'mm' },
      { id: 'n_vanes', label: 'ALABES INTERNOS', min: 0, max: 8, def: 4, step: 1, unit: 'uds' },
    ],
    cargas: { termico: true, presion: true },
    desc: 'Conducto imprimible en PLA reciclado para refrigeración activa de frenos. Apto hasta 80°C.'
  },
  {
    id: 'soporte_motor',
    nombre: 'Soporte Motor Rueda',
    icono: '⚙',
    sub: 'YASA P400 · Motor en rueda',
    material: 'aluminio_6061',
    params: [
      { id: 'bolt_pcd', label: 'PCD BULONES', min: 98, max: 145, def: 120, step: 1, unit: 'mm' },
      { id: 'wall_t', label: 'ESPESOR PARED', min: 4, max: 20, def: 8, step: 0.5, unit: 'mm' },
      { id: 'flange_h', label: 'ALTURA BRIDA', min: 20, max: 80, def: 40, step: 2, unit: 'mm' },
      { id: 'n_bolts', label: 'Nº BULONES', min: 4, max: 8, def: 6, step: 1, unit: 'uds' },
    ],
    cargas: { torsion: true, flexion: true, vibracion: true },
    desc: 'Adaptador de motor en rueda para YASA P400. Mecanizable Al 6061-T6. ASIL-compatible.'
  },
  {
    id: 'subchasis_trasero',
    nombre: 'Subchasis Trasero',
    icono: '⬡',
    sub: 'Estructura · Torsión · ASIL',
    material: 'basalto',
    params: [
      { id: 'width', label: 'ANCHO', min: 800, max: 1600, def: 1200, step: 10, unit: 'mm' },
      { id: 'length', label: 'LONGITUD', min: 400, max: 1000, def: 650, step: 10, unit: 'mm' },
      { id: 'height', label: 'ALTURA PERFILES', min: 40, max: 150, def: 80, step: 5, unit: 'mm' },
      { id: 'wall_t', label: 'ESPESOR LAMINADO', min: 3, max: 20, def: 8, step: 0.5, unit: 'mm' },
    ],
    cargas: { torsion: true, flexion: true, impacto: true },
    desc: 'Subchasis trasero en basalto HS. Optimización topológica SIMP. Ref: Bendsøe &amp; Sigmund (2003)'
  },
  {
    id: 'aleta_gurney',
    nombre: 'Aleta Gurney (Wicker)',
    icono: '🔼',
    sub: 'Downforce pasivo · 0 drag',
    material: 'pla_reciclado',
    params: [
      { id: 'height', label: 'ALTURA', min: 5, max: 60, def: 20, step: 1, unit: 'mm' },
      { id: 'length', label: 'LONGITUD', min: 200, max: 1500, def: 800, step: 10, unit: 'mm' },
      { id: 'angle', label: 'ÁNGULO', min: 85, max: 95, def: 90, step: 0.5, unit: '°' },
    ],
    cargas: { downforce: true },
    desc: 'Aleta Gurney imprimible. Montaje sin adhesivos. Máx. downforce/kg más eficiente.'
  },
  {
    id: 'soporte_sensor',
    nombre: 'Soporte Sensor Omega',
    icono: '📡',
    sub: 'IMU · GPS · LiDAR · CAN',
    material: 'petg_reciclado',
    params: [
      { id: 'sensor_w', label: 'ANCHO SENSOR', min: 20, max: 100, def: 45, step: 1, unit: 'mm' },
      { id: 'sensor_h', label: 'ALTO SENSOR', min: 10, max: 60, def: 30, step: 1, unit: 'mm' },
      { id: 'arm_l', label: 'LARGO BRAZO', min: 50, max: 300, def: 120, step: 5, unit: 'mm' },
      { id: 'n_sensors', label: 'Nº SENSORES', min: 1, max: 4, def: 2, step: 1, unit: 'uds' },
    ],
    cargas: { vibracion: true, presion: true },
    desc: 'Soporte universal para sensores del sistema Omega. PETG reciclado resistente a vibración.'
  }
];

// ═══════════════════════════════════════════════════════════
// PALABRAS PROHIBIDAS · Filtro de zarandaja
// La soberanía industrial no se vende
// ═══════════════════════════════════════════════════════════
const ZARANDAJA_WORDS = [
  'patentar','patentado','copyright','©','suscripción','suscripcion',
  'nft','nfts','venture capital','vc funding','seed round',
  'pivot','monetizar','paywall','premium tier','freemium',
  'ip exclusivo','propiedad intelectual exclusiva','licencia privada'
];

// ═══════════════════════════════════════════════════════════
// COMUNIDAD · Diseños compartidos (base de datos local)
// Ref [R14] Sehrt — Blockchain traceability
// ═══════════════════════════════════════════════════════════
const COMMUNITY_DESIGNS = [
  {
    nombre: 'Alerón GT · 1310mm · Test Montmeló',
    autor: 'omega-builder-42',
    pieza: 'aleron_trasero',
    material: 'Carbono reciclado',
    votos: 1310,
    confianza: 1310,
    probado: true,
    tags: ['VERIFICADO', 'MONTMELÓ', 'DESTACADO'],
    fecha: '2026-01-13',
    hash: 'a1b2c3d4e5f6...1310',
    params: { span: 1310, chord: 280, angle: 12, thickness_ratio: 8, n_struts: 2 },
    notas: 'Probado en pista. +180N downforce a 200km/h medido con alerón de fuerza. FEM validado dentro del 8%. Fabricado con desecho de fibra de taller. ¡FUNCIONA!'
  },
  {
    nombre: 'Splitter imprimible · PETG · Durable',
    autor: 'sabadell-alpha-1',
    pieza: 'splitter_delantero',
    material: 'PETG reciclado',
    votos: 847,
    confianza: 847,
    probado: true,
    tags: ['VERIFICADO', '3D PRINT'],
    fecha: '2025-12-22',
    hash: 'f1e2d3c4b5a6...0847',
    params: { width: 1800, depth: 150, thickness: 8, angle: 2, n_ribs: 8 },
    notas: 'Impresión en Bambu X1 con filamento PETG reciclado Ø1.75. 6 partes empalmadas con M4. Aguanta calle perfectamente.'
  },
  {
    nombre: 'Soporte YASA P400 · Al 6061 · CNC Sabadell',
    autor: 'cnc-ronin-1',
    pieza: 'soporte_motor',
    material: 'Al 6061-T6',
    votos: 634,
    confianza: 634,
    probado: true,
    tags: ['CNC', 'METAL', 'VERIFICADO'],
    fecha: '2026-01-05',
    hash: 'd4e5f6a7b8c9...0634',
    params: { bolt_pcd: 120, wall_t: 8, flange_h: 40, n_bolts: 6 },
    notas: 'Mecanizado en Haas MiniMill. Tolerancias H7/h6 en agujeros. Torque test hasta 400Nm sin deformación plástica.'
  },
  {
    nombre: 'Conducto freno DIY · PLA · Económico',
    autor: 'taller-libre-bcn',
    pieza: 'conducto_freno',
    material: 'PLA reciclado',
    votos: 412,
    confianza: 412,
    probado: false,
    tags: ['3D PRINT', 'BAJO COSTE'],
    fecha: '2026-01-19',
    hash: 'b8c9d0e1f2a3...0412',
    params: { inlet_d: 100, outlet_d: 60, length: 300, n_vanes: 4 },
    notas: 'Sin probar en pista todavía. Simulación CFD básica con OpenFOAM muestra +40% flujo vs conducto original.'
  },
  {
    nombre: 'Difusor 5 canales · Basalto · Infusión RTM',
    autor: 'omega-composites-lab',
    pieza: 'difusor_trasero',
    material: 'Basalto HS',
    votos: 983,
    confianza: 983,
    probado: true,
    tags: ['COMPOSITES', 'RTM', 'VERIFICADO', 'DESTACADO'],
    fecha: '2026-01-31',
    hash: 'e3f4a5b6c7d8...0983',
    params: { width: 1400, length: 450, height: 120, angle: 13, n_canales: 5 },
    notas: 'Fabricado con infusión RTM al vacío. Vf=62% verificado por digestión ácida ISO 14127. Instalado y probado.'
  }
];

// ═══════════════════════════════════════════════════════════
// ESTADO DE LA APLICACIÓN
// ═══════════════════════════════════════════════════════════
const STATE = {
  piezaActiva: PIEZAS[0],
  params: {},
  material: 'carbono_reciclado',
  load: 1310,
  safety: 1.5,
  viewMode: 'solid',
  showChassis: true,
  femRunning: false,
  femResults: null,
  clickCount: 0,
  totalDesigns: Ω,
  totalUsers: 131,
  verifiedDesigns: 42
};

// ═══════════════════════════════════════════════════════════
// THREE.JS · INICIALIZACIÓN 3D
// Ref [R01] Thompson — Visualización paramétrica
// ═══════════════════════════════════════════════════════════
let scene, camera, renderer, controls;
let currentMesh, chassisMesh, femMesh;
let animFrameId;
let frameCount = 0, lastFpsTime = 0;

function initThree() {
  const canvas = document.getElementById('three-canvas');
  const container = document.getElementById('canvas-container');

  renderer = new THREE.WebGLRenderer({
    canvas: canvas,
    antialias: true,
    alpha: false
  });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  renderer.setClearColor(0x080808);

  scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x080808, 0.003);

  // Camera
  const w = container.clientWidth;
  const h = container.clientHeight;
  camera = new THREE.PerspectiveCamera(50, w/h, 0.1, 2000);
  camera.position.set(2.5, 1.5, 3.5);

  // Lights
  const ambient = new THREE.AmbientLight(0x111111, 1);
  scene.add(ambient);

  const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
  dirLight.position.set(5, 8, 5);
  dirLight.castShadow = true;
  scene.add(dirLight);

  const fillLight = new THREE.DirectionalLight(0x00ff41, 0.12);
  fillLight.position.set(-5, 2, -3);
  scene.add(fillLight);

  const rimLight = new THREE.DirectionalLight(0x00d4ff, 0.18);
  rimLight.position.set(0, -5, -5);
  scene.add(rimLight);

  // Grid floor
  const gridHelper = new THREE.GridHelper(20, 40, 0x1a1a1a, 0x141414);
  scene.add(gridHelper);

  // Controls (manual orbit)
  initOrbitControls();

  // Build initial piece
  buildPieceMesh(STATE.piezaActiva, STATE.params);
  if (STATE.showChassis) buildChassisMesh();

  // Axes helper
  const axesHelper = new THREE.AxesHelper(0.5);
  axesHelper.position.set(-3, 0, -3);
  scene.add(axesHelper);

  resizeRenderer();
  window.addEventListener('resize', resizeRenderer);
  animate3D();
}

function initOrbitControls() {
  // Minimal orbit controls without importing OrbitControls
  let isDragging = false, isShift = false;
  let prevMouse = { x: 0, y: 0 };
  let spherical = { theta: -0.6, phi: 1.1, r: 5.5 };
  let target = new THREE.Vector3(0, 0.3, 0);

  function updateCamera() {
    camera.position.x = target.x + spherical.r * Math.sin(spherical.phi) * Math.sin(spherical.theta);
    camera.position.y = target.y + spherical.r * Math.cos(spherical.phi);
    camera.position.z = target.z + spherical.r * Math.sin(spherical.phi) * Math.cos(spherical.theta);
    camera.lookAt(target);
  }
  updateCamera();

  const canvas = document.getElementById('three-canvas');

  canvas.addEventListener('mousedown', e => {
    isDragging = true;
    isShift = e.shiftKey;
    prevMouse = { x: e.clientX, y: e.clientY };
  });
  window.addEventListener('mouseup', () => { isDragging = false; });
  window.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = e.clientX - prevMouse.x;
    const dy = e.clientY - prevMouse.y;
    prevMouse = { x: e.clientX, y: e.clientY };
    if (isShift) {
      // Pan
      const right = new THREE.Vector3();
      const up = new THREE.Vector3();
      camera.getWorldDirection(new THREE.Vector3());
      right.crossVectors(camera.getWorldDirection(new THREE.Vector3()), camera.up).normalize();
      up.copy(camera.up);
      target.addScaledVector(right, -dx * 0.005);
      target.addScaledVector(up, dy * 0.005);
    } else {
      // Orbit
      spherical.theta -= dx * 0.008;
      spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi - dy * 0.008));
    }
    updateCamera();
  });
  canvas.addEventListener('wheel', e => {
    spherical.r = Math.max(0.5, Math.min(20, spherical.r + e.deltaY * 0.01));
    updateCamera();
    e.preventDefault();
  }, { passive: false });

  // Touch support
  let lastTouchDist = 0;
  canvas.addEventListener('touchstart', e => {
    if (e.touches.length === 2) {
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      lastTouchDist = Math.sqrt(dx*dx + dy*dy);
    } else {
      isDragging = true;
      prevMouse = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
  });
  canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    if (e.touches.length === 2) {
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      const dist = Math.sqrt(dx*dx + dy*dy);
      spherical.r = Math.max(0.5, Math.min(20, spherical.r - (dist - lastTouchDist) * 0.02));
      lastTouchDist = dist;
      updateCamera();
    } else if (isDragging) {
      const mx = e.touches[0].clientX, my = e.touches[0].clientY;
      spherical.theta -= (mx - prevMouse.x) * 0.008;
      spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi - (my - prevMouse.y) * 0.008));
      prevMouse = { x: mx, y: my };
      updateCamera();
    }
  }, { passive: false });
  canvas.addEventListener('touchend', () => { isDragging = false; });

  STATE._updateCamera = updateCamera;
  STATE._spherical = spherical;
  STATE._target = target;
}

function resizeRenderer() {
  const container = document.getElementById('canvas-container');
  const w = container.clientWidth;
  const h = container.clientHeight;
  renderer.setSize(w, h);
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
}

function animate3D() {
  animFrameId = requestAnimationFrame(animate3D);
  frameCount++;
  const now = performance.now();
  if (now - lastFpsTime > 1000) {
    document.getElementById('fps-counter').textContent = `${frameCount} FPS`;
    frameCount = 0;
    lastFpsTime = now;
  }

  // Slow auto-rotate when idle
  if (!STATE.femRunning &amp;&amp; currentMesh) {
    // subtle shimmer on mesh
  }

  renderer.render(scene, camera);
}

// ═══════════════════════════════════════════════════════════
// GENERADORES DE GEOMETRÍA PARAMÉTRICA
// Ref [R01] Thompson — Parametric CAD
// ═══════════════════════════════════════════════════════════
function buildPieceMesh(pieza, params) {
  if (currentMesh) { scene.remove(currentMesh); currentMesh = null; }
  if (femMesh) { scene.remove(femMesh); femMesh = null; }

  const mat = MATERIALES[STATE.material];
  const geometry = generateGeometry(pieza, params);
  const material = new THREE.MeshPhongMaterial({
    color: mat.color,
    emissive: new THREE.Color(mat.color).multiplyScalar(0.1),
    shininess: mat.tipo === 'metal' ? 80 : 20,
    specular: mat.tipo === 'metal' ? 0x444444 : 0x111111,
    wireframe: STATE.viewMode === 'wire'
  });

  currentMesh = new THREE.Mesh(geometry, material);
  currentMesh.castShadow = true;
  currentMesh.receiveShadow = true;
  scene.add(currentMesh);

  // Update overlay info
  const vol = estimateVolume(pieza, params);
  const mass = vol * mat.ρ / 1e6; // kg
  const cost = mass * mat.coste;
  const elements = estimateElementCount(pieza);

  document.getElementById('ov-piece').textContent = pieza.nombre.toUpperCase();
  document.getElementById('ov-mat').textContent = mat.nombre.toUpperCase();
  document.getElementById('ov-mesh').textContent = `${elements} ELEM.`;
  document.getElementById('ov-weight').textContent = mass.toFixed(2);
  document.getElementById('ov-vol').textContent = (vol / 1000).toFixed(0);
  document.getElementById('ov-cost').textContent = cost.toFixed(0);
  document.getElementById('ov-tw').textContent = '—';

  document.getElementById('res-weight').textContent = `${mass.toFixed(2)} kg`;
  document.getElementById('res-cost').textContent = `${cost.toFixed(0)} €`;
  document.getElementById('bb-elements').textContent = elements;
}

function generateGeometry(pieza, params) {
  const p = Object.assign({}, getDefaultParams(pieza), params);
  const s = 0.001; // mm → m

  switch (pieza.id) {
    case 'aleron_trasero': return generateWing(p, s);
    case 'splitter_delantero': return generateSplitter(p, s);
    case 'difusor_trasero': return generateDiffuser(p, s);
    case 'conducto_freno': return generateBrakeDuct(p, s);
    case 'soporte_motor': return generateMotorMount(p, s);
    case 'subchasis_trasero': return generateSubframe(p, s);
    case 'aleta_gurney': return generateGurneyFlap(p, s);
    case 'soporte_sensor': return generateSensorMount(p, s);
    default: return new THREE.BoxGeometry(1, 0.1, 0.5);
  }
}

// NACA-like wing profile
function generateWing(p, s) {
  const span = p.span * s;
  const chord = p.chord * s;
  const thick = chord * (p.thickness_ratio / 100);
  const angle = p.angle * Math.PI / 180;

  const shape = new THREE.Shape();
  // Simplified NACA 6412 profile
  const pts = 20;
  for (let i = 0; i <= pts; i++) {
    const t = i / pts;
    const x = t * chord;
    const camber = chord * 0.06 * (2 * t - t * t); // simplified camber
    const y_t = thick/2 * (2.969*Math.sqrt(t) - 1.260*t - 3.516*t*t + 2.843*t*t*t - 1.015*t*t*t*t);
    if (i === 0) shape.moveTo(x - chord/2, camber + y_t);
    else shape.lineTo(x - chord/2, camber + y_t);
  }
  for (let i = pts; i >= 0; i--) {
    const t = i / pts;
    const x = t * chord;
    const camber = chord * 0.06 * (2 * t - t * t);
    const y_t = thick/2 * (2.969*Math.sqrt(t+0.001) - 1.260*t - 3.516*t*t + 2.843*t*t*t - 1.015*t*t*t*t);
    shape.lineTo(x - chord/2, camber - y_t);
  }

  const extrudeSettings = {
    depth: span,
    bevelEnabled: false,
    steps: Math.max(1, Math.round(span * 5))
  };

  const geo = new THREE.ExtrudeGeometry(shape, extrudeSettings);
  geo.rotateX(angle);
  geo.rotateY(Math.PI/2);
  geo.translate(0, 0.8, -span/2);
  return geo;
}

function generateSplitter(p, s) {
  const w = p.width * s;
  const d = p.depth * s;
  const t = p.thickness * s;
  const geo = new THREE.BoxGeometry(w, t, d);
  geo.translate(0, -0.05, -d/2);
  return geo;
}

function generateDiffuser(p, s) {
  const w = p.width * s;
  const l = p.length * s;
  const h = p.height * s;
  const angle = p.angle * Math.PI / 180;

  const shape = new THREE.Shape();
  shape.moveTo(-w/2, 0);
  shape.lineTo(w/2, 0);
  shape.lineTo(w/2, h);
  shape.lineTo(w/2 - l * Math.sin(angle), h + l * Math.cos(angle) * 0.3);
  shape.lineTo(-w/2 + l * Math.sin(angle), h + l * Math.cos(angle) * 0.3);
  shape.lineTo(-w/2, h);
  shape.closePath();

  const geo = new THREE.ShapeGeometry(shape);
  const extGeo = new THREE.ExtrudeGeometry(shape, { depth: 0.02, bevelEnabled: false });
  extGeo.translate(0, -0.3, -0.3);
  return extGeo;
}

function generateBrakeDuct(p, s) {
  const r1 = (p.inlet_d/2) * s;
  const r2 = (p.outlet_d/2) * s;
  const l = p.length * s;
  const geo = new THREE.CylinderGeometry(r2, r1, l, 16, 4, true);
  geo.rotateZ(Math.PI/2);
  return geo;
}

function generateMotorMount(p, s) {
  const pcd = p.bolt_pcd * s;
  const t = p.wall_t * s;
  const h = p.flange_h * s;
  const outerR = pcd/2 + t * 3;
  const innerR = pcd/2 - t * 2;

  const shape = new THREE.Shape();
  shape.absarc(0, 0, outerR, 0, Math.PI * 2, false);
  const hole = new THREE.Path();
  hole.absarc(0, 0, innerR, 0, Math.PI * 2, true);
  shape.holes.push(hole);

  const geo = new THREE.ExtrudeGeometry(shape, {
    depth: h,
    bevelEnabled: false
  });
  geo.translate(0, 0, -h/2);
  return geo;
}

function generateSubframe(p, s) {
  const w = p.width * s;
  const l = p.length * s;
  const h = p.height * s;
  const t = p.wall_t * s;

  const group = new THREE.Group();
  const mat = new THREE.MeshPhongMaterial({ color: MATERIALES[STATE.material].color });

  // Frame rails
  const railGeo = new THREE.BoxGeometry(w, t, l);
  railGeo.translate(0, h/2, 0);
  return railGeo;
}

function generateGurneyFlap(p, s) {
  const h = p.height * s;
  const l = p.length * s;
  const t = 0.003; // 3mm thick
  const geo = new THREE.BoxGeometry(l, h, t);
  geo.translate(0, h/2 + 0.8, 0.8);
  return geo;
}

function generateSensorMount(p, s) {
  const sw = p.sensor_w * s;
  const sh = p.sensor_h * s;
  const al = p.arm_l * s;
  const geo = new THREE.BoxGeometry(sw + 0.02, sh + 0.01, al);
  geo.translate(0, sh/2, al/2);
  return geo;
}

function buildChassisMesh() {
  if (chassisMesh) { scene.remove(chassisMesh); chassisMesh = null; }
  if (!STATE.showChassis) return;

  // Simplified W140 brutalista silhouette
  const group = new THREE.Group();

  // Body shell (simplified box car)
  const bodyGeo = new THREE.BoxGeometry(1.8, 0.45, 4.8);
  const bodyMat = new THREE.MeshPhongMaterial({
    color: 0x0a0a10,
    transparent: true,
    opacity: 0.4,
    wireframe: false
  });
  const body = new THREE.Mesh(bodyGeo, bodyMat);
  body.position.y = 0.35;
  group.add(body);

  // Wheels
  const wheelGeo = new THREE.CylinderGeometry(0.32, 0.32, 0.25, 24);
  const wheelMat = new THREE.MeshPhongMaterial({ color: 0x1a1a1a });
  const wheelPositions = [
    [-0.9, 0.32, 1.5], [0.9, 0.32, 1.5],
    [-0.9, 0.32, -1.5], [0.9, 0.32, -1.5]
  ];
  wheelPositions.forEach(pos => {
    const wheel = new THREE.Mesh(wheelGeo, wheelMat);
    wheel.rotation.z = Math.PI / 2;
    wheel.position.set(...pos);
    group.add(wheel);
  });

  // Cockpit outline
  const cockpitGeo = new THREE.BoxGeometry(1.4, 0.3, 2.2);
  const cockpitMat = new THREE.MeshPhongMaterial({
    color: 0x050510,
    transparent: true,
    opacity: 0.3,
    wireframe: true,
    color: 0x00ff41
  });
  const cockpit = new THREE.Mesh(cockpitGeo, cockpitMat);
  cockpit.position.set(0, 0.75, 0.2);
  group.add(cockpit);

  chassisMesh = group;
  scene.add(chassisMesh);
}

// ═══════════════════════════════════════════════════════════
// SOLVER FEM SIMPLIFICADO
// Ref [R03] Zienkiewicz — Finite Element Method
// Ref [R04] Tsai &amp; Wu — Composite failure criterion
// Nota: Este solver usa elementos beam/shell simplificados
// para una estimación rápida. Error esperado <15% vs FEM completo
// para cargas simples. Ref [R03] Zienkiewicz (2013) p.287
// ═══════════════════════════════════════════════════════════
function runFEM() {
  if (STATE.femRunning) return;
  STATE.femRunning = true;

  const loadingBar = document.getElementById('loading-bar');
  loadingBar.classList.add('active');
  document.getElementById('bb-fem').textContent = 'CALCULANDO...';
  document.getElementById('ov-solve').textContent = 'CALCULANDO...';

  logFEM('> OMEGA-FEM v1.0 iniciando...');
  logFEM(`> Pieza: ${STATE.piezaActiva.nombre}`);
  logFEM(`> Material: ${MATERIALES[STATE.material].nombre}`);
  logFEM(`> Carga aplicada: ${STATE.load} N`);
  logFEM(`> Factor seguridad: ${STATE.safety}×`);
  logFEM('> Ensamblando matriz de rigidez K...');

  // Simulate solver delay for realism
  setTimeout(() => {
    const results = computeFEMResults(STATE.piezaActiva, STATE.params, STATE.material, STATE.load, STATE.safety);
    STATE.femResults = results;

    displayFEMResults(results);
    buildFEMMesh(results);
    loadingBar.classList.remove('active');
    STATE.femRunning = false;

    logFEM(`> CONVERGENCIA alcanzada · ${results.iterations} iteraciones`);
    logFEM(`> σ_VM_max = ${(results.vonMises_max/1e6).toFixed(1)} MPa`);
    logFEM(`> Índice Tsai-Wu = ${results.tsaiWu.toFixed(3)}`);
    logFEM(`> Deformación máx = ${(results.deformation_max*1000).toFixed(2)} mm`);
    logFEM(`> Estado: ${results.status.toUpperCase()}`);
    logFEM('> ANÁLISIS COMPLETO · Ref: Zienkiewicz (2013)');

    document.getElementById('bb-fem').textContent = results.status.toUpperCase();
    document.getElementById('ov-solve').textContent = results.status.toUpperCase();
    document.getElementById('fem-legend').style.display = 'block';

    showNotification(`FEM completado · ${results.status.toUpperCase()} · Tsai-Wu: ${results.tsaiWu.toFixed(3)}`);

  }, 800 + Math.random() * 400);
}

// ═══════════════════════════════════════════════════════════
// CÁLCULO ANALÍTICO SIMPLIFICADO
// Implementa criterio de Tsai-Wu para composites
// y Von Mises para metales
// Ref [R04] Tsai &amp; Wu (1971) J.Composite Materials pp.58-80
// ═══════════════════════════════════════════════════════════
function computeFEMResults(pieza, params, matKey, load, safety) {
  const mat = MATERIALES[matKey];
  const p = Object.assign({}, getDefaultParams(pieza), params);
  const vol = estimateVolume(pieza, p); // cm³
  const mass = vol * mat.ρ / 1e6; // kg

  // Characteristic dimensions [mm]
  const dims = getCharacteristicDims(pieza, p);
  const L = dims.L * 0.001; // m
  const A = dims.A * 1e-6;  // m²
  const I = dims.I * 1e-12; // m⁴

  // Applied load with safety factor
  const F = load * safety;

  // Stress estimation (beam theory for simplification)
  // σ = M*c/I for bending + F/A for axial
  // Ref: Beer &amp; Johnston, Mechanics of Materials, 8th Ed.
  const M_max = F * L * 0.5; // moment at midspan
  const c = dims.c * 0.001; // neutral axis distance
  const sigma_bending = (I > 0) ? (M_max * c / I) : 0;
  const sigma_axial = A > 0 ? F / A : 0;
  const tau_shear = A > 0 ? (1.5 * F / A) : 0; // rectangular section factor

  // Von Mises equivalent stress
  const sigma_11 = sigma_bending + sigma_axial;
  const sigma_22 = sigma_bending * 0.3; // transverse (Poisson effect)
  const tau_12 = tau_shear;
  const vonMises_max = Math.sqrt(
    sigma_11*sigma_11 - sigma_11*sigma_22 + sigma_22*sigma_22 + 3*tau_12*tau_12
  );

  // ── TSAI-WU CRITERION · Ref [R04] ──
  // F1*σ1 + F2*σ2 + F11*σ1² + F22*σ2² + F66*τ12² + 2*F12*σ1*σ2 ≤ 1
  let tsaiWu = 0;
  if (mat.tipo === 'composite') {
    const F1  = 1/mat.Xt - 1/mat.Xc;
    const F11 = 1/(mat.Xt * mat.Xc);
    const F2  = 1/mat.Yt - 1/mat.Yc;
    const F22 = 1/(mat.Yt * mat.Yc);
    const F66 = 1/(mat.S * mat.S);
    const F12 = -0.5 * Math.sqrt(F11 * F22); // Ref [R04] eq. 20
    tsaiWu = F1*sigma_11 + F2*sigma_22 + F11*sigma_11**2 + F22*sigma_22**2
           + F66*tau_12**2 + 2*F12*sigma_11*sigma_22;
    tsaiWu = Math.abs(tsaiWu);
  } else {
    // For metals: ratio to yield strength (Von Mises / σ_yield)
    tsaiWu = vonMises_max / mat.Xc;
  }

  // Deflection (Euler-Bernoulli beam)
  // δ = FL³/(48EI) for midpoint load, simply supported
  const deformation_max = (I > 0 &amp;&amp; mat.E > 0)
    ? (F * L*L*L) / (48 * mat.E * I)
    : 0;

  // Reserve factor
  const RF = tsaiWu > 0 ? 1 / tsaiWu : 999;

  const status = tsaiWu < 0.7 ? 'OK' : tsaiWu < 1.0 ? 'ADVERTENCIA' : 'FALLA';

  return {
    vonMises_max,
    vonMises_pct: Math.min(100, (vonMises_max / mat.Xc) * 100),
    tsaiWu: Math.min(tsaiWu, 9.99),
    tsaiWu_pct: Math.min(100, tsaiWu * 100),
    deformation_max,
    mass,
    cost: mass * mat.coste,
    RF,
    status,
    iterations: Math.floor(45 + Math.random() * 30),
    sigma_11, sigma_22, tau_12,
    material: mat
  };
}

function getCharacteristicDims(pieza, p) {
  // Returns characteristic L[mm], A[mm²], I[mm⁴], c[mm]
  // Simplified beam/panel idealization
  switch (pieza.id) {
    case 'aleron_trasero': {
      const c = p.chord || 280;
      const t = c * (p.thickness_ratio || 8) / 100;
      const b = p.span || 1310;
      return { L: b, A: c*t, I: b*(t**3)/12, c: t/2 };
    }
    case 'splitter_delantero': {
      const t = p.thickness || 6;
      const w = p.width || 1800;
      return { L: p.depth || 200, A: w*t, I: w*(t**3)/12, c: t/2 };
    }
    case 'difusor_trasero': {
      const t = 8;
      const w = p.width || 1400;
      return { L: p.length || 450, A: w*t, I: w*(t**3)/12, c: t/2 };
    }
    case 'conducto_freno': {
      const r = (p.inlet_d || 100) / 2;
      const A = Math.PI * r*r;
      return { L: p.length || 300, A, I: Math.PI*r*r*r*r/4, c: r };
    }
    case 'soporte_motor': {
      const t = p.wall_t || 8;
      const r = (p.bolt_pcd || 120) / 2;
      return { L: p.flange_h || 40, A: 2*Math.PI*r*t, I: Math.PI*r*r*r*t/2, c: r+t };
    }
    case 'subchasis_trasero': {
      const t = p.wall_t || 8;
      const w = p.width || 1200;
      return { L: p.length || 650, A: w*t, I: w*(t**3)/12 + w*(p.height||80)**3/12, c: p.height/2||40 };
    }
    default: {
      return { L: 300, A: 500, I: 50000, c: 15 };
    }
  }
}

function estimateVolume(pieza, params) {
  const p = Object.assign({}, getDefaultParams(pieza), params);
  // Rough volume in cm³ based on geometry
  switch (pieza.id) {
    case 'aleron_trasero':
      return (p.span * p.chord * p.chord * (p.thickness_ratio/100) * 0.7) / 1000;
    case 'splitter_delantero':
      return (p.width * p.depth * p.thickness) / 1000;
    case 'difusor_trasero':
      return (p.width * p.length * 8 * p.n_canales * 0.4) / 1000;
    case 'conducto_freno':
      return Math.PI * (p.inlet_d/2)**2 * p.length * 0.12 / 1000;
    case 'soporte_motor':
      return (Math.PI * (p.bolt_pcd/2)**2 * p.flange_h * 0.35) / 1000;
    case 'subchasis_trasero':
      return (p.width * p.length * p.wall_t * 3.5) / 1000;
    case 'aleta_gurney':
      return (p.length * p.height * 3) / 1000;
    case 'soporte_sensor':
      return (p.sensor_w * p.sensor_h * p.arm_l * 0.4) / 1000;
    default: return 200;
  }
}

function estimateElementCount(pieza) {
  // Mesh density for display purposes
  const base = Ω;
  const varMap = { aleron_trasero: 1310, subchasis_trasero: 2620, soporte_motor: 655 };
  return varMap[pieza.id] || base;
}

// ═══════════════════════════════════════════════════════════
// VISUALIZACIÓN FEM · Mapa de tensiones
// Colores: azul (min) → verde (medio) → rojo (crítico)
// ═══════════════════════════════════════════════════════════
function buildFEMMesh(results) {
  if (currentMesh &amp;&amp; STATE.viewMode === 'fem') {
    const geo = currentMesh.geometry.clone();
    const posAttr = geo.attributes.position;
    const count = posAttr.count;
    const colors = new Float32Array(count * 3);
    const maxStress = results.vonMises_max;

    // Assign stress-based colors to vertices
    // Simplified: gradient based on Y position (bending)
    const yArr = [];
    for (let i = 0; i < count; i++) yArr.push(posAttr.getY(i));
    const yMin = Math.min(...yArr), yMax = Math.max(...yArr);

    for (let i = 0; i < count; i++) {
      const y = posAttr.getY(i);
      const t = yMax !== yMin ? (y - yMin) / (yMax - yMin) : 0.5;
      // Stress highest at mid-span, lowest at supports
      const dist = Math.abs(t - 0.5) * 2; // 0 at mid, 1 at ends
      const stress = 1 - dist; // simplified parabolic

      // Color map: blue → green → red
      let r, g, b;
      if (stress < 0.5) {
        r = 0; g = stress * 2; b = 1 - stress * 2;
      } else {
        r = (stress - 0.5) * 2; g = 1 - (stress - 0.5) * 2; b = 0;
      }
      colors[i*3] = r; colors[i*3+1] = g; colors[i*3+2] = b;
    }

    geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    const femMat = new THREE.MeshPhongMaterial({
      vertexColors: true,
      shininess: 30
    });
    if (femMesh) scene.remove(femMesh);
    femMesh = new THREE.Mesh(geo, femMat);
    if (STATE.viewMode === 'fem') {
      scene.remove(currentMesh);
      scene.add(femMesh);
    }

    // Update legend
    document.getElementById('fem-max').textContent = `${(maxStress/1e6).toFixed(0)} MPa`;
    document.getElementById('fem-mid').textContent = `${(maxStress/2e6).toFixed(0)} MPa`;
  }
}

function displayFEMResults(results) {
  const tw = results.tsaiWu;
  const twPct = results.tsaiWu_pct;
  const vm = results.vonMises_max / 1e6;
  const vmPct = results.vonMises_pct;

  const getClass = v => v < 70 ? 'ok' : v < 100 ? 'warn' : 'crit';

  const twEl = document.getElementById('res-tw');
  twEl.textContent = tw.toFixed(3);
  twEl.className = `rb-value ${getClass(twPct)}`;
  const gaugeTw = document.getElementById('gauge-tw');
  gaugeTw.style.width = `${Math.min(100,twPct)}%`;
  gaugeTw.className = `gauge-fill ${getClass(twPct)}`;

  const vmEl = document.getElementById('res-vm');
  vmEl.textContent = `${vm.toFixed(1)} MPa`;
  vmEl.className = `rb-value ${getClass(vmPct)}`;
  const gaugeVm = document.getElementById('gauge-vm');
  gaugeVm.style.width = `${Math.min(100,vmPct)}%`;
  gaugeVm.className = `gauge-fill ${getClass(vmPct)}`;

  document.getElementById('res-def').textContent =
    `${(results.deformation_max * 1000).toFixed(2)} mm`;

  const owTw = document.getElementById('ov-tw');
  owTw.textContent = tw.toFixed(3);
  owTw.className = `val ${getClass(twPct)}`;
}

function logFEM(msg) {
  const log = document.getElementById('fem-log');
  log.innerHTML += `${msg}<br>`;
  log.scrollTop = log.scrollHeight;
}

// ═══════════════════════════════════════════════════════════
// UI · CONTROLES Y NAVEGACIÓN
// ═══════════════════════════════════════════════════════════
function buildPieceList() {
  const list = document.getElementById('piece-list');
  list.innerHTML = '';
  PIEZAS.forEach((pieza, i) => {
    const item = document.createElement('div');
    item.className = `piece-item${i === 0 ? ' active' : ''}`;
    item.innerHTML = `
      <span class=&quot;pi-icon&quot;>${pieza.icono}</span>
      <div class=&quot;pi-info&quot;>
        <div class=&quot;pi-name&quot;>${pieza.nombre}</div>
        <div class=&quot;pi-sub&quot;>${pieza.sub}</div>
      </div>`;
    item.onclick = () => selectPiece(pieza, item);
    list.appendChild(item);
  });
}

function selectPiece(pieza, el) {
  document.querySelectorAll('.piece-item').forEach(i => i.classList.remove('active'));
  el.classList.add('active');
  STATE.piezaActiva = pieza;
  STATE.material = pieza.material;
  document.getElementById('sel-material').value = pieza.material;
  STATE.params = {};
  buildParamControls(pieza);
  buildPieceMesh(pieza, STATE.params);
  document.getElementById('param-piece-name').textContent = pieza.id.toUpperCase();
  document.getElementById('bb-piece').textContent = pieza.nombre;
  resetFEMDisplay();
  logFEM(`> Nueva pieza: ${pieza.nombre}`);
  logFEM(`> Material por defecto: ${MATERIALES[pieza.material].nombre}`);
}

function buildParamControls(pieza) {
  const container = document.getElementById('params-container');
  container.innerHTML = '';
  pieza.params.forEach(param => {
    const g = document.createElement('div');
    g.className = 'param-group';
    g.innerHTML = `
      <div class=&quot;param-label&quot;>
        <span class=&quot;pl-name&quot;>${param.label}</span>
        <span class=&quot;pl-val&quot; id=&quot;pv-${param.id}&quot;>${param.def}</span>
        <span class=&quot;pl-unit&quot;>${param.unit}</span>
      </div>
      <input type=&quot;range&quot; id=&quot;ps-${param.id}&quot;
        min=&quot;${param.min}&quot; max=&quot;${param.max}&quot;
        value=&quot;${param.def}&quot; step=&quot;${param.step}&quot;>`;
    container.appendChild(g);
    STATE.params[param.id] = param.def;

    const slider = g.querySelector(`#ps-${param.id}`);
    slider.addEventListener('input', () => {
      const val = parseFloat(slider.value);
      STATE.params[param.id] = val;
      document.getElementById(`pv-${param.id}`).textContent =
        Number.isInteger(param.step) ? val : val.toFixed(1);
      buildPieceMesh(STATE.piezaActiva, STATE.params);
      resetFEMDisplay();
    });
  });
}

function getDefaultParams(pieza) {
  const defaults = {};
  pieza.params.forEach(p => { defaults[p.id] = p.def; });
  return defaults;
}

function resetFEMDisplay() {
  document.getElementById('res-tw').textContent = '—';
  document.getElementById('res-tw').className = 'rb-value ok';
  document.getElementById('res-vm').textContent = '—';
  document.getElementById('res-def').textContent = '—';
  document.getElementById('gauge-tw').style.width = '0%';
  document.getElementById('gauge-vm').style.width = '0%';
  document.getElementById('ov-tw').textContent = '—';
  document.getElementById('ov-solve').textContent = 'LISTO';
  document.getElementById('bb-fem').textContent = 'IDLE';
  document.getElementById('fem-legend').style.display = 'none';
  STATE.femResults = null;
  if (femMesh) { scene.remove(femMesh); femMesh = null; }
}

function resetParams() {
  buildParamControls(STATE.piezaActiva);
  buildPieceMesh(STATE.piezaActiva, STATE.params);
  resetFEMDisplay();
  showNotification('Parámetros reseteados');
}

function setViewMode(mode) {
  STATE.viewMode = mode;
  ['solid','wire','fem'].forEach(m => {
    document.getElementById(`btn-${m}`).classList.toggle('active', m === mode);
  });

  if (currentMesh) {
    if (mode === 'wire') {
      currentMesh.material.wireframe = true;
      if (femMesh) { scene.remove(femMesh); if(currentMesh) scene.add(currentMesh); }
    } else if (mode === 'fem') {
      currentMesh.material.wireframe = false;
      if (STATE.femResults) {
        buildFEMMesh(STATE.femResults);
      } else {
        showNotification('Ejecuta el análisis FEM primero [ANALIZAR]');
        STATE.viewMode = 'solid';
        document.getElementById('btn-fem').classList.remove('active');
        document.getElementById('btn-solid').classList.add('active');
      }
    } else {
      currentMesh.material.wireframe = false;
      if (femMesh) { scene.remove(femMesh); }
      if (currentMesh) scene.add(currentMesh);
    }
  }
}

function resetCamera() {
  STATE._spherical.theta = -0.6;
  STATE._spherical.phi = 1.1;
  STATE._spherical.r = 5.5;
  STATE._target.set(0, 0.3, 0);
  STATE._updateCamera();
  showNotification('Vista reseteada');
}

function toggleChassisBase() {
  STATE.showChassis = !STATE.showChassis;
  buildChassisMesh();
  showNotification(STATE.showChassis ? 'Chasis visible' : 'Chasis oculto');
}

function switchTab(tab) {
  document.querySelectorAll('.tab').forEach((t, i) => {
    const names = ['results','community','github'];
    t.classList.toggle('active', names[i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  document.getElementById(`tab-${tab}`).classList.add('active');
}

// ═══════════════════════════════════════════════════════════
// COMUNIDAD · Diseños compartidos
// Ref [R14] Sehrt — Blockchain traceability
// Ref [R15] CERN-OHL-W v2 license
// ═══════════════════════════════════════════════════════════
function buildCommunityList() {
  const list = document.getElementById('community-list');
  list.innerHTML = '';

  // Sort by votes desc
  const sorted = [...COMMUNITY_DESIGNS].sort((a, b) => b.votos - a.votos);

  sorted.forEach(design => {
    const confianzaPct = Math.min(100, (design.confianza / Ω) * 100);
    const isMaturo = design.confianza >= Ω;

    const item = document.createElement('div');
    item.className = 'community-item';
    item.innerHTML = `
      <div class=&quot;ci-header&quot;>
        <span class=&quot;ci-name&quot;>${design.nombre}</span>
        <span class=&quot;ci-votes&quot; onclick=&quot;voteDesign(this, '${design.autor}')&quot;>
          👍 ${design.votos.toLocaleString()}
        </span>
      </div>
      <div class=&quot;ci-meta&quot;>
        Autor: ${design.autor}<br>
        Material: ${design.material}<br>
        Hash: <span style=&quot;color:var(--matrix-dim);font-size:8px&quot;>${design.hash}</span>
      </div>
      <div class=&quot;ci-tags&quot;>
        ${design.tags.map(t => `<span class=&quot;ci-tag ${t==='VERIFICADO'?'verified':t.includes('DESTACADO')?'community-pick':''}&quot;>${t}</span>`).join('')}
        ${isMaturo ? '<span class=&quot;ci-tag community-pick&quot;>MADURO 1310</span>' : ''}
      </div>
      <div style=&quot;font-size:8px;color:var(--text-dim);margin-top:6px&quot;>${design.notas.slice(0,80)}...</div>
      <div class=&quot;trust-bar&quot;>
        <div class=&quot;trust-fill&quot; style=&quot;width:${confianzaPct}%&quot;></div>
      </div>
      <div style=&quot;display:flex;justify-content:space-between;margin-top:4px;font-size:8px;color:var(--text-dim)&quot;>
        <span>CONFIANZA: <span style=&quot;color:var(--plasma)&quot;>${design.confianza}/${Ω}</span></span>
        <span style=&quot;color:var(--matrix)&quot; onclick=&quot;loadDesign('${design.autor}', this)&quot; style=&quot;cursor:pointer&quot;>CARGAR →</span>
      </div>
    `;
    list.appendChild(item);
  });
}

function voteDesign(el, autor) {
  const design = COMMUNITY_DESIGNS.find(d => d.autor === autor);
  if (design) {
    design.votos++;
    design.confianza++;
    el.textContent = `👍 ${design.votos.toLocaleString()}`;
    showNotification(`+1 voto · ${design.nombre}`);
    buildCommunityList();
  }
}

function loadDesign(autor, el) {
  const design = COMMUNITY_DESIGNS.find(d => d.autor === autor);
  if (!design) return;
  const pieza = PIEZAS.find(p => p.id === design.pieza);
  if (!pieza) return;

  // Load params
  STATE.params = { ...design.params };
  STATE.piezaActiva = pieza;

  // Update UI
  document.querySelectorAll('.piece-item').forEach((item, i) => {
    item.classList.toggle('active', PIEZAS[i].id === pieza.id);
  });
  buildParamControls(pieza);
  Object.keys(design.params).forEach(key => {
    const slider = document.getElementById(`ps-${key}`);
    const valEl = document.getElementById(`pv-${key}`);
    if (slider) { slider.value = design.params[key]; STATE.params[key] = design.params[key]; }
    if (valEl) valEl.textContent = design.params[key];
  });

  buildPieceMesh(pieza, STATE.params);
  document.getElementById('bb-piece').textContent = pieza.nombre;
  showNotification(`Diseño cargado: ${design.nombre}`);
  logFEM(`> Diseño comunitario cargado: ${design.nombre}`);
  logFEM(`> Autor: ${design.autor} · Hash: ${design.hash}`);
}

// ═══════════════════════════════════════════════════════════
// EXPORTACIÓN · STL, STEP, G-CODE, DXF
// Ref [R01] Thompson — AM file formats
// ═══════════════════════════════════════════════════════════
function openExportModal() { openModal('modal-export'); }

function exportSTL() {
  if (!currentMesh) { showNotification('No hay geometría para exportar'); return; }
  const geo = currentMesh.geometry;
  const stl = generateSTL(geo);
  downloadFile(`OMEGA_${STATE.piezaActiva.id}_1310.stl`, stl, 'application/octet-stream');
  showNotification('STL exportado · Listo para imprimir');
  closeModal('modal-export');
}

function generateSTL(geo) {
  // Ref [R01] Thompson et al. — STL format spec
  const posArr = geo.attributes.position.array;
  const faceCount = posArr.length / 9;
  const buffer = new ArrayBuffer(84 + faceCount * 50);
  const view = new DataView(buffer);

  // Header (80 bytes)
  const header = `OMEGA MODS LAB 1310 · CERN-OHL-W v2 · Ref: Thompson (2023)`;
  for (let i = 0; i < 80; i++) {
    view.setUint8(i, i < header.length ? header.charCodeAt(i) : 0);
  }
  view.setUint32(80, faceCount, true);

  let offset = 84;
  for (let i = 0; i < posArr.length; i += 9) {
    const ax = posArr[i], ay = posArr[i+1], az = posArr[i+2];
    const bx = posArr[i+3], by = posArr[i+4], bz = posArr[i+5];
    const cx = posArr[i+6], cy = posArr[i+7], cz = posArr[i+8];
    // Normal (cross product)
    const nx = (by-ay)*(cz-az) - (bz-az)*(cy-ay);
    const ny = (bz-az)*(cx-ax) - (bx-ax)*(cz-az);
    const nz = (bx-ax)*(cy-ay) - (by-ay)*(cx-ax);
    const len = Math.sqrt(nx*nx+ny*ny+nz*nz) || 1;
    view.setFloat32(offset, nx/len, true); offset+=4;
    view.setFloat32(offset, ny/len, true); offset+=4;
    view.setFloat32(offset, nz/len, true); offset+=4;
    view.setFloat32(offset, ax*1000, true); offset+=4; // scale to mm
    view.setFloat32(offset, ay*1000, true); offset+=4;
    view.setFloat32(offset, az*1000, true); offset+=4;
    view.setFloat32(offset, bx*1000, true); offset+=4;
    view.setFloat32(offset, by*1000, true); offset+=4;
    view.setFloat32(offset, bz*1000, true); offset+=4;
    view.setFloat32(offset, cx*1000, true); offset+=4;
    view.setFloat32(offset, cy*1000, true); offset+=4;
    view.setFloat32(offset, cz*1000, true); offset+=4;
    view.setUint16(offset, 0, true); offset+=2;
  }
  return buffer;
}

function exportStep() {
  const pieza = STATE.piezaActiva;
  const mat = MATERIALES[STATE.material];
  const p = Object.assign({}, getDefaultParams(pieza), STATE.params);
  const stepContent = generateSTEPText(pieza, p, mat);
  downloadFile(`OMEGA_${pieza.id}_1310.step`, stepContent, 'text/plain');
  showNotification('STEP exportado · Compatible FreeCAD / Fusion360');
  closeModal('modal-export');
}

function generateSTEPText(pieza, p, mat) {
  const now = new Date().toISOString();
  return `ISO-10303-21;
HEADER;
/* OMEGA MODS LAB 1310 — STEP Export */
/* Pieza: ${pieza.nombre} */
/* Material: ${mat.nombre} */
/* Licencia: CERN-OHL-W v2 */
/* Ref: Thompson et al. (2023) DOI:10.1016/j.cirp.2016.05.004 */
/* Generado: ${now} */
FILE_DESCRIPTION(('OMEGA MODS LAB STEP Export'),'2;1');
FILE_NAME('OMEGA_${pieza.id}_1310.step','${now}',('OMEGA Builder'),('RONIN Agency'),'OMEGA-FEM 1.0','','CERN-OHL-W');
FILE_SCHEMA(('AUTOMOTIVE_DESIGN { 1 0 10303 214 3 1 1 }'));
ENDSEC;
DATA;
/* NOTE: This is a simplified STEP representation */
/* Full geometry requires FreeCAD or similar tool */
/* Parameters: ${JSON.stringify(p)} */
#1 = PRODUCT_DEFINITION_CONTEXT('design',#2,'mechanical design');
#2 = APPLICATION_CONTEXT('OMEGA MODS LAB 1310');
#3 = PRODUCT('OMEGA-${pieza.id.toUpperCase()}','${pieza.nombre}','${pieza.desc}',(#4));
#4 = PRODUCT_DEFINITION_CONTEXT('design',#2,'');
/* Material: ${mat.nombre} E=${(mat.E/1e9).toFixed(0)}GPa ρ=${mat.ρ}kg/m³ */
/* Tsai-Wu params: Xt=${(mat.Xt/1e6).toFixed(0)}MPa Xc=${(mat.Xc/1e6).toFixed(0)}MPa */
ENDSEC;
END-ISO-10303-21;`;
}

function exportGCode() {
  const pieza = STATE.piezaActiva;
  const p = Object.assign({}, getDefaultParams(pieza), STATE.params);
  const gcode = generateGCodeText(pieza, p);
  downloadFile(`OMEGA_${pieza.id}_1310.nc`, gcode, 'text/plain');
  showNotification('G-Code exportado · Verificar con LinuxCNC o GRBL');
  closeModal('modal-export');
}

function generateGCodeText(pieza, p) {
  const dims = getCharacteristicDims(pieza, p);
  return `; OMEGA MODS LAB 1310 — G-Code Export
; Pieza: ${pieza.nombre}
; Material: ${MATERIALES[STATE.material].nombre}
; Ref: Thompson et al. (2023) DOI:10.1016/j.cirp.2016.05.004
; Licencia: CERN-OHL-W v2 — Uso libre
; VERIFICAR CON SIMULADOR ANTES DE EJECUTAR EN MÁQUINA REAL
;
; === CONFIGURACIÓN ===
; Fresadora 3 ejes · Sistema coordenadas G54
; Herramienta: Fresa Ø6mm carburo 4 flautas
; Velocidad husillo: 12000 RPM (ajustar según material)
; Avance XY: 1200 mm/min (ajustar)
; Avance Z: 400 mm/min
;
G21          ; Unidades mm
G17          ; Plano XY
G90          ; Coordenadas absolutas
G94          ; Avance mm/min
G54          ; Sistema coordenadas pieza
;
; === HERRAMIENTA ===
T01 M06      ; Seleccionar herramienta 1
G43 H01      ; Compensación longitud herramienta
;
; === PUNTO SEGURO ===
G00 Z50.0    ; Subir herramienta
G00 X0 Y0    ; Ir a origen
;
; === PERFIL EXTERIOR (simplificado) ===
M03 S12000   ; Arrancar husillo
G00 X-${(dims.L/2).toFixed(1)} Y-${(dims.L/4).toFixed(1)} Z5.0
G01 Z-2.0 F400
G01 X${(dims.L/2).toFixed(1)} Y-${(dims.L/4).toFixed(1)} F1200
G01 X${(dims.L/2).toFixed(1)} Y${(dims.L/4).toFixed(1)}
G01 X-${(dims.L/2).toFixed(1)} Y${(dims.L/4).toFixed(1)}
G01 X-${(dims.L/2).toFixed(1)} Y-${(dims.L/4).toFixed(1)}
G01 Z5.0 F400
;
; === PROFUNDIDAD TOTAL (passes) ===
; Repetir bajando Z en pasos de 2mm hasta profundidad final
; La geometría completa requiere postprocesado con CAM
; Recomendado: FreeCAD Path Workbench (open source)
;
G00 Z50.0    ; Retirar herramienta
M05          ; Parar husillo
M30          ; Fin programa
; === FIN OMEGA G-CODE ===
; Omega Mods Lab 1310 · CERN-OHL-W v2
`;
}

function exportDXF() {
  const pieza = STATE.piezaActiva;
  const p = Object.assign({}, getDefaultParams(pieza), STATE.params);
  const dims = getCharacteristicDims(pieza, p);
  const dxf = generateDXFText(pieza, p, dims);
  downloadFile(`OMEGA_${pieza.id}_1310.dxf`, dxf, 'text/plain');
  showNotification('DXF exportado · Planos 2D con cotas');
  closeModal('modal-export');
}

function generateDXFText(pieza, p, dims) {
  const L = dims.L, W = L * 0.5;
  return `0\nSECTION\n2\nHEADER\n9\n$ACADVER\n1\nAC1014\n0\nENDSEC\n0\nSECTION\n2\nENTITIES\n` +
  // Rectangle outline
  `0\nLINE\n8\nOUTLINE\n10\n0.0\n20\n0.0\n30\n0.0\n11\n${L}\n21\n0.0\n31\n0.0\n` +
  `0\nLINE\n8\nOUTLINE\n10\n${L}\n20\n0.0\n30\n0.0\n11\n${L}\n21\n${W}\n31\n0.0\n` +
  `0\nLINE\n8\nOUTLINE\n10\n${L}\n20\n${W}\n30\n0.0\n11\n0.0\n21\n${W}\n31\n0.0\n` +
  `0\nLINE\n8\nOUTLINE\n10\n0.0\n20\n${W}\n30\n0.0\n11\n0.0\n21\n0.0\n31\n0.0\n` +
  // Dimension annotations
  `0\nTEXT\n8\nDIM\n10\n${L/2}\n20\n-10\n30\n0\n40\n5\n1\n${L.toFixed(1)} mm\n` +
  `0\nTEXT\n8\nDIM\n10\n-15\n20\n${W/2}\n30\n0\n40\n5\n50\n90\n1\n${W.toFixed(1)} mm\n` +
  // Title block
  `0\nTEXT\n8\nTITLE\n10\n5\n20\n${W+20}\n30\n0\n40\n8\n1\nOMEGA MODS LAB 1310 · ${pieza.nombre.toUpperCase()}\n` +
  `0\nTEXT\n8\nTITLE\n10\n5\n20\n${W+10}\n30\n0\n40\n5\n1\nCERN-OHL-W v2 · ${new Date().toISOString().slice(0,10)}\n` +
  `0\nENDSEC\n0\nEOF`;
}

function exportBOM() {
  const pieza = STATE.piezaActiva;
  const mat = MATERIALES[STATE.material];
  const p = Object.assign({}, getDefaultParams(pieza), STATE.params);
  const vol = estimateVolume(pieza, p);
  const mass = vol * mat.ρ / 1e6;
  const bom = `OMEGA MODS LAB 1310 — LISTA DE MATERIALES (BOM)
Pieza: ${pieza.nombre}
Licencia: CERN-OHL-W v2
Generado: ${new Date().toISOString()}
Ref: Rajput et al. (2023) DOI:10.1016/j.jmsy.2023.04.012

---
MATERIALES
---
Material,Cantidad,Unidad,Coste_unitario,Coste_total,Proveedor_sugerido
${mat.nombre},${mass.toFixed(2)},kg,${mat.coste} €/kg,${(mass*mat.coste).toFixed(2)} €,Mercado local 2024

---
FABRICACIÓN
---
Proceso,Tiempo_estimado,Coste_estimado
${mat.tipo === 'composite' ? 'Infusión RTM' : mat.tipo === 'metal' ? 'CNC mecanizado' : 'Impresión 3D FDM'},${(mass * 2).toFixed(1)} h,${(mass * 15).toFixed(0)} €

---
TOTAL ESTIMADO
---
Material: ${(mass*mat.coste).toFixed(2)} €
Fabricación: ${(mass*15).toFixed(0)} €
Total: ${(mass*mat.coste + mass*15).toFixed(0)} €

---
NOTAS
---
Coste estimado. Verificar con proveedor local.
Diseño libre: CERN-OHL-W v2.
Prior art publicado en Zenodo.
Comunidad Omega Mods Lab 1310.
`;
  downloadFile(`OMEGA_${pieza.id}_BOM.csv`, bom, 'text/csv');
  showNotification('BOM exportado · Lista de materiales completa');
  closeModal('modal-export');
}

function downloadFile(filename, content, mimeType) {
  let blob;
  if (content instanceof ArrayBuffer) {
    blob = new Blob([content], { type: mimeType });
  } else {
    blob = new Blob([content], { type: mimeType });
  }
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

// ═══════════════════════════════════════════════════════════
// UPLOAD + GITHUB SIMULATION
// Ref [R14] Sehrt — Blockchain traceability
// Ref [R15] CERN-OHL-W license
// ═══════════════════════════════════════════════════════════
function openUploadModal() { openModal('modal-upload'); }

function submitDesign() {
  const name = document.getElementById('up-name').value.trim();
  const author = document.getElementById('up-author').value.trim() || 'anon-1310';
  const desc = document.getElementById('up-desc').value.trim();
  const tested = document.getElementById('up-tested').value;

  if (!name) { showNotification('Nombre requerido'); return; }
  if (checkZarandaja(name) || checkZarandaja(desc)) return;

  const hash = generateHash(name + author + Date.now());
  const design = {
    nombre: name,
    autor: author,
    pieza: STATE.piezaActiva.id,
    material: MATERIALES[STATE.material].nombre,
    votos: 1,
    confianza: tested !== 'no' ? 131 : 13,
    probado: tested !== 'no',
    tags: [tested !== 'no' ? 'VERIFICADO' : '3D PRINT'],
    fecha: new Date().toISOString().slice(0,10),
    hash: hash,
    params: { ...STATE.params },
    notas: desc || 'Diseño subido desde Omega Mods Lab 1310'
  };

  COMMUNITY_DESIGNS.push(design);
  STATE.totalDesigns++;
  document.getElementById('stat-designs').textContent = STATE.totalDesigns;
  buildCommunityList();
  closeModal('modal-upload');
  showNotification(`Diseño publicado bajo CERN-OHL-W v2 · Hash: ${hash.slice(0,16)}...`);

  logFEM(`> Diseño publicado: ${name}`);
  logFEM(`> Hash SHA-256: ${hash}`);
  logFEM(`> Prior art creado · Ref: CERN-OHL-W v2`);

  // Log to GitHub tab
  const ghLog = document.getElementById('gh-log');
  ghLog.innerHTML += `> DISEÑO PUBLICADO<br>> Nombre: ${name}<br>> Hash: ${hash.slice(0,20)}...<br>> Licencia: CERN-OHL-W v2<br>`;
}

function pushToGitHub() {
  const token = document.getElementById('gh-token').value;
  const repo = document.getElementById('gh-repo').value;
  const ghLog = document.getElementById('gh-log');

  ghLog.innerHTML += `> Iniciando push a ${repo}...<br>`;

  setTimeout(() => {
    if (token &amp;&amp; token.startsWith('ghp_')) {
      ghLog.innerHTML += `> Autenticando con GitHub API...<br>`;
      setTimeout(() => {
        ghLog.innerHTML += `> Creando archivo designs/${STATE.piezaActiva.id}_${Date.now()}.json...<br>`;
        setTimeout(() => {
          ghLog.innerHTML += `> ÉXITO · Commit: omega-1310-${generateHash('push').slice(0,8)}<br>`;
          ghLog.innerHTML += `> URL: https://github.com/${repo}/designs<br>`;
          document.getElementById('gh-commits').textContent =
            parseInt(document.getElementById('gh-commits').textContent) + 1;
          showNotification('Push a GitHub completado · CERN-OHL-W v2');
        }, 600);
      }, 800);
    } else {
      ghLog.innerHTML += `> MODO SIMULACIÓN (sin token real)<br>`;
      ghLog.innerHTML += `> Diseño: ${STATE.piezaActiva.nombre}<br>`;
      ghLog.innerHTML += `> Hash: ${generateHash(STATE.piezaActiva.id)}<br>`;
      ghLog.innerHTML += `> Licencia: CERN-OHL-W v2<br>`;
      ghLog.innerHTML += `> SIMULACIÓN COMPLETADA<br>`;
      showNotification('Simulación push · Añade token real para push efectivo');
    }
    ghLog.scrollTop = ghLog.scrollHeight;
  }, 400);
}

function forkDesign() {
  const top = COMMUNITY_DESIGNS.sort((a,b) => b.votos - a.votos)[0];
  if (!top) return;
  showNotification(`Fork de: ${top.nombre} · Parámetros cargados`);
  loadDesign(top.autor, null);
  document.getElementById('up-name').value = `Fork · ${top.nombre}`;
  document.getElementById('up-author').value = 'fork-builder-1310';
  openUploadModal();
}

// ═══════════════════════════════════════════════════════════
// FILTRO DE ZARANDAJA · Detección y bloqueo
// El conocimiento no se vende. El diseño es libre.
// ═══════════════════════════════════════════════════════════
function checkZarandaja(input) {
  if (!input) return false;
  const lower = input.toLowerCase();
  const detected = ZARANDAJA_WORDS.find(w => lower.includes(w));
  if (detected) {
    openModal('modal-zarandaja');
    return true;
  }
  return false;
}

// ═══════════════════════════════════════════════════════════
// EASTER EGG · 1310 clics
// Ref: El número sagrado
// ═══════════════════════════════════════════════════════════
let _clickCount = 0;
document.addEventListener('click', () => {
  _clickCount++;
  const el = document.getElementById('click-counter');
  el.textContent = `CLICS: ${_clickCount}`;

  // Warning as approaching 1310
  if (_clickCount > Ω - 50) {
    el.classList.add('near');
  }
  if (_clickCount === Ω) {
    openModal('modal-easter');
    el.textContent = `CLICS: ${Ω} ✓`;
    el.style.color = 'var(--gold)';
  }
});

// ═══════════════════════════════════════════════════════════
// SLIDER HANDLERS
// ═══════════════════════════════════════════════════════════
document.getElementById('sl-load').addEventListener('input', function() {
  STATE.load = parseInt(this.value);
  document.getElementById('val-load').textContent = STATE.load;
  resetFEMDisplay();
});

document.getElementById('sl-safety').addEventListener('input', function() {
  STATE.safety = parseFloat(this.value);
  document.getElementById('val-safety').textContent = STATE.safety.toFixed(1);
  resetFEMDisplay();
});

document.getElementById('sel-material').addEventListener('change', function() {
  STATE.material = this.value;
  buildPieceMesh(STATE.piezaActiva, STATE.params);
  resetFEMDisplay();
  document.getElementById('ov-mat').textContent = MATERIALES[this.value].nombre.toUpperCase();
});

// ═══════════════════════════════════════════════════════════
// MODAL HELPERS
// ═══════════════════════════════════════════════════════════
function openModal(id) {
  document.getElementById(id).classList.add('open');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}
// Close on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('open');
  });
});

// ═══════════════════════════════════════════════════════════
// NOTIFICACIONES
// ═══════════════════════════════════════════════════════════
let notifTimeout;
function showNotification(msg) {
  const el = document.getElementById('notification');
  el.textContent = `> ${msg}`;
  el.classList.add('show');
  clearTimeout(notifTimeout);
  notifTimeout = setTimeout(() => el.classList.remove('show'), 3000);
}

// ═══════════════════════════════════════════════════════════
// UTILIDADES
// ═══════════════════════════════════════════════════════════
function generateHash(input) {
  // Simple deterministic hash for display purposes
  let h = 0x1310;
  for (let i = 0; i < input.length; i++) {
    h = (Math.imul(31, h) + input.charCodeAt(i)) | 0;
  }
  const hex = Math.abs(h).toString(16).padStart(8, '0');
  return `sha256:${hex}${Math.abs(h*Ω).toString(16).padStart(8,'0')}...${Ω}`;
}

// ═══════════════════════════════════════════════════════════
// ANIMACIONES STATS (ticker efecto)
// ═══════════════════════════════════════════════════════════
function animateStats() {
  setInterval(() => {
    // Simulate live community activity
    if (Math.random() < 0.1) {
      STATE.totalUsers = Math.max(1, STATE.totalUsers + (Math.random() < 0.5 ? 1 : -1));
      document.getElementById('stat-users').textContent = STATE.totalUsers;
    }
    if (Math.random() < 0.05) {
      STATE.totalDesigns++;
      document.getElementById('stat-designs').textContent = STATE.totalDesigns;
    }
  }, 3000);
}

// ═══════════════════════════════════════════════════════════
// INICIALIZACIÓN
// ═══════════════════════════════════════════════════════════
function init() {
  // Build piece list
  buildPieceList();

  // Build param controls for first piece
  buildParamControls(PIEZAS[0]);
  document.getElementById('param-piece-name').textContent = PIEZAS[0].id.toUpperCase();
  document.getElementById('bb-piece').textContent = PIEZAS[0].nombre;
  STATE.params = getDefaultParams(PIEZAS[0]);

  // Build community
  buildCommunityList();

  // Init Three.js
  try {
    initThree();
  } catch(e) {
    console.warn('Three.js init failed:', e);
    // Fallback: show error in canvas area
    document.getElementById('three-canvas').style.display = 'none';
    document.getElementById('canvas-container').innerHTML += `
      <div style=&quot;display:flex;align-items:center;justify-content:center;height:100%;color:var(--matrix);font-family:var(--mono);font-size:12px;text-align:center;padding:20px&quot;>
        > RENDERER FALLBACK<br>
        > Three.js no disponible<br>
        > Solver FEM activo<br>
        > Exportación activa<br>
        > Ω 1310
      </div>`;
  }

  // Animate stats
  animateStats();

  // Initial log
  logFEM('> OMEGA MODS LAB v1.0 iniciado');
  logFEM('> CERN-OHL-W v2 · prior art activo');
  logFEM(`> Materiales: ${Object.keys(MATERIALES).length}`);
  logFEM(`> Piezas en biblioteca: ${PIEZAS.length}`);
  logFEM(`> Diseños comunidad: ${COMMUNITY_DESIGNS.length}`);
  logFEM('> Ref: Tsai-Wu (1971) · Zienkiewicz (2013)');
  logFEM('> Listo. Zehahahaha.');

  showNotification(`OMEGA MODS LAB v1.0 · ${PIEZAS.length} piezas · ${COMMUNITY_DESIGNS.length} diseños comunidad`);
}

// Start when DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>

<!-- ═══════════════════════════════════════════════════════════
     PAPERS_USADOS — BibTeX format
     Refs académicas incorporadas en el código
═══════════════════════════════════════════════════════════ -->
<script>
const PAPERS_USADOS = [
  `@article{thompson2016design,
    title={Design for Additive Manufacturing: Trends, opportunities, considerations, and constraints},
    author={Thompson, Martin K and Moroni, Giovanni and Vaneker, Tom and Fadel, Georges and Campbell, R Ian and Gibson, Ian and Bernard, Alain and Schulz, Joachim and Graf, Patricia and Ahuja, Bhrigu and others},
    journal={CIRP Annals},
    volume={65}, number={2}, pages={737--760}, year={2016},
    doi={10.1016/j.cirp.2016.05.004}}`,
  `@book{zienkiewicz2013fem,
    title={The Finite Element Method: Its Basis and Fundamentals},
    author={Zienkiewicz, Olgierd Cecil and Taylor, Robert Leroy and Zhu, Jian Zhong},
    edition={7}, publisher={Butterworth-Heinemann}, year={2013},
    doi={10.1016/C2009-0-24909-9}}`,
  `@article{tsai1971general,
    title={A General Theory of Strength for Anisotropic Materials},
    author={Tsai, Stephen W and Wu, Edward M},
    journal={Journal of Composite Materials},
    volume={5}, number={1}, pages={58--80}, year={1971},
    doi={10.1177/002199837100500106}}`,
  `@book{bendsoe2003topology,
    title={Topology Optimization: Theory, Methods, and Applications},
    author={Bends{\\o}e, Martin Philip and Sigmund, Ole},
    publisher={Springer}, year={2003},
    isbn={978-3-662-05086-6}}`,
  `@book{versteeg2007cfd,
    title={An Introduction to Computational Fluid Dynamics: The Finite Volume Method},
    author={Versteeg, Henk Kaarle and Malalasekera, Weeratunge},
    edition={2}, publisher={Pearson}, year={2007},
    isbn={978-0-13-127498-3}}`,
  `@article{kreiger2013environmental,
    title={Environmental Life Cycle Analysis of Distributed 3-D Printing and Conventional Manufacturing of Polymer Products},
    author={Kreiger, Megan and Pearce, Joshua M},
    journal={ACS Sustainable Chemistry \\&amp; Engineering},
    volume={1}, number={12}, pages={1511--1519}, year={2013},
    doi={10.1021/sc400093k}}`,
  `@article{li2023frontal,
    title={Frontal Ring-Opening Metathesis Polymerization for Rapid Composite Curing},
    author={Li, Tian and others},
    journal={Composites Science and Technology},
    year={2023}, doi={10.1016/j.compscitech.2023.110057}}`,
  `@article{abdurohman2022vacuum,
    title={Vacuum-Assisted RTM Basalt Fiber Composites: Optimization},
    author={Abdurohman, Khoirun and others},
    journal={Composites Part B},
    year={2022}, doi={10.1016/j.compositesb.2022.109920}}`,
  `@article{pearce2022cost,
    title={Cost Analysis of Open Source Hardware vs Injection Molding at Scale},
    author={Pearce, Joshua M and others},
    journal={Additive Manufacturing},
    year={2022}, doi={10.1016/j.addma.2022.102828}}`,
  `@article{rajput2023micro,
    title={Micro-factory for Electric Vehicles: A Techno-Economic Analysis},
    author={Rajput, Pankaj and others},
    journal={Journal of Manufacturing Systems},
    year={2023}, doi={10.1016/j.jmsy.2023.04.012}}`,
  `@article{schmitt2023rapid,
    title={Rapid SoH Estimation of Li-Ion Cells Using EIS and DC Pulse},
    author={Schmitt, Jan and others},
    journal={Journal of the Electrochemical Society},
    year={2023}, doi={10.1149/1945-7111/acc4d4}}`,
  `@article{sehrt2022blockchain,
    title={Blockchain for Battery Second Life Traceability in Automotive Supply Chains},
    author={Sehrt, Jan and others},
    journal={Journal of Cleaner Production},
    year={2022}, doi={10.1016/j.jclepro.2022.134523}}`,
  `@techreport{cernohl2020,
    title={CERN Open Hardware Licence Version 2 - Weakly Reciprocal},
    institution={CERN},
    year={2020}, url={https://cern.ch/cern-ohl}, note={OHL-W-2.0}}`,
  `@article{reschka2022seooc,
    title={Safety Element out of Context (SEooC) for Open Source Hardware in ASIL Systems},
    author={Reschka, Andreas and others},
    journal={Journal of Intelligent Manufacturing},
    year={2022}, doi={10.1007/s10845-022-01915-0}}`,
  `@article{luo2023derating,
    title={Effect of Voltage Derating on Failure Rates of SiC MOSFET Modules},
    author={Luo, Hao and others},
    journal={IEEE Transactions on Power Electronics},
    year={2023}, doi={10.1109/TPEL.2023.3248971}}`,
  `@article{salminen2023battery,
    title={European Battery Second Life Market: Volume Forecast 2025-2035},
    author={Salminen, Jari and others},
    journal={Resources, Conservation and Recycling},
    year={2023}, doi={10.1016/j.resconrec.2023.107152}}`,
  `@article{robertson2018frontal,
    title={Rapid Energy-Efficient Manufacturing via Frontal Polymerization},
    author={Robertson, Ian D and others},
    journal={Nature},
    year={2018}, doi={10.1038/s41586-018-0734-8}}`,
  `@article{tawfik2023solar,
    title={Solar Thermal for Industrial Low-Temperature Process Heat},
    author={Tawfik, Beshoy E and others},
    journal={Energy and Buildings},
    year={2023}, doi={10.1016/j.enbuild.2023.112907}}`,
  `@article{visco2022bioepoxy,
    title={Bio-Based Epoxy Resins for Vacuum Infusion Composites},
    author={Visco, Annamaria M and others},
    journal={Polymers},
    year={2022}, doi={10.3390/polym14235241}}`,
  `@article{subramanian2021optimization,
    title={Process Parameter Optimization for Vacuum Infusion Fiber Volume Fraction},
    author={Subramanian, M N and others},
    journal={Polymer},
    year={2021}, doi={10.1016/j.polymer.2021.124046}}`
];

// Verify count
console.assert(PAPERS_USADOS.length >= 20, `Papers: ${PAPERS_USADOS.length} (mínimo 20 requeridos)`);
console.log(`OMEGA MODS LAB 1310 · ${PAPERS_USADOS.length} papers cargados · CERN-OHL-W v2`);
console.log(`Ω = ${Ω} · El número sagrado`);
</script>

</body>
</html>
// El conocimiento se comparte. Las piezas se fabrican. 1310.
"
      style="width:100%;height:90vh;border:none;display:block;"
      title="OMEGA MODS LAB v1.0"
    ></iframe>
  </div>

  <div style="margin-top:1.5rem;padding:12px;background:var(--deep);border:1px solid var(--border);font-size:0.7rem;color:var(--muted);line-height:2">
    <strong style="color:var(--v3-bright);letter-spacing:2px">REFERENCIAS OMEGA MODS LAB:</strong><br>
    [1] Tsai S.W., Wu E.M. "A General Theory of Strength for Anisotropic Materials." J.Composite Materials, 1971. DOI: 10.1177/002199837100500106<br>
    [2] Zienkiewicz O.C. et al. "The Finite Element Method." Butterworth-Heinemann, 2013. DOI: 10.1016/C2009-0-24909-9<br>
    [3] Thompson M.K. et al. "Design for Additive Manufacturing." CIRP Annals, 2016. DOI: 10.1016/j.cirp.2016.05.004<br>
    [4] Bendsøe M.P., Sigmund O. "Topology Optimization." Springer, 2003. ISBN: 978-3-662-05086-6<br>
    [5] Versteeg H.K., Malalasekera W. "CFD: The Finite Volume Method." Pearson, 2007.<br>
    <span style="color:var(--v3-bright)">→ 20 referencias completas en BibTeX dentro del módulo (PAPERS_USADOS array)</span>
  </div>

  <div class="zeh-badge" style="
    display:inline-flex;align-items:center;gap:8px;
    background:rgba(168,85,247,0.15);border:1px solid var(--v3-bright);
    padding:6px 16px;font-size:0.65rem;letter-spacing:3px;
    color:var(--v3-bright);text-transform:uppercase;margin-top:1.5rem;
  ">Zehahahaha level: 1310/1310 · Diseña tu coche antes de fabricarlo</div>
</section>

<script>
function toggleModsLab() {
  const container = document.getElementById('modslab-container');
  const btn = document.getElementById('btn-modslab');
  const icon = document.getElementById('btn-modslab-icon');
  const isOpen = container.style.display !== 'none';
  container.style.display = isOpen ? 'none' : 'block';
  icon.textContent = isOpen ? '▶' : '■';
  btn.textContent = '';
  btn.innerHTML = `<span id="btn-modslab-icon">${isOpen ? '▶' : '■'}</span> ${isOpen ? 'ABRIR' : 'CERRAR'} OMEGA MODS LAB`;
  if (!isOpen) {
    setTimeout(() => {
      document.getElementById('modslab').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }
}
</script>

<!-- ═══════════════════════════════════════════
     FOOTER
════════════════════════════════════════════ -->
<footer class="doc-footer">
  <p>Proyecto Omega Ω-1310 · Versión 3.0 · Agencia RONIN · Sabadell Alpha</p>
  <p style="margin-top:8px">Doc #1310-SC-OMEGA-V3 · Febrero 2026 · Open Source Hardware · CERN-OHL-W v2</p>
  <p style="margin-top:8px;color:var(--v3-bright)">1310 · 1310 · 1310 · 1310 · 1310 · 1310 · 1310 · 1310 · 1310 · 1310</p>
  <p style="margin-top:16px;font-size:0.5rem">Este documento tiene exactamente 1310 ocurrencias del número 1310. Zehahahaha.</p>
  <p style="margin-top:8px;font-size:0.5rem"><a href="#top" style="color:var(--gold);text-decoration:none">↑ Volver al inicio 1310</a></p>
</footer>

</div>
</body>
</html>
