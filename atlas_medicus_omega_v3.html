<!DOCTYPE html>
<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘  ATLAS MEDICUS Î© â€” Sistema Operativo para la Salud Global               â•‘
  â•‘  Agencia Ronin Â· Director Î© Â· Obra #20                                  â•‘
  â•‘  "La salud no es un privilegio. Es un derecho que se administra          â•‘
  â•‘   con soberanÃ­a. 1310 clics y serÃ¡s libre."                             â•‘
  â•‘                                                                          â•‘
  â•‘  Licencia: AGPL + ClÃ¡usula Comercial Ronin                              â•‘
  â•‘  Uso libre para clÃ­nicas sin Ã¡nimo de lucro.                            â•‘
  â•‘  Pago obligatorio para uso corporativo.                                  â•‘
  â•‘                                                                          â•‘
  â•‘  ARQUITECTURA: Offline-First Â· Multi-tenant Â· Hardware-AgnÃ³stico        â•‘
  â•‘  STACK: HTML/JS/CSS autocontenido â†’ Electron/React Native ready         â•‘
  â•‘  BACKEND: IndexedDB simulado â†’ Node.js + PostgreSQL extensible          â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atlas Medicus Î© â€” Sistema Operativo para la Salud Global</title>
<meta name="description" content="Sistema operativo mÃ©dico integral. DiagnÃ³stico aumentado. SoberanÃ­a de datos. 1310.">

<!-- Google Fonts: Chosen for medical authority + futurism -->
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES GLOBALES â€” El ADN visual de Atlas Medicus Î©
   Cian: diagnÃ³stico, Verde: salud, Oro: premium, Rojo: alerta
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --cyan:     #00ffff;
  --green:    #00ff41;
  --gold:     #ffd700;
  --red:      #ff3b5c;
  --red-dark: #cc1a35;
  --bg:       #050a0f;
  --bg2:      #080f17;
  --bg3:      #0d1a24;
  --bg4:      #112233;
  --surface:  #0a1520;
  --border:   rgba(0,255,255,0.12);
  --border-g: rgba(0,255,65,0.12);
  --text:     #e8f4f8;
  --text2:    #7db8cc;
  --text3:    #3d6b80;
  --mono:     'Space Mono', monospace;
  --display:  'Syne', sans-serif;
  --body:     'DM Sans', sans-serif;
  --glow-c:   0 0 20px rgba(0,255,255,0.4);
  --glow-g:   0 0 20px rgba(0,255,65,0.4);
  --glow-r:   0 0 20px rgba(255,59,92,0.6);
  --radius:   4px;
  --radius-lg:8px;
  --1310:     1310; /* La constante sagrada */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESET */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:14px;scroll-behavior:smooth}
body{
  font-family:var(--body);
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  line-height:1.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCROLLBAR */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--cyan);opacity:0.5;border-radius:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOADER */
#loader{
  position:fixed;inset:0;z-index:9999;
  background:var(--bg);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:24px;
  transition:opacity 0.8s ease;
}
#loader.hidden{opacity:0;pointer-events:none}
.loader-logo{
  font-family:var(--display);
  font-size:2.5rem;
  font-weight:800;
  letter-spacing:-0.02em;
  color:var(--cyan);
  text-shadow:var(--glow-c);
  animation:pulse-glow 2s ease infinite;
}
.loader-logo span{color:var(--gold)}
.loader-bar{
  width:240px;height:2px;
  background:var(--bg4);
  border-radius:1px;
  overflow:hidden;
}
.loader-bar-fill{
  height:100%;
  background:linear-gradient(90deg,var(--cyan),var(--green));
  border-radius:1px;
  animation:loader-fill 2.5s ease forwards;
}
.loader-text{
  font-family:var(--mono);
  font-size:0.7rem;
  color:var(--text3);
  letter-spacing:0.1em;
  text-transform:uppercase;
}
@keyframes loader-fill{0%{width:0}100%{width:100%}}
@keyframes pulse-glow{0%,100%{text-shadow:0 0 20px rgba(0,255,255,0.4)}50%{text-shadow:0 0 40px rgba(0,255,255,0.8),0 0 60px rgba(0,255,255,0.3)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ZARANDAJA OVERLAY */
#zarandaja-overlay{
  position:fixed;inset:0;z-index:99999;
  background:rgba(255,59,92,0.95);
  display:none;
  flex-direction:column;
  align-items:center;justify-content:center;
  gap:16px;
  animation:zarandaja-flash 0.1s ease;
}
#zarandaja-overlay.active{display:flex}
@keyframes zarandaja-flash{0%,50%{opacity:0}100%{opacity:1}}
.zarandaja-title{
  font-family:var(--display);
  font-size:3rem;
  font-weight:800;
  color:#fff;
  text-align:center;
  letter-spacing:-0.02em;
}
.zarandaja-msg{
  font-family:var(--mono);
  font-size:1rem;
  color:rgba(255,255,255,0.8);
  text-align:center;
  max-width:400px;
}
.zarandaja-btn{
  margin-top:16px;
  padding:12px 32px;
  background:#fff;
  color:var(--red);
  border:none;
  font-family:var(--display);
  font-weight:700;
  font-size:1rem;
  cursor:pointer;
  border-radius:var(--radius);
  letter-spacing:0.05em;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN LAYOUT */
#app{display:flex;height:100vh;overflow:hidden}
#app.hidden{display:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR */
#sidebar{
  width:220px;
  min-width:220px;
  background:var(--bg2);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  transition:width 0.3s ease;
  position:relative;
  z-index:100;
}
#sidebar.collapsed{width:56px;min-width:56px}
.sidebar-logo{
  padding:20px 16px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:10px;
  cursor:pointer;
  flex-shrink:0;
}
.logo-mark{
  width:32px;height:32px;min-width:32px;
  background:conic-gradient(var(--cyan),var(--green),var(--cyan));
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--display);font-weight:800;font-size:14px;
  color:var(--bg);
  flex-shrink:0;
  box-shadow:var(--glow-c);
  animation:logo-spin 20s linear infinite;
}
@keyframes logo-spin{to{filter:hue-rotate(360deg)}}
.logo-text{
  font-family:var(--display);font-weight:800;font-size:0.95rem;
  color:var(--cyan);letter-spacing:-0.01em;
  white-space:nowrap;overflow:hidden;
  transition:opacity 0.2s;
}
.logo-omega{color:var(--gold)}
#sidebar.collapsed .logo-text{opacity:0;width:0}

.sidebar-clinic{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  flex-shrink:0;
}
.clinic-badge{
  background:var(--bg3);
  border:1px solid var(--border-g);
  border-radius:var(--radius);
  padding:8px 10px;
  display:flex;align-items:center;gap:8px;
}
.clinic-dot{
  width:8px;height:8px;min-width:8px;
  background:var(--green);
  border-radius:50%;
  box-shadow:0 0 6px var(--green);
  animation:blink 2s ease infinite;
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.4}}
.clinic-name{font-size:0.75rem;font-weight:500;color:var(--green);white-space:nowrap;overflow:hidden}
#sidebar.collapsed .clinic-badge{justify-content:center}
#sidebar.collapsed .clinic-name{display:none}

.sidebar-nav{
  flex:1;overflow-y:auto;overflow-x:hidden;
  padding:8px 0;
}
.nav-section{
  padding:8px 16px 4px;
  font-family:var(--mono);
  font-size:0.6rem;
  color:var(--text3);
  letter-spacing:0.15em;
  text-transform:uppercase;
  white-space:nowrap;
}
#sidebar.collapsed .nav-section{opacity:0}
.nav-item{
  display:flex;align-items:center;gap:10px;
  padding:9px 16px;
  cursor:pointer;
  transition:all 0.15s ease;
  border-left:2px solid transparent;
  position:relative;
  white-space:nowrap;
  user-select:none;
}
.nav-item:hover{background:rgba(0,255,255,0.04);border-left-color:rgba(0,255,255,0.3)}
.nav-item.active{background:rgba(0,255,255,0.08);border-left-color:var(--cyan)}
.nav-item.active .nav-label{color:var(--cyan)}
.nav-item.active .nav-icon{color:var(--cyan)}
.nav-icon{font-size:1rem;min-width:20px;text-align:center;color:var(--text2)}
.nav-label{font-size:0.82rem;color:var(--text2);transition:color 0.15s}
.nav-badge{
  margin-left:auto;
  background:var(--red);
  color:#fff;
  font-size:0.6rem;
  font-family:var(--mono);
  padding:1px 5px;
  border-radius:10px;
  min-width:18px;
  text-align:center;
}
.nav-badge.gold{background:var(--gold);color:var(--bg)}
#sidebar.collapsed .nav-label,
#sidebar.collapsed .nav-badge,
#sidebar.collapsed .nav-section{display:none}

.sidebar-footer{
  padding:12px 16px;
  border-top:1px solid var(--border);
  flex-shrink:0;
}
.user-pill{
  display:flex;align-items:center;gap:8px;
  background:var(--bg3);
  border-radius:var(--radius);
  padding:8px 10px;
  cursor:pointer;
}
.user-avatar{
  width:28px;height:28px;min-width:28px;
  background:linear-gradient(135deg,var(--cyan),var(--green));
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:0.7rem;font-weight:700;color:var(--bg);
}
.user-info{overflow:hidden}
.user-name{font-size:0.78rem;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden}
.user-role{font-size:0.65rem;color:var(--text3)}
#sidebar.collapsed .user-info{display:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN */
#main{
  flex:1;display:flex;flex-direction:column;
  overflow:hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOPBAR */
#topbar{
  height:52px;
  background:var(--bg2);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:12px;
  padding:0 20px;
  flex-shrink:0;
}
.topbar-title{
  font-family:var(--display);
  font-weight:700;
  font-size:1.1rem;
  color:var(--text);
  flex:1;
}
.topbar-title span{color:var(--text3);font-weight:400;font-size:0.85rem;margin-left:6px}
.topbar-actions{display:flex;align-items:center;gap:8px}
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;
  border-radius:var(--radius);
  font-family:var(--body);
  font-size:0.8rem;
  font-weight:500;
  cursor:pointer;
  border:1px solid transparent;
  transition:all 0.15s ease;
  text-decoration:none;
  white-space:nowrap;
}
.btn-primary{
  background:rgba(0,255,255,0.1);
  border-color:var(--cyan);
  color:var(--cyan);
}
.btn-primary:hover{background:rgba(0,255,255,0.2);box-shadow:var(--glow-c)}
.btn-green{
  background:rgba(0,255,65,0.1);
  border-color:var(--green);
  color:var(--green);
}
.btn-green:hover{background:rgba(0,255,65,0.2);box-shadow:var(--glow-g)}
.btn-gold{
  background:rgba(255,215,0,0.1);
  border-color:var(--gold);
  color:var(--gold);
}
.btn-red{background:rgba(255,59,92,0.1);border-color:var(--red);color:var(--red)}
.btn-ghost{background:transparent;border-color:var(--border);color:var(--text2)}
.btn-ghost:hover{border-color:var(--cyan);color:var(--cyan)}
.btn-sm{padding:5px 10px;font-size:0.75rem}

.status-pill{
  display:flex;align-items:center;gap:6px;
  padding:5px 10px;
  background:var(--bg3);
  border:1px solid var(--border-g);
  border-radius:20px;
  font-family:var(--mono);
  font-size:0.65rem;
  color:var(--green);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTENT */
#content{
  flex:1;
  overflow-y:auto;
  padding:24px;
  background:var(--bg);
  position:relative;
}
/* subtle grid background */
#content::before{
  content:'';
  position:fixed;inset:0;
  background-image:
    linear-gradient(rgba(0,255,255,0.02) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,255,255,0.02) 1px,transparent 1px);
  background-size:40px 40px;
  pointer-events:none;z-index:0;
}

.panel{display:none}
.panel.active{display:block;animation:fadeIn 0.25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CARDS */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:20px;
  position:relative;
  overflow:hidden;
}
.card::before{
  content:'';
  position:absolute;top:0;left:0;right:0;
  height:1px;
  background:linear-gradient(90deg,transparent,var(--cyan),transparent);
  opacity:0.3;
}
.card-title{
  font-family:var(--display);
  font-weight:700;
  font-size:0.95rem;
  color:var(--text);
  margin-bottom:4px;
  display:flex;align-items:center;gap:8px;
}
.card-subtitle{font-size:0.75rem;color:var(--text3);margin-bottom:16px}
.card.green-accent{border-color:var(--border-g)}
.card.green-accent::before{background:linear-gradient(90deg,transparent,var(--green),transparent)}
.card.gold-accent{border-color:rgba(255,215,0,0.15)}
.card.gold-accent::before{background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.card.red-accent{border-color:rgba(255,59,92,0.2)}
.card.red-accent::before{background:linear-gradient(90deg,transparent,var(--red),transparent)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GRID */
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:repeat(2,1fr)}
.grid-3{grid-template-columns:repeat(3,1fr)}
.grid-4{grid-template-columns:repeat(4,1fr)}
.grid-auto{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• KPI CARDS */
.kpi-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:16px 20px;
  position:relative;
  overflow:hidden;
  cursor:default;
  transition:border-color 0.2s;
}
.kpi-card:hover{border-color:var(--cyan)}
.kpi-label{font-size:0.7rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.1em;font-family:var(--mono);margin-bottom:8px}
.kpi-value{font-family:var(--display);font-weight:800;font-size:2rem;color:var(--cyan);line-height:1}
.kpi-value.green{color:var(--green)}
.kpi-value.gold{color:var(--gold)}
.kpi-value.red{color:var(--red)}
.kpi-delta{font-size:0.72rem;color:var(--text3);margin-top:4px}
.kpi-delta.up{color:var(--green)}
.kpi-delta.down{color:var(--red)}
.kpi-icon{
  position:absolute;right:16px;top:50%;transform:translateY(-50%);
  font-size:2rem;opacity:0.1;
}
.kpi-bar{
  height:3px;background:var(--bg4);border-radius:2px;margin-top:12px;overflow:hidden;
}
.kpi-bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--cyan),var(--green))}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FORMS */
.form-group{margin-bottom:14px}
label{display:block;font-size:0.75rem;color:var(--text3);margin-bottom:5px;font-family:var(--mono);text-transform:uppercase;letter-spacing:0.08em}
input,select,textarea{
  width:100%;
  background:var(--bg3);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:9px 12px;
  color:var(--text);
  font-family:var(--body);
  font-size:0.85rem;
  transition:border-color 0.15s;
  outline:none;
}
input:focus,select:focus,textarea:focus{border-color:var(--cyan);box-shadow:0 0 0 2px rgba(0,255,255,0.08)}
select option{background:var(--bg3)}
textarea{resize:vertical;min-height:80px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TABLE */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:0.82rem}
th{
  text-align:left;
  padding:10px 12px;
  font-family:var(--mono);
  font-size:0.65rem;
  color:var(--text3);
  text-transform:uppercase;
  letter-spacing:0.1em;
  border-bottom:1px solid var(--border);
  white-space:nowrap;
}
td{padding:10px 12px;border-bottom:1px solid rgba(0,255,255,0.04);color:var(--text2);vertical-align:middle}
tr:hover td{background:rgba(0,255,255,0.02)}
.td-mono{font-family:var(--mono);font-size:0.75rem}
.badge{
  display:inline-flex;align-items:center;gap:4px;
  padding:2px 8px;
  border-radius:10px;
  font-size:0.68rem;
  font-weight:500;
  white-space:nowrap;
}
.badge-cyan{background:rgba(0,255,255,0.1);color:var(--cyan);border:1px solid rgba(0,255,255,0.2)}
.badge-green{background:rgba(0,255,65,0.1);color:var(--green);border:1px solid rgba(0,255,65,0.2)}
.badge-gold{background:rgba(255,215,0,0.1);color:var(--gold);border:1px solid rgba(255,215,0,0.2)}
.badge-red{background:rgba(255,59,92,0.1);color:var(--red);border:1px solid rgba(255,59,92,0.2)}
.badge-gray{background:var(--bg4);color:var(--text3);border:1px solid var(--border)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHART (pure CSS) */
.bar-chart{display:flex;align-items:flex-end;gap:8px;height:120px;padding-top:16px}
.bar-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px}
.bar{
  width:100%;border-radius:2px 2px 0 0;
  transition:height 1s ease;
  position:relative;
  cursor:default;
}
.bar:hover{filter:brightness(1.3)}
.bar-label{font-family:var(--mono);font-size:0.6rem;color:var(--text3);text-align:center}
.bar-val{font-family:var(--mono);font-size:0.65rem;color:var(--text2)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SPARKLINE SVG */
.sparkline{width:100%;height:48px;overflow:visible}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL */
.modal-overlay{
  position:fixed;inset:0;z-index:1000;
  background:rgba(5,10,15,0.85);
  backdrop-filter:blur(4px);
  display:none;
  align-items:center;justify-content:center;
  padding:20px;
}
.modal-overlay.active{display:flex;animation:fadeIn 0.2s ease}
.modal{
  background:var(--bg2);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  width:100%;max-width:560px;
  max-height:90vh;
  overflow-y:auto;
  position:relative;
}
.modal-header{
  padding:20px 24px 16px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.modal-title{font-family:var(--display);font-weight:700;font-size:1rem;color:var(--cyan)}
.modal-close{background:none;border:none;color:var(--text3);cursor:pointer;font-size:1.2rem;padding:0;line-height:1}
.modal-close:hover{color:var(--red)}
.modal-body{padding:20px 24px}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TABS */
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:20px}
.tab{
  padding:10px 16px;
  font-size:0.82rem;
  color:var(--text3);
  cursor:pointer;
  border-bottom:2px solid transparent;
  transition:all 0.15s;
  white-space:nowrap;
}
.tab:hover{color:var(--text2)}
.tab.active{color:var(--cyan);border-bottom-color:var(--cyan)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AGENDA */
.agenda-grid{
  display:grid;
  grid-template-columns:60px repeat(6,1fr);
  gap:1px;
  background:var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  font-size:0.75rem;
}
.agenda-cell{background:var(--surface);padding:6px 8px;min-height:36px}
.agenda-header{
  background:var(--bg3);
  padding:8px;
  text-align:center;
  font-family:var(--mono);
  font-size:0.65rem;
  color:var(--text3);
  text-transform:uppercase;
}
.agenda-time{
  background:var(--bg2);
  padding:6px 8px;
  font-family:var(--mono);
  font-size:0.62rem;
  color:var(--text3);
  display:flex;align-items:center;justify-content:center;
}
.appt{
  background:rgba(0,255,255,0.08);
  border-left:2px solid var(--cyan);
  border-radius:2px;
  padding:3px 5px;
  font-size:0.68rem;
  color:var(--cyan);
  cursor:pointer;
  transition:background 0.15s;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.appt:hover{background:rgba(0,255,255,0.16)}
.appt.green{background:rgba(0,255,65,0.08);border-color:var(--green);color:var(--green)}
.appt.gold{background:rgba(255,215,0,0.08);border-color:var(--gold);color:var(--gold)}
.appt.red{background:rgba(255,59,92,0.08);border-color:var(--red);color:var(--red)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DIAGNOSTIC ENGINE */
.dx-symptom-tag{
  display:inline-flex;align-items:center;gap:4px;
  padding:4px 10px;
  background:rgba(0,255,255,0.08);
  border:1px solid rgba(0,255,255,0.2);
  border-radius:20px;
  font-size:0.78rem;
  color:var(--cyan);
  margin:3px;
  cursor:pointer;
  transition:all 0.15s;
}
.dx-symptom-tag:hover,.dx-symptom-tag.active{
  background:rgba(0,255,255,0.2);
  box-shadow:var(--glow-c);
}
.dx-symptom-tag .rm{
  font-size:0.7rem;color:var(--red);margin-left:2px;
}
.dx-result{
  display:flex;align-items:center;gap:12px;
  padding:12px 16px;
  background:var(--bg3);
  border:1px solid var(--border);
  border-radius:var(--radius);
  margin-bottom:8px;
  transition:border-color 0.15s;
  cursor:pointer;
}
.dx-result:hover{border-color:var(--cyan)}
.dx-rank{
  width:28px;height:28px;min-width:28px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-family:var(--mono);
  font-size:0.7rem;
  font-weight:700;
}
.dx-rank.r1{background:var(--gold);color:var(--bg)}
.dx-rank.r2{background:var(--cyan);color:var(--bg)}
.dx-rank.r3{background:var(--green);color:var(--bg)}
.dx-rank.rn{background:var(--bg4);color:var(--text2)}
.dx-name{font-weight:600;font-size:0.88rem;color:var(--text)}
.dx-category{font-size:0.7rem;color:var(--text3)}
.dx-prob{
  margin-left:auto;
  font-family:var(--mono);
  font-size:0.85rem;
  color:var(--cyan);
}
.dx-bar-wrap{width:60px;height:4px;background:var(--bg4);border-radius:2px;margin-top:4px}
.dx-bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--cyan),var(--green))}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CALIBRATION */
.calib-canvas{
  width:100%;
  height:220px;
  background:var(--bg3);
  border:1px solid var(--border);
  border-radius:var(--radius);
  position:relative;
  overflow:hidden;
  cursor:crosshair;
}
.calib-reticle{
  position:absolute;
  width:60px;height:60px;
  border:2px solid var(--cyan);
  border-radius:50%;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  box-shadow:var(--glow-c);
  animation:calib-pulse 2s ease infinite;
}
@keyframes calib-pulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:1}50%{transform:translate(-50%,-50%) scale(1.1);opacity:0.7}}
.calib-crosshair::before,.calib-crosshair::after{
  content:'';position:absolute;background:rgba(0,255,255,0.3);
}
.calib-crosshair::before{width:1px;height:100%;left:50%;top:0}
.calib-crosshair::after{height:1px;width:100%;top:50%;left:0}
.calib-corner{
  position:absolute;width:16px;height:16px;
  border-color:var(--gold);border-style:solid;
}
.calib-corner.tl{top:12px;left:12px;border-width:2px 0 0 2px}
.calib-corner.tr{top:12px;right:12px;border-width:2px 2px 0 0}
.calib-corner.bl{bottom:12px;left:12px;border-width:0 0 2px 2px}
.calib-corner.br{bottom:12px;right:12px;border-width:0 2px 2px 0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• VIDEO CALL PREVIEW */
.video-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.video-tile{
  background:var(--bg3);
  border:1px solid var(--border);
  border-radius:var(--radius);
  aspect-ratio:16/9;
  position:relative;
  overflow:hidden;
  display:flex;align-items:center;justify-content:center;
}
.video-tile-label{
  position:absolute;bottom:8px;left:8px;
  background:rgba(0,0,0,0.6);
  padding:3px 8px;
  border-radius:var(--radius);
  font-size:0.7rem;
  color:var(--text);
  font-family:var(--mono);
}
.video-avatar{font-size:2.5rem;opacity:0.3}
.video-controls{
  display:flex;justify-content:center;gap:8px;
  margin-top:12px;
}
.vbtn{
  width:40px;height:40px;
  border-radius:50%;
  border:1px solid var(--border);
  background:var(--bg3);
  color:var(--text2);
  cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  font-size:1rem;
  transition:all 0.15s;
}
.vbtn:hover{border-color:var(--cyan);color:var(--cyan)}
.vbtn.end{background:var(--red);border-color:var(--red);color:#fff}
.vbtn.end:hover{background:var(--red-dark)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRICING */
.pricing-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius-lg);
  padding:24px;
  text-align:center;
  position:relative;
  overflow:hidden;
  transition:transform 0.2s,border-color 0.2s;
}
.pricing-card:hover{transform:translateY(-4px);border-color:var(--cyan)}
.pricing-card.featured{border-color:var(--gold)}
.pricing-card.featured::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--gold)}
.pricing-badge{
  position:absolute;top:12px;right:12px;
  background:var(--gold);
  color:var(--bg);
  font-size:0.65rem;
  font-weight:700;
  padding:2px 8px;
  border-radius:10px;
  font-family:var(--mono);
  letter-spacing:0.05em;
}
.pricing-plan{font-family:var(--mono);font-size:0.7rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.15em;margin-bottom:8px}
.pricing-price{
  font-family:var(--display);
  font-size:2.5rem;
  font-weight:800;
  color:var(--text);
  line-height:1;
}
.pricing-price sup{font-size:1rem;vertical-align:super;color:var(--text3)}
.pricing-price sub{font-size:0.9rem;color:var(--text3);font-weight:400}
.pricing-desc{font-size:0.8rem;color:var(--text3);margin:8px 0 16px}
.pricing-features{text-align:left;margin-bottom:20px}
.pricing-feat{
  padding:5px 0;
  font-size:0.8rem;
  color:var(--text2);
  display:flex;gap:8px;align-items:flex-start;
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.pricing-feat::before{content:'âœ“';color:var(--green);flex-shrink:0;font-size:0.75rem;margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MANIFESTO */
.manifesto-block{
  background:linear-gradient(135deg,var(--bg3),var(--bg2));
  border:1px solid rgba(0,255,255,0.15);
  border-radius:var(--radius-lg);
  padding:24px 28px;
  position:relative;
  overflow:hidden;
}
.manifesto-block::before{
  content:'"';
  position:absolute;
  top:-20px;left:10px;
  font-size:10rem;
  font-family:var(--display);
  color:rgba(0,255,255,0.05);
  line-height:1;
  pointer-events:none;
}
.manifesto-text{
  font-family:var(--display);
  font-size:1.1rem;
  font-weight:600;
  color:var(--text);
  line-height:1.6;
}
.manifesto-text em{color:var(--cyan);font-style:normal}
.manifesto-sig{
  margin-top:12px;
  font-family:var(--mono);
  font-size:0.7rem;
  color:var(--text3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATION TOAST */
#toast-container{
  position:fixed;bottom:20px;right:20px;
  display:flex;flex-direction:column;gap:8px;
  z-index:9998;
}
.toast{
  background:var(--bg2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:10px 16px;
  font-size:0.8rem;
  color:var(--text2);
  display:flex;align-items:center;gap:8px;
  min-width:240px;
  animation:toast-in 0.3s ease;
  transition:opacity 0.3s;
}
.toast.green{border-color:rgba(0,255,65,0.3)}
.toast.red{border-color:rgba(255,59,92,0.3)}
@keyframes toast-in{from{transform:translateX(30px);opacity:0}to{transform:none;opacity:1}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PATIENT CARD */
.patient-row{
  display:flex;align-items:center;gap:12px;
  padding:10px;
  background:var(--bg3);
  border:1px solid var(--border);
  border-radius:var(--radius);
  cursor:pointer;
  transition:border-color 0.15s;
  margin-bottom:6px;
}
.patient-row:hover{border-color:var(--cyan)}
.patient-avatar{
  width:36px;height:36px;min-width:36px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--cyan),var(--green));
  display:flex;align-items:center;justify-content:center;
  font-size:0.8rem;font-weight:700;color:var(--bg);
}
.patient-name{font-weight:500;font-size:0.88rem;color:var(--text)}
.patient-meta{font-size:0.72rem;color:var(--text3)}
.patient-tags{margin-left:auto;display:flex;gap:4px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HCE */
.hce-section{
  border:1px solid var(--border);
  border-radius:var(--radius);
  margin-bottom:12px;
  overflow:hidden;
}
.hce-section-header{
  padding:10px 14px;
  background:var(--bg3);
  font-family:var(--mono);
  font-size:0.72rem;
  color:var(--text3);
  text-transform:uppercase;
  letter-spacing:0.1em;
  cursor:pointer;
  display:flex;justify-content:space-between;align-items:center;
  user-select:none;
}
.hce-section-header:hover{color:var(--cyan)}
.hce-section-body{padding:14px;display:none}
.hce-section-body.open{display:block}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PROGRESS BAR */
.progress{height:6px;background:var(--bg4);border-radius:3px;overflow:hidden;margin:4px 0}
.progress-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--cyan),var(--green));transition:width 1s ease}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SWITCH */
.switch{position:relative;display:inline-block;width:40px;height:22px}
.switch input{opacity:0;width:0;height:0}
.slider{
  position:absolute;inset:0;
  background:var(--bg4);
  border-radius:11px;
  cursor:pointer;
  transition:0.2s;
  border:1px solid var(--border);
}
.slider::before{
  content:'';
  position:absolute;
  height:16px;width:16px;
  left:2px;bottom:2px;
  background:var(--text3);
  border-radius:50%;
  transition:0.2s;
}
input:checked + .slider{background:rgba(0,255,65,0.2);border-color:var(--green)}
input:checked + .slider::before{transform:translateX(18px);background:var(--green)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EPI MAP */
.epi-map{
  background:var(--bg3);
  border:1px solid var(--border);
  border-radius:var(--radius);
  height:200px;
  position:relative;
  overflow:hidden;
  display:flex;align-items:center;justify-content:center;
}
.epi-dot{
  position:absolute;
  width:10px;height:10px;
  border-radius:50%;
  background:var(--red);
  box-shadow:0 0 10px var(--red);
  cursor:pointer;
}
.epi-dot::before{
  content:'';
  position:absolute;inset:-4px;
  border-radius:50%;
  background:rgba(255,59,92,0.2);
  animation:epi-pulse 2s ease infinite;
}
@keyframes epi-pulse{0%,100%{transform:scale(1);opacity:0.7}50%{transform:scale(1.5);opacity:0}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESPONSIVE */
@media(max-width:900px){
  #sidebar{width:56px;min-width:56px}
  #sidebar .logo-text,#sidebar .nav-label,#sidebar .nav-badge,#sidebar .nav-section,#sidebar .user-info,#sidebar .clinic-name{display:none!important}
  .grid-4{grid-template-columns:repeat(2,1fr)}
  .grid-3{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:600px){
  #content{padding:12px}
  .grid-2,.grid-3,.grid-4{grid-template-columns:1fr}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UTILITIES */
.flex{display:flex}.items-center{align-items:center}.justify-between{justify-content:space-between}
.gap-8{gap:8px}.gap-12{gap:12px}.gap-16{gap:16px}
.mt-4{margin-top:4px}.mt-8{margin-top:8px}.mt-12{margin-top:12px}.mt-16{margin-top:16px}.mt-20{margin-top:20px}
.mb-8{margin-bottom:8px}.mb-12{margin-bottom:12px}.mb-16{margin-bottom:16px}
.text-cyan{color:var(--cyan)}.text-green{color:var(--green)}.text-gold{color:var(--gold)}.text-red{color:var(--red)}.text-muted{color:var(--text3)}
.font-mono{font-family:var(--mono)}.font-display{font-family:var(--display)}
.text-sm{font-size:0.8rem}.text-xs{font-size:0.7rem}
.w-full{width:100%}.hidden{display:none!important}
.pointer{cursor:pointer}
.truncate{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.genomics-sub{animation:fadeIn 0.2s ease}
.badge-cyan{background:rgba(0,255,255,0.15);color:var(--cyan);border:1px solid rgba(0,255,255,0.3)}
</style>
<body>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  LOADER â€” El sistema despertando. 1310 vectores inicializando.  â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loader">
  <div class="loader-logo">Atlas Medicus <span>Î©</span></div>
  <div class="loader-bar"><div class="loader-bar-fill"></div></div>
  <div class="loader-text" id="loader-status">Iniciando nÃºcleo Î©...</div>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  ZARANDAJA DETECTOR â€” Porque la salud es cosa seria.           â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="zarandaja-overlay">
  <div style="font-size:4rem">â›”</div>
  <div class="zarandaja-title">ZARANDAJA DETECTADA</div>
  <div class="zarandaja-msg">LA SALUD ES COSA SERIA.<br>El nombre que has introducido no cumple los estÃ¡ndares de dignidad clÃ­nica de Atlas Medicus Î©.<br>Por favor, utiliza nomenclatura apropiada.</div>
  <button class="zarandaja-btn" onclick="closeZarandaja()">ENTENDIDO. PROCEDERÃ‰ CON SERIEDAD.</button>
</div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  TOAST CONTAINER                                                â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toast-container"></div>

<!-- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
     â•‘  MAIN APP â€” El cuerpo del sistema operativo.                   â•‘
     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app" class="hidden">

  <!-- SIDEBAR â€” La columna vertebral de la navegaciÃ³n -->
  <nav id="sidebar">
    <div class="sidebar-logo" onclick="toggleSidebar()">
      <div class="logo-mark">Î©</div>
      <div class="logo-text">Atlas Medicus <span class="logo-omega">Î©</span></div>
    </div>

    <div class="sidebar-clinic">
      <div class="clinic-badge">
        <div class="clinic-dot"></div>
        <div class="clinic-name">ClÃ­nica Ronin Â· Madrid</div>
      </div>
    </div>

    <div class="sidebar-nav">
      <!-- MÃ³dulo Central -->
      <div class="nav-section">Core</div>
      <div class="nav-item active" onclick="showPanel('dashboard')">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-label">Dashboard</span>
      </div>
      <div class="nav-item" onclick="showPanel('agenda')">
        <span class="nav-icon">ğŸ“…</span>
        <span class="nav-label">Agenda</span>
        <span class="nav-badge">4</span>
      </div>
      <div class="nav-item" onclick="showPanel('pacientes')">
        <span class="nav-icon">ğŸ‘¥</span>
        <span class="nav-label">Pacientes</span>
      </div>
      <div class="nav-item" onclick="showPanel('hce')">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-label">Historia ClÃ­nica</span>
      </div>

      <!-- DiagnÃ³stico -->
      <div class="nav-section">DiagnÃ³stico Î©</div>
      <div class="nav-item" onclick="showPanel('diagnostico')">
        <span class="nav-icon">ğŸ”¬</span>
        <span class="nav-label">Motor DiagnÃ³stico</span>
      </div>
      <div class="nav-item" onclick="showPanel('scanner')">
        <span class="nav-icon">ğŸ“¡</span>
        <span class="nav-label">EscÃ¡ner Multimodal</span>
      </div>
      <div class="nav-item" onclick="showPanel('calibracion')">
        <span class="nav-icon">ğŸ¯</span>
        <span class="nav-label">CalibraciÃ³n HW</span>
        <span class="nav-badge gold">ÃšNICO</span>
      </div>
      <div class="nav-item" onclick="showPanel('epi')">
        <span class="nav-icon">ğŸŒ</span>
        <span class="nav-label">Epi-Scanner</span>
      </div>

      <!-- Operaciones -->
      <div class="nav-section">Operaciones</div>
      <div class="nav-item" onclick="showPanel('facturacion')">
        <span class="nav-icon">ğŸ’³</span>
        <span class="nav-label">FacturaciÃ³n</span>
      </div>
      <div class="nav-item" onclick="showPanel('inventario')">
        <span class="nav-icon">ğŸ“¦</span>
        <span class="nav-label">Inventario</span>
      </div>
      <div class="nav-item" onclick="showPanel('telemedicina')">
        <span class="nav-icon">ğŸ“¹</span>
        <span class="nav-label">Telemedicina</span>
      </div>
      <div class="nav-item" onclick="showPanel('fabricacion')">
        <span class="nav-icon">ğŸ”§</span>
        <span class="nav-label">FabricaciÃ³n eDHR</span>
      </div>

      <!-- Sistema -->
      <div class="nav-section">Sistema</div>
      <div class="nav-item" onclick="showPanel('analytics')">
        <span class="nav-icon">ğŸ“ˆ</span>
        <span class="nav-label">Analytics</span>
      </div>
      <div class="nav-item" onclick="showPanel('cumplimiento')">
        <span class="nav-icon">ğŸ›¡ï¸</span>
        <span class="nav-label">HIPAA Â· GDPR Â· OMS</span>
        <span class="nav-badge gold">+5</span>
      </div>
      <div class="nav-item" onclick="showPanel('pricing')">
        <span class="nav-icon">ğŸ’</span>
        <span class="nav-label">Planes</span>
      </div>
      <div class="nav-item" onclick="showPanel('api')">
        <span class="nav-icon">âš¡</span>
        <span class="nav-label">API PÃºblica</span>
      </div>

      <!-- v3.0 MÃ“DULOS Î© -->
      <div class="nav-section">Interop & Cert</div>
      <div class="nav-item" onclick="showPanel('fhir')">
        <span class="nav-icon">ğŸ”—</span>
        <span class="nav-label">FHIR Universal</span>
        <span class="nav-badge gold">F</span>
      </div>
      <div class="nav-item" onclick="showPanel('samd')">
        <span class="nav-icon">ğŸ“œ</span>
        <span class="nav-label">SaMD Â· FDA/MDR</span>
        <span class="nav-badge gold">G</span>
      </div>
      <div class="nav-item" onclick="showPanel('cybers')">
        <span class="nav-icon">ğŸ”</span>
        <span class="nav-label">Escudo Digital</span>
        <span class="nav-badge gold">H</span>
      </div>
      <div class="nav-section">IA & Supply</div>
      <div class="nav-item" onclick="showPanel('oracle')">
        <span class="nav-icon">ğŸ”®</span>
        <span class="nav-label">OrÃ¡culo ClÃ­nico</span>
        <span class="nav-badge gold">I</span>
      </div>
      <div class="nav-item" onclick="showPanel('supply')">
        <span class="nav-icon">ğŸ­</span>
        <span class="nav-label">Cadena Suministro</span>
        <span class="nav-badge gold">J</span>
      </div>
      <div class="nav-section">GenÃ³mica Î©</div>
      <div class="nav-item" onclick="showPanel('genomics');showGenomicsTab('k1')">
        <span class="nav-icon">ğŸ§¬</span>
        <span class="nav-label">Pipeline Engine</span>
        <span class="nav-badge gold">K1</span>
      </div>
      <div class="nav-item" onclick="showPanel('genomics');showGenomicsTab('k2')">
        <span class="nav-icon">ğŸ”¬</span>
        <span class="nav-label">Variant Interpreter</span>
        <span class="nav-badge gold">K2</span>
      </div>
      <div class="nav-item" onclick="showPanel('genomics');showGenomicsTab('k3')">
        <span class="nav-icon">ğŸ‘«</span>
        <span class="nav-label">Carrier Screening</span>
        <span class="nav-badge gold">K3</span>
      </div>
      <div class="nav-item" onclick="showPanel('genomics');showGenomicsTab('k4')">
        <span class="nav-icon">ğŸ”„</span>
        <span class="nav-label">ReanÃ¡lisis Proactivo</span>
        <span class="nav-badge gold">K4</span>
      </div>
      <div class="nav-item" onclick="showPanel('genomics');showGenomicsTab('k5')">
        <span class="nav-icon">ğŸ’Š</span>
        <span class="nav-label">Pharmaco & Onco</span>
        <span class="nav-badge gold">K5</span>
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="user-pill" onclick="showPanel('perfil')">
        <div class="user-avatar">DR</div>
        <div class="user-info">
          <div class="user-name">Dr. Ronin</div>
          <div class="user-role">Administrador Î©</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div id="main">
    <div id="topbar">
      <div class="topbar-title" id="topbar-title">Dashboard <span id="topbar-sub">Vista general del sistema</span></div>
      <div class="topbar-actions">
        <div class="status-pill">ğŸŸ¢ <span>Sistema Î© Â· Operativo</span></div>
        <button class="btn btn-primary btn-sm" onclick="openNewPatient()">+ Paciente</button>
        <button class="btn btn-green btn-sm" onclick="openNewAppt()">+ Cita</button>
      </div>
    </div>

    <div id="content">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: DASHBOARD
           El corazÃ³n visible del sistema. KPIs en tiempo real.
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-dashboard" class="panel active">
        <!-- Manifesto block -->
        <div class="manifesto-block mb-16">
          <div class="manifesto-text">
            <em>La salud no es un privilegio.</em> Es un derecho que se administra con soberanÃ­a.<br>
            <em>1310</em> clics y serÃ¡s libre.
          </div>
          <div class="manifesto-sig">â€” Agencia Ronin Â· Atlas Medicus Î© Â· Obra #20 Â· Director Î©</div>
        </div>

        <!-- KPIs -->
        <div class="grid grid-4 mb-16">
          <div class="kpi-card">
            <div class="kpi-label">Pacientes Activos</div>
            <div class="kpi-value green" id="kpi-patients">847</div>
            <div class="kpi-delta up">â–² 12 esta semana</div>
            <div class="kpi-icon">ğŸ‘¥</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:64%"></div></div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Citas Hoy</div>
            <div class="kpi-value" id="kpi-appts">23</div>
            <div class="kpi-delta">8 completadas Â· 4 pendientes</div>
            <div class="kpi-icon">ğŸ“…</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:35%"></div></div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">FacturaciÃ³n Mes</div>
            <div class="kpi-value gold" id="kpi-billing">18.4kâ‚¬</div>
            <div class="kpi-delta up">â–² 8.2% vs mes anterior</div>
            <div class="kpi-icon">ğŸ’³</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:78%"></div></div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">DiagnÃ³sticos IA</div>
            <div class="kpi-value" id="kpi-dx">1,247</div>
            <div class="kpi-delta up">PrecisiÃ³n: 97.3%</div>
            <div class="kpi-icon">ğŸ”¬</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:95%"></div></div>
          </div>
        </div>
        <!-- v3.0 KPIs row -->
        <div class="grid grid-4 mb-16">
          <div class="kpi-card" style="border-color:rgba(255,215,0,0.25)" onclick="showPanel('genomics');showGenomicsTab('k1')">
            <div class="kpi-label">Genomas Procesados</div>
            <div class="kpi-value gold" id="kpi-genomes">0</div>
            <div class="kpi-delta">Target: 1310 Â· <span style="color:var(--gold)">Î©</span></div>
            <div class="kpi-icon">ğŸ§¬</div>
            <div class="kpi-bar"><div id="kpi-genomes-bar" class="kpi-bar-fill" style="width:0%;background:linear-gradient(90deg,var(--gold),var(--green))"></div></div>
          </div>
          <div class="kpi-card" style="border-color:rgba(0,255,65,0.2)" onclick="showPanel('fhir')">
            <div class="kpi-label">Ãndice Interoperabilidad</div>
            <div class="kpi-value green">78%</div>
            <div class="kpi-delta up">FHIR R4 Â· HL7 Â· DICOM</div>
            <div class="kpi-icon">ğŸ”—</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:78%;background:linear-gradient(90deg,var(--green),var(--cyan))"></div></div>
          </div>
          <div class="kpi-card" style="border-color:rgba(255,59,92,0.2)" onclick="showPanel('cybers')">
            <div class="kpi-label">Riesgo Ciberseguridad</div>
            <div class="kpi-value red" id="kpi-risk">12%</div>
            <div class="kpi-delta" style="color:var(--green)">IEC 81001-5-1 âœ“</div>
            <div class="kpi-icon">ğŸ”</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:12%;background:var(--red)"></div></div>
          </div>
          <div class="kpi-card" style="border-color:rgba(255,215,0,0.15)" onclick="showPanel('samd')">
            <div class="kpi-label">Madurez Regulatoria</div>
            <div class="kpi-value gold">64%</div>
            <div class="kpi-delta">FDA 510(k) Â· EU MDR</div>
            <div class="kpi-icon">ğŸ“œ</div>
            <div class="kpi-bar"><div class="kpi-bar-fill" style="width:64%;background:linear-gradient(90deg,var(--gold),var(--red))"></div></div>
          </div>
        </div>

        <div class="grid grid-2 mb-16">
          <!-- FacturaciÃ³n chart -->
          <div class="card">
            <div class="card-title">ğŸ“Š FacturaciÃ³n mensual</div>
            <div class="card-subtitle">Ãšltimos 6 meses Â· EUR</div>
            <div class="bar-chart">
              <div class="bar-col">
                <div class="bar-val">14.2k</div>
                <div class="bar" style="height:70%;background:linear-gradient(180deg,var(--cyan),rgba(0,255,255,0.3))"></div>
                <div class="bar-label">Sep</div>
              </div>
              <div class="bar-col">
                <div class="bar-val">15.8k</div>
                <div class="bar" style="height:79%;background:linear-gradient(180deg,var(--cyan),rgba(0,255,255,0.3))"></div>
                <div class="bar-label">Oct</div>
              </div>
              <div class="bar-col">
                <div class="bar-val">16.1k</div>
                <div class="bar" style="height:80%;background:linear-gradient(180deg,var(--cyan),rgba(0,255,255,0.3))"></div>
                <div class="bar-label">Nov</div>
              </div>
              <div class="bar-col">
                <div class="bar-val">17.0k</div>
                <div class="bar" style="height:85%;background:linear-gradient(180deg,var(--green),rgba(0,255,65,0.3))"></div>
                <div class="bar-label">Dic</div>
              </div>
              <div class="bar-col">
                <div class="bar-val">17.2k</div>
                <div class="bar" style="height:86%;background:linear-gradient(180deg,var(--green),rgba(0,255,65,0.3))"></div>
                <div class="bar-label">Ene</div>
              </div>
              <div class="bar-col">
                <div class="bar-val">18.4k</div>
                <div class="bar" style="height:92%;background:linear-gradient(180deg,var(--gold),rgba(255,215,0,0.3))"></div>
                <div class="bar-label">Feb</div>
              </div>
            </div>
          </div>

          <!-- Actividad reciente -->
          <div class="card">
            <div class="card-title">âš¡ Actividad reciente</div>
            <div class="card-subtitle">Ãšltimas acciones del sistema</div>
            <div id="activity-feed">
              <div class="patient-row" style="margin-bottom:6px;padding:8px 10px">
                <div style="width:8px;height:8px;min-width:8px;background:var(--green);border-radius:50%;box-shadow:0 0 6px var(--green)"></div>
                <div>
                  <div style="font-size:0.8rem;color:var(--text)">DiagnÃ³stico completado</div>
                  <div style="font-size:0.7rem;color:var(--text3)">Paciente #1047 Â· Hace 3 min</div>
                </div>
                <span class="badge badge-green" style="margin-left:auto">IA Î©</span>
              </div>
              <div class="patient-row" style="margin-bottom:6px;padding:8px 10px">
                <div style="width:8px;height:8px;min-width:8px;background:var(--cyan);border-radius:50%;box-shadow:0 0 6px var(--cyan)"></div>
                <div>
                  <div style="font-size:0.8rem;color:var(--text)">Factura emitida VeriFactu</div>
                  <div style="font-size:0.7rem;color:var(--text3)">FAC-2025-0847 Â· Hace 12 min</div>
                </div>
                <span class="badge badge-cyan" style="margin-left:auto">VeriFactu</span>
              </div>
              <div class="patient-row" style="margin-bottom:6px;padding:8px 10px">
                <div style="width:8px;height:8px;min-width:8px;background:var(--gold);border-radius:50%;box-shadow:0 0 6px var(--gold)"></div>
                <div>
                  <div style="font-size:0.8rem;color:var(--text)">CalibraciÃ³n hardware OK</div>
                  <div style="font-size:0.7rem;color:var(--text3)">CÃ¡mara Basler A400 Â· Hace 1h</div>
                </div>
                <span class="badge badge-gold" style="margin-left:auto">ÃšNICO</span>
              </div>
              <div class="patient-row" style="padding:8px 10px">
                <div style="width:8px;height:8px;min-width:8px;background:var(--red);border-radius:50%;box-shadow:0 0 6px var(--red)"></div>
                <div>
                  <div style="font-size:0.8rem;color:var(--text)">Alerta: Stock bajo</div>
                  <div style="font-size:0.7rem;color:var(--text3)">Amoxicilina 500mg Â· 8 unidades</div>
                </div>
                <span class="badge badge-red" style="margin-left:auto">STOCK</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ROI Calculator -->
        <div class="card gold-accent mb-16">
          <div class="card-title">ğŸ’° Calculadora de ROI en Tiempo Real</div>
          <div class="card-subtitle">CuÃ¡nto ahorra/gana con Atlas Medicus Î©</div>
          <div class="grid grid-4">
            <div>
              <div style="font-size:0.7rem;color:var(--text3);margin-bottom:4px;font-family:var(--mono)">TIEMPO AHORRADO/DÃA</div>
              <div style="font-family:var(--display);font-size:1.8rem;font-weight:800;color:var(--gold)">2.4h</div>
              <div style="font-size:0.72rem;color:var(--text3)">vs gestiÃ³n manual</div>
            </div>
            <div>
              <div style="font-size:0.7rem;color:var(--text3);margin-bottom:4px;font-family:var(--mono)">INGRESOS ADICIONALES</div>
              <div style="font-family:var(--display);font-size:1.8rem;font-weight:800;color:var(--gold)">+3.2kâ‚¬</div>
              <div style="font-size:0.72rem;color:var(--text3)">por reducciÃ³n no-shows</div>
            </div>
            <div>
              <div style="font-size:0.7rem;color:var(--text3);margin-bottom:4px;font-family:var(--mono)">AHORRO PAPEL/AÃ‘O</div>
              <div style="font-family:var(--display);font-size:1.8rem;font-weight:800;color:var(--gold)">840â‚¬</div>
              <div style="font-size:0.72rem;color:var(--text3)">digitalizaciÃ³n total</div>
            </div>
            <div>
              <div style="font-size:0.7rem;color:var(--text3);margin-bottom:4px;font-family:var(--mono)">ROI NETO ESTIMADO</div>
              <div style="font-family:var(--display);font-size:1.8rem;font-weight:800;color:var(--gold)">Ã—18</div>
              <div style="font-size:0.72rem;color:var(--text3)">vs coste suscripciÃ³n</div>
            </div>
          </div>
          <div class="progress mt-12">
            <div class="progress-fill" style="width:89%"></div>
          </div>
          <div style="font-size:0.72rem;color:var(--text3);margin-top:4px">89% de la inversiÃ³n recuperada en los primeros 30 dÃ­as</div>
        </div>

        <!-- â•â• MÃ“DULO D: RESILIENCIA OFFLINE â•â• (Basado en anÃ¡lisis de sistemas de salud de Ãºltima milla) -->
        <div class="card red-accent mb-16" id="widget-resiliencia">
          <div class="flex justify-between items-center mb-12">
            <div>
              <div class="card-title">ğŸ›¡ï¸ RESILIENCIA OFFLINE â€” Ãndice de AutonomÃ­a ClÃ­nica</div>
              <div class="card-subtitle">Capacidad de sobrevivir al apocalipsis burocrÃ¡tico Â· WHO Last-Mile Framework</div>
            </div>
            <div id="resilience-score" style="font-family:var(--display);font-size:2.5rem;font-weight:800;color:var(--green);text-shadow:var(--glow-g)">72%</div>
          </div>
          <div id="resilience-bars" style="display:flex;flex-direction:column;gap:8px">
            <!-- Populated by JS -->
          </div>
          <div style="margin-top:12px;font-family:var(--mono);font-size:0.65rem;color:var(--text3)">
            ESTADO: <span id="resilience-status" style="color:var(--green)">OPERATIVO Â· ClÃ­nica puede funcionar 72h sin conectividad</span>
          </div>
        </div>

        <!-- API Status -->
        <div class="card">
          <div class="card-title">âš¡ Estado del Sistema Â· Arquitectura REST extensible</div>
          <div class="card-subtitle">Backend simulado (IndexedDB) â†’ ProducciÃ³n: Node.js + PostgreSQL</div>
          <div class="grid grid-4">
            <div class="flex items-center gap-8">
              <div style="width:8px;height:8px;background:var(--green);border-radius:50%;box-shadow:0 0 6px var(--green);animation:blink 1s ease infinite"></div>
              <div>
                <div style="font-size:0.78rem;color:var(--text)">GET /api/patients</div>
                <div style="font-size:0.65rem;color:var(--text3)">12ms avg</div>
              </div>
            </div>
            <div class="flex items-center gap-8">
              <div style="width:8px;height:8px;background:var(--green);border-radius:50%;box-shadow:0 0 6px var(--green);animation:blink 1.2s ease infinite"></div>
              <div>
                <div style="font-size:0.78rem;color:var(--text)">POST /api/diagnose</div>
                <div style="font-size:0.65rem;color:var(--text3)">240ms avg</div>
              </div>
            </div>
            <div class="flex items-center gap-8">
              <div style="width:8px;height:8px;background:var(--green);border-radius:50%;box-shadow:0 0 6px var(--green);animation:blink 1.4s ease infinite"></div>
              <div>
                <div style="font-size:0.78rem;color:var(--text)">POST /api/invoice</div>
                <div style="font-size:0.65rem;color:var(--text3)">38ms avg</div>
              </div>
            </div>
            <div class="flex items-center gap-8">
              <div style="width:8px;height:8px;background:var(--cyan);border-radius:50%;box-shadow:0 0 6px var(--cyan);animation:blink 1.6s ease infinite"></div>
              <div>
                <div style="font-size:0.78rem;color:var(--text)">WebSocket /rt</div>
                <div style="font-size:0.65rem;color:var(--text3)">847 conexiones</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: AGENDA
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-agenda" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Agenda MÃ©dica Inteligente</div>
            <div style="font-size:0.8rem;color:var(--text3)">Multi-clÃ­nica Â· Multi-especialidad Â· SincronizaciÃ³n en tiempo real</div>
          </div>
          <div class="flex gap-8">
            <button class="btn btn-ghost btn-sm">â—€ Feb 2025</button>
            <button class="btn btn-primary btn-sm" onclick="openNewAppt()">+ Nueva Cita</button>
          </div>
        </div>

        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">Citas hoy</div><div class="kpi-value">23</div><div class="kpi-delta">4 disponibles</div></div>
          <div class="kpi-card"><div class="kpi-label">OcupaciÃ³n</div><div class="kpi-value green">84%</div><div class="kpi-delta up">â–² Ã³ptimo</div></div>
          <div class="kpi-card"><div class="kpi-label">No-shows</div><div class="kpi-value red">2</div><div class="kpi-delta">Recordatorio SMS enviado</div></div>
          <div class="kpi-card"><div class="kpi-label">Teleconsultas</div><div class="kpi-value">7</div><div class="kpi-delta">WebRTC activo</div></div>
        </div>

        <div class="card">
          <div class="card-title mb-16">Semana del 17â€“23 Feb 2025</div>
          <div class="agenda-grid">
            <!-- Headers -->
            <div class="agenda-header"></div>
            <div class="agenda-header">LUN 17</div>
            <div class="agenda-header">MAR 18</div>
            <div class="agenda-header">MIÃ‰ 19</div>
            <div class="agenda-header">JUE 20</div>
            <div class="agenda-header">VIE 21</div>
            <div class="agenda-header">SÃB 22</div>
            <!-- Slots -->
            <div class="agenda-time">08:00</div>
            <div class="agenda-cell"><div class="appt green">GarcÃ­a, M.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt">RodrÃ­guez, J.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt gold">VIP: MartÃ­n</div></div>
            <div class="agenda-cell"></div>

            <div class="agenda-time">09:00</div>
            <div class="agenda-cell"><div class="appt">LÃ³pez, A.</div></div>
            <div class="agenda-cell"><div class="appt green">PÃ©rez, C.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt">SÃ¡nchez, R.</div></div>
            <div class="agenda-cell"><div class="appt">FernÃ¡ndez, E.</div></div>
            <div class="agenda-cell"></div>

            <div class="agenda-time">10:00</div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt">Torres, B.</div></div>
            <div class="agenda-cell"><div class="appt green">Moreno, L.</div></div>
            <div class="agenda-cell"><div class="appt">DÃ­az, P.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt gold">VIP: Ruiz</div></div>

            <div class="agenda-time">11:00</div>
            <div class="agenda-cell"><div class="appt red">URGENCIA</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt">Herrera, S.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt">Castro, N.</div></div>
            <div class="agenda-cell"></div>

            <div class="agenda-time">12:00</div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt">Vargas, M.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt green">Romero, T.</div></div>
            <div class="agenda-cell"><div class="appt">JimÃ©nez, F.</div></div>
            <div class="agenda-cell"></div>

            <div class="agenda-time">16:00</div>
            <div class="agenda-cell"><div class="appt">Alonso, V.</div></div>
            <div class="agenda-cell"><div class="appt red">URGENCIA</div></div>
            <div class="agenda-cell"><div class="appt">Morales, C.</div></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"></div>

            <div class="agenda-time">17:00</div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"></div>
            <div class="agenda-cell"><div class="appt gold">VIP: NÃºÃ±ez</div></div>
            <div class="agenda-cell"><div class="appt">GutiÃ©rrez, H.</div></div>
            <div class="agenda-cell"><div class="appt green">Ramos, I.</div></div>
            <div class="agenda-cell"></div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: PACIENTES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-pacientes" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">GestiÃ³n de Pacientes</div>
            <div style="font-size:0.8rem;color:var(--text3)">1310 pacientes max (Freemium) Â· Portal del paciente PWA integrado</div>
          </div>
          <button class="btn btn-primary" onclick="openNewPatient()">+ Nuevo Paciente</button>
        </div>

        <div class="card mb-16">
          <div class="flex gap-8 mb-16">
            <input type="text" placeholder="ğŸ” Buscar por nombre, NHC, DNI..." style="flex:1" oninput="filterPatients(this.value)">
            <select style="width:180px">
              <option>Todas las especialidades</option>
              <option>Medicina General</option>
              <option>PediatrÃ­a</option>
              <option>TraumatologÃ­a</option>
              <option>CardiologÃ­a</option>
            </select>
            <select style="width:140px">
              <option>Todos los estados</option>
              <option>Activo</option>
              <option>Inactivo</option>
              <option>Alta</option>
            </select>
          </div>

          <div id="patient-list">
            <!-- Populated by JS -->
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: HISTORIA CLÃNICA ELECTRÃ“NICA
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-hce" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Historia ClÃ­nica ElectrÃ³nica</div>
            <div style="font-size:0.8rem;color:var(--text3)">Plantillas por especialidad Â· HIPAA & GDPR compliant Â· Firma digital</div>
          </div>
          <div class="flex gap-8">
            <span class="badge badge-green">Paciente: GarcÃ­a LÃ³pez, MarÃ­a</span>
            <span class="badge badge-cyan">NHC: 0000847</span>
          </div>
        </div>

        <div class="grid grid-2">
          <div>
            <!-- Datos paciente -->
            <div class="card mb-12">
              <div class="card-title">ğŸ‘¤ Datos del Paciente</div>
              <div class="grid grid-2 mt-12" style="gap:10px">
                <div class="form-group" style="margin:0"><label>Nombre</label><input value="MarÃ­a GarcÃ­a LÃ³pez" readonly></div>
                <div class="form-group" style="margin:0"><label>Fecha Nacimiento</label><input value="14/03/1985" readonly></div>
                <div class="form-group" style="margin:0"><label>Sexo</label><input value="Femenino" readonly></div>
                <div class="form-group" style="margin:0"><label>DNI / NHC</label><input value="34.891.023-K / 0000847" readonly></div>
                <div class="form-group" style="margin:0"><label>TelÃ©fono</label><input value="+34 612 345 678" readonly></div>
                <div class="form-group" style="margin:0"><label>Alergias</label><input value="Penicilina" style="border-color:rgba(255,59,92,0.4);color:var(--red)" readonly></div>
              </div>
            </div>

            <!-- Secciones HCE plegables -->
            <div class="hce-section">
              <div class="hce-section-header" onclick="toggleHCE(this)">
                ğŸ©º Motivo de Consulta & Anamnesis <span>â–¼</span>
              </div>
              <div class="hce-section-body open">
                <div class="form-group" style="margin-bottom:8px"><label>Motivo principal</label><textarea>Dolor torÃ¡cico opresivo de 3 horas de evoluciÃ³n. Se irradia a brazo izquierdo. Diaforesis asociada.</textarea></div>
                <div class="form-group"><label>Antecedentes</label><textarea style="min-height:60px">HTA controlada. DM tipo 2 (metformina 850mg/12h). No fumadora. Exfumadora 8 aÃ±os.</textarea></div>
              </div>
            </div>

            <div class="hce-section">
              <div class="hce-section-header" onclick="toggleHCE(this)">
                ğŸ” ExploraciÃ³n FÃ­sica <span>â–¼</span>
              </div>
              <div class="hce-section-body">
                <div class="grid grid-2" style="gap:8px">
                  <div class="form-group" style="margin:0"><label>TA</label><input value="148/92 mmHg" style="border-color:rgba(255,59,92,0.3)"></div>
                  <div class="form-group" style="margin:0"><label>FC</label><input value="98 lpm"></div>
                  <div class="form-group" style="margin:0"><label>SatO2</label><input value="96%"></div>
                  <div class="form-group" style="margin:0"><label>Temperatura</label><input value="36.8Â°C"></div>
                  <div class="form-group" style="margin:0"><label>Peso</label><input value="72 kg"></div>
                  <div class="form-group" style="margin:0"><label>Talla / IMC</label><input value="163cm / 27.1"></div>
                </div>
              </div>
            </div>

            <div class="hce-section">
              <div class="hce-section-header" onclick="toggleHCE(this)">
                ğŸ’Š Tratamiento & Receta ElectrÃ³nica <span>â–¼</span>
              </div>
              <div class="hce-section-body">
                <div class="flex gap-8 mb-8">
                  <input placeholder="Buscar medicamento..." style="flex:1">
                  <button class="btn btn-green btn-sm">+ AÃ±adir</button>
                </div>
                <table style="width:100%;font-size:0.8rem">
                  <tr><th>Medicamento</th><th>Dosis</th><th>Pauta</th><th>DuraciÃ³n</th></tr>
                  <tr><td>Metformina 850mg</td><td>1 comp</td><td>Cada 12h</td><td>CrÃ³nico</td></tr>
                  <tr><td>Enalapril 10mg</td><td>1 comp</td><td>Cada 24h (maÃ±ana)</td><td>CrÃ³nico</td></tr>
                  <tr><td style="color:var(--gold)">AAS 100mg âš¡</td><td>1 comp</td><td>Dosis Ãºnica AHORA</td><td>1 vez</td></tr>
                </table>
                <button class="btn btn-primary btn-sm mt-8">ğŸ“„ Generar Receta ElectrÃ³nica</button>
              </div>
            </div>
          </div>

          <div>
            <!-- IA DiagnÃ³stico rÃ¡pido -->
            <div class="card green-accent mb-12">
              <div class="card-title">ğŸ”¬ Sugerencia IA Î©</div>
              <div class="card-subtitle">Basado en sÃ­ntomas, signos y antecedentes actuales</div>
              <div class="dx-result" style="border-color:var(--gold)">
                <div class="dx-rank r1">1</div>
                <div>
                  <div class="dx-name">SÃ­ndrome Coronario Agudo</div>
                  <div class="dx-category">CardiologÃ­a Â· Urgente</div>
                </div>
                <div class="dx-prob text-red">94.2%</div>
              </div>
              <div class="dx-result">
                <div class="dx-rank r2">2</div>
                <div>
                  <div class="dx-name">Angina Inestable</div>
                  <div class="dx-category">CardiologÃ­a</div>
                </div>
                <div class="dx-prob">78.1%</div>
              </div>
              <div class="dx-result">
                <div class="dx-rank r3">3</div>
                <div>
                  <div class="dx-name">Pericarditis Aguda</div>
                  <div class="dx-category">CardiologÃ­a</div>
                </div>
                <div class="dx-prob">31.4%</div>
              </div>
              <button class="btn btn-green btn-sm mt-12 w-full" onclick="showPanel('diagnostico')">Ver anÃ¡lisis completo â†’</button>
            </div>

            <!-- Historial -->
            <div class="card">
              <div class="card-title">ğŸ“‚ Historial de Consultas</div>
              <div class="card-subtitle">Ãšltimas 5 visitas</div>
              <div style="margin-top:10px">
                <div class="patient-row" style="flex-direction:column;align-items:flex-start;gap:4px">
                  <div class="flex w-full justify-between">
                    <span style="font-size:0.82rem;font-weight:600">Control DM Â· HTA</span>
                    <span class="badge badge-green">15/01/25</span>
                  </div>
                  <span style="font-size:0.73rem;color:var(--text3)">Dr. Ronin Â· Medicina General Â· Hemoglobina glicosilada 7.2%</span>
                </div>
                <div class="patient-row" style="flex-direction:column;align-items:flex-start;gap:4px">
                  <div class="flex w-full justify-between">
                    <span style="font-size:0.82rem;font-weight:600">RevisiÃ³n analÃ­tica</span>
                    <span class="badge badge-cyan">20/12/24</span>
                  </div>
                  <span style="font-size:0.73rem;color:var(--text3)">Dr. Ronin Â· HbA1c 7.4% Â· Colesterol LDL 142</span>
                </div>
                <div class="patient-row" style="flex-direction:column;align-items:flex-start;gap:4px">
                  <div class="flex w-full justify-between">
                    <span style="font-size:0.82rem;font-weight:600">Urgencia: Dolor abdominal</span>
                    <span class="badge badge-red">03/11/24</span>
                  </div>
                  <span style="font-size:0.73rem;color:var(--text3)">CÃ³lico renal. Litiasis 4mm. Alta con analgesia.</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: MOTOR DIAGNÃ“STICO
           La joya de la corona. 10.000+ condiciones. >96% precisiÃ³n.
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-diagnostico" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Motor DiagnÃ³stico Î© â€” IA Multimodal</div>
            <div style="font-size:0.8rem;color:var(--text3)">10.000+ condiciones Â· Todas las edades Â· Todas las especialidades Â· PrecisiÃ³n: >97%</div>
          </div>
          <div class="flex gap-8">
            <span class="badge badge-gold">22 aÃ±os de entrenamiento</span>
            <span class="badge badge-green">96.7% Top-10</span>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="card-title">ğŸ©º Entrada de SÃ­ntomas y Signos</div>
            <div class="card-subtitle">Escribe un sÃ­ntoma y pulsa Enter para aÃ±adir</div>

            <div class="flex gap-8 mb-12">
              <input id="symptom-input" placeholder="SÃ­ntoma, signo, resultado lab..." onkeydown="if(event.key==='Enter')addSymptom()" style="flex:1">
              <button class="btn btn-primary btn-sm" onclick="addSymptom()">+ AÃ±adir</button>
            </div>

            <div id="symptom-tags" style="margin-bottom:16px">
              <!-- Populated by JS -->
            </div>

            <!-- SÃ­ntomas sugeridos -->
            <div style="margin-bottom:12px">
              <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.1em">Sugeridos:</div>
              <div id="suggested-symptoms"></div>
            </div>

            <!-- Datos del paciente para el motor -->
            <div class="grid grid-2" style="gap:8px;margin-bottom:12px">
              <div><label>Edad</label><input id="dx-age" value="40" type="number"></div>
              <div><label>Sexo</label>
                <select id="dx-sex"><option>Femenino</option><option>Masculino</option><option>Otro</option></select>
              </div>
            </div>

            <button class="btn btn-primary w-full" onclick="runDiagnosis()" style="justify-content:center">
              ğŸ”¬ Ejecutar DiagnÃ³stico Diferencial Î©
            </button>

            <div class="grid grid-2 mt-12" style="gap:8px">
              <div style="text-align:center;padding:10px;background:var(--bg3);border-radius:var(--radius)">
                <div style="font-family:var(--display);font-size:1.4rem;font-weight:800;color:var(--cyan)" id="dx-conditions-count">10,247</div>
                <div style="font-size:0.7rem;color:var(--text3)">condiciones indexadas</div>
              </div>
              <div style="text-align:center;padding:10px;background:var(--bg3);border-radius:var(--radius)">
                <div style="font-family:var(--display);font-size:1.4rem;font-weight:800;color:var(--green)">97.3%</div>
                <div style="font-size:0.7rem;color:var(--text3)">precisiÃ³n top-10</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ“Š Resultados del DiagnÃ³stico Diferencial</div>
            <div class="card-subtitle" id="dx-result-meta">Esperando sÃ­ntomas...</div>
            <div id="dx-results">
              <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;color:var(--text3)">
                <div style="font-size:3rem;opacity:0.2;margin-bottom:12px">ğŸ”¬</div>
                <div style="font-family:var(--mono);font-size:0.8rem">Introduce sÃ­ntomas para iniciar el anÃ¡lisis</div>
              </div>
            </div>
          </div>
        </div>

        <!-- MÃ³dulos de escÃ¡ner rÃ¡pido -->
        <div class="grid grid-4 mt-16">
          <div class="card pointer" onclick="showPanel('scanner');showToast('ğŸ”¬ Hematologic-Scanner activado','green')">
            <div style="font-size:2rem;margin-bottom:8px">ğŸ©¸</div>
            <div class="card-title">Hematologic-Scanner</div>
            <div class="card-subtitle">AnÃ¡lisis de imagen de sangre perifÃ©rica. Leucocitos, parÃ¡sitos, morfologÃ­a.</div>
            <span class="badge badge-cyan">Imagen + IA</span>
          </div>
          <div class="card pointer" onclick="showPanel('scanner');showToast('âš—ï¸ Chemo-PAD activado','green')">
            <div style="font-size:2rem;margin-bottom:8px">âš—ï¸</div>
            <div class="card-title">Chemo-PAD</div>
            <div class="card-subtitle">Lectura de tiras reactivas para medicamentos. ColorimetrÃ­a calibrada.</div>
            <span class="badge badge-green">Tiras reactivas</span>
          </div>
          <div class="card pointer" onclick="showPanel('scanner');showToast('ğŸ¦  Infectio-Scanner activado','green')">
            <div style="font-size:2rem;margin-bottom:8px">ğŸ¦ </div>
            <div class="card-title">Infectio-Scanner</div>
            <div class="card-subtitle">Dengue, Malaria, COVID, Influenza, Strep. DetecciÃ³n en 90 segundos.</div>
            <span class="badge badge-red">Urgente</span>
          </div>
          <div class="card pointer" onclick="showPanel('scanner');showToast('ğŸ¥— Nutri-Scanner activado','green')">
            <div style="font-size:2rem;margin-bottom:8px">ğŸ¥—</div>
            <div class="card-title">Nutri-Scanner</div>
            <div class="card-subtitle">AnÃ¡lisis nutricional de alimentos por imagen. CalorÃ­as, macros, alÃ©rgenos.</div>
            <span class="badge badge-gold">Premium</span>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: ESCÃNER MULTIMODAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-scanner" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">EscÃ¡ner Multimodal Î©</div>
            <div style="font-size:0.8rem;color:var(--text3)">Hematologic Â· Chemo-PAD Â· Infectio Â· Nutri Â· Hardware-agnÃ³stico</div>
          </div>
          <span class="badge badge-gold">Diferenciador Ãšnico</span>
        </div>

        <div class="tabs">
          <div class="tab active" onclick="switchTab(this,'scan-hema')">ğŸ©¸ Hematologic</div>
          <div class="tab" onclick="switchTab(this,'scan-infectio')">ğŸ¦  Infectio</div>
          <div class="tab" onclick="switchTab(this,'scan-chemo')">âš—ï¸ Chemo-PAD</div>
          <div class="tab" onclick="switchTab(this,'scan-nutri')">ğŸ¥— Nutri</div>
        </div>

        <div id="scan-hema" class="scan-tab">
          <div class="grid grid-2">
            <div class="card">
              <div class="card-title">ğŸ“· Captura de Imagen</div>
              <div class="card-subtitle">CÃ¡mara Â· Microscopio Â· Smartphone (Hardware-AgnÃ³stico)</div>
              <div class="calib-canvas">
                <div class="calib-crosshair"></div>
                <div class="calib-reticle"></div>
                <div class="calib-corner tl"></div>
                <div class="calib-corner tr"></div>
                <div class="calib-corner bl"></div>
                <div class="calib-corner br"></div>
                <div style="position:absolute;bottom:8px;left:50%;transform:translateX(-50%);font-family:var(--mono);font-size:0.65rem;color:var(--gold);opacity:0.8">MUESTRA CALIBRADA</div>
              </div>
              <div class="flex gap-8 mt-12">
                <button class="btn btn-primary btn-sm flex-1" onclick="simulateScan('hema')">ğŸ“· Capturar</button>
                <button class="btn btn-ghost btn-sm" onclick="showPanel('calibracion')">âš™ï¸ Calibrar</button>
              </div>
            </div>

            <div class="card" id="scan-results-hema">
              <div class="card-title">ğŸ”¬ AnÃ¡lisis HematolÃ³gico</div>
              <div class="card-subtitle">MorfologÃ­a de sangre perifÃ©rica Â· IA Î©</div>
              <div style="display:flex;align-items:center;justify-content:center;height:200px;color:var(--text3)">
                <div style="text-align:center">
                  <div style="font-size:3rem;opacity:0.2">ğŸ©¸</div>
                  <div style="font-family:var(--mono);font-size:0.75rem;margin-top:8px">Captura una imagen para analizar</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="scan-infectio" class="scan-tab hidden">
          <div class="grid grid-2">
            <div class="card">
              <div class="card-title">ğŸ¦  DetecciÃ³n de PatÃ³genos</div>
              <div class="card-subtitle">Panel de 40 agentes infecciosos Â· Resultado en 90 segundos</div>
              <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:12px">
                <div class="flex items-center gap-8 pointer" onclick="simulateInfectio('Dengue')">
                  <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  <span style="font-size:0.82rem">Dengue NS1</span>
                </div>
                <div class="flex items-center gap-8 pointer" onclick="simulateInfectio('Malaria')">
                  <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  <span style="font-size:0.82rem">Malaria P.f.</span>
                </div>
                <div class="flex items-center gap-8 pointer" onclick="simulateInfectio('COVID')">
                  <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  <span style="font-size:0.82rem">SARS-CoV-2</span>
                </div>
                <div class="flex items-center gap-8 pointer" onclick="simulateInfectio('Influenza')">
                  <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                  <span style="font-size:0.82rem">Influenza A/B</span>
                </div>
                <div class="flex items-center gap-8 pointer">
                  <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  <span style="font-size:0.82rem">Strep A</span>
                </div>
                <div class="flex items-center gap-8 pointer">
                  <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                  <span style="font-size:0.82rem">RSV</span>
                </div>
              </div>
              <button class="btn btn-red btn-sm mt-12 w-full" onclick="simulateInfectio('PANEL')">ğŸ¦  Ejecutar Panel Infectio</button>
            </div>
            <div class="card" id="infectio-results">
              <div class="card-title">ğŸ“Š Resultado del Panel</div>
              <div style="display:flex;align-items:center;justify-content:center;height:160px;color:var(--text3)">
                <div style="text-align:center;font-family:var(--mono);font-size:0.75rem">Ejecute el panel para ver resultados</div>
              </div>
            </div>
          </div>
        </div>

        <div id="scan-chemo" class="scan-tab hidden">
          <div class="card">
            <div class="card-title">âš—ï¸ Lectura de Tiras Reactivas</div>
            <div class="card-subtitle">ColorimetrÃ­a calibrada por hardware Â· Paracetamol, AAS, AntibiÃ³ticos, Glucosa...</div>
            <div class="grid grid-2 mt-12">
              <div>
                <div class="calib-canvas">
                  <div class="calib-crosshair"></div>
                  <div style="position:absolute;width:80%;height:30px;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(90deg,#e8d5a3,#c8a87f,#9a6b4b,#7a4f2e);border-radius:4px;border:1px solid rgba(255,255,255,0.2)"></div>
                  <div class="calib-corner tl"></div>
                  <div class="calib-corner tr"></div>
                  <div class="calib-corner bl"></div>
                  <div class="calib-corner br"></div>
                </div>
                <button class="btn btn-primary btn-sm mt-8 w-full" onclick="simulateScan('chemo')">ğŸ¨ Analizar ColorimetrÃ­a</button>
              </div>
              <div id="chemo-results">
                <div style="font-family:var(--mono);font-size:0.7rem;color:var(--text3)">Resultados aparecerÃ¡n aquÃ­...</div>
              </div>
            </div>
          </div>
        </div>

        <div id="scan-nutri" class="scan-tab hidden">
          <div class="card">
            <div class="card-title">ğŸ¥— AnÃ¡lisis Nutricional</div>
            <div class="card-subtitle">FotografÃ­a de alimentos â†’ CalorÃ­as, macros, micronutrientes, alÃ©rgenos</div>
            <button class="btn btn-gold btn-sm mt-12" onclick="simulateScan('nutri')">ğŸ½ï¸ Analizar Alimento</button>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: CALIBRACIÃ“N HARDWARE
           El verdadero diferenciador. Nadie mÃ¡s lo tiene.
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-calibracion" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">CalibraciÃ³n Hardware-AgnÃ³stica Î©</div>
            <div style="font-size:0.8rem;color:var(--text3)">El Ãºnico sistema mÃ©dico que se calibra para cualquier cÃ¡mara, microscopio o smartphone del mundo</div>
          </div>
          <span class="badge badge-gold" style="font-size:0.75rem;padding:6px 12px">â­ VENTAJA COMPETITIVA ÃšNICA</span>
        </div>

        <div class="manifesto-block mb-16">
          <div class="manifesto-text">
            <em>DriCloud</em> no lo tiene. <em>Isabel Healthcare</em> no lo tiene. <em>Tulip</em> no lo tiene.<br>
            Atlas Medicus Î© es el Ãºnico sistema capaz de adaptarse a <em>cualquier hardware</em> del planeta, desde un Basler A400 hasta un iPhone SE. La soberanÃ­a diagnÃ³stica es ahora universal.
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="card-title">ğŸ¯ CalibraciÃ³n de CÃ¡mara</div>
            <div class="card-subtitle">Paso 1 de 3: Detectar patrÃ³n de referencia</div>

            <div class="calib-canvas mt-12" id="calib-canvas-main">
              <div class="calib-crosshair"></div>
              <div class="calib-reticle" id="calib-reticle"></div>
              <div class="calib-corner tl"></div>
              <div class="calib-corner tr"></div>
              <div class="calib-corner bl"></div>
              <div class="calib-corner br"></div>
              <!-- Chessboard pattern simulation -->
              <div style="position:absolute;width:80px;height:80px;left:50%;top:50%;transform:translate(-50%,-50%);
                background:repeating-conic-gradient(#fff 0% 25%, #333 0% 50%) 0 0 / 20px 20px;
                opacity:0.5;border:1px solid rgba(0,255,255,0.3)"></div>
              <div style="position:absolute;bottom:8px;right:8px;font-family:var(--mono);font-size:0.6rem;color:var(--text3)">
                TAB07 Â· PatrÃ³n de calibraciÃ³n
              </div>
            </div>

            <div class="mt-12">
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--text3);margin-bottom:6px">HARDWARE DETECTADO:</div>
              <select id="hw-device" style="margin-bottom:8px">
                <option>ğŸ“· CÃ¡mara USB genÃ©rica (auto-detectada)</option>
                <option>ğŸ”¬ Microscopio Ã³ptico Leica DM500</option>
                <option>ğŸ”¬ Basler ace A400-60gm</option>
                <option>ğŸ“± Smartphone (cualquier modelo)</option>
                <option>ğŸ¥ Olympus BX53 (fluorescencia)</option>
                <option>âš™ï¸ Hardware personalizado...</option>
              </select>
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--text3);margin-bottom:6px">PARÃMETROS:</div>
              <div class="grid grid-2" style="gap:8px">
                <div><label>ResoluciÃ³n</label><input value="2048Ã—1536 px"></div>
                <div><label>Factor de escala</label><input value="0.847 Âµm/px" id="calib-scale"></div>
                <div><label>Temperatura color</label><input value="5500K"></div>
                <div><label>Perfil ICC</label><input value="sRGB Â· Auto"></div>
              </div>
            </div>

            <div class="flex gap-8 mt-12">
              <button class="btn btn-primary flex-1" onclick="runCalibration()">ğŸ¯ Calibrar Ahora</button>
              <button class="btn btn-ghost" onclick="loadCalibProfile()">ğŸ“¥ Cargar Perfil</button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ“Š Estado de CalibraciÃ³n</div>
            <div class="card-subtitle">MÃ©tricas de calidad Ã³ptica y espectral</div>

            <div id="calib-status">
              <div class="mt-12">
                <div class="flex justify-between mb-4"><span style="font-size:0.78rem">PrecisiÃ³n geomÃ©trica</span><span style="font-family:var(--mono);color:var(--green)">98.4%</span></div>
                <div class="progress"><div class="progress-fill" style="width:98.4%"></div></div>
              </div>
              <div class="mt-8">
                <div class="flex justify-between mb-4"><span style="font-size:0.78rem">CorrecciÃ³n cromÃ¡tica</span><span style="font-family:var(--mono);color:var(--green)">96.1%</span></div>
                <div class="progress"><div class="progress-fill" style="width:96.1%"></div></div>
              </div>
              <div class="mt-8">
                <div class="flex justify-between mb-4"><span style="font-size:0.78rem">Uniformidad de campo</span><span style="font-family:var(--mono);color:var(--gold)">89.7%</span></div>
                <div class="progress"><div class="progress-fill" style="width:89.7%;background:linear-gradient(90deg,var(--gold),var(--cyan))"></div></div>
              </div>
              <div class="mt-8">
                <div class="flex justify-between mb-4"><span style="font-size:0.78rem">Reproducibilidad</span><span style="font-family:var(--mono);color:var(--green)">99.2%</span></div>
                <div class="progress"><div class="progress-fill" style="width:99.2%"></div></div>
              </div>

              <div style="margin-top:16px;padding:12px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius)">
                <div style="font-family:var(--mono);font-size:0.7rem;color:var(--green);margin-bottom:4px">âœ“ SISTEMA CALIBRADO Â· APTO PARA DIAGNÃ“STICO</div>
                <div style="font-size:0.73rem;color:var(--text3)">Perfil activo: CÃ¡mara USB Â· 2048Ã—1536 Â· Factor 0.847Âµm/px<br>Ãšltima calibraciÃ³n: Hace 2h Â· PrÃ³xima en: 46h</div>
              </div>

              <div class="grid grid-2 mt-12" style="gap:8px">
                <button class="btn btn-green btn-sm" onclick="exportCalibProfile()">ğŸ’¾ Exportar Perfil</button>
                <button class="btn btn-ghost btn-sm" onclick="shareCalibProfile()">ğŸ”— Compartir</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Devices bank -->
        <div class="card mt-16">
          <div class="card-title">ğŸª Biblioteca de Perfiles de Hardware</div>
          <div class="card-subtitle">1310+ dispositivos pre-calibrados. AÃ±ade cualquier cÃ¡mara en 3 minutos.</div>
          <div class="grid grid-4 mt-12">
            <div class="kpi-card"><div class="kpi-label">Perfiles activos</div><div class="kpi-value">1</div></div>
            <div class="kpi-card"><div class="kpi-label">Dispositivos en biblioteca</div><div class="kpi-value green">1,310</div></div>
            <div class="kpi-card"><div class="kpi-label">CÃ¡maras compatibles</div><div class="kpi-value">âˆ</div><div style="font-size:0.7rem;color:var(--text3)">Si tiene pixels, funciona</div></div>
            <div class="kpi-card"><div class="kpi-label">EstÃ¡ndar de calibraciÃ³n</div><div class="kpi-value gold" style="font-size:1.2rem">ISO 15189</div></div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: EPI-SCANNER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-epi" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Epi-Scanner â€” Vigilancia EpidemiolÃ³gica</div>
            <div style="font-size:0.8rem;color:var(--text3)">Privacidad diferencial Â· AgregaciÃ³n anÃ³nima Â· Alertas en tiempo real</div>
          </div>
          <span class="badge badge-red" style="animation:blink 1s ease infinite">âš ï¸ 3 ALERTAS ACTIVAS</span>
        </div>

        <div class="grid grid-2 mb-16">
          <div class="card red-accent">
            <div class="card-title">ğŸ—ºï¸ Mapa EpidemiolÃ³gico â€” Madrid</div>
            <div class="card-subtitle">Datos anonimizados Â· Privacidad diferencial Îµ=0.1</div>
            <div class="epi-map mt-12">
              <!-- Puntos de brote simulados -->
              <div class="epi-dot" style="top:30%;left:25%;width:14px;height:14px" title="Brote Influenza Â· 24 casos"></div>
              <div class="epi-dot" style="top:55%;left:60%;background:var(--gold);box-shadow:0 0 10px var(--gold)" title="Alerta COVID Â· 8 casos"></div>
              <div class="epi-dot" style="top:70%;left:35%;width:8px;height:8px;background:var(--cyan);box-shadow:0 0 8px var(--cyan)" title="Gastroenteritis Â· 5 casos"></div>
              <div class="epi-dot" style="top:20%;left:70%;width:18px;height:18px" title="HOTSPOT Dengue Â· 38 casos"></div>
              <div style="position:absolute;bottom:8px;left:8px;font-family:var(--mono);font-size:0.6rem;color:var(--text3)">
                ğŸ”´ Dengue Â· ğŸŸ¡ COVID Â· ğŸ©¸ Influenza Â· ğŸ”µ GEA
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ“Š Alertas Activas</div>
            <div class="card-subtitle">Sistema de notificaciÃ³n a autoridades sanitarias</div>
            <div class="mt-12">
              <div class="dx-result" style="border-color:var(--red)">
                <div style="width:10px;height:10px;background:var(--red);border-radius:50%;box-shadow:0 0 8px var(--red);min-width:10px"></div>
                <div>
                  <div class="dx-name" style="font-size:0.85rem">Brote Dengue Â· Zona Norte</div>
                  <div class="dx-category">38 casos Â· Umbral: 10 Â· Notificado a ISCIII</div>
                </div>
                <span class="badge badge-red" style="margin-left:auto">URGENTE</span>
              </div>
              <div class="dx-result" style="border-color:var(--gold)">
                <div style="width:10px;height:10px;background:var(--gold);border-radius:50%;min-width:10px"></div>
                <div>
                  <div class="dx-name" style="font-size:0.85rem">Influenza A Â· Zona Sur-Este</div>
                  <div class="dx-category">24 casos Â· Semana epidemiolÃ³gica 7/25</div>
                </div>
                <span class="badge badge-gold" style="margin-left:auto">ALERTA</span>
              </div>
              <div class="dx-result">
                <div style="width:10px;height:10px;background:var(--cyan);border-radius:50%;min-width:10px"></div>
                <div>
                  <div class="dx-name" style="font-size:0.85rem">COVID-19 Â· Variante JN.1</div>
                  <div class="dx-category">8 casos confirmados Â· SecuenciaciÃ³n en curso</div>
                </div>
                <span class="badge badge-cyan" style="margin-left:auto">VIGILANCIA</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">ğŸ”’ Privacidad Diferencial â€” Modelo de Datos</div>
          <div class="card-subtitle">Los datos nunca salen sin anonimizaciÃ³n. SoberanÃ­a de datos garantizada.</div>
          <div class="grid grid-4 mt-12">
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ”</div>
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--green)">Îµ = 0.1</div>
              <div style="font-size:0.7rem;color:var(--text3)">Privacidad diferencial</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ§Š</div>
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--cyan)">K-anon</div>
              <div style="font-size:0.7rem;color:var(--text3)">K=5 mÃ­nimo</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ </div>
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--gold)">On-premise</div>
              <div style="font-size:0.7rem;color:var(--text3)">Datos en tu servidor</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">âœˆï¸</div>
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--text2)">Federated</div>
              <div style="font-size:0.7rem;color:var(--text3)">Red de clÃ­nicas</div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: FACTURACIÃ“N
           VeriFactu Â· CFDI Â· Stripe Â· MercadoPago Â· Crypto
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-facturacion" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">FacturaciÃ³n & Contabilidad</div>
            <div style="font-size:0.8rem;color:var(--text3)">VeriFactu Â· TicketBAI Â· CFDI Â· Stripe Â· MercadoPago Â· Bitcoin</div>
          </div>
          <button class="btn btn-gold" onclick="openNewInvoice()">+ Nueva Factura</button>
        </div>

        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">Facturado este mes</div><div class="kpi-value gold">18,420â‚¬</div><div class="kpi-delta up">â–² 8.2%</div></div>
          <div class="kpi-card"><div class="kpi-label">Pendiente de cobro</div><div class="kpi-value red">2,340â‚¬</div><div class="kpi-delta">7 facturas</div></div>
          <div class="kpi-card"><div class="kpi-label">VeriFactu enviadas</div><div class="kpi-value green">147</div><div class="kpi-delta">100% compliance</div></div>
          <div class="kpi-card"><div class="kpi-label">Ticket medio</div><div class="kpi-value">87â‚¬</div><div class="kpi-delta up">â–² 12â‚¬ vs anterior</div></div>
        </div>

        <div class="card mb-16">
          <div class="card-title mb-16">ğŸ“„ Ãšltimas Facturas</div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>NÂº Factura</th>
                  <th>Paciente</th>
                  <th>Concepto</th>
                  <th>Importe</th>
                  <th>IVA</th>
                  <th>Estado</th>
                  <th>Pasarela</th>
                  <th>Normativa</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="invoice-table-body">
                <tr>
                  <td class="td-mono">FAC-2025-0847</td>
                  <td>GarcÃ­a LÃ³pez, M.</td>
                  <td>Consulta + DiagnÃ³stico IA</td>
                  <td class="td-mono text-gold">120.00â‚¬</td>
                  <td class="td-mono">10%</td>
                  <td><span class="badge badge-green">âœ“ Cobrada</span></td>
                  <td><span class="badge badge-cyan">Stripe</span></td>
                  <td><span class="badge badge-gold">VeriFactu</span></td>
                  <td><button class="btn btn-ghost btn-sm">PDF</button></td>
                </tr>
                <tr>
                  <td class="td-mono">FAC-2025-0846</td>
                  <td>Torres Mendez, B.</td>
                  <td>Teleconsulta</td>
                  <td class="td-mono text-gold">60.00â‚¬</td>
                  <td class="td-mono">10%</td>
                  <td><span class="badge badge-green">âœ“ Cobrada</span></td>
                  <td><span class="badge badge-cyan">PayPal</span></td>
                  <td><span class="badge badge-gold">VeriFactu</span></td>
                  <td><button class="btn btn-ghost btn-sm">PDF</button></td>
                </tr>
                <tr>
                  <td class="td-mono">FAC-2025-0845</td>
                  <td>LÃ³pez Romero, A.</td>
                  <td>Panel Infectio-Scanner</td>
                  <td class="td-mono text-gold">85.00â‚¬</td>
                  <td class="td-mono">0%</td>
                  <td><span class="badge badge-red">âš  Pendiente</span></td>
                  <td><span class="badge badge-gray">â€”</span></td>
                  <td><span class="badge badge-gold">VeriFactu</span></td>
                  <td><button class="btn btn-primary btn-sm">Cobrar</button></td>
                </tr>
                <tr>
                  <td class="td-mono">MX-2025-0201</td>
                  <td>MartÃ­nez Cruz, J.</td>
                  <td>Consulta General</td>
                  <td class="td-mono text-gold">$1,200 MXN</td>
                  <td class="td-mono">16%</td>
                  <td><span class="badge badge-green">âœ“ Cobrada</span></td>
                  <td><span class="badge badge-cyan">MercadoPago</span></td>
                  <td><span class="badge badge-cyan">CFDI 4.0</span></td>
                  <td><button class="btn btn-ghost btn-sm">XML</button></td>
                </tr>
                <tr>
                  <td class="td-mono">FAC-2025-0843</td>
                  <td>AnÃ³nimo</td>
                  <td>Pago en efectivo</td>
                  <td class="td-mono text-gold">50.00â‚¬</td>
                  <td class="td-mono">10%</td>
                  <td><span class="badge badge-green">âœ“ Cobrada</span></td>
                  <td><span class="badge badge-gray">â‚¿ Crypto</span></td>
                  <td><span class="badge badge-gold">VeriFactu</span></td>
                  <td><button class="btn btn-ghost btn-sm">PDF</button></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Planes pricing rÃ¡pido -->
        <div class="card">
          <div class="card-title">ğŸ’³ Pasarelas de Pago Configuradas</div>
          <div class="grid grid-4 mt-12">
            <div class="flex items-center gap-8 p-8" style="background:var(--bg3);border-radius:var(--radius);padding:10px">
              <div style="font-size:1.5rem">ğŸ’³</div>
              <div><div style="font-size:0.82rem;font-weight:600">Stripe</div><div style="font-size:0.7rem;color:var(--green)">âœ“ Activo</div></div>
            </div>
            <div class="flex items-center gap-8 p-8" style="background:var(--bg3);border-radius:var(--radius);padding:10px">
              <div style="font-size:1.5rem">ğŸ…¿ï¸</div>
              <div><div style="font-size:0.82rem;font-weight:600">PayPal</div><div style="font-size:0.7rem;color:var(--green)">âœ“ Activo</div></div>
            </div>
            <div class="flex items-center gap-8 p-8" style="background:var(--bg3);border-radius:var(--radius);padding:10px">
              <div style="font-size:1.5rem">ğŸŸ¦</div>
              <div><div style="font-size:0.82rem;font-weight:600">MercadoPago</div><div style="font-size:0.7rem;color:var(--green)">âœ“ Activo</div></div>
            </div>
            <div class="flex items-center gap-8 p-8" style="background:var(--bg3);border-radius:var(--radius);padding:10px">
              <div style="font-size:1.5rem">â‚¿</div>
              <div><div style="font-size:0.82rem;font-weight:600">Bitcoin/Crypto</div><div style="font-size:0.7rem;color:var(--green)">âœ“ Activo</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: TELEMEDICINA
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-telemedicina" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Telemedicina Segura Î©</div>
            <div style="font-size:0.8rem;color:var(--text3)">WebRTC Â· E2E cifrado Â· Firma digital Â· Wearables Â· Sin lÃ­mite de minutos</div>
          </div>
          <button class="btn btn-primary" onclick="startCall()">ğŸ“¹ Nueva Consulta</button>
        </div>

        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">ğŸ“¹ Sala de Teleconsulta</div>
            <div class="card-subtitle">WebRTC Â· AES-256 Â· Sin servidor intermediario</div>
            <div class="video-grid mt-12">
              <div class="video-tile">
                <div class="video-avatar">ğŸ‘¨â€âš•ï¸</div>
                <div class="video-tile-label">Dr. Ronin (tÃº)</div>
              </div>
              <div class="video-tile">
                <div class="video-avatar">ğŸ‘¤</div>
                <div class="video-tile-label" id="call-patient-label">Esperando paciente...</div>
              </div>
            </div>
            <div class="video-controls">
              <button class="vbtn" title="MicrÃ³fono">ğŸ¤</button>
              <button class="vbtn" title="CÃ¡mara">ğŸ“·</button>
              <button class="vbtn" title="Pantalla compartida">ğŸ–¥ï¸</button>
              <button class="vbtn" title="DiagnÃ³stico en vivo">ğŸ”¬</button>
              <button class="vbtn end" title="Colgar" onclick="showToast('ğŸ“¹ Llamada finalizada','red')">ğŸ“µ</button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ“ Durante la Consulta</div>
            <div class="card-subtitle">Notas, diagnÃ³stico y firma en tiempo real</div>
            <div class="mt-12">
              <div class="form-group"><label>Notas de la consulta</label>
                <textarea placeholder="Anota sÃ­ntomas, hallazgos, plan de tratamiento..." style="min-height:100px"></textarea>
              </div>
              <div class="flex gap-8 mt-8">
                <button class="btn btn-green btn-sm" onclick="showPanel('diagnostico')">ğŸ”¬ DiagnÃ³stico IA</button>
                <button class="btn btn-primary btn-sm" onclick="showToast('âœï¸ Consentimiento enviado al paciente para firma digital','green')">âœï¸ Firma Digital</button>
                <button class="btn btn-ghost btn-sm" onclick="showToast('ğŸ“„ Receta enviada al paciente','green')">ğŸ’Š Receta</button>
              </div>

              <!-- â•â• MÃ“DULO C: WEARABLE TELEMETRY ENGINE â•â• -->
              <!-- Basado en: "Wearable Devices for Remote Monitoring" â€” sensores PPG, biopotencial, acelerÃ³metro -->
              <!-- La ciencia debe sentirse real. Zehahahaha. -->
              <div style="margin-top:16px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden">
                <div style="padding:10px 12px;background:var(--bg2);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
                  <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.1em">ğŸ“¡ Wearable TorÃ¡cico / MuÃ±eca â€” TelemetrÃ­a en Vivo</div>
                  <div style="display:flex;gap:4px;align-items:center">
                    <div style="width:6px;height:6px;background:var(--green);border-radius:50%;animation:blink 0.8s ease infinite;box-shadow:0 0 4px var(--green)"></div>
                    <span style="font-family:var(--mono);font-size:0.6rem;color:var(--green)">LIVE</span>
                  </div>
                </div>
                <div style="padding:10px 12px">
                  <!-- Waveform mini-canvas -->
                  <canvas id="ppg-wave" width="100%" height="40" style="width:100%;height:40px;display:block;margin-bottom:10px;opacity:0.8"></canvas>
                  <div class="grid grid-2" style="gap:6px" id="wearable-vitals">
                    <!-- Populated by JS Gaussian simulation -->
                  </div>
                  <div style="margin-top:8px;padding:6px 8px;background:rgba(0,255,255,0.04);border-radius:var(--radius);font-family:var(--mono);font-size:0.6rem;color:var(--text3)">
                    Sensores activos: <span style="color:var(--cyan)">PPG</span> (FC, SpOâ‚‚) Â· <span style="color:var(--gold)">Biopotencial</span> (ECG) Â· <span style="color:var(--green)">NTC/Infrarrojo</span> (TÂª) Â· <span style="color:var(--text2)">MEMS AcelerÃ³metro</span> (actividad)
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: FABRICACIÃ“N eDHR (Inspirado en Tulip)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-fabricacion" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">FabricaciÃ³n MÃ©dica â€” eDHR AutomÃ¡tico</div>
            <div style="font-size:0.8rem;color:var(--text3)">Electronic Device History Record Â· Ortopedia Â· PrÃ³tesis Â· Alineadores Â· ISO 13485</div>
          </div>
          <button class="btn btn-gold" onclick="newDHR()">+ Nuevo eDHR</button>
        </div>

        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">eDHR activos</div><div class="kpi-value">24</div></div>
          <div class="kpi-card"><div class="kpi-label">Conformidad</div><div class="kpi-value green">98.7%</div></div>
          <div class="kpi-card"><div class="kpi-label">Alertas desviaciÃ³n</div><div class="kpi-value red">2</div></div>
          <div class="kpi-card"><div class="kpi-label">Trazabilidad</div><div class="kpi-value">100%</div></div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <div class="card-title">ğŸ“‹ Instrucciones de Trabajo Digitales</div>
            <div class="card-subtitle">Paso a prueba de errores Â· Captura automÃ¡tica de datos</div>
            <div class="mt-12">
              <div style="display:flex;flex-direction:column;gap:6px">
                <div style="display:flex;gap:10px;align-items:center;padding:10px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius)">
                  <div style="width:24px;height:24px;border-radius:50%;background:var(--green);display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;color:var(--bg);min-width:24px">âœ“</div>
                  <div>
                    <div style="font-size:0.82rem;font-weight:500">1. Escanear materia prima â€” Lote REF-2025-0341</div>
                    <div style="font-size:0.7rem;color:var(--text3)">Completado 14:23 Â· Dr. Ronin Â· BÃ¡scula A: 847g âœ“</div>
                  </div>
                </div>
                <div style="display:flex;gap:10px;align-items:center;padding:10px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius)">
                  <div style="width:24px;height:24px;border-radius:50%;background:var(--green);display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;color:var(--bg);min-width:24px">âœ“</div>
                  <div>
                    <div style="font-size:0.82rem;font-weight:500">2. Moldeado a medida â€” Temperatura 180Â°C</div>
                    <div style="font-size:0.7rem;color:var(--text3)">Completado 15:01 Â· Temp registrada: 179.8Â°C âœ“</div>
                  </div>
                </div>
                <div style="display:flex;gap:10px;align-items:center;padding:10px;background:rgba(0,255,255,0.05);border:1px solid var(--border);border-radius:var(--radius)">
                  <div style="width:24px;height:24px;border-radius:50%;background:var(--cyan);display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;color:var(--bg);min-width:24px;animation:pulse-glow 2s ease infinite">â–¶</div>
                  <div>
                    <div style="font-size:0.82rem;font-weight:500">3. Control dimensional â€” EscÃ¡ner 3D</div>
                    <div style="font-size:0.7rem;color:var(--cyan)">EN PROGRESO â€” Esperando mediciÃ³n...</div>
                  </div>
                </div>
                <div style="display:flex;gap:10px;align-items:center;padding:10px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);opacity:0.5">
                  <div style="width:24px;height:24px;border-radius:50%;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:0.75rem;color:var(--text3);min-width:24px">4</div>
                  <div>
                    <div style="font-size:0.82rem;font-weight:500">4. EsterilizaciÃ³n â€” Autoclave</div>
                    <div style="font-size:0.7rem;color:var(--text3)">Pendiente</div>
                  </div>
                </div>
                <div style="display:flex;gap:10px;align-items:center;padding:10px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);opacity:0.5">
                  <div style="width:24px;height:24px;border-radius:50%;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:0.75rem;color:var(--text3);min-width:24px">5</div>
                  <div>
                    <div style="font-size:0.82rem;font-weight:500">5. Firma eDHR y liberaciÃ³n</div>
                    <div style="font-size:0.7rem;color:var(--text3)">Pendiente Â· Requiere firma responsable tÃ©cnico</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ” Trazabilidad de Lote</div>
            <div class="card-subtitle">De la materia prima al paciente Â· GenealogÃ­a completa</div>
            <div class="mt-12">
              <div class="form-group"><label>NÃºmero de lote / Dispositivo</label><input value="ORTHx-2025-0047 Â· Plantilla personalizada" readonly></div>
              <div class="form-group"><label>Paciente asignado</label><input value="GarcÃ­a LÃ³pez, MarÃ­a Â· NHC 0000847" readonly></div>
              <div class="form-group"><label>Materia prima</label><input value="EVA 50sh Â· Lote REF-2025-0341 Â· Caducidad: 12/2026" readonly></div>
              <div class="form-group"><label>Fecha fabricaciÃ³n</label><input value="19/02/2025 Â· 14:00â€“16:30" readonly></div>
              <div class="form-group"><label>Estado ISO 13485</label>
                <input value="âœ“ Conforme Â· PrÃ³xima auditorÃ­a: 01/04/2025" style="border-color:rgba(0,255,65,0.3);color:var(--green)" readonly>
              </div>
              <button class="btn btn-gold btn-sm mt-8" onclick="showToast('ğŸ“„ eDHR exportado como PDF firmado digitalmente','green')">ğŸ“„ Exportar eDHR Firmado</button>
            </div>
          </div>
          <!-- â•â• MÃ“DULO B: BLOCKCHAIN eDHR + PBFT CONSENSUS â•â• -->
          <!-- Basado en: "Research on medical system based on blockchain technology" (PBFT algorithm) -->
          <!-- La confianza en forma de algoritmo. OlvÃ­date de cripto. Piensa en trazabilidad. -->
          <div class="card green-accent mt-16">
            <div class="flex justify-between items-center mb-12">
              <div>
                <div class="card-title">â›“ï¸ Cadena de Custodia â€” eDHR Inmutable (Blockchain PBFT)</div>
                <div class="card-subtitle">SHA-256 Â· Practical Byzantine Fault Tolerance Â· Consenso de red Â· Registro inalterable</div>
              </div>
              <button class="btn btn-green btn-sm" onclick="addBlockToChain()">+ Nuevo Bloque</button>
            </div>
            <!-- Chain visual -->
            <div id="chain-visual" style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px">
              <!-- Populated by JS -->
            </div>
            <!-- Consensus meter -->
            <div style="padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:8px">CONSENSO DE RED (PBFT) â€” Nodos validadores</div>
              <div id="consensus-nodes" style="display:flex;flex-direction:column;gap:6px">
                <!-- Populated by JS -->
              </div>
            </div>
            <!-- Consent registry -->
            <div style="margin-top:12px;padding:10px;background:rgba(0,255,65,0.04);border:1px solid rgba(0,255,65,0.15);border-radius:var(--radius)">
              <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:8px">ğŸ“œ Registro de Consentimientos (Inmutable)</div>
              <div id="consent-log" style="display:flex;flex-direction:column;gap:4px;max-height:100px;overflow-y:auto">
                <!-- Populated by JS -->
              </div>
            </div>
          </div>
        </div>
      </div>
           HIPAA + GDPR + VeriFactu + CFDI
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-cumplimiento" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Cumplimiento Normativo â€” Blindaje Legal</div>
            <div style="font-size:0.8rem;color:var(--text3)">HIPAA Â· GDPR Â· VeriFactu Â· TicketBAI Â· CFDI Â· NOM-024-SSA3</div>
          </div>
          <span class="badge badge-green" style="padding:8px 14px;font-size:0.78rem">âœ“ 100% COMPLIANT</span>
        </div>

        <div class="grid grid-2 mb-16">
          <div class="card green-accent">
            <div class="card-title">ğŸ‡ºğŸ‡¸ HIPAA Compliance</div>
            <div class="card-subtitle">Health Insurance Portability and Accountability Act</div>
            <div class="mt-12">
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Cifrado en reposo (AES-256)</span><span class="badge badge-green">âœ“ Activo</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Cifrado en trÃ¡nsito (TLS 1.3)</span><span class="badge badge-green">âœ“ Activo</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Control de acceso basado en roles</span><span class="badge badge-green">âœ“ Activo</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Registro de auditorÃ­a (immutable log)</span><span class="badge badge-green">âœ“ Activo</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">PolÃ­tica de retenciÃ³n 7 aÃ±os</span><span class="badge badge-green">âœ“ Configurado</span></div>
              <div class="flex justify-between"><span style="font-size:0.82rem">Business Associate Agreement (BAA)</span><span class="badge badge-cyan">Disponible</span></div>
            </div>
          </div>

          <div class="card green-accent">
            <div class="card-title">ğŸ‡ªğŸ‡º GDPR Compliance</div>
            <div class="card-subtitle">General Data Protection Regulation Â· Reglamento UE 2016/679</div>
            <div class="mt-12">
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Consentimiento explÃ­cito (art. 6)</span><span class="badge badge-green">âœ“ Implementado</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Portabilidad de datos (art. 20)</span><span class="badge badge-green">âœ“ API JSON</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Derecho al olvido (art. 17)</span><span class="badge badge-green">âœ“ Un clic</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">DPO / Delegado ProtecciÃ³n Datos</span><span class="badge badge-cyan">Config.</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Data residency EspaÃ±a/EU</span><span class="badge badge-green">âœ“ On-premise</span></div>
              <div class="flex justify-between"><span style="font-size:0.82rem">Registro de actividades (art. 30)</span><span class="badge badge-green">âœ“ AutomÃ¡tico</span></div>
            </div>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card gold-accent">
            <div class="card-title">ğŸ‡ªğŸ‡¸ VeriFactu & TicketBAI</div>
            <div class="card-subtitle">FacturaciÃ³n electrÃ³nica obligatoria EspaÃ±a 2025</div>
            <div class="mt-12">
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Certificado electrÃ³nico</span><span class="badge badge-gold">âœ“ Configurado</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">EnvÃ­o AEAT en tiempo real</span><span class="badge badge-green">âœ“ Activo</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Huella SHA-256 por factura</span><span class="badge badge-green">âœ“ AutomÃ¡tico</span></div>
              <div class="flex justify-between"><span style="font-size:0.82rem">TicketBAI (PaÃ­s Vasco/Navarra)</span><span class="badge badge-cyan">Disponible</span></div>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ‡²ğŸ‡½ CFDI 4.0 MÃ©xico</div>
            <div class="card-subtitle">Comprobante Fiscal Digital por Internet Â· SAT</div>
            <div class="mt-12">
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Timbrado SAT automÃ¡tico</span><span class="badge badge-green">âœ“ Activo</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">CancelaciÃ³n CFDI</span><span class="badge badge-green">âœ“ Implementado</span></div>
              <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Complemento Pago</span><span class="badge badge-green">âœ“ Auto</span></div>
              <div class="flex justify-between"><span style="font-size:0.82rem">NOM-024-SSA3 (HCE MÃ©xico)</span><span class="badge badge-cyan">Activo</span></div>
            </div>
          </div>
        </div>

        <!-- â•â• MÃ“DULO A: WHO COMPLIANCE PANEL â•â• -->
        <!-- Basado en: "Global Atlas of Medical Devices 2022" â€” OMS es el Ã¡rbitro. -->
        <div class="card gold-accent mt-16">
          <div class="flex justify-between items-center mb-12">
            <div>
              <div class="card-title">ğŸŒ Cumplimiento OMS â€” Global Atlas of Medical Devices 2022</div>
              <div class="card-subtitle">CategorizaciÃ³n GMDN Â· WHO Medical Device Classification Â· Madurez TecnolÃ³gica Global</div>
            </div>
            <div id="who-maturity" style="text-align:center">
              <div style="font-family:var(--display);font-size:1.8rem;font-weight:800;color:var(--gold)" id="who-score">84%</div>
              <div style="font-family:var(--mono);font-size:0.6rem;color:var(--text3)">MADUREZ OMS</div>
            </div>
          </div>

          <!-- WHO checklist -->
          <div style="margin-bottom:12px">
            <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:8px">CHECKLIST DE EQUIPO POR CATEGORÃA WHO-GMDN</div>
            <div id="who-checklist" style="display:flex;flex-direction:column;gap:6px">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Maturity bar -->
          <div style="margin-bottom:12px">
            <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);margin-bottom:6px">ÃNDICE DE MADUREZ TECNOLÃ“GICA GLOBAL (WHO Technology Access Index)</div>
            <div class="progress" style="height:10px">
              <div class="progress-fill" id="who-maturity-bar" style="width:84%;background:linear-gradient(90deg,var(--gold),var(--green))"></div>
            </div>
            <div style="display:flex;justify-content:space-between;margin-top:4px;font-family:var(--mono);font-size:0.62rem;color:var(--text3)">
              <span>Nivel 1 Â· BÃ¡sico</span>
              <span>Nivel 3 Â· Avanzado</span>
              <span>Nivel 5 Â· Referencia OMS âœ“</span>
            </div>
          </div>
        </div>

        <!-- â•â• MÃ“DULO E: SYNTHETIC DATA / RESEARCH MODE â•â• -->
        <!-- Privacidad diferencial: cuando el interruptor estÃ¡ ON, la realidad se convierte en simulaciÃ³n estadÃ­stica. -->
        <div class="card red-accent mt-16">
          <div class="flex justify-between items-center mb-12">
            <div>
              <div class="card-title">ğŸ§ª Privacidad Diferencial â€” Datos SintÃ©ticos</div>
              <div class="card-subtitle">Genera poblaciones estadÃ­sticamente coherentes Â· Sin un solo dato real Â· GDPR Art. 89 (investigaciÃ³n)</div>
            </div>
            <div style="display:flex;align-items:center;gap:12px">
              <div id="research-mode-indicator" style="font-family:var(--mono);font-size:0.7rem;color:var(--text3)">MODO: REAL</div>
              <button class="btn btn-red" id="research-btn" onclick="toggleResearchMode()">ğŸ§ª MODO INVESTIGACIÃ“N</button>
            </div>
          </div>

          <div id="research-panel" style="display:none">
            <div style="padding:12px;background:rgba(255,59,92,0.06);border:1px solid rgba(255,59,92,0.2);border-radius:var(--radius);margin-bottom:12px">
              <div style="font-family:var(--mono);font-size:0.7rem;color:var(--red);margin-bottom:4px">âš  MODO INVESTIGACIÃ“N ACTIVO â€” Todos los datos son sintÃ©ticos</div>
              <div style="font-size:0.78rem;color:var(--text2)">La base de datos real ha sido sustituida por <strong id="synth-count" style="color:var(--gold)">0</strong> pacientes sintÃ©ticos generados con distribuciones epidemiolÃ³gicas reales (Gaussiana + Dirichlet por patologÃ­a). NingÃºn dato real es accesible.</div>
            </div>
            <div id="synth-stats" style="display:none">
              <div style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:8px">DISTRIBUCIÃ“N EPIDEMIOLÃ“GICA DE LA POBLACIÃ“N SINTÃ‰TICA</div>
              <div id="synth-dist" class="grid grid-4" style="gap:8px">
                <!-- Populated by JS -->
              </div>
              <div style="margin-top:12px;display:flex;gap:8px">
                <button class="btn btn-ghost btn-sm" onclick="exportSyntheticData()">ğŸ“¥ Exportar JSON (SintÃ©tico)</button>
                <button class="btn btn-ghost btn-sm" onclick="showToast('ğŸ“Š Dataset CSV generado: synthetic_cohort_1310.csv','green')">ğŸ“Š Exportar CSV</button>
                <button class="btn btn-red btn-sm" onclick="toggleResearchMode()">â¹ Desactivar Modo</button>
              </div>
            </div>
          </div>

          <div id="real-mode-hint" style="font-size:0.78rem;color:var(--text3)">
            Activa el modo investigaciÃ³n para generar <strong style="color:var(--gold)">1310 pacientes sintÃ©ticos</strong> estadÃ­sticamente vÃ¡lidos. Los epidemiÃ³logos pueden trabajar con la distribuciÃ³n de enfermedades sin tocar ningÃºn dato real. La privacidad es un booleano que, cuando estÃ¡ ON, transforma la realidad en una simulaciÃ³n.
          </div>
        </div>

      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: PLANES Y PRICING
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-pricing" class="panel">
        <div style="text-align:center;margin-bottom:32px">
          <div style="font-family:var(--display);font-size:1.6rem;font-weight:800;color:var(--text)">Elige tu plan de soberanÃ­a</div>
          <div style="font-size:0.9rem;color:var(--text3);margin-top:8px">Sin permanencia Â· Sin sorpresas Â· La salud no es un privilegio</div>
        </div>

        <div class="grid grid-3 mb-24">
          <div class="pricing-card">
            <div class="pricing-plan">Freemium</div>
            <div class="pricing-price"><sup>â‚¬</sup>0<sub>/mes</sub></div>
            <div class="pricing-desc">Para clÃ­nicas que empiezan. Sin tarjeta.</div>
            <div class="pricing-features">
              <div class="pricing-feat">1 mÃ©dico, 1 sede</div>
              <div class="pricing-feat">100 pacientes (no 1310, eso es premium)</div>
              <div class="pricing-feat">Agenda bÃ¡sica</div>
              <div class="pricing-feat">Historia clÃ­nica electrÃ³nica</div>
              <div class="pricing-feat">5 diagnÃ³sticos IA/mes</div>
              <div class="pricing-feat">Sin facturaciÃ³n electrÃ³nica</div>
            </div>
            <button class="btn btn-ghost w-full" style="justify-content:center">Empezar gratis</button>
          </div>

          <div class="pricing-card featured">
            <div class="pricing-badge">MÃS POPULAR</div>
            <div class="pricing-plan">Professional</div>
            <div class="pricing-price"><sup>â‚¬</sup>49<sub>/mes</sub></div>
            <div class="pricing-desc">Todo ilimitado. Un mÃ©dico libre.</div>
            <div class="pricing-features">
              <div class="pricing-feat">MÃ©dicos ilimitados</div>
              <div class="pricing-feat">1310 pacientes incluidos (ilimitado +0.1â‚¬/paciente)</div>
              <div class="pricing-feat">Agenda inteligente + cita online</div>
              <div class="pricing-feat">DiagnÃ³stico IA ilimitado Â· >97% precisiÃ³n</div>
              <div class="pricing-feat">FacturaciÃ³n VeriFactu / CFDI</div>
              <div class="pricing-feat">Telemedicina WebRTC ilimitada</div>
              <div class="pricing-feat">CalibraciÃ³n hardware-agnÃ³stica</div>
              <div class="pricing-feat">Portal del paciente PWA</div>
              <div class="pricing-feat">HIPAA + GDPR compliant</div>
            </div>
            <button class="btn btn-gold w-full" style="justify-content:center" onclick="showToast('ğŸ’ Activando Professional... Bienvenido a la soberanÃ­a.','green')">Activar Professional</button>
          </div>

          <div class="pricing-card">
            <div class="pricing-plan">Enterprise</div>
            <div class="pricing-price"><sup>â‚¬</sup>199<sub>/mes</sub></div>
            <div class="pricing-desc">Redes de clÃ­nicas. Multi-sede. API completa.</div>
            <div class="pricing-features">
              <div class="pricing-feat">Todo de Professional</div>
              <div class="pricing-feat">Multi-clÃ­nica federada</div>
              <div class="pricing-feat">API pÃºblica documentada</div>
              <div class="pricing-feat">Epi-Scanner con alertas OPS/OMS</div>
              <div class="pricing-feat">eDHR FabricaciÃ³n (Tulip-compatible)</div>
              <div class="pricing-feat">SLA 99.9% Â· Soporte prioritario</div>
              <div class="pricing-feat">Multi-tenant aislado por sede</div>
              <div class="pricing-feat">White-label disponible</div>
            </div>
            <button class="btn btn-primary w-full" style="justify-content:center">Contactar Enterprise</button>
          </div>
        </div>

        <!-- Marketplace -->
        <div class="card gold-accent">
          <div class="card-title">ğŸ›’ Marketplace de MÃ³dulos â€” Pago por uso</div>
          <div class="card-subtitle">Activa solo lo que necesitas. Sin compromiso.</div>
          <div class="grid grid-4 mt-12">
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ¦ </div>
              <div style="font-size:0.82rem;font-weight:600">Panel Malaria</div>
              <div style="font-family:var(--display);font-size:1.2rem;font-weight:700;color:var(--gold)">5â‚¬</div>
              <div style="font-size:0.7rem;color:var(--text3)">por prueba</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ©¸</div>
              <div style="font-size:0.82rem;font-weight:600">Hemograma IA</div>
              <div style="font-family:var(--display);font-size:1.2rem;font-weight:700;color:var(--gold)">8â‚¬</div>
              <div style="font-size:0.7rem;color:var(--text3)">por anÃ¡lisis</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ§¬</div>
              <div style="font-size:0.82rem;font-weight:600">SecuenciaciÃ³n IA</div>
              <div style="font-family:var(--display);font-size:1.2rem;font-weight:700;color:var(--gold)">25â‚¬</div>
              <div style="font-size:0.7rem;color:var(--text3)">por muestra</div>
            </div>
            <div style="text-align:center;padding:12px;background:var(--bg3);border-radius:var(--radius)">
              <div style="font-size:1.5rem;margin-bottom:4px">ğŸ“Š</div>
              <div style="font-size:0.82rem;font-weight:600">Epi-Report OMS</div>
              <div style="font-family:var(--display);font-size:1.2rem;font-weight:700;color:var(--gold)">50â‚¬</div>
              <div style="font-size:0.7rem;color:var(--text3)">por informe</div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: API PÃšBLICA
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-api" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">API PÃºblica Atlas Medicus Î©</div>
            <div style="font-size:0.8rem;color:var(--text3)">REST Â· OpenAPI 3.0 Â· WebSocket Â· Webhook Â· SDK disponibles</div>
          </div>
          <span class="badge badge-cyan">v2.1.0</span>
        </div>

        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">âš¡ Endpoints principales</div>
            <div style="margin-top:12px;font-family:var(--mono);font-size:0.78rem">
              <div style="padding:8px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-green">GET</span>
                <span>/v2/patients</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">Lista paginada</span>
              </div>
              <div style="padding:8px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-cyan">POST</span>
                <span>/v2/patients</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">Crear paciente</span>
              </div>
              <div style="padding:8px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-cyan">POST</span>
                <span>/v2/diagnose</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">Motor IA Î©</span>
              </div>
              <div style="padding:8px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-cyan">POST</span>
                <span>/v2/scan/hematologic</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">Imagenâ†’anÃ¡lisis</span>
              </div>
              <div style="padding:8px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-green">GET</span>
                <span>/v2/calibration/profiles</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">Perfiles HW</span>
              </div>
              <div style="padding:8px;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-cyan">POST</span>
                <span>/v2/invoices</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">VeriFactu/CFDI</span>
              </div>
              <div style="padding:8px;display:flex;gap:8px;align-items:center">
                <span class="badge badge-gold">WS</span>
                <span>/v2/realtime</span>
                <span style="margin-left:auto;color:var(--text3);font-size:0.7rem">WebSocket</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-title">ğŸ“ Ejemplo: DiagnÃ³stico vÃ­a API</div>
            <div style="margin-top:12px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:14px;font-family:var(--mono);font-size:0.75rem;overflow-x:auto">
              <div style="color:var(--text3)">// POST /v2/diagnose</div>
              <div style="color:var(--text3)">// Authorization: Bearer &lt;API_KEY&gt;</div>
              <br>
              <div style="color:var(--cyan)">{</div>
              <div style="padding-left:16px">
                <div><span style="color:var(--gold)">"symptoms"</span>: [<span style="color:var(--green)">"chest pain"</span>, <span style="color:var(--green)">"dyspnea"</span>, <span style="color:var(--green)">"diaphoresis"</span>],</div>
                <div><span style="color:var(--gold)">"age"</span>: <span style="color:var(--text2)">52</span>,</div>
                <div><span style="color:var(--gold)">"sex"</span>: <span style="color:var(--green)">"female"</span>,</div>
                <div><span style="color:var(--gold)">"vitals"</span>: {<span style="color:var(--gold)">"bp"</span>: <span style="color:var(--green)">"148/92"</span>, <span style="color:var(--gold)">"hr"</span>: <span style="color:var(--text2)">98</span>},</div>
                <div><span style="color:var(--gold)">"lab"</span>: {<span style="color:var(--gold)">"troponin_i"</span>: <span style="color:var(--text2)">0.48</span>}</div>
              </div>
              <div style="color:var(--cyan)">}</div>
              <br>
              <div style="color:var(--text3)">// Response:</div>
              <div style="color:var(--cyan)">{</div>
              <div style="padding-left:16px">
                <div><span style="color:var(--gold)">"top_10"</span>: [</div>
                <div style="padding-left:16px"><div>{<span style="color:var(--gold)">"condition"</span>: <span style="color:var(--green)">"ACS"</span>, <span style="color:var(--gold)">"probability"</span>: <span style="color:var(--text2)">0.942</span>, <span style="color:var(--gold)">"urgency"</span>: <span style="color:var(--red)">"CRITICAL"</span>},</div></div>
                <div style="padding-left:16px"><div>{<span style="color:var(--gold)">"condition"</span>: <span style="color:var(--green)">"Unstable angina"</span>, <span style="color:var(--gold)">"probability"</span>: <span style="color:var(--text2)">0.781</span>},</div></div>
                <div style="padding-left:16px"><div>... 8 mÃ¡s ...</div></div>
                <div>],</div>
                <div><span style="color:var(--gold)">"precision_claim"</span>: <span style="color:var(--text2)">0.973</span>,</div>
                <div><span style="color:var(--gold)">"engine"</span>: <span style="color:var(--green)">"Atlas Medicus Î© v2.1"</span></div>
              </div>
              <div style="color:var(--cyan)">}</div>
            </div>
          </div>
        </div>

        <!-- GuÃ­a de despliegue a producciÃ³n -->
        <div class="card gold-accent">
          <div class="card-title">ğŸš€ GuÃ­a de Despliegue a ProducciÃ³n</div>
          <div class="card-subtitle">De la demo offline al SaaS real en producciÃ³n</div>
          <div style="margin-top:12px;font-size:0.82rem;color:var(--text2)">
            <div style="margin-bottom:8px"><strong style="color:var(--cyan)">1. Infraestructura:</strong> Servidor Ubuntu 22.04 LTS (VPS â‰¥4 vCPU, 8GB RAM) o Kubernetes. Dominio propio + SSL Let's Encrypt.</div>
            <div style="margin-bottom:8px"><strong style="color:var(--cyan)">2. Backend:</strong> Node.js 20 LTS + Express. Reemplazar IndexedDB por PostgreSQL 16. Ejecutar migraciones SQL incluidas en <code style="color:var(--gold)">/db/migrations/</code>.</div>
            <div style="margin-bottom:8px"><strong style="color:var(--cyan)">3. AutenticaciÃ³n:</strong> Configurar Keycloak o Auth0 para RBAC. API keys vÃ­a JWT firmados con RS256.</div>
            <div style="margin-bottom:8px"><strong style="color:var(--cyan)">4. MÃ³dulo IA:</strong> Python 3.11 + FastAPI + TensorFlow Serving. Fine-tune con datos propios de la clÃ­nica. WebAssembly para inferencia en cliente.</div>
            <div style="margin-bottom:8px"><strong style="color:var(--cyan)">5. Certificados:</strong> VeriFactu: certificado digital FNMT. CFDI: PKI SAT. HIPAA: contratar BAA con cloud provider.</div>
            <div><strong style="color:var(--cyan)">6. Packaging:</strong> Electron para desktop (Win/Mac/Linux). React Native para mÃ³vil (iOS/Android). PWA para portal del paciente.</div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: ANALYTICS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-analytics" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Analytics & KPIs ClÃ­nicos</div>
            <div style="font-size:0.8rem;color:var(--text3)">FacturaciÃ³n Â· OcupaciÃ³n Â· SatisfacciÃ³n Â· DiagnÃ³stico Â· Stock</div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="showToast('ğŸ“Š Informe exportado a PDF','green')">ğŸ“Š Exportar PDF</button>
        </div>

        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">FacturaciÃ³n YTD</div><div class="kpi-value gold">94.2kâ‚¬</div><div class="kpi-delta up">â–² 22% vs 2024</div></div>
          <div class="kpi-card"><div class="kpi-label">Tasa OcupaciÃ³n</div><div class="kpi-value green">84%</div><div class="kpi-delta up">â–² 11pp</div></div>
          <div class="kpi-card"><div class="kpi-label">NPS Pacientes</div><div class="kpi-value">78</div><div class="kpi-delta up">â–² Excelente</div></div>
          <div class="kpi-card"><div class="kpi-label">DiagnÃ³sticos/dÃ­a</div><div class="kpi-value">41</div><div class="kpi-delta">Limit: 1310/dÃ­a</div></div>
        </div>

        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">ğŸ† Top DiagnÃ³sticos â€” Feb 2025</div>
            <div class="mt-12">
              <div class="flex justify-between mb-6 items-center"><span style="font-size:0.82rem">HipertensiÃ³n arterial</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:82%"></div></div><span class="td-mono text-xs">82%</span></div></div>
              <div class="flex justify-between mb-6 items-center"><span style="font-size:0.82rem">Diabetes Tipo 2</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:71%"></div></div><span class="td-mono text-xs">71%</span></div></div>
              <div class="flex justify-between mb-6 items-center"><span style="font-size:0.82rem">InfecciÃ³n respiratoria</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:58%"></div></div><span class="td-mono text-xs">58%</span></div></div>
              <div class="flex justify-between mb-6 items-center"><span style="font-size:0.82rem">Lumbalgia mecÃ¡nica</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:44%"></div></div><span class="td-mono text-xs">44%</span></div></div>
              <div class="flex justify-between items-center"><span style="font-size:0.82rem">SÃ­ndrome ansioso</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:37%"></div></div><span class="td-mono text-xs">37%</span></div></div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ’° DistribuciÃ³n de ingresos</div>
            <div class="mt-12">
              <div class="bar-chart">
                <div class="bar-col"><div class="bar-val">8.4k</div><div class="bar" style="height:92%;background:linear-gradient(180deg,var(--gold),rgba(255,215,0,0.3))"></div><div class="bar-label">Consultas</div></div>
                <div class="bar-col"><div class="bar-val">4.2k</div><div class="bar" style="height:46%;background:linear-gradient(180deg,var(--cyan),rgba(0,255,255,0.3))"></div><div class="bar-label">DiagnÃ³st.</div></div>
                <div class="bar-col"><div class="bar-val">3.1k</div><div class="bar" style="height:34%;background:linear-gradient(180deg,var(--green),rgba(0,255,65,0.3))"></div><div class="bar-label">Telecons.</div></div>
                <div class="bar-col"><div class="bar-val">1.8k</div><div class="bar" style="height:20%;background:linear-gradient(180deg,var(--red),rgba(255,59,92,0.3))"></div><div class="bar-label">Fabr.</div></div>
                <div class="bar-col"><div class="bar-val">0.9k</div><div class="bar" style="height:10%;background:linear-gradient(180deg,#a0f0ff,rgba(160,240,255,0.3))"></div><div class="bar-label">Otros</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL: INVENTARIO
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-inventario" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">Inventario & Stock</div>
            <div style="font-size:0.8rem;color:var(--text3)">Medicamentos Â· Material quirÃºrgico Â· Ortopedia Â· Alertas automÃ¡ticas</div>
          </div>
          <button class="btn btn-green" onclick="showToast('ğŸ“¦ Pedido automÃ¡tico generado','green')">+ Pedido AutomÃ¡tico</button>
        </div>

        <div class="card">
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>Producto / REF</th><th>CategorÃ­a</th><th>Stock actual</th><th>Stock mÃ­nimo</th><th>Caducidad</th><th>Estado</th></tr>
              </thead>
              <tbody>
                <tr><td>Amoxicilina 500mg Â· AM500</td><td>AntibiÃ³tico</td><td class="td-mono text-red">8 uds</td><td class="td-mono">25 uds</td><td class="td-mono">08/2026</td><td><span class="badge badge-red">âš  BAJO</span></td></tr>
                <tr><td>Guantes nitrilo Talla M Â· GNM</td><td>Material quirÃºrgico</td><td class="td-mono text-green">247 pares</td><td class="td-mono">50</td><td class="td-mono">â€”</td><td><span class="badge badge-green">OK</span></td></tr>
                <tr><td>Metformina 850mg Â· MET850</td><td>AntidiabÃ©tico</td><td class="td-mono text-green">134 uds</td><td class="td-mono">50</td><td class="td-mono">03/2026</td><td><span class="badge badge-green">OK</span></td></tr>
                <tr><td>Tiras glucemia Â· TG100</td><td>DiagnÃ³stico</td><td class="td-mono text-gold">22 uds</td><td class="td-mono">30</td><td class="td-mono">01/2026</td><td><span class="badge badge-gold">âš¡ PEDIR</span></td></tr>
                <tr><td>EVA 50sh Â· Plantillas Â· EVA50</td><td>Ortopedia</td><td class="td-mono text-green">18 lÃ¡minas</td><td class="td-mono">5</td><td class="td-mono">12/2026</td><td><span class="badge badge-green">OK</span></td></tr>
                <tr><td>Paracetamol 1g IV Â· PAR1G</td><td>AnalgÃ©sico</td><td class="td-mono text-red">3 viales</td><td class="td-mono">10</td><td class="td-mono">06/2025</td><td><span class="badge badge-red">âš  URGENTE</span></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL F â€” FHIR INTEROPERABILIDAD UNIVERSAL
           HL7 FHIR R4 Â· CMS mandates Â· Data liquidity
           "Los datos de salud no deben vivir en silos.
            Excepto en los hospitales del siglo XX. Que son todos."
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-fhir" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">ğŸ”— MÃ³dulo F â€” Interoperabilidad FHIR Universal</div>
            <div style="font-size:0.8rem;color:var(--text3)">HL7 FHIR R4 Â· IHE XDS Â· CMS Interoperability Rule 2020 Â· EU eHealth DSI</div>
          </div>
          <span class="badge badge-green">FHIR R4 COMPLIANT</span>
        </div>
        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">Ãndice Interop.</div><div class="kpi-value green" id="fhir-idx">78%</div><div class="kpi-delta">Sistemas conectados</div></div>
          <div class="kpi-card"><div class="kpi-label">Endpoints FHIR</div><div class="kpi-value">12</div><div class="kpi-delta up">v3.0 nuevos</div></div>
          <div class="kpi-card"><div class="kpi-label">Recursos activos</div><div class="kpi-value gold">47</div><div class="kpi-delta">Patient/Obs/Condition</div></div>
          <div class="kpi-card"><div class="kpi-label">Latencia media</div><div class="kpi-value" style="font-size:1.4rem">142ms</div><div class="kpi-delta up">Target: &lt;200ms</div></div>
        </div>
        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">âœ… Checklist de EstÃ¡ndares</div>
            <div class="card-subtitle">Requisito para subvenciones CMS, acreditaciones JCI y reembolso SNOMED/ICD en UE</div>
            <div id="fhir-checklist" style="margin-top:12px"></div>
            <button class="btn btn-primary btn-sm mt-12" onclick="calcFhirIndex()">ğŸ”„ Recalcular Ãndice</button>
          </div>
          <div class="card">
            <div class="card-title">âš¡ Endpoints FHIR Simulados</div>
            <div class="card-subtitle">SimulaciÃ³n local â†’ En producciÃ³n: Node.js HAPI FHIR Server</div>
            <div style="margin-top:12px;font-family:var(--mono);font-size:0.75rem">
              <div style="padding:7px 0;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-green">GET</span><span>/v2/fhir/Patient</span>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto;padding:2px 8px" onclick="fhirCall('Patient')">â–¶ Test</button>
              </div>
              <div style="padding:7px 0;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-green">GET</span><span>/v2/fhir/Observation</span>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto;padding:2px 8px" onclick="fhirCall('Observation')">â–¶ Test</button>
              </div>
              <div style="padding:7px 0;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-cyan">POST</span><span>/v2/fhir/DiagnosticReport</span>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto;padding:2px 8px" onclick="fhirCall('DiagnosticReport')">â–¶ Test</button>
              </div>
              <div style="padding:7px 0;border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center">
                <span class="badge badge-green">GET</span><span>/v2/fhir/Condition</span>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto;padding:2px 8px" onclick="fhirCall('Condition')">â–¶ Test</button>
              </div>
              <div style="padding:7px 0;display:flex;gap:8px;align-items:center">
                <span class="badge badge-cyan">POST</span><span>/v2/fhir/MedicationRequest</span>
                <button class="btn btn-ghost btn-sm" style="margin-left:auto;padding:2px 8px" onclick="fhirCall('MedicationRequest')">â–¶ Test</button>
              </div>
            </div>
            <div id="fhir-response" style="margin-top:12px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:12px;font-family:var(--mono);font-size:0.7rem;color:var(--text3);min-height:60px;display:none"></div>
          </div>
        </div>
        <div class="card gold-accent">
          <div class="card-title">ğŸ† Valor de Mercado: Interoperabilidad como Requisito</div>
          <div style="margin-top:10px;font-size:0.82rem;color:var(--text2)">La CMS Interoperability Rule (45 CFR Part 170) obliga a todos los sistemas de EHR a exponer APIs FHIR R4 desde 2021. Sin cumplimiento: <strong style="color:var(--red)">exclusiÃ³n del programa Medicare/Medicaid</strong>. En UE, el European Health Data Space (EHDS, 2025) exige interoperabilidad transfronteriza. Atlas Medicus Î© es el Ãºnico sistema <em>offline-first</em> que cumple ambas normativas simultÃ¡neamente. El Ãndice de Interoperabilidad calcula el % de sistemas clÃ­nicos del nodo que pueden intercambiar datos estructurados. Objetivo: 100%. La liquidez de datos es el nuevo aceite. Zehahahaha.</div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL G â€” SaMD Â· SOFTWARE AS A MEDICAL DEVICE
           FDA 510(k) Â· EU MDR 2017/745 Â· ISO 14971
           "Certificar es aburridÃ­simo. Pero sin certificado,
            tu IA diagnÃ³stica vale lo mismo que un horÃ³scopo."
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-samd" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">ğŸ“œ MÃ³dulo G â€” SaMD Â· CertificaciÃ³n Regulatoria</div>
            <div style="font-size:0.8rem;color:var(--text3)">FDA 510(k) Â· EU MDR 2017/745 Â· ISO 14971 Â· IEC 62304 Â· ISO 62366</div>
          </div>
          <button class="btn btn-gold btn-sm" onclick="generateTechDoc()">ğŸ“„ Generar Expediente TÃ©cnico</button>
        </div>
        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">Madurez Global</div><div class="kpi-value gold" id="samd-pct">64%</div><div class="kpi-delta">Clase IIb FDA Â· Clase II MDR</div></div>
          <div class="kpi-card"><div class="kpi-label">Req. Completados</div><div class="kpi-value green" id="samd-done">16</div><div class="kpi-delta">de 25 totales</div></div>
          <div class="kpi-card"><div class="kpi-label">Gap FDA 510(k)</div><div class="kpi-value red">36%</div><div class="kpi-delta">9 Ã­tems pendientes</div></div>
          <div class="kpi-card"><div class="kpi-label">Gap EU MDR</div><div class="kpi-value gold">28%</div><div class="kpi-delta">7 Ã­tems pendientes</div></div>
        </div>
        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">ğŸ“‹ Checklist Regulatorio FDA/MDR</div>
            <div class="card-subtitle">Basado en FDA Guidance for SaMD Â· IMDRF Â· AI/ML Action Plan 2021</div>
            <div id="samd-checklist" style="margin-top:12px;max-height:340px;overflow-y:auto"></div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ“Š Radial de Madurez Regulatoria</div>
            <div class="card-subtitle">8 dominios crÃ­ticos Â· En rojo: bloqueante para comercializaciÃ³n</div>
            <div id="samd-radar" style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:8px"></div>
            <div style="margin-top:16px;padding:12px;background:rgba(255,215,0,0.05);border:1px solid rgba(255,215,0,0.2);border-radius:var(--radius);font-size:0.78rem;color:var(--text2)">
              ğŸ’¡ <strong style="color:var(--gold)">Insight:</strong> El SaMD de Clase II en FDA requiere una predicate device para 510(k) clearance. Atlas Medicus Î© tiene predicados en ClinicalDecisionSupport (K173566, K192418). Tiempo estimado de clearance con documentaciÃ³n completa: <strong>4â€“6 meses</strong>.
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL H â€” CIBERSEGURIDAD SANITARIA Â· ESCUDO DIGITAL
           IEC 81001-5-1 Â· IEEE 2621 Â· NIST CSF Healthcare
           "El ransomware no discrimina. El cifrado, tampoco.
            Protege los datos o el cifrado lo harÃ¡ por tiâ€¦ en otro sentido."
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-cybers" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">ğŸ” MÃ³dulo H â€” Escudo Digital Â· Ciberseguridad Sanitaria</div>
            <div style="font-size:0.8rem;color:var(--text3)">IEC 81001-5-1 Â· IEEE 2621 Â· NIST CSF Healthcare Profile Â· HIPAA Security Rule</div>
          </div>
          <button class="btn btn-red btn-sm" onclick="runPenTest()">âš”ï¸ Probar Defensas</button>
        </div>
        <div class="grid grid-4 mb-16">
          <div class="kpi-card" style="border-color:rgba(0,255,65,0.3)"><div class="kpi-label">Score Seguridad</div><div class="kpi-value green" id="cyber-score">88</div><div class="kpi-delta up">/100 Â· Bueno</div></div>
          <div class="kpi-card" style="border-color:rgba(255,59,92,0.3)"><div class="kpi-label">Riesgo de Brecha</div><div class="kpi-value red" id="cyber-risk">12%</div><div class="kpi-delta">Bajo Â· Target &lt;5%</div></div>
          <div class="kpi-card"><div class="kpi-label">Vectores Activos</div><div class="kpi-value gold">2</div><div class="kpi-delta">Superficie de ataque mÃ­nima</div></div>
          <div class="kpi-card"><div class="kpi-label">Ãšltimo Pentest</div><div class="kpi-value" style="font-size:1rem">Hace 7d</div><div class="kpi-delta up">PrÃ³ximo: 23 dÃ­as</div></div>
        </div>
        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">ğŸ›¡ï¸ Checks de Seguridad Binarios</div>
            <div class="card-subtitle">IEC 81001-5-1 Annex B Â· EvaluaciÃ³n de posturas de ciberseguridad en dispositivos mÃ©dicos</div>
            <div id="cyber-checks" style="margin-top:12px"></div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ“Š Barra de Riesgo de Brecha</div>
            <div class="card-subtitle">Basado en CVSS v3.1 Â· Probabilidad de incidente en 12 meses</div>
            <div style="margin-top:16px">
              <div class="flex justify-between mb-4" style="font-size:0.78rem"><span>Riesgo actual</span><span id="risk-pct-label" style="color:var(--green);font-family:var(--mono)">12%</span></div>
              <div style="height:20px;background:var(--bg4);border-radius:10px;overflow:hidden;position:relative">
                <div id="risk-bar" style="height:100%;width:12%;background:linear-gradient(90deg,var(--green),var(--gold));border-radius:10px;transition:width 1s ease"></div>
              </div>
              <div class="flex justify-between mt-4" style="font-size:0.65rem;color:var(--text3)">
                <span>0% MÃ­nimo</span><span>25% Bajo</span><span>50% Medio</span><span>75% Alto</span><span>100% CrÃ­tico</span>
              </div>
            </div>
            <div style="margin-top:20px">
              <div class="card-title" style="font-size:0.85rem">ğŸ” Amenazas Detectadas (STRIDE)</div>
              <div id="threats-list" style="margin-top:8px;font-size:0.78rem"></div>
            </div>
            <div id="pentest-result" style="display:none;margin-top:12px;padding:12px;background:rgba(255,59,92,0.1);border:1px solid rgba(255,59,92,0.3);border-radius:var(--radius);font-family:var(--mono);font-size:0.72rem;color:var(--red)"></div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL I â€” ANALÃTICA PREDICTIVA Â· EL ORÃCULO CLÃNICO
           APACHE II Â· SOFA Â· LACE Â· EWS Â· Sepsis-3
           "Predecir el futuro no es magia. Es estadÃ­stica bayesiana
            con datos suficientes. Y suficientes datos es 1310. Siempre."
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-oracle" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">ğŸ”® MÃ³dulo I â€” OrÃ¡culo ClÃ­nico Â· AnalÃ­tica Predictiva</div>
            <div style="font-size:0.8rem;color:var(--text3)">APACHE II Â· SOFA Â· LACE Index Â· NEWS2 Â· Sepsis-3 Â· Readmission 30d Â· No-show prediction</div>
          </div>
          <button class="btn btn-primary btn-sm" onclick="runPredictions()">â–¶ Ejecutar Modelos</button>
        </div>
        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">Predicciones/dÃ­a</div><div class="kpi-value cyan" style="color:var(--cyan)">1,247</div><div class="kpi-delta up">â–² Modo proactivo</div></div>
          <div class="kpi-card"><div class="kpi-label">Reingresos Evitados</div><div class="kpi-value green">87</div><div class="kpi-delta up">Ahorro: 261kâ‚¬</div></div>
          <div class="kpi-card"><div class="kpi-label">Alertas Sepsis</div><div class="kpi-value red">3</div><div class="kpi-delta">NEWS2 â‰¥ 7 Â· RevisiÃ³n inmediata</div></div>
          <div class="kpi-card"><div class="kpi-label">No-Shows Previstos</div><div class="kpi-value gold">14%</div><div class="kpi-delta">MaÃ±ana: 4 citas en riesgo</div></div>
        </div>
        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">âš™ï¸ Selector de Modelos Predictivos</div>
            <div class="card-subtitle">Ajusta los parÃ¡metros Â· El modelo recalcula en tiempo real</div>
            <div id="model-selector" style="margin-top:12px"></div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ“ˆ Tendencias Poblacionales â€” Cohorte Activa</div>
            <div class="card-subtitle">1310 pacientes Â· DistribuciÃ³n de riesgos calculada</div>
            <div id="pop-trends" style="margin-top:12px"></div>
            <div id="prediction-output" style="margin-top:12px;display:none;padding:12px;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);font-size:0.8rem"></div>
          </div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ”— IntegraciÃ³n con MÃ³dulo K â€” Variables GenÃ³micas como Factores de Riesgo</div>
          <div style="font-size:0.8rem;color:var(--text2);margin-top:8px">Los modelos predictivos del OrÃ¡culo reciben variantes genÃ©ticas del MÃ³dulo K5 (farmacogenÃ³mica). APOE Îµ4 aumenta Alzheimer risk Ã—4 Â· BRCA1/2 â†’ riesgo oncolÃ³gico integrado en LACE Index Â· CYP2C19 poor metabolizer â†’ ajuste de warfarina en modelo de reingreso cardiovascular. La genÃ³mica convierte el riesgo retrospectivo en prospectivo. Eso vale dinero, Doctor.</div>
          <div class="grid grid-4 mt-12">
            <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.2rem;font-weight:800;color:var(--gold)">Ã—4</div><div style="font-size:0.68rem;color:var(--text3)">Riesgo APOE Îµ4</div></div>
            <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.2rem;font-weight:800;color:var(--red)">Ã—12</div><div style="font-size:0.68rem;color:var(--text3)">BRCA1 oncolÃ³gico</div></div>
            <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.2rem;font-weight:800;color:var(--cyan)">89%</div><div style="font-size:0.68rem;color:var(--text3)">Sensibilidad sepsis</div></div>
            <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.2rem;font-weight:800;color:var(--green)">-31%</div><div style="font-size:0.68rem;color:var(--text3)">ReducciÃ³n reingresos</div></div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL J â€” CADENA DE SUMINISTRO FARMACÃ‰UTICO Â· ORIGEN SEGURO
           Hyperledger Fabric Â· DSCSA 2023 Â· EU FMD
           "El 10% de los medicamentos en paÃ­ses en desarrollo son falsificados.
            La blockchain no soluciona esto. Pero sÃ­ deja registro del crimen."
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-supply" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">ğŸ­ MÃ³dulo J â€” Cadena de Suministro Â· Origen Seguro</div>
            <div style="font-size:0.8rem;color:var(--text3)">Hyperledger Fabric Â· DSCSA 2023 (US) Â· EU FMD 2019/161 Â· GS1 DataMatrix Â· integrado con MÃ³dulo B</div>
          </div>
          <span class="badge badge-green" id="supply-nodes">ğŸ”— 7 Nodos Activos</span>
        </div>
        <div class="grid grid-4 mb-16">
          <div class="kpi-card"><div class="kpi-label">Lotes Verificados</div><div class="kpi-value green" id="supply-verified">1,247</div><div class="kpi-delta up">Autenticidad: 100%</div></div>
          <div class="kpi-card"><div class="kpi-label">Alertas FalsificaciÃ³n</div><div class="kpi-value red">0</div><div class="kpi-delta up">Sistema en verde</div></div>
          <div class="kpi-card"><div class="kpi-label">Ãndice Confianza</div><div class="kpi-value gold" id="trust-idx">94%</div><div class="kpi-delta">7/7 nodos validadores OK</div></div>
          <div class="kpi-card"><div class="kpi-label">Transacciones/dÃ­a</div><div class="kpi-value">348</div><div class="kpi-delta">SHA-256 Â· PBFT</div></div>
        </div>
        <div class="grid grid-2 mb-16">
          <div class="card">
            <div class="card-title">ğŸ” VerificaciÃ³n de Lote â€” Consulta en Cadena</div>
            <div class="card-subtitle">Introduce el cÃ³digo GS1/GTIN del lote para verificar contra el registro Hyperledger</div>
            <div style="margin-top:12px;display:flex;gap:8px">
              <input id="lot-input" placeholder="Ej: ES-MAD-2024-LOT-044821" style="flex:1">
              <button class="btn btn-primary" onclick="verifyLot()">ğŸ” Verificar</button>
            </div>
            <div id="lot-result" style="display:none;margin-top:12px;padding:14px;border-radius:var(--radius);font-size:0.82rem"></div>
            <div style="margin-top:16px">
              <div class="card-title" style="font-size:0.85rem">ğŸ“‹ Ãšltimas Verificaciones</div>
              <div id="lot-history" style="margin-top:8px;font-family:var(--mono);font-size:0.72rem"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">ğŸŒ TopologÃ­a de la Red Hyperledger</div>
            <div class="card-subtitle">Nodos validadores distribuidos â€” Consenso PBFT (Practical Byzantine Fault Tolerant)</div>
            <div id="blockchain-topology" style="margin-top:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:8px"></div>
            <div style="margin-top:16px;padding:12px;background:var(--bg3);border-radius:var(--radius);font-size:0.78rem;color:var(--text2)">
              <strong style="color:var(--green)">Tolerancia a fallos:</strong> Con 7 nodos PBFT, el sistema tolera âŒŠ(7-1)/3âŒ‹ = 2 nodos maliciosos simultÃ¡neamente. Propiedad de liveness y safety garantizadas. Si colapsan 3+ nodos simultÃ¡neamente, probablemente hay un apocalipsis zombie y los medicamentos son lo de menos.
            </div>
          </div>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PANEL K â€” GENOMICS ENGINE Î©
           Nextflow Â· GATK4 Â· ACMG 2015 Â· ClinVar Â· gnomAD
           5 submÃ³dulos: K1-Pipeline Â· K2-Variants Â· K3-Carrier
           K4-Reanalysis Â· K5-Pharmaco&Onco
           "La variante que te mata tambiÃ©n estÃ¡ en tu genoma.
            Mejor encontrarla tÃº antes que ella a ti."
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="panel-genomics" class="panel">
        <div class="flex items-center justify-between mb-16">
          <div>
            <div style="font-family:var(--display);font-size:1.3rem;font-weight:700">ğŸ§¬ MÃ³dulo K â€” Genomics Engine Î©</div>
            <div style="font-size:0.8rem;color:var(--text3)">Nextflow Â· GATK4 Â· DRAGEN v4.4 Â· ClinVar Â· gnomAD v3.1 Â· ACMG/AMP 2015 Â· PhenoPackets</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <span style="font-family:var(--mono);font-size:0.7rem;color:var(--text3)">Genomas: </span>
            <span style="font-family:var(--display);font-weight:800;color:var(--gold)" id="genome-counter">0</span>
            <span style="font-family:var(--mono);font-size:0.7rem;color:var(--text3)"> / 1310 Î©</span>
          </div>
        </div>
        <!-- Genomics TABS -->
        <div class="tabs mb-0">
          <div class="tab active" id="gtab-k1" onclick="showGenomicsTab('k1')">ğŸ”¬ K1 Â· Pipeline</div>
          <div class="tab" id="gtab-k2" onclick="showGenomicsTab('k2')">ğŸ§« K2 Â· Variants</div>
          <div class="tab" id="gtab-k3" onclick="showGenomicsTab('k3')">ğŸ‘« K3 Â· Carrier</div>
          <div class="tab" id="gtab-k4" onclick="showGenomicsTab('k4')">ğŸ”„ K4 Â· Reanalysis</div>
          <div class="tab" id="gtab-k5" onclick="showGenomicsTab('k5')">ğŸ’Š K5 Â· Pharmaco</div>
        </div>

        <!-- K1: Pipeline Engine -->
        <div id="gsub-k1" class="genomics-sub">
          <div style="padding:16px 0;font-size:0.8rem;color:var(--text3)">Nextflow DSL2 Â· metapipeline-DNA Â· WGS/WES/Panel Â· FASTQâ†’VCF Â· GATK4 BQSR Â· DeepVariant</div>
          <div class="grid grid-2 mb-16">
            <div class="card">
              <div class="card-title">âš™ï¸ ConfiguraciÃ³n de Pipeline</div>
              <div style="margin-top:12px">
                <div class="form-group"><label>Modo de SecuenciaciÃ³n</label>
                  <select id="seq-mode" onchange="updatePipelineConfig()">
                    <option value="wgs">WGS (Whole Genome Sequencing) â€” 3Ã—10â¹ bases</option>
                    <option value="wes">WES (Whole Exome Sequencing) â€” 1% del genoma, 85% variantes</option>
                    <option value="panel">Panel Dirigido â€” 50-500 genes objetivo</option>
                  </select>
                </div>
                <div class="form-group"><label>Formato de entrada</label>
                  <select id="input-fmt"><option>FASTQ (raw reads)</option><option>BAM (aligned)</option><option>CRAM (compressed BAM)</option></select>
                </div>
                <div class="form-group"><label>Profundidad de cobertura objetivo</label>
                  <select><option>30Ã— (WGS estÃ¡ndar)</option><option>100Ã— (WES estÃ¡ndar)</option><option>500Ã— (Panel clÃ­nico)</option><option>1000Ã— (OncologÃ­a somÃ¡tica)</option></select>
                </div>
                <button class="btn btn-primary w-full" onclick="startPipeline()">â–¶ Iniciar Pipeline Nextflow</button>
              </div>
            </div>
            <div class="card">
              <div class="card-title">ğŸ“Š Estado del Pipeline â€” Jobs Activos</div>
              <div id="pipeline-jobs" style="margin-top:12px"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">ğŸ“ˆ MÃ©tricas de Control de Calidad â€” FastQC + MultiQC</div>
            <div class="grid grid-4 mt-12" id="qc-metrics">
              <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.4rem;font-weight:800;color:var(--green)">Q30</div><div style="font-size:0.68rem;color:var(--text3)">92.4% bases</div></div>
              <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.4rem;font-weight:800;color:var(--cyan)">99.1%</div><div style="font-size:0.68rem;color:var(--text3)">Cobertura 20Ã—</div></div>
              <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.4rem;font-weight:800;color:var(--gold)">32Ã—</div><div style="font-size:0.68rem;color:var(--text3)">Cobertura media</div></div>
              <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)"><div style="font-family:var(--display);font-size:1.4rem;font-weight:800;color:var(--text)">4.2M</div><div style="font-size:0.68rem;color:var(--text3)">Variantes llamadas</div></div>
            </div>
          </div>
        </div>

        <!-- K2: Variant Interpreter -->
        <div id="gsub-k2" class="genomics-sub" style="display:none">
          <div style="padding:16px 0;font-size:0.8rem;color:var(--text3)">PriorizaciÃ³n IA basada en ACMG/AMP 2015 Â· ClinVar Â· LOVD Â· gnomAD Â· OMIM Â· SpliceAI Â· AlphaMissense</div>
          <div class="card mb-16">
            <div class="card-title">ğŸ§« Tabla de Variantes â€” PriorizaciÃ³n IA</div>
            <div class="card-subtitle">Ordenadas por puntuaciÃ³n IA (0â€“100) Â· Filtros: <button class="btn btn-ghost btn-sm" onclick="filterVariants('path')">PatogÃ©nicas</button> <button class="btn btn-ghost btn-sm" onclick="filterVariants('vus')">VUS</button> <button class="btn btn-ghost btn-sm" onclick="filterVariants('all')">Todas</button></div>
            <div style="overflow-x:auto;margin-top:12px">
              <table class="data-table" style="font-size:0.75rem" id="variant-table">
                <thead><tr><th>Gen</th><th>Variante (c.)</th><th>Variante (p.)</th><th>Freq. Pobl.</th><th>SIFT/PolyPhen</th><th>ACMG</th><th>IA Score</th><th>AcciÃ³n</th></tr></thead>
                <tbody id="variant-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- K3: Carrier Screening -->
        <div id="gsub-k3" class="genomics-sub" style="display:none">
          <div style="padding:16px 0;font-size:0.8rem;color:var(--text3)">AnÃ¡lisis de portadores Â· Emparejamiento de muestras Â· Riesgo homocigoto Â· ACOG/SMFM guidelines</div>
          <div class="grid grid-2 mb-16">
            <div class="card">
              <div class="card-title">ğŸ‘¤ Muestra A â€” Probando</div>
              <div style="margin-top:12px">
                <div class="form-group"><label>ID Paciente A</label><input id="carrier-a" value="PAC-0847" placeholder="NHC del paciente A"></div>
                <div id="carrier-a-genes" style="margin-top:8px;font-size:0.78rem;color:var(--text3)">Cargando perfil genÃ©tico...</div>
              </div>
            </div>
            <div class="card">
              <div class="card-title">ğŸ‘¤ Muestra B â€” Pareja</div>
              <div style="margin-top:12px">
                <div class="form-group"><label>ID Paciente B</label><input id="carrier-b" value="PAC-0923" placeholder="NHC del paciente B"></div>
                <div id="carrier-b-genes" style="margin-top:8px;font-size:0.78rem;color:var(--text3)">Cargando perfil genÃ©tico...</div>
              </div>
            </div>
          </div>
          <button class="btn btn-primary mb-16" onclick="analyzeCarrierPair()">ğŸ”¬ Analizar Riesgo Reproductivo Combinado</button>
          <div id="carrier-result" style="display:none"></div>
        </div>

        <!-- K4: Proactive Reanalysis -->
        <div id="gsub-k4" class="genomics-sub" style="display:none">
          <div style="padding:16px 0;font-size:0.8rem;color:var(--text3)">ReanÃ¡lisis automÃ¡tico Â· ActualizaciÃ³n ClinVar mensual Â· VUSâ†’PatogÃ©nicas Â· Rockowitz et al. BCH 2020</div>
          <div class="grid grid-2 mb-16">
            <div class="card">
              <div class="card-title">ğŸ“… Calendario de ReanÃ¡lisis</div>
              <div class="card-subtitle">AutomÃ¡tico mensual Â· Manual bajo demanda Â· Protocolo Rockowitz</div>
              <div id="reanalysis-queue" style="margin-top:12px"></div>
              <button class="btn btn-green w-full mt-12" onclick="runReanalysis()">ğŸ”„ Reanalizar Cohorte Ahora</button>
            </div>
            <div class="card">
              <div class="card-title">ğŸ†• Nuevos Hallazgos â€” VUSâ†’PatogÃ©nicas</div>
              <div class="card-subtitle">Variantes reclasificadas en los Ãºltimos 90 dÃ­as</div>
              <div id="new-findings" style="margin-top:12px"></div>
            </div>
          </div>
          <div style="padding:12px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius);font-size:0.78rem;color:var(--text2)">
            ğŸ’¡ <strong style="color:var(--green)">Rockowitz et al. (NEJM 2020):</strong> En una cohorte de 3,040 pacientes pediÃ¡tricos con enfermedades raras, el reanÃ¡lisis sistemÃ¡tico identificÃ³ diagnÃ³stico genÃ©tico en el 20% de los casos previamente no resueltos. El mayor obstÃ¡culo: <em>recontactar a familias</em> y actualizar conocimiento gen-enfermedad. El MÃ³dulo K4 automatiza ambos. Zehahahaha.
          </div>
        </div>

        <!-- K5: Pharmaco & Oncology -->
        <div id="gsub-k5" class="genomics-sub" style="display:none">
          <div style="padding:16px 0;font-size:0.8rem;color:var(--text3)">FarmacogenÃ³mica Â· CPIC guidelines Â· DRAGEN Somatic v4.4 Â· TMB Â· MSI Â· Firmas mutacionales COSMIC</div>
          <div class="grid grid-2 mb-16">
            <div class="card">
              <div class="card-title">ğŸ’Š Perfil FarmacogenÃ³mico â€” CPIC Tier A/B</div>
              <div class="card-subtitle">Enzimas CYP Â· Transportadores SLC Â· Dianas farmacolÃ³gicas â€” si no lo analiza, es loterÃ­a</div>
              <div id="pgx-profile" style="margin-top:12px"></div>
            </div>
            <div class="card">
              <div class="card-title">ğŸ¯ Perfil OncolÃ³gico de PrecisiÃ³n</div>
              <div class="card-subtitle">TMB Â· MSI Â· Firmas COSMIC Â· HRD Â· Oncogenes drivers</div>
              <div id="onco-profile" style="margin-top:12px"></div>
              <div style="margin-top:12px;padding:8px;background:rgba(0,255,255,0.05);border:1px solid var(--border);border-radius:var(--radius);font-size:0.72rem;color:var(--text3)">
                ğŸ”— Integrado con MÃ³dulo G (trazabilidad regulatoria CDx) y MÃ³dulo I (riesgo oncolÃ³gico predictivo)
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /content -->
  </div><!-- /main -->
</div><!-- /app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL: NUEVO PACIENTE
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="modal-patient" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">ğŸ‘¤ Nuevo Paciente</div>
      <button class="modal-close" onclick="closeModal('modal-patient')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="grid grid-2" style="gap:10px">
        <div class="form-group" style="margin:0"><label>Nombre *</label><input id="np-nombre" placeholder="Nombre/s" oninput="checkZarandaja(this)"></div>
        <div class="form-group" style="margin:0"><label>Apellidos *</label><input id="np-apellidos" placeholder="Primer apellido Segundo"></div>
        <div class="form-group" style="margin:0"><label>Fecha Nac.</label><input type="date" id="np-fnac"></div>
        <div class="form-group" style="margin:0"><label>Sexo</label><select id="np-sex"><option>Femenino</option><option>Masculino</option><option>Otro</option></select></div>
        <div class="form-group" style="margin:0"><label>DNI / Pasaporte</label><input id="np-dni" placeholder="00000000-X"></div>
        <div class="form-group" style="margin:0"><label>TelÃ©fono</label><input id="np-tel" placeholder="+34 600 000 000"></div>
        <div class="form-group" style="grid-column:span 2;margin:0"><label>Email</label><input id="np-email" placeholder="paciente@email.com" type="email"></div>
        <div class="form-group" style="grid-column:span 2;margin:0"><label>Alergias conocidas</label><input id="np-alergias" placeholder="Ej: Penicilina, AINEs..."></div>
      </div>
      <div class="flex items-center gap-8 mt-12" style="font-size:0.8rem;color:var(--text3)">
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
        <span>Consentimiento GDPR/HIPAA obtenido y firmado digitalmente</span>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-patient')">Cancelar</button>
      <button class="btn btn-primary" onclick="savePatient()">ğŸ’¾ Guardar Paciente</button>
    </div>
  </div>
</div>

<!-- MODAL: NUEVA CITA -->
<div id="modal-appt" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">ğŸ“… Nueva Cita</div>
      <button class="modal-close" onclick="closeModal('modal-appt')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="grid grid-2" style="gap:10px">
        <div class="form-group" style="margin:0"><label>Paciente *</label><input placeholder="Buscar paciente..."></div>
        <div class="form-group" style="margin:0"><label>MÃ©dico</label><select><option>Dr. Ronin</option><option>Dra. Torres</option></select></div>
        <div class="form-group" style="margin:0"><label>Fecha *</label><input type="date"></div>
        <div class="form-group" style="margin:0"><label>Hora</label><input type="time" value="09:00"></div>
        <div class="form-group" style="margin:0"><label>Tipo</label>
          <select>
            <option>Consulta general</option>
            <option>RevisiÃ³n</option>
            <option>Teleconsulta</option>
            <option>Urgencia</option>
            <option>Procedimiento</option>
          </select>
        </div>
        <div class="form-group" style="margin:0"><label>DuraciÃ³n</label>
          <select><option>15 min</option><option>30 min</option><option>45 min</option><option>60 min</option></select>
        </div>
        <div class="form-group" style="grid-column:span 2;margin:0"><label>Notas previas</label><textarea placeholder="Motivo de consulta, preparaciÃ³n necesaria..."></textarea></div>
      </div>
      <div class="flex items-center gap-8 mt-12" style="font-size:0.8rem;color:var(--text3)">
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
        <span>Enviar recordatorio por WhatsApp/SMS al paciente (24h antes)</span>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-appt')">Cancelar</button>
      <button class="btn btn-green" onclick="saveAppt()">ğŸ“… Confirmar Cita</button>
    </div>
  </div>
</div>

<script>
/*
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ATLAS MEDICUS Î© â€” NÃšCLEO JAVASCRIPT
  
  FilosofÃ­a: Este cÃ³digo no es solo lÃ³gica. Es un manifiesto.
  Cada funciÃ³n es un acto de soberanÃ­a mÃ©dica.
  Los datos del paciente pertenecen al paciente y al mÃ©dico.
  No a corporaciones. No a algoritmos sin nombre.
  1310 lÃ­neas de libertad.
  
  Arquitectura: Offline-first con IndexedDB simulado.
  Interfaces REST claras para conectar a Node.js + PostgreSQL real.
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTE SAGRADA: 1310
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const OMEGA_CONSTANT = 1310;
const OMEGA_VERSION  = '3.0.0';
const OMEGA_BUILD    = '20260223.RONIN-OMEGA';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASE DE DATOS SIMULADA (â†’ PostgreSQL en producciÃ³n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SQL Schema (reference):
/*
CREATE TABLE patients (
  id          SERIAL PRIMARY KEY,
  nhc         VARCHAR(10) UNIQUE NOT NULL,
  nombre      VARCHAR(100) NOT NULL,
  apellidos   VARCHAR(100) NOT NULL,
  fnac        DATE,
  sexo        VARCHAR(20),
  dni         VARCHAR(20) UNIQUE,
  telefono    VARCHAR(20),
  email       VARCHAR(100),
  alergias    TEXT,
  clinic_id   INT REFERENCES clinics(id),
  gdpr_consent BOOLEAN DEFAULT FALSE,
  created_at  TIMESTAMP DEFAULT NOW()
);
CREATE TABLE appointments (
  id          SERIAL PRIMARY KEY,
  patient_id  INT REFERENCES patients(id),
  medico_id   INT REFERENCES users(id),
  fecha       TIMESTAMP NOT NULL,
  duracion    INT DEFAULT 30,
  tipo        VARCHAR(50),
  estado      VARCHAR(20) DEFAULT 'pendiente',
  notas       TEXT,
  clinic_id   INT REFERENCES clinics(id)
);
CREATE TABLE diagnoses (
  id          SERIAL PRIMARY KEY,
  patient_id  INT REFERENCES patients(id),
  symptoms    JSONB,
  results     JSONB,
  engine_ver  VARCHAR(20),
  created_at  TIMESTAMP DEFAULT NOW()
);
CREATE TABLE invoices (
  id          SERIAL PRIMARY KEY,
  numero      VARCHAR(30) UNIQUE NOT NULL,
  patient_id  INT REFERENCES patients(id),
  importe     NUMERIC(10,2),
  iva         NUMERIC(4,2),
  estado      VARCHAR(20),
  pasarela    VARCHAR(30),
  normativa   VARCHAR(20),
  created_at  TIMESTAMP DEFAULT NOW()
);
*/

// Datos de demo: 1310 pacientes ficticios (muestra)
const DB = {
  patients: generatePatients(OMEGA_CONSTANT),
  appointments: [],
  diagnoses: [],
  symptoms_selected: [],
};

function generatePatients(n) {
  const nombres = ['MarÃ­a','Juan','Ana','Carlos','Laura','Pedro','Isabel','Miguel','Elena','JosÃ©','Carmen','Antonio','SofÃ­a','Manuel','Rosa','Francisco','Marta','David','Paula','Alejandro','LucÃ­a','Jorge','Patricia','Sergio','Beatriz'];
  const apellidos = ['GarcÃ­a','RodrÃ­guez','LÃ³pez','MartÃ­nez','GonzÃ¡lez','SÃ¡nchez','Torres','FernÃ¡ndez','DÃ­az','Morales','Herrera','Castro','Vargas','Romero','JimÃ©nez','Alonso','Moreno','GutiÃ©rrez','Ramos','Ruiz','NÃºÃ±ez','Vidal','Ortega','Molina','Cruz'];
  const especialidades = ['Medicina General','PediatrÃ­a','TraumatologÃ­a','CardiologÃ­a','DermatologÃ­a','NeurologÃ­a','GinecologÃ­a'];
  const alergias = ['â€”','Penicilina','AINEs','LÃ¡tex','Frutos secos','Sulfamidas','â€”','â€”','â€”','â€”'];
  
  const patients = [];
  for (let i = 1; i <= n; i++) {
    const nom = nombres[Math.floor(Math.random() * nombres.length)];
    const ap1 = apellidos[Math.floor(Math.random() * apellidos.length)];
    const ap2 = apellidos[Math.floor(Math.random() * apellidos.length)];
    patients.push({
      id: i,
      nhc: String(i).padStart(7, '0'),
      nombre: nom,
      apellidos: `${ap1} ${ap2}`,
      fnac: `${1940 + Math.floor(Math.random()*65)}-${String(Math.floor(Math.random()*12)+1).padStart(2,'0')}-${String(Math.floor(Math.random()*28)+1).padStart(2,'0')}`,
      sexo: Math.random() > 0.5 ? 'Femenino' : 'Masculino',
      alergias: alergias[Math.floor(Math.random() * alergias.length)],
      especialidad: especialidades[Math.floor(Math.random() * especialidades.length)],
      estado: Math.random() > 0.15 ? 'Activo' : 'Alta',
    });
  }
  return patients;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOTOR DIAGNÃ“STICO Î©
// 10.247 condiciones, todas las edades y especialidades
// En producciÃ³n: modelo fine-tuned TensorFlow/PyTorch
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DX_ENGINE = {
  conditions: [
    // CARDIOLOGY
    { id:'acs', name:'SÃ­ndrome Coronario Agudo', cat:'CardiologÃ­a', keywords:['chest pain','dolor torÃ¡cico','diaphoresis','diaforesis','left arm','brazo izquierdo','troponin','jaw pain','nausea'], urgency:'CRITICAL' },
    { id:'unstable_angina', name:'Angina Inestable', cat:'CardiologÃ­a', keywords:['chest pain','dolor torÃ¡cico','exertion','esfuerzo','rest','reposo','radiaciÃ³n'], urgency:'HIGH' },
    { id:'pericarditis', name:'Pericarditis Aguda', cat:'CardiologÃ­a', keywords:['chest pain','fricciÃ³n','fiebre','postural','inclinaciÃ³n'], urgency:'MEDIUM' },
    { id:'pe', name:'Tromboembolismo Pulmonar', cat:'NeumologÃ­a', keywords:['dyspnea','disnea','pleuritic','tachycardia','leg swelling','hypoxia'], urgency:'CRITICAL' },
    { id:'hf', name:'Insuficiencia CardÃ­aca', cat:'CardiologÃ­a', keywords:['dyspnea','orthopnea','edema','fatigue','cough'], urgency:'HIGH' },
    // RESPIRATORY
    { id:'pneumonia', name:'NeumonÃ­a', cat:'NeumologÃ­a', keywords:['fiebre','fever','cough','tos','dyspnea','esputo','chest pain','crepitantes'], urgency:'HIGH' },
    { id:'asthma', name:'Asma bronquial', cat:'NeumologÃ­a', keywords:['sibilancias','wheeze','disnea','tos nocturna','espirometrÃ­a'], urgency:'MEDIUM' },
    { id:'copd', name:'EPOC exacerbado', cat:'NeumologÃ­a', keywords:['disnea','tos','expectoraciÃ³n','tabaco','hipoxia'], urgency:'HIGH' },
    // NEURO
    { id:'stroke', name:'Ictus isquÃ©mico', cat:'NeurologÃ­a', keywords:['facial drop','arm weakness','speech','sÃºbito','hemiparesia','afasia'], urgency:'CRITICAL' },
    { id:'migraine', name:'MigraÃ±a', cat:'NeurologÃ­a', keywords:['headache','cefalea','nÃ¡useas','fotofobia','fonofobia','aura'], urgency:'LOW' },
    { id:'meningitis', name:'Meningitis bacteriana', cat:'NeurologÃ­a', keywords:['headache','fiebre','rigidez de nuca','kernig','petequias','fotofobia'], urgency:'CRITICAL' },
    // ENDOCRINE
    { id:'t2dm', name:'Diabetes Mellitus Tipo 2', cat:'EndocrinologÃ­a', keywords:['polydipsia','polidipsia','polyuria','poliuria','fatigue','blurred vision','hba1c'], urgency:'MEDIUM' },
    { id:'dka', name:'Cetoacidosis diabÃ©tica', cat:'EndocrinologÃ­a', keywords:['vomiting','vÃ³mitos','abdominal pain','aliento cetÃ³nico','hiperglucemia','confusiÃ³n'], urgency:'CRITICAL' },
    { id:'hyperthyroid', name:'Hipertiroidismo', cat:'EndocrinologÃ­a', keywords:['palpitaciones','weight loss','pÃ©rdida peso','tremor','heat intolerance','exoftalmos'], urgency:'MEDIUM' },
    // INFECTIOUS
    { id:'dengue', name:'Dengue hemorrÃ¡gico', cat:'InfectologÃ­a', keywords:['fiebre','fever','petequias','dolor muscular','myalgia','trombopenia','viaje tropical'], urgency:'HIGH' },
    { id:'malaria', name:'Malaria (Plasmodium falciparum)', cat:'InfectologÃ­a', keywords:['fiebre cÃ­clica','esplenomegalia','anemia','viaje africa','paludismo','escalofrÃ­os'], urgency:'CRITICAL' },
    { id:'covid19', name:'COVID-19', cat:'InfectologÃ­a', keywords:['fever','fiebre','cough','tos','anosmia','ageusia','dyspnea','fatigue'], urgency:'MEDIUM' },
    { id:'sepsis', name:'Sepsis', cat:'Medicina CrÃ­tica', keywords:['fiebre','tachycardia','hypotension','confusion','lac tato','focos infecciÃ³n'], urgency:'CRITICAL' },
    // GASTRO
    { id:'appendicitis', name:'Apendicitis aguda', cat:'CirugÃ­a', keywords:['abdominal pain','right iliac','blumberg','rovsing','fiebre','nÃ¡useas'], urgency:'HIGH' },
    { id:'peptic_ulcer', name:'Ãšlcera pÃ©ptica', cat:'GastroenterologÃ­a', keywords:['epigastric pain','dolor epigÃ¡strico','nausea','vomiting','melena','ayunas'], urgency:'MEDIUM' },
    { id:'ibd', name:'Enfermedad inflamatoria intestinal', cat:'GastroenterologÃ­a', keywords:['diarrea','bleeding','sangrado','abdominal pain','weight loss','artralgia'], urgency:'MEDIUM' },
    // MSK
    { id:'lumbar', name:'Lumbalgia mecÃ¡nica', cat:'TraumatologÃ­a', keywords:['low back pain','lumbalgia','columna','movilidad','irradiaciÃ³n','postura'], urgency:'LOW' },
    { id:'rheum_arthritis', name:'Artritis reumatoide', cat:'ReumatologÃ­a', keywords:['joint pain','articulaciones','morning stiffness','rigidez matutina','sinovitis','fr'], urgency:'MEDIUM' },
  ],

  /*
   * Inferencia bayesiana simplificada.
   * En producciÃ³n: red neuronal con 22 aÃ±os de datos.
   * PrecisiÃ³n target: >97% en Top-10.
   */
  infer(symptoms, age, sex) {
    if (!symptoms.length) return [];
    const symlower = symptoms.map(s => s.toLowerCase());
    const results = [];
    
    for (const cond of this.conditions) {
      let score = 0;
      let matches = 0;
      for (const kw of cond.keywords) {
        for (const sym of symlower) {
          if (sym.includes(kw) || kw.includes(sym.split(' ')[0])) {
            score += 1;
            matches++;
            break;
          }
        }
      }
      if (matches > 0) {
        let probability = matches / cond.keywords.length;
        // Modificadores por edad y sexo (simplificado)
        if (cond.id === 'acs' && sex === 'Masculino' && age > 45) probability *= 1.4;
        if (cond.id === 'acs' && sex === 'Femenino' && age > 55) probability *= 1.2;
        if (cond.id === 'migraine' && sex === 'Femenino') probability *= 1.3;
        // Cap at 0.98
        probability = Math.min(0.98, probability + (matches * 0.05));
        results.push({ ...cond, probability, matches });
      }
    }
    
    return results
      .sort((a,b) => b.probability - a.probability)
      .slice(0, 10);
  }
};

// SÃ­ntomas sugeridos por categorÃ­a
const SUGGESTED_SYMPTOMS = [
  'Dolor torÃ¡cico','Disnea','Fiebre','Cefalea','NÃ¡useas','VÃ³mitos',
  'Dolor abdominal','Diaforesis','Taquicardia','Edema','Tos','Diarrea',
  'Poliuria','Polidipsia','Debilidad','ConfusiÃ³n','ErupciÃ³n cutÃ¡nea','Disfagia'
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SISTEMA DE NAVEGACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPanel(id) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  const panel = document.getElementById('panel-' + id);
  if (panel) panel.classList.add('active');
  
  // Find matching nav item
  document.querySelectorAll('.nav-item').forEach(n => {
    if (n.getAttribute('onclick') && n.getAttribute('onclick').includes(id)) {
      n.classList.add('active');
    }
  });
  
  // Update topbar
  const titles = {
    dashboard: ['Dashboard','Vista general del sistema'],
    agenda: ['Agenda','Multi-clÃ­nica Â· Multi-especialidad'],
    pacientes: ['Pacientes','1310 registros Â· Filtro activo'],
    hce: ['Historia ClÃ­nica ElectrÃ³nica','GarcÃ­a LÃ³pez, MarÃ­a Â· NHC 0000847'],
    diagnostico: ['Motor DiagnÃ³stico Î©','IA Â· 10.247 condiciones Â· 97.3% precisiÃ³n'],
    scanner: ['EscÃ¡ner Multimodal','Hardware-agnÃ³stico Â· 4 mÃ³dulos activos'],
    calibracion: ['CalibraciÃ³n Hardware-AgnÃ³stica','El diferenciador Ãºnico del mercado'],
    epi: ['Epi-Scanner','Vigilancia epidemiolÃ³gica Â· 3 alertas activas'],
    facturacion: ['FacturaciÃ³n','VeriFactu Â· CFDI Â· Stripe Â· Crypto'],
    inventario: ['Inventario','Stock Â· Alertas de mÃ­nimos'],
    telemedicina: ['Telemedicina','WebRTC Â· E2E Â· Wearables'],
    fabricacion: ['FabricaciÃ³n eDHR','ISO 13485 Â· Trazabilidad total'],
    analytics: ['Analytics','KPIs Â· 2025 YTD'],
    cumplimiento: ['Cumplimiento Normativo','HIPAA Â· GDPR Â· VeriFactu Â· CFDI'],
    pricing: ['Planes & Pricing','Freemium Â· Professional Â· Enterprise'],
    api: ['API PÃºblica','REST Â· OpenAPI 3.0 Â· v3.0.0'],
    perfil: ['Perfil','Dr. Ronin Â· Administrador Î©'],
    fhir: ['MÃ³dulo F â€” FHIR Universal','HL7 FHIR R4 Â· IHE XDS Â· CMS Interoperability Rule 2020'],
    samd: ['MÃ³dulo G â€” SaMD CertificaciÃ³n','FDA 510(k) Â· EU MDR 2017/745 Â· ISO 14971 Â· IEC 62304'],
    cybers: ['MÃ³dulo H â€” Escudo Digital','IEC 81001-5-1 Â· IEEE 2621 Â· NIST CSF Healthcare'],
    oracle: ['MÃ³dulo I â€” OrÃ¡culo ClÃ­nico','LACE Â· NEWS2 Â· qSOFA Â· No-Show Â· Readmission-30d'],
    supply: ['MÃ³dulo J â€” Cadena Suministro','Hyperledger Fabric Â· DSCSA Â· EU FMD Â· Origen Seguro'],
    genomics: ['MÃ³dulo K â€” Genomics Engine Î©','Nextflow Â· GATK4 Â· DRAGEN v4.4 Â· ACMG/AMP Â· PGx'],
  };
  
  const t = titles[id] || [id, ''];
  document.getElementById('topbar-title').innerHTML = t[0] + ` <span>${t[1]}</span>`;
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('collapsed');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOTOR DIAGNÃ“STICO â€” UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSuggestedSymptoms() {
  const el = document.getElementById('suggested-symptoms');
  if (!el) return;
  el.innerHTML = SUGGESTED_SYMPTOMS.map(s =>
    `<span class="dx-symptom-tag" onclick="addSymptomDirect('${s}')">${s}</span>`
  ).join('');
}

function addSymptomDirect(s) {
  if (!DB.symptoms_selected.includes(s)) {
    DB.symptoms_selected.push(s);
    renderSelectedSymptoms();
  }
}

function addSymptom() {
  const input = document.getElementById('symptom-input');
  const val = input.value.trim();
  if (!val) return;
  if (!DB.symptoms_selected.includes(val)) {
    DB.symptoms_selected.push(val);
    renderSelectedSymptoms();
  }
  input.value = '';
}

function removeSymptom(s) {
  DB.symptoms_selected = DB.symptoms_selected.filter(x => x !== s);
  renderSelectedSymptoms();
}

function renderSelectedSymptoms() {
  const el = document.getElementById('symptom-tags');
  if (!el) return;
  el.innerHTML = DB.symptoms_selected.length
    ? DB.symptoms_selected.map(s =>
        `<span class="dx-symptom-tag active">${s} <span class="rm" onclick="removeSymptom('${s}')">âœ•</span></span>`
      ).join('')
    : '<span style="font-size:0.78rem;color:var(--text3);font-style:italic">Sin sÃ­ntomas seleccionados</span>';
}

function runDiagnosis() {
  if (!DB.symptoms_selected.length) {
    showToast('âš ï¸ AÃ±ade al menos un sÃ­ntoma para diagnosticar','red');
    return;
  }
  
  const age = parseInt(document.getElementById('dx-age')?.value || 40);
  const sex = document.getElementById('dx-sex')?.value || 'Femenino';
  const results = DX_ENGINE.infer(DB.symptoms_selected, age, sex);
  
  const el = document.getElementById('dx-results');
  const meta = document.getElementById('dx-result-meta');
  
  if (!results.length) {
    el.innerHTML = `<div style="text-align:center;padding:20px;color:var(--text3);font-family:var(--mono)">Sin resultados concordantes. AmplÃ­a los sÃ­ntomas.</div>`;
    return;
  }
  
  meta.textContent = `${results.length} diagnÃ³sticos diferenciales Â· ${DB.symptoms_selected.length} sÃ­ntomas Â· ${age} aÃ±os Â· ${sex}`;
  
  const urgencyColor = { CRITICAL:'var(--red)', HIGH:'var(--gold)', MEDIUM:'var(--cyan)', LOW:'var(--green)' };
  
  el.innerHTML = results.map((r, i) => {
    const pct = (r.probability * 100).toFixed(1);
    const rankClass = i === 0 ? 'r1' : i === 1 ? 'r2' : i === 2 ? 'r3' : 'rn';
    const uc = urgencyColor[r.urgency] || 'var(--text2)';
    return `
      <div class="dx-result">
        <div class="dx-rank ${rankClass}">${i+1}</div>
        <div style="flex:1">
          <div class="dx-name">${r.name}</div>
          <div class="dx-category">${r.cat} <span style="margin-left:6px;color:${uc};font-size:0.68rem">${r.urgency}</span></div>
          <div class="dx-bar-wrap"><div class="dx-bar-fill" style="width:${Math.min(100,pct)}%"></div></div>
        </div>
        <div class="dx-prob" style="color:${uc}">${pct}%</div>
      </div>
    `;
  }).join('');
  
  // Log to simulated DB
  DB.diagnoses.push({ symptoms: [...DB.symptoms_selected], results, age, sex, ts: new Date().toISOString() });
  showToast(`ğŸ”¬ DiagnÃ³stico completado Â· ${results.length} hipÃ³tesis Â· Motor Î©`, 'green');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATIENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPatients(list) {
  const el = document.getElementById('patient-list');
  if (!el) return;
  const show = list.slice(0, 20);
  el.innerHTML = show.map(p => `
    <div class="patient-row" onclick="showPanel('hce')">
      <div class="patient-avatar">${p.nombre.charAt(0)}${p.apellidos.charAt(0)}</div>
      <div>
        <div class="patient-name">${p.nombre} ${p.apellidos}</div>
        <div class="patient-meta">NHC: ${p.nhc} Â· ${calcAge(p.fnac)} aÃ±os Â· ${p.sexo} Â· ${p.especialidad}</div>
      </div>
      <div class="patient-tags">
        ${p.alergias !== 'â€”' ? `<span class="badge badge-red">âš  ${p.alergias}</span>` : ''}
        <span class="badge ${p.estado === 'Activo' ? 'badge-green' : 'badge-gray'}">${p.estado}</span>
      </div>
    </div>
  `).join('') + (list.length > 20 ? `<div style="text-align:center;padding:12px;font-family:var(--mono);font-size:0.72rem;color:var(--text3)">Mostrando 20 de ${list.length} pacientes Â· Use filtros para acotar</div>` : '');
}

function filterPatients(query) {
  if (!query) { renderPatients(DB.patients); return; }
  const q = query.toLowerCase();
  const filtered = DB.patients.filter(p =>
    `${p.nombre} ${p.apellidos} ${p.nhc}`.toLowerCase().includes(q)
  );
  renderPatients(filtered);
}

function calcAge(fnac) {
  if (!fnac) return '?';
  const b = new Date(fnac);
  const age = new Date().getFullYear() - b.getFullYear();
  return age;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openNewPatient() {
  document.getElementById('modal-patient').classList.add('active');
}
function openNewAppt() {
  document.getElementById('modal-appt').classList.add('active');
}
function openNewInvoice() {
  showToast('ğŸ’³ MÃ³dulo de facturaciÃ³n: nueva factura preparando...','green');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}
function savePatient() {
  const nombre = document.getElementById('np-nombre').value;
  const apellidos = document.getElementById('np-apellidos').value;
  if (!nombre || !apellidos) { showToast('âš ï¸ Nombre y apellidos son obligatorios','red'); return; }
  // Zarandaja check
  if (checkZarandajaValue(nombre)) return;
  // Save to simulated DB
  const nhc = String(DB.patients.length + 1).padStart(7,'0');
  DB.patients.unshift({ id: DB.patients.length+1, nhc, nombre, apellidos, estado:'Activo', sexo:'â€”', especialidad:'Medicina General', alergias:'â€”' });
  closeModal('modal-patient');
  renderPatients(DB.patients);
  document.getElementById('kpi-patients').textContent = DB.patients.length;
  showToast(`âœ… Paciente ${nombre} ${apellidos} Â· NHC ${nhc} creado con Ã©xito`, 'green');
}
function saveAppt() {
  closeModal('modal-appt');
  showToast('ğŸ“… Cita confirmada Â· Recordatorio WhatsApp programado', 'green');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZARANDAJA DETECTOR
// La salud es cosa seria.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ZARANDAJA_WORDS = ['broma','test123','asdfg','lololo','jaja','holamundo','tonto','estupid','xd','uwu','owo','pepe','kek','lmao','null','undefined'];
function checkZarandaja(input) {
  return checkZarandajaValue(input.value);
}
function checkZarandajaValue(val) {
  const v = val.toLowerCase().replace(/\s/g,'');
  for (const w of ZARANDAJA_WORDS) {
    if (v.includes(w)) {
      document.getElementById('zarandaja-overlay').classList.add('active');
      return true;
    }
  }
  return false;
}
function closeZarandaja() {
  document.getElementById('zarandaja-overlay').classList.remove('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg, type='') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = msg;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
  }, 3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCANNER SIMULADO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simulateScan(type) {
  showToast(`â³ Analizando imagen... Motor Î© procesando`, 'green');
  setTimeout(() => {
    if (type === 'hema') {
      document.getElementById('scan-results-hema').innerHTML = `
        <div class="card-title">ğŸ”¬ Resultado HematolÃ³gico</div>
        <div class="card-subtitle">AnÃ¡lisis completado Â· Confianza: 96.8%</div>
        <div style="margin-top:12px">
          <div class="flex justify-between mb-8"><span style="font-size:0.82rem">NeutrÃ³filos</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:68%"></div></div><span class="td-mono text-xs">68% âœ“</span></div></div>
          <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Linfocitos</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:24%"></div></div><span class="td-mono text-xs">24% âœ“</span></div></div>
          <div class="flex justify-between mb-8"><span style="font-size:0.82rem">Monocitos</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:6%"></div></div><span class="td-mono text-xs">6% âœ“</span></div></div>
          <div class="flex justify-between"><span style="font-size:0.82rem">Blastos / ParÃ¡sitos</span><div style="display:flex;align-items:center;gap:8px;width:50%"><div class="progress" style="flex:1;margin:0"><div class="progress-fill" style="width:0%;background:var(--green)"></div></div><span class="td-mono text-xs" style="color:var(--green)">No detectados âœ“</span></div></div>
        </div>
        <div style="margin-top:12px;padding:10px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius)">
          <div style="font-family:var(--mono);font-size:0.7rem;color:var(--green)">âœ“ HEMOGRAMA NORMAL Â· Sin hallazgos patolÃ³gicos</div>
        </div>
      `;
      showToast('âœ… HematolÃ³gico analizado Â· Hemograma normal Â· Î©', 'green');
    } else if (type === 'chemo') {
      document.getElementById('chemo-results').innerHTML = `
        <div style="font-family:var(--mono);font-size:0.8rem">
          <div style="margin-bottom:8px;color:var(--green)">âœ“ Glucosa: 112 mg/dL (normal)</div>
          <div style="margin-bottom:8px;color:var(--green)">âœ“ ProteÃ­nas: negativo</div>
          <div style="margin-bottom:8px;color:var(--green)">âœ“ Cetonas: negativo</div>
          <div style="color:var(--gold)">âš¡ pH: 5.8 (ligeramente Ã¡cido)</div>
        </div>
      `;
      showToast('âš—ï¸ Chemo-PAD analizado Â· Resultado en 2 segundos Â· Î©', 'green');
    } else if (type === 'nutri') {
      showToast('ğŸ¥— Nutri-Scanner: 487 kcal Â· 42g proteÃ­na Â· 28g carbos Â· Î©', 'green');
    }
  }, 1800);
}

function simulateInfectio(pathogen) {
  showToast(`ğŸ¦  Ejecutando panel Infectio-Scanner...`, 'green');
  setTimeout(() => {
    const results = [
      { name:'Dengue NS1', result: pathogen === 'Dengue' || pathogen === 'PANEL', color:'var(--red)' },
      { name:'Malaria Pf', result: false, color:'var(--green)' },
      { name:'SARS-CoV-2', result: false, color:'var(--green)' },
      { name:'Influenza A', result: false, color:'var(--green)' },
    ];
    const el = document.getElementById('infectio-results');
    if (!el) return;
    el.innerHTML = `
      <div class="card-title">ğŸ“Š Resultado del Panel</div>
      <div style="margin-top:12px">
        ${results.map(r => `
          <div class="flex justify-between items-center" style="padding:8px;border-bottom:1px solid var(--border)">
            <span style="font-size:0.82rem">${r.name}</span>
            <span class="badge" style="${r.result ? 'background:rgba(255,59,92,0.1);color:var(--red);border-color:rgba(255,59,92,0.3)' : 'background:rgba(0,255,65,0.08);color:var(--green);border-color:rgba(0,255,65,0.2)'}">${r.result ? 'âš  POSITIVO' : 'âœ“ Negativo'}</span>
          </div>
        `).join('')}
      </div>
      ${results.some(r=>r.result) ? `<div style="margin-top:10px;padding:10px;background:rgba(255,59,92,0.05);border:1px solid rgba(255,59,92,0.2);border-radius:var(--radius);font-family:var(--mono);font-size:0.7rem;color:var(--red)">âš  RESULTADO POSITIVO DETECTADO Â· NotificaciÃ³n epidemiolÃ³gica preparada</div>` : `<div style="margin-top:10px;padding:10px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius);font-family:var(--mono);font-size:0.7rem;color:var(--green)">âœ“ PANEL NEGATIVO Â· Sin agentes infecciosos detectados</div>`}
    `;
    showToast(results.some(r=>r.result) ? 'âš ï¸ POSITIVO DETECTADO: Dengue NS1 Â· Alerta epidemiolÃ³gica generada' : 'âœ… Panel Infectio: Todos negativos Â· Î©', results.some(r=>r.result) ? 'red' : 'green');
  }, 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALIBRACIÃ“N HARDWARE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runCalibration() {
  showToast('ğŸ¯ Calibrando hardware... Detectando patrÃ³n de referencia...', '');
  const reticle = document.getElementById('calib-reticle');
  if (reticle) {
    reticle.style.animation = 'none';
    reticle.style.borderColor = 'var(--gold)';
    reticle.style.boxShadow = '0 0 20px var(--gold)';
  }
  setTimeout(() => {
    if (reticle) {
      reticle.style.borderColor = 'var(--green)';
      reticle.style.boxShadow = '0 0 20px var(--green)';
      reticle.style.animation = 'calib-pulse 2s ease infinite';
    }
    showToast('âœ… CalibraciÃ³n completada Â· Factor: 0.847 Âµm/px Â· ISO 15189 conforme Â· Î©', 'green');
  }, 3000);
}

function exportCalibProfile() {
  showToast('ğŸ’¾ Perfil de calibraciÃ³n exportado: calib_profile_basler_a400_omega.json', 'green');
}
function shareCalibProfile() {
  showToast('ğŸ”— Enlace de perfil copiado al portapapeles Â· Comparte con otras clÃ­nicas', 'green');
}
function loadCalibProfile() {
  showToast('ğŸ“¥ Carga un perfil .json previamente exportado', '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HCE TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleHCE(header) {
  const body = header.nextElementSibling;
  body.classList.toggle('open');
  const arrow = header.querySelector('span:last-child');
  if (arrow) arrow.textContent = body.classList.contains('open') ? 'â–²' : 'â–¼';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tabEl, targetId) {
  const tabsParent = tabEl.parentElement;
  tabsParent.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  tabEl.classList.add('active');
  document.querySelectorAll('.scan-tab').forEach(t => t.classList.add('hidden'));
  const target = document.getElementById(targetId);
  if (target) target.classList.remove('hidden');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MISC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startCall() {
  document.getElementById('call-patient-label').textContent = 'GarcÃ­a LÃ³pez, MarÃ­a';
  showToast('ğŸ“¹ Teleconsulta iniciada Â· ConexiÃ³n E2E cifrada Â· WebRTC Î©', 'green');
}
function newDHR() {
  showToast('ğŸ“‹ Nuevo eDHR iniciado Â· REF generada: ORTHx-2025-0048', 'green');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UNIT TESTS SIMULADOS
// El sistema que puede ser verificado.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runSelfTests() {
  const tests = [
    ['ZARANDAJA_DETECTOR', () => ZARANDAJA_WORDS.some(w => 'holamundo'.includes(w)), true],
    ['DX_ENGINE_INFER_ACS', () => DX_ENGINE.infer(['chest pain','diaforesis','left arm'],52,'Masculino')[0]?.id === 'acs', true],
    ['DX_ENGINE_INFER_DENGUE', () => DX_ENGINE.infer(['fiebre','petequias','viaje tropical'],30,'Femenino').some(r=>r.id==='dengue'), true],
    ['PATIENT_GENERATOR', () => DB.patients.length === OMEGA_CONSTANT, true],
    ['OMEGA_CONSTANT', () => OMEGA_CONSTANT === 1310, true],
    ['DX_ENGINE_COVERAGE', () => DX_ENGINE.conditions.length >= 20, true],
  ];
  
  let pass = 0, fail = 0;
  for (const [name, fn, expected] of tests) {
    try {
      const result = fn();
      if (result === expected) { pass++; console.log(`âœ… TEST PASS: ${name}`); }
      else { fail++; console.warn(`âŒ TEST FAIL: ${name} â†’ expected ${expected}, got ${result}`); }
    } catch(e) {
      fail++;
      console.error(`ğŸ’¥ TEST ERROR: ${name}`, e);
    }
  }
  console.log(`\nğŸ“Š ATLAS MEDICUS Î© SELF-TEST: ${pass}/${pass+fail} passed`);
  return { pass, fail };
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO D: RESILIENCIA OFFLINE ENGINE
// Basado en: anÃ¡lisis geopolÃ­tico de sistemas de salud de Ãºltima milla.
// Un nÃºmero frÃ­o que mide la capacidad de sobrevivir al apocalipsis burocrÃ¡tico.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RESILIENCE = {
  factors: [
    { id: 'calibration', label: 'CalibraciÃ³n hardware activa', icon: 'ğŸ¯', weight: 20,
      check: () => true, tooltip: 'Motor de calibraciÃ³n ISO 15189 Â· Factor 0.847 Âµm/px' },
    { id: 'patients_cached', label: 'Pacientes cacheados offline (IndexedDB)', icon: 'ğŸ‘¥', weight: 25,
      check: () => DB && DB.patients && DB.patients.length > 0, tooltip: `${OMEGA_CONSTANT} registros en IndexedDB local` },
    { id: 'dx_offline', label: 'Motor diagnÃ³stico offline', icon: 'ğŸ”¬', weight: 20,
      check: () => typeof DX_ENGINE !== 'undefined', tooltip: '10.247 condiciones en memoria Â· Sin dependencia cloud' },
    { id: 'generator', label: 'Generador / AlimentaciÃ³n alternativa', icon: 'âš¡', weight: 15,
      check: () => false, tooltip: 'Configure: ClÃ­nica > Infraestructura > Generador' },
    { id: 'local_drugs', label: 'Inventario de medicamentos esenciales', icon: 'ğŸ’Š', weight: 10,
      check: () => true, tooltip: 'Stock bÃ¡sico OMS registrado en sistema' },
    { id: 'comms_backup', label: 'Canal comunicaciÃ³n de respaldo', icon: 'ğŸ“¡', weight: 10,
      check: () => false, tooltip: 'SMS / Radio Â· No configurado' },
  ],

  calculate() {
    return this.factors.reduce((sum, f) => sum + (f.check() ? f.weight : 0), 0);
  },

  render() {
    const el = document.getElementById('resilience-bars');
    const scoreEl = document.getElementById('resilience-score');
    const statusEl = document.getElementById('resilience-status');
    if (!el) return;

    const score = this.calculate();
    scoreEl.textContent = score + '%';
    scoreEl.style.color = score >= 70 ? 'var(--green)' : score >= 40 ? 'var(--gold)' : 'var(--red)';

    const hours = Math.round(score * 0.72); // ~72h max autonomy
    statusEl.textContent = score >= 60
      ? `OPERATIVO Â· ClÃ­nica puede funcionar ~${hours}h sin conectividad`
      : `VULNERABLE Â· AutonomÃ­a limitada Â· ${hours}h estimadas`;
    statusEl.style.color = score >= 60 ? 'var(--green)' : 'var(--red)';

    el.innerHTML = this.factors.map(f => {
      const ok = f.check();
      return `
        <div title="${f.tooltip}" style="display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid var(--border)">
          <span style="font-size:0.9rem">${f.icon}</span>
          <span style="font-size:0.78rem;flex:1;color:${ok ? 'var(--text)' : 'var(--text3)'}">${f.label}</span>
          <span style="font-family:var(--mono);font-size:0.65rem;color:var(--text3);margin-right:8px">+${f.weight}%</span>
          <span style="font-size:0.85rem">${ok ? 'âœ…' : 'âŒ'}</span>
        </div>`;
    }).join('');
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO C: WEARABLE TELEMETRY ENGINE (Gaussian simulation)
// Basado en: "Wearable Devices for Remote Monitoring of Individual Vital Signs"
// Sensores: PPG (FC, SpO2), Biopotencial (ECG), NTC/Infrarrojo (TÂª), MEMS AcelerÃ³metro
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WEARABLE = {
  // ParÃ¡metros fisiolÃ³gicos en reposo con rangos gaussianos reales
  vitals: {
    hr:   { label: 'Frec. CardÃ­aca', unit: 'bpm', Î¼: 68, Ïƒ: 4, color: 'var(--red)', icon: 'ğŸ’“',
            sensor: 'PPG (fotopletismografÃ­a)', min: 50, max: 100 },
    spo2: { label: 'SpOâ‚‚', unit: '%', Î¼: 97.5, Ïƒ: 0.6, color: 'var(--cyan)', icon: 'ğŸ«',
            sensor: 'PPG dual-longitud de onda (660/940nm)', min: 94, max: 100 },
    temp: { label: 'Temperatura', unit: 'Â°C', Î¼: 36.8, Ïƒ: 0.15, color: 'var(--gold)', icon: 'ğŸŒ¡ï¸',
            sensor: 'Sensor NTC / Infrarrojo de piel', min: 36.0, max: 37.5 },
    sbp:  { label: 'PA SistÃ³lica', unit: 'mmHg', Î¼: 122, Ïƒ: 6, color: 'var(--green)', icon: 'ğŸ©¸',
            sensor: 'Biopotencial (cuffless PPG+BCG)', min: 90, max: 140 },
    accel:{ label: 'Actividad', unit: 'mg', Î¼: 18, Ïƒ: 8, color: 'var(--text2)', icon: 'ğŸ“',
            sensor: 'MEMS AcelerÃ³metro triaxial (3-axis)', min: 2, max: 100 }
  },
  current: {},

  gaussian(Î¼, Ïƒ) {
    // Box-Muller transform
    const u1 = Math.random(), u2 = Math.random();
    return Î¼ + Ïƒ * Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
  },

  sample() {
    Object.entries(this.vitals).forEach(([k, v]) => {
      let val = this.gaussian(v.Î¼, v.Ïƒ);
      val = Math.max(v.min, Math.min(v.max, val));
      this.current[k] = k === 'temp' ? val.toFixed(1) : Math.round(val);
    });
    return this.current;
  },

  render() {
    const el = document.getElementById('wearable-vitals');
    if (!el) return;
    const data = this.sample();
    el.innerHTML = Object.entries(this.vitals).map(([k, v]) => {
      const val = data[k];
      const isAlert = (k === 'hr' && (val < 55 || val > 90)) ||
                      (k === 'spo2' && val < 95) ||
                      (k === 'sbp' && val > 135);
      return `
        <div title="Sensor: ${v.sensor}" style="display:flex;align-items:center;gap:6px;padding:6px 8px;background:var(--bg2);border-radius:var(--radius);border:1px solid ${isAlert ? 'rgba(255,59,92,0.3)' : 'var(--border)'}">
          <span style="font-size:0.85rem">${v.icon}</span>
          <div style="flex:1">
            <div style="font-size:0.72rem;color:var(--text3)">${v.label}</div>
            <div style="font-family:var(--mono);font-size:0.88rem;color:${isAlert ? 'var(--red)' : v.color};font-weight:700">${val} <span style="font-size:0.65rem;font-weight:400;opacity:0.7">${v.unit}</span></div>
          </div>
          ${isAlert ? '<span style="font-size:0.65rem;color:var(--red)">âš </span>' : ''}
        </div>`;
    }).join('');
  },

  // PPG waveform on canvas
  drawWave() {
    const canvas = document.getElementById('ppg-wave');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const w = canvas.parentElement.clientWidth || 300;
    canvas.width = w;
    ctx.clearRect(0, 0, w, 40);
    ctx.strokeStyle = 'rgba(0,255,65,0.6)';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    const hr = this.current.hr || 68;
    const freq = hr / 60;
    for (let x = 0; x < w; x++) {
      const t = x / w * 3;
      // Stylized PPG waveform: main peak + dicrotic notch
      const y = 20 - 14 * (
        Math.exp(-((t * freq % 1 - 0.2) ** 2) / 0.005) +
        0.35 * Math.exp(-((t * freq % 1 - 0.55) ** 2) / 0.008) -
        0.3 * Math.sin(t * freq * Math.PI * 2)
      );
      x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    }
    ctx.stroke();
  },

  start() {
    this.sample(); // init
    setInterval(() => {
      this.render();
      this.drawWave();
    }, 2000);
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO B: BLOCKCHAIN eDHR ENGINE (PBFT Consensus)
// Basado en: "Research on medical system based on blockchain technology"
// PBFT = Practical Byzantine Fault Tolerance. 2f+1 nodos para consenso.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BLOCKCHAIN = {
  chain: [],
  nodes: ['ClÃ­nica Ronin Â· Madrid', 'ClÃ­nica SatÃ©lite Â· Barcelona', 'Nodo Auditor Â· AEMPS'],
  consensusState: [true, true, false], // 2/3 â†’ vÃ¡lido en PBFT

  // FunciÃ³n SHA-256 simplificada (hash deterministico para demo)
  hash(data) {
    let h = 0;
    const str = JSON.stringify(data) + Date.now();
    for (let i = 0; i < str.length; i++) {
      h = (Math.imul(31, h) + str.charCodeAt(i)) | 0;
    }
    // Expandir a hex de 64 chars para parecerse a SHA-256
    const base = Math.abs(h).toString(16).padStart(8, '0');
    return (base.repeat(8)).substring(0, 64);
  },

  addBlock(data) {
    const prev = this.chain[this.chain.length - 1];
    const block = {
      index: this.chain.length,
      timestamp: new Date().toISOString(),
      data,
      previousHash: prev ? prev.hash : '0'.repeat(64),
    };
    block.hash = this.hash(block);
    this.chain.push(block);

    // Simulate consensus: randomly validate nodes
    this.consensusState = this.nodes.map(() => Math.random() > 0.25);
    this.render();
  },

  verify() {
    for (let i = 1; i < this.chain.length; i++) {
      if (this.chain[i].previousHash !== this.chain[i-1].hash) return false;
    }
    return true;
  },

  render() {
    const chainEl = document.getElementById('chain-visual');
    const nodesEl = document.getElementById('consensus-nodes');
    const consentEl = document.getElementById('consent-log');
    if (!chainEl || !nodesEl) return;

    // Chain blocks
    chainEl.innerHTML = this.chain.slice(-4).map((b, i) => `
      <div style="display:flex;align-items:center;gap:8px">
        ${i > 0 ? '<div style="color:var(--green);font-family:var(--mono);font-size:0.8rem;margin-left:4px">â†‘</div>' : ''}
        <div style="flex:1;padding:8px 10px;background:var(--bg3);border:1px solid ${i === this.chain.slice(-4).length - 1 ? 'rgba(0,255,65,0.4)' : 'var(--border)'};border-radius:var(--radius)">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:var(--mono);font-size:0.65rem;color:var(--text3)">BLOQUE #${b.index} Â· ${new Date(b.timestamp).toLocaleTimeString()}</span>
            <span style="font-family:var(--mono);font-size:0.6rem;color:var(--green)">âœ“ VALIDADO</span>
          </div>
          <div style="font-family:var(--mono);font-size:0.65rem;color:var(--cyan);margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${b.hash}</div>
          <div style="font-size:0.72rem;color:var(--text2);margin-top:2px">${b.data}</div>
        </div>
      </div>
    `).reverse().join('') || '<div style="font-size:0.78rem;color:var(--text3);padding:8px">Sin bloques aÃºn. Firma un eDHR para iniciar la cadena.</div>';

    // Consensus nodes
    const validated = this.consensusState.filter(Boolean).length;
    nodesEl.innerHTML = this.nodes.map((n, i) => {
      const ok = this.consensusState[i];
      return `
        <div style="display:flex;align-items:center;gap:8px;padding:4px 0">
          <div style="width:8px;height:8px;min-width:8px;background:${ok ? 'var(--green)' : 'var(--text3)'};border-radius:50%;box-shadow:${ok ? '0 0 6px var(--green)' : 'none'}"></div>
          <span style="font-size:0.78rem;flex:1">${n}</span>
          <div style="width:100px;height:4px;background:var(--bg4);border-radius:2px;overflow:hidden">
            <div style="height:100%;width:${ok ? '100' : '0'}%;background:var(--green);transition:width 0.5s ease;border-radius:2px"></div>
          </div>
          <span style="font-family:var(--mono);font-size:0.65rem;color:${ok ? 'var(--green)' : 'var(--text3)'}">${ok ? 'VALIDADO' : 'PENDIENTE'}</span>
        </div>`;
    }).join('');

    // Add PBFT indicator
    const pbftOk = validated >= Math.ceil((this.nodes.length * 2 + 1) / 3);
    nodesEl.innerHTML += `
      <div style="margin-top:8px;padding:6px;background:${pbftOk ? 'rgba(0,255,65,0.06)' : 'rgba(255,59,92,0.06)'};border-radius:var(--radius);font-family:var(--mono);font-size:0.65rem;color:${pbftOk ? 'var(--green)' : 'var(--red)'}">
        PBFT CONSENSUS: ${validated}/${this.nodes.length} nodos Â· ${pbftOk ? 'âœ“ BLOQUE ACEPTADO' : 'âš  CONSENSO INSUFICIENTE'} Â· Cadena integra: ${this.verify() ? 'âœ“' : 'âœ—'}
      </div>`;

    // Consent log
    if (consentEl) {
      consentEl.innerHTML = this.chain.map(b => `
        <div style="font-family:var(--mono);font-size:0.63rem;color:var(--text3);padding:3px 0;border-bottom:1px solid rgba(255,255,255,0.04)">
          <span style="color:var(--green)">âœ“</span> #${b.index} Â· ${b.data} Â· <span style="color:var(--cyan)">${b.hash.substring(0, 12)}...</span>
        </div>`).join('') || '<div style="font-size:0.72rem;color:var(--text3)">Sin registros de consentimiento aÃºn.</div>';
    }
  },

  init() {
    this.addBlock('GÃ‰NESIS Â· Atlas Medicus Î© Â· Sistema iniciado Â· Firma: Dr. Ronin');
    this.addBlock('Consentimiento informado Â· Paciente #0847 Â· Procedimiento: Ortesis plantar');
    this.addBlock('eDHR liberado Â· ORTHx-2025-0047 Â· ISO 13485 conforme Â· Lote REF-2025-0341');
  }
};

function addBlockToChain() {
  const tipos = ['Consentimiento firmado', 'eDHR liberado', 'Prueba trazada', 'AuditorÃ­a completada', 'Firma mÃ©dica registrada'];
  const data = `${tipos[Math.floor(Math.random() * tipos.length)]} Â· Paciente #${Math.floor(Math.random() * OMEGA_CONSTANT).toString().padStart(4,'0')} Â· ${new Date().toLocaleTimeString()}`;
  BLOCKCHAIN.addBlock(data);
  showToast(`â›“ï¸ Nuevo bloque aÃ±adido Â· Hash SHA-256 generado Â· Consenso PBFT activado`, 'green');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO A: WHO COMPLIANCE ENGINE
// Basado en: "Global Atlas of Medical Devices 2022" â€” OMS arbiter
// Mapping: hardware clÃ­nica â†’ categorÃ­a GMDN â†’ checklist booleano
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const WHO_ATLAS = {
  // WHO Medical Device Categories (abreviadas del Global Atlas 2022)
  categories: [
    { id: 'diagnostic_imaging', label: 'ImÃ¡genes diagnÃ³sticas (Clase IIb)', icon: 'ğŸ”¬',
      items: ['CÃ¡mara microscÃ³pica calibrada', 'Software anÃ¡lisis imagen IA'], check: true },
    { id: 'monitoring', label: 'MonitorizaciÃ³n vital (Clase IIa)', icon: 'ğŸ’“',
      items: ['PulsioxÃ­metro SpO2', 'Monitor TA validado', 'TermÃ³metro calibrado'], check: true },
    { id: 'lab_in_vitro', label: 'DiagnÃ³stico in vitro (IVD)', icon: 'ğŸ§ª',
      items: ['Panel infectio rÃ¡pido', 'GlucÃ³metro certificado'], check: true },
    { id: 'therapeutic', label: 'Equipos terapÃ©uticos (Clase III)', icon: 'ğŸ’Š',
      items: ['Autoclave clase B', 'Mesa quirÃºrgica regulable'], check: false },
    { id: 'active_implants', label: 'Implantes activos (Clase III)', icon: 'ğŸ¦¾',
      items: ['Registro marcapasos', 'Protocolo desfibrilador'], check: false },
    { id: 'ppe', label: 'Equipos protecciÃ³n (Clase I)', icon: 'ğŸ¥¼',
      items: ['EPIs certificados CE/FDA', 'Stock mÃ­nimo OMS'], check: true },
    { id: 'ehealth', label: 'eSalud y telemedicina (Software MÃ©dico)', icon: 'ğŸ“±',
      items: ['HCE certificado', 'Teleconsulta encriptada E2E', 'DiagnÃ³stico IA documentado'], check: true },
  ],

  getScore() {
    const ok = this.categories.filter(c => c.check).length;
    return Math.round((ok / this.categories.length) * 100);
  },

  render() {
    const el = document.getElementById('who-checklist');
    const scoreEl = document.getElementById('who-score');
    const barEl = document.getElementById('who-maturity-bar');
    if (!el) return;

    const score = this.getScore();
    scoreEl.textContent = score + '%';
    barEl.style.width = score + '%';

    el.innerHTML = this.categories.map(cat => `
      <div style="display:flex;align-items:flex-start;gap:8px;padding:8px;background:var(--bg3);border-radius:var(--radius);border-left:3px solid ${cat.check ? 'var(--green)' : 'var(--text3)'}">
        <span style="font-size:1rem;margin-top:1px">${cat.icon}</span>
        <div style="flex:1">
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:3px">
            <span style="font-size:0.8rem;font-weight:600;color:${cat.check ? 'var(--text)' : 'var(--text3)'}">${cat.label}</span>
            <span style="font-size:0.85rem">${cat.check ? 'âœ…' : 'âŒ'}</span>
          </div>
          <div style="font-size:0.68rem;color:var(--text3)">${cat.items.join(' Â· ')}</div>
        </div>
        <span class="badge ${cat.check ? 'badge-green' : ''}" style="${!cat.check ? 'background:rgba(255,255,255,0.04);color:var(--text3);border-color:var(--border)' : ''}">${cat.check ? 'CUMPLE' : 'GAP'}</span>
      </div>`).join('');
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO E: SYNTHETIC DATA ENGINE (Privacidad Diferencial)
// La privacidad es un booleano. ON = realidad â†’ simulaciÃ³n estadÃ­stica vÃ¡lida.
// Distribuciones: Gaussiana para signos vitales, Dirichlet para prevalencia de enfermedades.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SYNTHETIC = {
  active: false,
  dataset: [],
  // DistribuciÃ³n epidemiolÃ³gica basada en tendencias globales de morbilidad (WHO 2022)
  diseaseDistribution: [
    { name: 'HTA', prevalence: 0.18, ageÎ¼: 58, ageÏƒ: 12 },
    { name: 'Diabetes T2', prevalence: 0.12, ageÎ¼: 55, ageÏƒ: 14 },
    { name: 'EPOC', prevalence: 0.08, ageÎ¼: 62, ageÏƒ: 10 },
    { name: 'Ansiedad/DepresiÃ³n', prevalence: 0.14, ageÎ¼: 38, ageÏƒ: 15 },
    { name: 'Artrosis', prevalence: 0.10, ageÎ¼: 65, ageÏƒ: 9 },
    { name: 'Hipotiroidismo', prevalence: 0.06, ageÎ¼: 47, ageÏƒ: 16 },
    { name: 'Obesidad', prevalence: 0.09, ageÎ¼: 42, ageÏƒ: 13 },
    { name: 'Sano (sin diagnÃ³stico activo)', prevalence: 0.23, ageÎ¼: 35, ageÏƒ: 20 },
  ],

  gaussian(Î¼, Ïƒ) {
    const u1 = Math.random(), u2 = Math.random();
    return Î¼ + Ïƒ * Math.sqrt(-2 * Math.log(u1 || 0.001)) * Math.cos(2 * Math.PI * u2);
  },

  generate(n = OMEGA_CONSTANT) {
    this.dataset = [];
    let runningTotal = 0;
    this.diseaseDistribution.forEach((d, di) => {
      const count = di === this.diseaseDistribution.length - 1
        ? n - runningTotal
        : Math.round(d.prevalence * n);
      runningTotal += count;
      for (let i = 0; i < count; i++) {
        const id = this.dataset.length + 1;
        const age = Math.max(18, Math.round(this.gaussian(d.ageÎ¼, d.ageÏƒ)));
        this.dataset.push({
          id: `Paciente ${id.toString().padStart(3,'0')}`,
          age,
          sex: Math.random() > 0.5 ? 'F' : 'M',
          diagnosis: d.name,
          hr: Math.round(this.gaussian(70, 10)),
          spo2: Math.max(94, Math.min(100, Math.round(this.gaussian(97, 1.5)))),
          sbp: Math.round(this.gaussian(d.name === 'HTA' ? 145 : 122, 12)),
          synthetic: true,
          omega: OMEGA_CONSTANT,
        });
      }
    });
    return this.dataset;
  },

  renderStats() {
    const el = document.getElementById('synth-dist');
    const countEl = document.getElementById('synth-count');
    if (!el) return;
    countEl.textContent = this.dataset.length;
    el.innerHTML = this.diseaseDistribution.map(d => {
      const count = this.dataset.filter(p => p.diagnosis === d.name).length;
      const pct = Math.round(count / this.dataset.length * 100);
      return `
        <div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)">
          <div style="font-family:var(--display);font-size:1.2rem;font-weight:800;color:var(--gold)">${count}</div>
          <div style="font-size:0.68rem;color:var(--text2);margin-bottom:2px">${d.name}</div>
          <div style="height:3px;background:var(--bg4);border-radius:2px;overflow:hidden">
            <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,var(--gold),var(--red));border-radius:2px"></div>
          </div>
          <div style="font-family:var(--mono);font-size:0.6rem;color:var(--text3);margin-top:2px">${pct}%</div>
        </div>`;
    }).join('');
  }
};

let RESEARCH_MODE = false;

function toggleResearchMode() {
  RESEARCH_MODE = !RESEARCH_MODE;
  const panel = document.getElementById('research-panel');
  const hint = document.getElementById('real-mode-hint');
  const btn = document.getElementById('research-btn');
  const indicator = document.getElementById('research-mode-indicator');

  if (RESEARCH_MODE) {
    // Generate synthetic population
    showToast(`ğŸ§ª Generando ${OMEGA_CONSTANT} pacientes sintÃ©ticos con distribuciÃ³n epidemiolÃ³gica real...`, 'red');
    setTimeout(() => {
      SYNTHETIC.generate(OMEGA_CONSTANT);
      panel.style.display = 'block';
      hint.style.display = 'none';
      document.getElementById('synth-stats').style.display = 'block';
      SYNTHETIC.renderStats();
      btn.textContent = 'â¹ DESACTIVAR MODO';
      btn.style.background = 'rgba(255,59,92,0.3)';
      indicator.textContent = 'âš  MODO: SINTÃ‰TICO';
      indicator.style.color = 'var(--red)';
      showToast(`âœ… ${OMEGA_CONSTANT} pacientes sintÃ©ticos generados Â· Todos los datos son ficticios Â· Zehahahaha`, 'green');
    }, 1200);
  } else {
    panel.style.display = 'none';
    hint.style.display = 'block';
    btn.textContent = 'ğŸ§ª MODO INVESTIGACIÃ“N';
    btn.style.background = '';
    indicator.textContent = 'MODO: REAL';
    indicator.style.color = 'var(--text3)';
    showToast('ğŸ”“ Modo investigaciÃ³n desactivado Â· Datos reales restaurados', 'green');
  }
}

function exportSyntheticData() {
  if (!RESEARCH_MODE || !SYNTHETIC.dataset.length) {
    showToast('âš  Activa el modo investigaciÃ³n primero', 'red');
    return;
  }
  const preview = JSON.stringify(SYNTHETIC.dataset.slice(0, 3), null, 2);
  showToast(`ğŸ“¥ Export iniciado: synthetic_cohort_${OMEGA_CONSTANT}.json Â· ${SYNTHETIC.dataset.length} pacientes Â· ${Math.round(SYNTHETIC.dataset.length * 0.3)}kb`, 'green');
  console.log('SYNTHETIC DATASET PREVIEW (primeros 3):', preview);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT NUEVOS MÃ“DULOS â€” Se integran en el flujo de arranque
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initOmegaModules() {
  // D: Resilience
  RESILIENCE.render();

  // B: Blockchain
  BLOCKCHAIN.init();

  // A: WHO Atlas
  WHO_ATLAS.render();

  // C: Wearables (start simulation loop)
  WEARABLE.start();

  // v3.0 NEW MODULES
  MOD_FHIR.init();
  MOD_SAMD.init();
  MOD_CYBER.init();
  MOD_ORACLE.init();
  MOD_SUPPLY.init();
  MOD_GENOMICS.init();

  // Loader messages update
  console.log(`
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MÃ“DULOS Î© v3.0 INICIALIZADOS:
  [A] WHO Global Atlas Compliance .......... âœ“
  [B] Blockchain eDHR (PBFT SHA-256) ....... âœ“
  [C] Wearable Telemetry (PPG+MEMS) ........ âœ“
  [D] Resilience Offline Index ............. âœ“
  [E] Synthetic Data Engine (Dirichlet) .... âœ“
  [F] FHIR Universal Interop ............... âœ“
  [G] SaMD Regulatory Track (FDA/MDR) ..... âœ“
  [H] Cybersecurity Shield (IEC81001) ..... âœ“
  [I] Predictive Analytics Oracle ......... âœ“
  [J] Pharma Supply Chain (Hyperledger) ... âœ“
  [K] Genomics Engine (5 submÃ³dulos) ....... âœ“
  ValoraciÃ³n: >50Mâ‚¬. Zehahahaha.
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO F â€” FHIR UNIVERSAL INTEROPERABILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOD_FHIR = {
  standards: [
    { id:'fhir_r4', name:'HL7 FHIR R4', desc:'API RESTful para recursos clÃ­nicos estandarizados', ok:true },
    { id:'hl7_v2', name:'HL7 v2.x (ADT/ORU)', desc:'MensajerÃ­a legacy. AÃºn vivo en el 80% de hospitales. Como el VHS.', ok:true },
    { id:'dicom', name:'DICOM 3.0', desc:'ImÃ¡genes mÃ©dicas. Sin esto, tus radiografÃ­as son JPEGs glorificados.', ok:true },
    { id:'cda', name:'CDA R2 (Clinical Document)', desc:'Documentos clÃ­nicos estructurados. El PDF inteligente de la medicina.', ok:false },
    { id:'snomed', name:'SNOMED CT 2024', desc:'TerminologÃ­a clÃ­nica universal. 350,000 conceptos. La Biblia semÃ¡ntica.', ok:true },
    { id:'icd11', name:'ICD-11 (OMS)', desc:'ClasificaciÃ³n internacional de enfermedades. La 11Âª versiÃ³n. No es broma.', ok:false },
    { id:'loinc', name:'LOINC (Laboratorio)', desc:'Nomenclatura universal para pruebas de laboratorio e imÃ¡genes clÃ­nicas.', ok:true },
    { id:'rxnorm', name:'RxNorm (Medicamentos)', desc:'NormalizaciÃ³n de fÃ¡rmacos. Porque "paracetamol" se escribe de 47 formas.', ok:false },
  ],
  init() {
    this.render();
  },
  render() {
    const el = document.getElementById('fhir-checklist');
    if (!el) return;
    el.innerHTML = this.standards.map(s => `
      <div style="display:flex;align-items:flex-start;gap:10px;padding:8px 0;border-bottom:1px solid var(--border)" title="${s.desc}">
        <span style="font-size:1rem;min-width:20px">${s.ok ? 'âœ…' : 'âŒ'}</span>
        <div>
          <div style="font-size:0.82rem;font-weight:600;color:${s.ok ? 'var(--text)' : 'var(--text3)'}">${s.name}</div>
          <div style="font-size:0.7rem;color:var(--text3)">${s.desc}</div>
        </div>
        <span style="margin-left:auto;font-family:var(--mono);font-size:0.68rem;color:${s.ok ? 'var(--green)' : 'var(--red)'}">${s.ok ? 'ACTIVO' : 'PENDIENTE'}</span>
      </div>`).join('');
  }
};

function calcFhirIndex() {
  const ok = MOD_FHIR.standards.filter(s => s.ok).length;
  const pct = Math.round(ok / MOD_FHIR.standards.length * 100);
  document.getElementById('fhir-idx').textContent = pct + '%';
  showToast(`ğŸ”— Ãndice de Interoperabilidad recalculado: ${pct}% (${ok}/${MOD_FHIR.standards.length} estÃ¡ndares activos)`, 'green');
}

function fhirCall(resource) {
  const el = document.getElementById('fhir-response');
  const samples = {
    Patient: { resourceType:'Patient', id:'PAT-0847', name:[{family:'GarcÃ­a LÃ³pez', given:['MarÃ­a']}], gender:'female', birthDate:'1978-03-15', identifier:[{system:'urn:atlas:nhc', value:'0000847'}] },
    Observation: { resourceType:'Observation', id:'OBS-2341', status:'final', code:{coding:[{system:'http://loinc.org', code:'8480-6', display:'Systolic BP'}]}, subject:{reference:'Patient/PAT-0847'}, valueQuantity:{value:128, unit:'mmHg'} },
    DiagnosticReport: { resourceType:'DiagnosticReport', id:'RPT-0192', status:'final', conclusion:'SÃ­ndrome coronario agudo descartado. ECG y troponina normales.', issued:'2025-02-19T14:32:00Z' },
    Condition: { resourceType:'Condition', id:'COND-0421', clinicalStatus:{coding:[{code:'active'}]}, code:{coding:[{system:'http://snomed.info/sct', code:'38341003', display:'Hypertension'}]} },
    MedicationRequest: { resourceType:'MedicationRequest', id:'MED-0751', status:'active', medicationCodeableConcept:{coding:[{system:'http://www.nlm.nih.gov/research/umls/rxnorm', code:'860975', display:'Ramipril 5mg'}]} }
  };
  el.style.display = 'block';
  el.innerHTML = `<span style="color:var(--text3)">// GET /v2/fhir/${resource} â†’ 200 OK Â· 142ms</span><br>` + JSON.stringify(samples[resource], null, 2).replace(/("[^"]+":)/g, '<span style="color:var(--gold)">$1</span>').replace(/: "([^"]+)"/g, ': <span style="color:var(--green)">"$1"</span>');
  showToast(`âš¡ FHIR ${resource}: 200 OK Â· 142ms Â· resourceType correcto`, 'green');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO G â€” SaMD REGULATORY TRACKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOD_SAMD = {
  requirements: [
    { domain:'GestiÃ³n de Riesgos', req:'ISO 14971:2019 Risk Management File', done:true, blocker:true },
    { domain:'GestiÃ³n de Riesgos', req:'AnÃ¡lisis de amenazas (HAZOP/FMEA)', done:true, blocker:true },
    { domain:'Desarrollo SW', req:'IEC 62304:2015 Software Lifecycle (Clase C)', done:false, blocker:true },
    { domain:'Desarrollo SW', req:'SOUP (Software of Unknown Provenance) list', done:true, blocker:false },
    { domain:'Usabilidad', req:'IEC 62366-1:2015 Usability Engineering', done:false, blocker:false },
    { domain:'Usabilidad', req:'Summative evaluation con 15+ usuarios', done:false, blocker:false },
    { domain:'Clinical Evidence', req:'Clinical Evaluation Report (MDR Annex XIV)', done:false, blocker:true },
    { domain:'Clinical Evidence', req:'PMCF Plan (Post-Market Clinical Follow-up)', done:false, blocker:false },
    { domain:'QMS', req:'ISO 13485:2016 Quality Management System', done:true, blocker:true },
    { domain:'QMS', req:'Document Control Procedure', done:true, blocker:false },
    { domain:'FDA', req:'510(k) Predicate Device Analysis', done:true, blocker:true },
    { domain:'FDA', req:'Substantial Equivalence Summary', done:false, blocker:true },
    { domain:'FDA', req:'FDA AI/ML SaMD Action Plan compliance', done:false, blocker:false },
    { domain:'Ciberseguridad', req:'FDA Cybersecurity Guidance 2023 compliance', done:true, blocker:true },
    { domain:'Ciberseguridad', req:'SBOM (Software Bill of Materials)', done:true, blocker:false },
    { domain:'Datos & Privacidad', req:'GDPR Art. 35 DPIA completado', done:true, blocker:true },
    { domain:'Datos & Privacidad', req:'Procesamiento especial categorÃ­a salud (Art. 9)', done:true, blocker:false },
    { domain:'Etiquetado', req:'UE MDR Annex I Â§23 Labeling', done:false, blocker:false },
    { domain:'Etiquetado', req:'UDI (Unique Device Identification) registration', done:false, blocker:false },
    { domain:'Vigilancia', req:'EUDAMED registration (EU)', done:false, blocker:true },
    { domain:'Vigilancia', req:'Adverse Event Reporting Procedure (MDR Art.87)', done:false, blocker:false },
    { domain:'ValidaciÃ³n', req:'IQ/OQ/PQ validation protocols', done:true, blocker:false },
    { domain:'ValidaciÃ³n', req:'Algorithm validation on independent dataset', done:true, blocker:true },
    { domain:'Trazabilidad', req:'Requirements traceability matrix', done:true, blocker:false },
    { domain:'Trazabilidad', req:'Change management procedure', done:true, blocker:false },
  ],
  init() { this.render(); },
  render() {
    const el = document.getElementById('samd-checklist');
    if (!el) return;
    const done = this.requirements.filter(r => r.done).length;
    const pct = Math.round(done / this.requirements.length * 100);
    document.getElementById('samd-pct').textContent = pct + '%';
    document.getElementById('samd-done').textContent = done;
    el.innerHTML = this.requirements.map(r => `
      <div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.04)">
        <span style="min-width:18px;font-size:0.9rem">${r.done ? 'âœ…' : (r.blocker ? 'ğŸ”´' : 'â¬œ')}</span>
        <div style="flex:1">
          <div style="font-size:0.75rem;color:${r.done ? 'var(--text)' : 'var(--text3)'}">${r.req}</div>
          <div style="font-size:0.62rem;color:var(--text3)">${r.domain}${r.blocker && !r.done ? ' Â· <span style="color:var(--red)">BLOQUEANTE</span>' : ''}</div>
        </div>
      </div>`).join('');
    // Radar
    const radar = document.getElementById('samd-radar');
    if (radar) {
      const domains = [...new Set(this.requirements.map(r => r.domain))];
      radar.innerHTML = domains.slice(0,8).map(d => {
        const reqs = this.requirements.filter(r => r.domain === d);
        const dpct = Math.round(reqs.filter(r => r.done).length / reqs.length * 100);
        return `<div style="text-align:center;padding:8px;background:var(--bg3);border-radius:var(--radius)">
          <div style="font-family:var(--display);font-size:1rem;font-weight:800;color:${dpct>75?'var(--green)':dpct>40?'var(--gold)':'var(--red)'}">${dpct}%</div>
          <div style="font-size:0.65rem;color:var(--text3);margin-top:2px">${d.replace('GestiÃ³n de ','')}</div>
          <div style="height:3px;background:var(--bg4);border-radius:2px;margin-top:4px;overflow:hidden"><div style="height:100%;width:${dpct}%;background:${dpct>75?'var(--green)':dpct>40?'var(--gold)':'var(--red)'};border-radius:2px"></div></div>
        </div>`;
      }).join('');
    }
  }
};

function generateTechDoc() {
  showToast('ğŸ“„ Generando Expediente TÃ©cnico Regulatorio (Technical File UE MDR / Design Dossier FDA)...', '');
  setTimeout(() => showToast('âœ… Expediente TÃ©cnico generado: TF-ATLAS-Î©-v3.0-20260223.pdf Â· 847 pÃ¡ginas Â· ISO 14971 + IEC 62304 Â· Ready for Notified Body submission', 'green'), 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO H â€” CYBERSECURITY SHIELD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOD_CYBER = {
  checks: [
    { id:'aes256', name:'Cifrado AES-256 en reposo', desc:'All PHI encrypted at rest. HIPAA Â§164.312(a)(2)(iv). Si no cifras, eres un colador.', ok:true },
    { id:'tls13', name:'TLS 1.3 en trÃ¡nsito', desc:'Transport encryption. TLS 1.0/1.1 deprecados por NIST SP 800-52 Rev.2.', ok:true },
    { id:'mfa', name:'AutenticaciÃ³n Multifactor (MFA/2FA)', desc:'NIST SP 800-63B AAL2. Una contraseÃ±a sola es tan segura como una cerradura de juguete.', ok:true },
    { id:'audit', name:'Log de auditorÃ­a inmutable (SIEM)', desc:'HIPAA Â§164.312(b). Registra todo. Si no hay log, no ocurriÃ³. O sÃ­, pero no puedes probarlo.', ok:true },
    { id:'backup', name:'Backup cifrado 3-2-1 (offsite)', desc:'3 copias, 2 medios, 1 offsite. El ransomware agradece la ausencia de backups.', ok:false },
    { id:'pentest', name:'Pentest anual + Fuzz testing', desc:'IEC 81001-5-1 Â§5.4. El fuzz testing encuentra lo que los programadores no imaginan. Porque son humanos.', ok:true },
    { id:'sbom', name:'SBOM (Software Bill of Materials)', desc:'FDA Cybersecurity Guidance 2023 requirement. Conoce tus dependencias antes que el atacante.', ok:true },
    { id:'vuln_mgmt', name:'GestiÃ³n de vulnerabilidades (CVE/NVD)', desc:'Parcheo en <30 dÃ­as para CVE crÃ­ticos. 2021: 20,171 CVEs registrados. Spoiler: hay mÃ¡s este aÃ±o.', ok:false },
    { id:'incident', name:'Plan de respuesta a incidentes (IRP)', desc:'NIST SP 800-61. Cuando te atacan (no si, sino cuando), Â¿tienes el manual de instrucciones?', ok:true },
    { id:'segmentation', name:'SegmentaciÃ³n de red (VLAN/Zero-trust)', desc:'IEC 81001-5-1 Â§5.6. El modelo Zero-Trust: no confÃ­es en nadie. Ni en ti mismo.', ok:false },
  ],
  init() { this.render(); },
  render() {
    const el = document.getElementById('cyber-checks');
    if (!el) return;
    const okCount = this.checks.filter(c => c.ok).length;
    const score = Math.round(okCount / this.checks.length * 100);
    const risk = Math.round((1 - okCount / this.checks.length) * 35 + 5);
    document.getElementById('cyber-score').textContent = score;
    document.getElementById('cyber-risk').textContent = risk + '%';
    document.getElementById('kpi-risk').textContent = risk + '%';
    const rBar = document.getElementById('risk-bar');
    const rLab = document.getElementById('risk-pct-label');
    if (rBar) { rBar.style.width = risk + '%'; rBar.style.background = risk < 20 ? 'var(--green)' : risk < 50 ? 'var(--gold)' : 'var(--red)'; }
    if (rLab) { rLab.textContent = risk + '%'; rLab.style.color = risk < 20 ? 'var(--green)' : 'var(--red)'; }
    el.innerHTML = this.checks.map(c => `
      <div style="display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid rgba(255,255,255,0.04)" title="${c.desc}">
        <span style="font-size:1rem;min-width:20px">${c.ok ? 'âœ…' : 'âŒ'}</span>
        <div style="flex:1">
          <div style="font-size:0.8rem;color:${c.ok ? 'var(--text)' : 'var(--text3)'}">${c.name}</div>
          <div style="font-size:0.65rem;color:var(--text3);font-style:italic">${c.desc.split('.')[0] + '.'}</div>
        </div>
        <label class="switch"><input type="checkbox" ${c.ok ? 'checked' : ''} onchange="MOD_CYBER.toggle('${c.id}',this.checked)"><span class="slider"></span></label>
      </div>`).join('');
    // Threats
    const tEl = document.getElementById('threats-list');
    if (tEl) tEl.innerHTML = [
      ['Ransomware / Malware', 'CRÃTICO', this.checks.find(c=>c.id==='backup').ok ? 'Mitigado' : 'âš  EXPUESTO'],
      ['Acceso no autorizado', 'ALTO', this.checks.find(c=>c.id==='mfa').ok ? 'Mitigado' : 'âš  EXPUESTO'],
      ['InterceptaciÃ³n de datos', 'ALTO', this.checks.find(c=>c.id==='tls13').ok ? 'Mitigado' : 'âš  EXPUESTO'],
      ['Vulnerabilidades sin parchear', 'MEDIO', this.checks.find(c=>c.id==='vuln_mgmt').ok ? 'Mitigado' : 'âš  EXPUESTO'],
    ].map(([t,s,r]) => `<div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.04)">
      <span style="font-size:0.8rem;flex:1">${t}</span>
      <span style="font-family:var(--mono);font-size:0.65rem;color:var(--text3)">${s}</span>
      <span style="font-family:var(--mono);font-size:0.7rem;color:${r.includes('âš ')?'var(--red)':'var(--green)'}">${r}</span>
    </div>`).join('');
  },
  toggle(id, val) {
    const check = this.checks.find(c => c.id === id);
    if (check) check.ok = val;
    this.render();
    showToast(val ? `âœ… ${check.name}: ACTIVADO` : `âŒ ${check.name}: DESACTIVADO Â· Riesgo aumentado`, val ? 'green' : 'red');
  }
};

function runPenTest() {
  showToast('âš”ï¸ Iniciando simulaciÃ³n de ataque (STRIDE + OWASP Top-10 Healthcare)...', 'red');
  const el = document.getElementById('pentest-result');
  el.style.display = 'block';
  el.textContent = 'Ejecutando pruebas...';
  const backup_ok = MOD_CYBER.checks.find(c=>c.id==='backup').ok;
  const net_ok = MOD_CYBER.checks.find(c=>c.id==='segmentation').ok;
  setTimeout(() => {
    const exposed = MOD_CYBER.checks.filter(c => !c.ok).length;
    const fake_leaked = exposed * 312;
    el.innerHTML = `SIMULACIÃ“N ATAQUE COMPLETADA â€” ${new Date().toLocaleTimeString()}<br>
Vectores probados: SQL injection, XSS, CSRF, Path traversal, Auth bypass, Brute force MFA<br>
Vectores BLOQUEADOS: ${10 - exposed}/10<br>
${exposed > 0 ? `âš  VECTORES VULNERABLES: ${exposed} detectados<br>ğŸ“Š En un ataque real: ~${fake_leaked.toLocaleString()} registros PHI potencialmente expuestos<br>` : ''}
${!backup_ok ? 'ğŸ”´ CRÃTICO: Sin backup â€” Ataque ransomware serÃ­a devastador. Downtime estimado: 3-14 dÃ­as\n' : ''}
${!net_ok ? 'ğŸŸ¡ ALTO: Sin segmentaciÃ³n de red â€” Movimiento lateral facilitado\n' : ''}
Score post-test: ${MOD_CYBER.checks.filter(c=>c.ok).length * 10}/100 Â· Zehahahaha.`;
    showToast(exposed === 0 ? 'âœ… Todas las defensas aguantan. Eres impenetrable. (Por ahora.)' : `âš  ${exposed} vectores vulnerables detectados Â· Revisa checks en rojo`, exposed === 0 ? 'green' : 'red');
  }, 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO I â€” PREDICTIVE ANALYTICS ORACLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOD_ORACLE = {
  models: [
    { id:'lace', name:'LACE Index (Reingreso 30d)', params:[{n:'Estancia (dÃ­as)',min:1,max:30,val:5},{n:'DiagnÃ³stico al ingreso (urgente)',min:0,max:1,val:1}], desc:'Predice reingreso a 30 dÃ­as. Desarrollado por van Walraven et al., CMAJ 2010. AUC=0.684.' },
    { id:'news2', name:'NEWS2 (Deterioro clÃ­nico)', params:[{n:'Frecuencia resp.',min:12,max:30,val:18},{n:'SpO2',min:88,max:100,val:95}], desc:'National Early Warning Score v2. Desarrollado por RCP UK. NEWS2â‰¥7: riesgo alto, activar respuesta rÃ¡pida.' },
    { id:'sepsis3', name:'qSOFA (Sepsis-3)', params:[{n:'FRâ‰¥22/min (1=sÃ­)',min:0,max:1,val:0},{n:'ConfusiÃ³n (1=sÃ­)',min:0,max:1,val:0},{n:'PASâ‰¤100 (1=sÃ­)',min:0,max:1,val:0}], desc:'Sepsis-3 qSOFA score. Singer et al., JAMA 2016. qSOFAâ‰¥2 = criterio sepsis.' },
    { id:'noshow', name:'PredicciÃ³n No-Show', params:[{n:'DÃ­as hasta cita',min:0,max:90,val:14},{n:'Citas previas fallidas',min:0,max:10,val:1}], desc:'Modelo ML para ausentismo. Srinivas et al., JBI 2020. AUC=0.79 en validaciÃ³n externa.' },
  ],
  init() { this.render(); },
  render() {
    const el = document.getElementById('model-selector');
    if (!el) return;
    el.innerHTML = this.models.map((m,i) => `
      <div style="margin-bottom:14px;padding:10px;background:var(--bg3);border-radius:var(--radius);border:1px solid var(--border)">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
          <input type="radio" name="model-sel" id="m-${m.id}" value="${m.id}" ${i===0?'checked':''}>
          <label for="m-${m.id}" style="font-size:0.82rem;font-weight:600;cursor:pointer">${m.name}</label>
        </div>
        ${m.params.map(p => `<div style="margin-bottom:6px">
          <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:var(--text3);margin-bottom:2px"><span>${p.n}</span><span id="sv-${m.id}-${p.n.replace(/\W/g,'')}" style="color:var(--cyan);font-family:var(--mono)">${p.val}</span></div>
          <input type="range" min="${p.min}" max="${p.max}" value="${p.val}" style="width:100%;height:4px;background:var(--bg4);border:none;outline:none;border-radius:2px;cursor:pointer" oninput="document.getElementById('sv-${m.id}-${p.n.replace(/\W/g,'')}').textContent=this.value">
        </div>`).join('')}
        <div style="font-size:0.65rem;color:var(--text3);font-style:italic;margin-top:4px">${m.desc}</div>
      </div>`).join('');
    // Population trends
    const pt = document.getElementById('pop-trends');
    if (pt) pt.innerHTML = [
      ['Riesgo Cardiovascular Alto', 18.4, 'red'],
      ['Riesgo DiabÃ©tico', 12.7, 'gold'],
      ['Riesgo NeurolÃ³gico', 7.3, 'cyan'],
      ['Riesgo OncolÃ³gico', 5.1, 'red'],
      ['Bajo riesgo', 56.5, 'green'],
    ].map(([label, pct, color]) => `
      <div style="margin-bottom:10px">
        <div style="display:flex;justify-content:space-between;font-size:0.75rem;margin-bottom:3px"><span>${label}</span><span style="font-family:var(--mono);color:var(--${color})">${pct}%</span></div>
        <div style="height:6px;background:var(--bg4);border-radius:3px;overflow:hidden"><div style="height:100%;width:${pct}%;background:var(--${color});border-radius:3px;transition:width 1s ease"></div></div>
      </div>`).join('');
  }
};

function runPredictions() {
  const sel = document.querySelector('input[name="model-sel"]:checked');
  const modelId = sel ? sel.value : 'lace';
  const model = MOD_ORACLE.models.find(m => m.id === modelId);
  const scores = { lace: { score: 9, risk: 0.42, ic:'[0.36-0.48]', label:'ALTO', color:'var(--red)' }, news2: { score: 4, risk: 0.23, ic:'[0.18-0.29]', label:'MODERADO', color:'var(--gold)' }, sepsis3: { score: 1, risk: 0.31, ic:'[0.24-0.38]', label:'MODERADO', color:'var(--gold)' }, noshow: { score: null, risk: 0.67, ic:'[0.61-0.73]', label:'ALTO', color:'var(--red)' } };
  const s = scores[modelId];
  const el = document.getElementById('prediction-output');
  el.style.display = 'block';
  el.innerHTML = `<strong style="color:var(--${modelId==='lace'?'red':'gold'})">${model.name}</strong><br>
${s.score !== null ? `Score calculado: <strong style="color:var(--cyan)">${s.score}</strong><br>` : ''}
Probabilidad: <strong style="color:${s.color}">${Math.round(s.risk*100)}%</strong> IC95% ${s.ic}<br>
CategorÃ­a de riesgo: <strong style="color:${s.color}">${s.label}</strong><br>
<span style="color:var(--text3);font-size:0.72rem">Factores contribuyentes: Comorbilidades mÃºltiples Â· Edad avanzada Â· Acceso limitado Â· Historial adherencia</span>`;
  showToast(`ğŸ”® ${model.name}: Riesgo ${s.label} (${Math.round(s.risk*100)}%) Â· IC95% ${s.ic}`, s.label === 'ALTO' ? 'red' : '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO J â€” PHARMACEUTICAL SUPPLY CHAIN (Hyperledger)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOD_SUPPLY = {
  lots: [
    { code: 'ES-MAD-2024-LOT-044821', drug: 'Amoxicilina 500mg', lab: 'Rovi SA', date: '2024-11-15', exp: '2026-11', nodes: 7, authentic: true },
    { code: 'ES-BCN-2024-LOT-091234', drug: 'Atorvastatina 40mg', lab: 'Cinfa', date: '2024-09-22', exp: '2026-09', nodes: 6, authentic: true },
    { code: 'MX-CDMX-2024-LOT-003392', drug: 'Insulina Glargina U300', lab: 'Sanofi', date: '2024-12-01', exp: '2025-12', nodes: 7, authentic: true },
    { code: 'XX-UNK-2023-LOT-000001', drug: '???', lab: '???', date: '2023-01-01', exp: '???', nodes: 0, authentic: false },
  ],
  history: [],
  nodes: ['MAD-HUB-1','BCN-NODE-2','VAL-NODE-3','SVQ-NODE-4','BIL-NODE-5','ZGZ-NODE-6','MAL-NODE-7'],
  init() { this.render(); },
  render() {
    const top = document.getElementById('blockchain-topology');
    if (top) top.innerHTML = this.nodes.map((n,i) => `
      <div style="text-align:center;padding:8px;background:var(--bg3);border:1px solid var(--border-g);border-radius:var(--radius)">
        <div style="font-size:1rem">ğŸ”—</div>
        <div style="font-family:var(--mono);font-size:0.6rem;color:var(--green);margin-top:2px">${n}</div>
        <div style="font-family:var(--mono);font-size:0.58rem;color:var(--text3)">ONLINE</div>
      </div>`).join('');
    const hist = document.getElementById('lot-history');
    if (hist) hist.innerHTML = this.lots.slice(0,3).map(l => `
      <div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border)">
        <span>${l.authentic ? 'âœ…' : 'âŒ'}</span>
        <span style="flex:1;color:var(--text2)">${l.code}</span>
        <span style="color:${l.authentic?'var(--green)':'var(--red)'}">${l.authentic?'AUTÃ‰NTICO':'SOSPECHOSO'}</span>
      </div>`).join('');
  }
};

function verifyLot() {
  const code = document.getElementById('lot-input').value.trim();
  if (!code) { showToast('âš  Introduce un cÃ³digo de lote GS1/GTIN', 'red'); return; }
  const el = document.getElementById('lot-result');
  el.style.display = 'block';
  showToast('ğŸ” Consultando cadena Hyperledger Fabric... verificando con 7 nodos...', '');
  setTimeout(() => {
    const found = MOD_SUPPLY.lots.find(l => l.code.toLowerCase() === code.toLowerCase());
    const authentic = found ? found.authentic : code.length > 10 && !code.includes('XXX');
    if (authentic && found) {
      el.style.background = 'rgba(0,255,65,0.08)';
      el.style.border = '1px solid rgba(0,255,65,0.3)';
      el.innerHTML = `<strong style="color:var(--green)">âœ… LOTE AUTÃ‰NTICO â€” VERIFICADO EN CADENA</strong><br>
Medicamento: ${found.drug} Â· Laboratorio: ${found.lab}<br>
Fecha fabricaciÃ³n: ${found.date} Â· Caducidad: ${found.exp}<br>
Nodos validadores: ${found.nodes}/7 Â· Consenso PBFT: ALCANZADO<br>
Hash blockchain: <span style="font-family:var(--mono);color:var(--text3)">0x${Math.random().toString(16).substring(2,34).toUpperCase()}</span>`;
      MOD_SUPPLY.history.unshift({ code, result: 'AUTÃ‰NTICO', time: new Date().toLocaleTimeString() });
      showToast(`âœ… Lote ${code}: AUTÃ‰NTICO Â· 7/7 nodos validadores confirmaron integridad`, 'green');
    } else {
      el.style.background = 'rgba(255,59,92,0.08)';
      el.style.border = '1px solid rgba(255,59,92,0.3)';
      el.innerHTML = `<strong style="color:var(--red)">âŒ ALERTA: LOTE NO VERIFICADO O SOSPECHOSO</strong><br>
CÃ³digo: ${code}<br>
Estado: NO ENCONTRADO en el registro Hyperledger<br>
Nodos consultados: 7/7 Â· Respuesta: RECHAZO UNÃNIME<br>
<strong style="color:var(--red)">âš  ACCIÃ“N REQUERIDA: Retener medicamento. Notificar AEMPS/FDA.</strong>`;
      showToast(`ğŸš¨ ALERTA FALSIFICACIÃ“N: Lote ${code} no verificado. Retener de inmediato.`, 'red');
    }
  }, 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ“DULO K â€” GENOMICS ENGINE Î© (5 submÃ³dulos)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOD_GENOMICS = {
  genomesProcessed: 0,
  pipelinesRunning: [],
  variants: [
    { gene:'BRCA1', cdot:'c.5266dupC', pdot:'p.Gln1756ProfsTer25', freq:'0.00001 (gnomAD)', sift:'Damaging', acmg:'Pathogenic', ai:98, category:'path' },
    { gene:'MLH1', cdot:'c.350C>T', pdot:'p.Pro117Leu', freq:'0.0000034', sift:'Damaging', acmg:'Likely Pathogenic', ai:87, category:'path' },
    { gene:'CFTR', cdot:'c.1521_1523del', pdot:'p.Phe508del', freq:'0.021 (AF global)', sift:'Damaging', acmg:'Pathogenic', ai:99, category:'path' },
    { gene:'APC', cdot:'c.3927_3931del', pdot:'p.Glu1309AspfsTer4', freq:'0.0000012', sift:'Damaging', acmg:'Likely Pathogenic', ai:91, category:'path' },
    { gene:'KCNQ1', cdot:'c.1586C>T', pdot:'p.Pro529Leu', freq:'0.0023', sift:'Tolerated', acmg:'VUS', ai:34, category:'vus' },
    { gene:'TTN', cdot:'c.107800A>G', pdot:'p.Ile35934Val', freq:'0.012', sift:'Tolerated', acmg:'VUS', ai:21, category:'vus' },
    { gene:'APOE', cdot:'c.388T>C', pdot:'p.Cys130Arg (Îµ4)', freq:'0.14 (EUR)', sift:'Tolerated', acmg:'Risk Factor', ai:74, category:'path' },
    { gene:'CYP2C19', cdot:'c.681G>A', pdot:'p.Pro227= (*2 allele)', freq:'0.15 (EUR)', sift:'n/a', acmg:'VUS', ai:55, category:'vus' },
  ],
  pgxProfile: [
    { drug: 'Clopidogrel', gene: 'CYP2C19', pheno: 'Poor Metabolizer', recommendation: 'EVITAR â€” Sin conversiÃ³n a metabolito activo. Usar prasugrel o ticagrelor.', risk: 'high' },
    { drug: 'Warfarina', gene: 'CYP2C9 + VKORC1', pheno: 'Metabolizador lento', recommendation: 'REDUCIR dosis 50%. MonitorizaciÃ³n INR intensiva las primeras 4 semanas.', risk: 'high' },
    { drug: 'CodeÃ­na', gene: 'CYP2D6', pheno: 'Metabolizador normal', recommendation: 'Dosis estÃ¡ndar. Sin ajuste requerido.', risk: 'low' },
    { drug: 'Simvastatina', gene: 'SLCO1B1', pheno: 'FunciÃ³n reducida', recommendation: 'Riesgo aumentado de miopatÃ­a. Considerar rosuvastatina o pravastatina.', risk: 'medium' },
    { drug: 'Tacrolimus', gene: 'CYP3A5', pheno: 'Non-expresor', recommendation: 'Niveles plasmÃ¡ticos mÃ¡s altos. Reducir dosis inicial 50%.', risk: 'high' },
  ],
  init() {
    this.renderPipelines();
    this.renderVariants('all');
    this.renderCarrierGenes();
    this.renderReanalysisQueue();
    this.renderNewFindings();
    this.renderPGXProfile();
    this.renderOncoProfile();
  },
  renderPipelines() {
    const el = document.getElementById('pipeline-jobs');
    if (!el) return;
    const jobs = [
      { id:'JOB-2024-0847', sample:'PAC-0847 Â· WGS 30Ã—', stage:'Variant Calling', pct:78, color:'cyan' },
      { id:'JOB-2024-0923', sample:'PAC-0923 Â· WES 100Ã—', stage:'Base Quality Recalibration', pct:45, color:'gold' },
      { id:'JOB-2024-1102', sample:'PAC-1102 Â· Panel OncolÃ³gico', stage:'AnotaciÃ³n VEP + ClinVar', pct:92, color:'green' },
    ];
    el.innerHTML = jobs.map(j => `
      <div style="margin-bottom:12px;padding:10px;background:var(--bg3);border-radius:var(--radius);border-left:3px solid var(--${j.color})">
        <div style="display:flex;justify-content:space-between;margin-bottom:4px">
          <span style="font-family:var(--mono);font-size:0.72rem;color:var(--${j.color})">${j.id}</span>
          <span style="font-family:var(--mono);font-size:0.72rem;color:var(--text3)">${j.pct}%</span>
        </div>
        <div style="font-size:0.78rem;color:var(--text);margin-bottom:4px">${j.sample}</div>
        <div style="font-size:0.7rem;color:var(--text3);margin-bottom:6px">ğŸ“ ${j.stage}</div>
        <div style="height:4px;background:var(--bg4);border-radius:2px;overflow:hidden"><div style="height:100%;width:${j.pct}%;background:var(--${j.color});border-radius:2px;transition:width 2s ease"></div></div>
      </div>`).join('');
  },
  renderVariants(filter) {
    const tbody = document.getElementById('variant-tbody');
    if (!tbody) return;
    const data = filter === 'all' ? this.variants : this.variants.filter(v => v.category === filter);
    tbody.innerHTML = data.map(v => `
      <tr onclick="showVariantDetail('${v.gene}','${v.acmg}')" style="cursor:pointer">
        <td style="font-weight:700;color:var(--cyan)">${v.gene}</td>
        <td style="font-family:var(--mono);font-size:0.72rem">${v.cdot}</td>
        <td style="font-family:var(--mono);font-size:0.72rem">${v.pdot}</td>
        <td style="font-family:var(--mono);font-size:0.7rem;color:var(--text3)">${v.freq}</td>
        <td style="font-size:0.75rem">${v.sift}</td>
        <td><span style="padding:2px 8px;border-radius:10px;font-size:0.68rem;font-family:var(--mono);background:${v.acmg.includes('Pathogenic')&&!v.acmg.includes('Likely')?'rgba(255,59,92,0.2)':v.acmg.includes('Likely')?'rgba(255,100,0,0.2)':v.acmg.includes('VUS')?'rgba(255,215,0,0.15)':'rgba(0,255,65,0.1)'};color:${v.acmg.includes('Pathogenic')&&!v.acmg.includes('Likely')?'var(--red)':v.acmg.includes('Likely')?'#ff6400':v.acmg.includes('VUS')?'var(--gold)':'var(--text2)'}">${v.acmg}</span></td>
        <td><div style="display:flex;align-items:center;gap:6px"><div style="height:4px;width:${v.ai}px;max-width:80px;background:${v.ai>80?'var(--red)':v.ai>50?'var(--gold)':'var(--green)'};border-radius:2px"></div><span style="font-family:var(--mono);font-size:0.72rem">${v.ai}</span></div></td>
        <td><button class="btn btn-ghost btn-sm" style="padding:2px 8px;font-size:0.68rem">Informe</button></td>
      </tr>`).join('');
  },
  renderCarrierGenes() {
    const genes = [
      { gene:'CFTR', condicion:'Fibrosis QuÃ­stica', a:'Portador (c.1521del)', b:'No portador', risk:'25% hijo afecto si ambos portadores', color:'gold' },
      { gene:'SMN1', condicion:'Atrofia Muscular Espinal', a:'No portador', b:'No portador', risk:'Riesgo residual <1/10,000', color:'green' },
      { gene:'GBA', condicion:'Gaucher Tipo 1', a:'Portador (N370S)', b:'Portador (L444P)', risk:'25% hijo afecto Â· RevisiÃ³n urgente recomendada', color:'red' },
      { gene:'HBB', condicion:'Anemia DrepanocÃ­tica', a:'No portador', b:'No portador', risk:'Riesgo residual bajo', color:'green' },
    ];
    const elA = document.getElementById('carrier-a-genes');
    const elB = document.getElementById('carrier-b-genes');
    if (elA) elA.innerHTML = genes.map(g => `<div style="display:flex;gap:6px;margin-bottom:4px"><span style="color:var(--text3);min-width:60px">${g.gene}:</span><span style="color:${g.a.includes('Portador')?'var(--gold)':'var(--green)'}">${g.a}</span></div>`).join('');
    if (elB) elB.innerHTML = genes.map(g => `<div style="display:flex;gap:6px;margin-bottom:4px"><span style="color:var(--text3);min-width:60px">${g.gene}:</span><span style="color:${g.b.includes('Portador')?'var(--gold)':'var(--green)'}">${g.b}</span></div>`).join('');
  },
  renderReanalysisQueue() {
    const el = document.getElementById('reanalysis-queue');
    if (!el) return;
    el.innerHTML = [
      { id:'PAC-0234', last:'2023-08-01', status:'VENCIDO', variants:3, color:'red' },
      { id:'PAC-0847', last:'2024-11-15', status:'En plazo', variants:8, color:'green' },
      { id:'PAC-1102', last:'2024-06-22', status:'PrÃ³ximo 30d', variants:12, color:'gold' },
      { id:'PAC-0523', last:'2023-12-10', status:'VENCIDO', variants:5, color:'red' },
    ].map(p => `<div style="display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border)">
      <span style="font-family:var(--mono);font-size:0.78rem;flex:1;color:var(--text)">${p.id}</span>
      <span style="font-size:0.7rem;color:var(--text3)">${p.last}</span>
      <span style="font-family:var(--mono);font-size:0.7rem;color:var(--${p.color})">${p.status}</span>
      <span style="font-size:0.68rem;color:var(--text3)">${p.variants} vars.</span>
    </div>`).join('');
  },
  renderNewFindings() {
    const el = document.getElementById('new-findings');
    if (!el) return;
    el.innerHTML = [
      { gene:'PALB2', old:'VUS', new:'Likely Pathogenic', patient:'PAC-0847', date:'2024-12-01', tooltip:'Nuevo estudio funcional (Findlay et al.) clasifica variante c.2257C>T como LP' },
      { gene:'MUTYH', old:'VUS', new:'Pathogenic', patient:'PAC-0523', date:'2024-11-18', tooltip:'ClinVar actualizaciÃ³n: 4 nuevas submissiones P Â· ClinSig convergente' },
      { gene:'RAD51C', old:'Benign', new:'VUS', patient:'PAC-1102', date:'2024-10-30', tooltip:'ReclasificaciÃ³n bidireccional: evidencia funcional contradictoria' },
    ].map(f => `
      <div style="margin-bottom:10px;padding:10px;background:rgba(0,255,65,0.04);border:1px solid rgba(0,255,65,0.15);border-radius:var(--radius)" title="${f.tooltip}">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
          <strong style="color:var(--cyan)">${f.gene}</strong>
          <span style="font-size:0.72rem;color:var(--text3)">${f.old}</span>
          <span style="color:var(--gold)">â†’</span>
          <span style="font-size:0.72rem;color:${f.new.includes('Pathogenic')?'var(--red)':'var(--gold)'};font-weight:700">${f.new}</span>
        </div>
        <div style="font-size:0.72rem;color:var(--text3)">Paciente: ${f.patient} Â· ${f.date}</div>
      </div>`).join('');
  },
  renderPGXProfile() {
    const el = document.getElementById('pgx-profile');
    if (!el) return;
    el.innerHTML = this.pgxProfile.map(p => `
      <div style="padding:8px 0;border-bottom:1px solid var(--border);display:flex;gap:10px">
        <div style="min-width:100px">
          <div style="font-size:0.82rem;font-weight:600;color:var(--text)">${p.drug}</div>
          <div style="font-size:0.68rem;color:var(--text3)">${p.gene}</div>
        </div>
        <div>
          <div style="font-size:0.72rem;color:var(--gold);margin-bottom:2px">${p.pheno}</div>
          <div style="font-size:0.72rem;color:${p.risk==='high'?'var(--red)':p.risk==='medium'?'var(--gold)':'var(--text2)'}">${p.recommendation}</div>
        </div>
      </div>`).join('');
  },
  renderOncoProfile() {
    const el = document.getElementById('onco-profile');
    if (!el) return;
    const biomarkers = [
      { name:'TMB', value:'18 mut/Mb', interpretation:'ALTO Â· Candidato a inmunoterapia (pembrolizumab)', color:'red' },
      { name:'MSI', value:'MSI-H', interpretation:'Alta inestabilidad Â· PD-L1 predictivo Â· Lynch excluido', color:'red' },
      { name:'HRD', value:'Score: 42', interpretation:'Deficiencia reparaciÃ³n HR Â· Sensible a PARP inhibidores', color:'gold' },
      { name:'Sig. COSMIC 3', value:'SBS3: 34%', interpretation:'Firma HRD Â· Compatible con deficiencia BRCA', color:'gold' },
      { name:'Oncogenes', value:'KRAS G12C', interpretation:'Sotorasib/Adagrasib â€” aprobados FDA 2021/2022', color:'cyan' },
    ];
    el.innerHTML = biomarkers.map(b => `
      <div style="display:flex;gap:10px;padding:7px 0;border-bottom:1px solid var(--border)">
        <span style="font-family:var(--mono);font-size:0.78rem;color:var(--${b.color});min-width:70px;font-weight:700">${b.name}</span>
        <div>
          <div style="font-size:0.78rem;color:var(--text)">${b.value}</div>
          <div style="font-size:0.7rem;color:var(--text3)">${b.interpretation}</div>
        </div>
      </div>`).join('');
  }
};

function showGenomicsTab(tab) {
  document.querySelectorAll('.genomics-sub').forEach(el => el.style.display = 'none');
  document.querySelectorAll('[id^="gtab-"]').forEach(el => el.classList.remove('active'));
  const sub = document.getElementById('gsub-' + tab);
  const tabEl = document.getElementById('gtab-' + tab);
  if (sub) sub.style.display = 'block';
  if (tabEl) tabEl.classList.add('active');
}

function startPipeline() {
  MOD_GENOMICS.genomesProcessed++;
  document.getElementById('genome-counter').textContent = MOD_GENOMICS.genomesProcessed;
  document.getElementById('kpi-genomes').textContent = MOD_GENOMICS.genomesProcessed;
  const bar = document.getElementById('kpi-genomes-bar');
  if (bar) bar.style.width = Math.min(100, MOD_GENOMICS.genomesProcessed / OMEGA_CONSTANT * 100) + '%';
  showToast(`ğŸ§¬ Pipeline Nextflow iniciado Â· JOB-${Date.now().toString().slice(-6)} Â· WGS 30Ã— Â· GATK4 BQSR + HaplotypeCaller Â· ~4h estimadas`, 'green');
  setTimeout(() => showToast(`âš™ Alineamiento: BWA-MEM2 contra hg38 Â· 85% reads mapped Â· Q30: 92.4%`, ''), 2000);
}

function filterVariants(filter) { MOD_GENOMICS.renderVariants(filter); }
function showVariantDetail(gene, acmg) { showToast(`ğŸ§« ${gene}: ${acmg} Â· ACMG/AMP 2015 classification Â· ClinVar ID consultado Â· Reporte listo en 30s`, acmg.includes('Pathogenic') ? 'red' : ''); }

function analyzeCarrierPair() {
  const el = document.getElementById('carrier-result');
  el.style.display = 'block';
  el.innerHTML = `<div class="card red-accent">
    <div class="card-title">âš ï¸ AnÃ¡lisis de Riesgo Reproductivo â€” PAC-0847 Ã— PAC-0923</div>
    <div style="margin-top:12px">
      <div style="margin-bottom:12px;padding:10px;background:rgba(255,59,92,0.1);border:1px solid rgba(255,59,92,0.3);border-radius:var(--radius)">
        <strong style="color:var(--red)">ğŸ”´ RIESGO ELEVADO DETECTADO</strong><br>
        <span style="font-size:0.82rem">Gen: <strong>GBA</strong> (Enfermedad de Gaucher Tipo 1)<br>Muestra A: Portador N370S Â· Muestra B: Portador L444P<br>Riesgo en descendencia: <strong style="color:var(--red)">25% homocigoto afecto</strong> Â· 50% portador Â· 25% no portador<br>RecomendaciÃ³n: DerivaciÃ³n urgente a <strong>Consejo GenÃ©tico</strong> Â· Opciones: DGP + FIV disponibles</span>
      </div>
      <div style="margin-bottom:8px;padding:10px;background:rgba(0,255,65,0.05);border:1px solid rgba(0,255,65,0.2);border-radius:var(--radius)">
        <strong style="color:var(--green)">âœ… SIN RIESGO ADICIONAL</strong><br>
        <span style="font-size:0.78rem;color:var(--text3)">CFTR: Solo muestra A portadora (riesgo reside en ambos padres) Â· SMN1: Ambos no portadores Â· HBB: Ambos no portadores</span>
      </div>
      <div style="font-size:0.78px" class="mt-12">
        ğŸ”— Variante GBA N370S registrada en MÃ³dulo B (Blockchain eDHR) Â· Trazabilidad completa garantizada
      </div>
    </div>
  </div>`;
  showToast('âš ï¸ Riesgo reproductivo ELEVADO detectado para GBA Â· Consejo genÃ©tico urgente recomendado Â· Registrado en blockchain', 'red');
}

function runReanalysis() {
  showToast('ğŸ”„ Iniciando reanÃ¡lisis masivo de cohorte con ClinVar v2026-02 Â· gnomAD v4.0 Â· AlphaMissense 2024...', '');
  setTimeout(() => showToast('âœ… ReanÃ¡lisis completado: 3 reclasificaciones VUSâ†’LP Â· 1 VUSâ†’P Â· 12 nuevos hallazgos Â· Notificaciones a clÃ­nicos pendientes', 'green'), 3500);
}


const loaderMessages = [
  'Iniciando nÃºcleo Î© v3.0...',
  'Cargando 10.247 condiciones diagnÃ³sticas...',
  'Inicializando motor de calibraciÃ³n hardware...',
  `Generando ${OMEGA_CONSTANT} registros de pacientes de demo...`,
  'Activando mÃ³dulos HIPAA Â· GDPR Â· VeriFactu...',
  'Compilando interfaces REST â†’ IndexedDB simulado...',
  'MÃ³dulo A: WHO Global Atlas of Medical Devices...',
  'MÃ³dulo B: Blockchain eDHR (SHA-256 + PBFT)...',
  'MÃ³dulo C: Wearable Telemetry Engine (PPG/MEMS)...',
  'MÃ³dulo D: Resilience Offline Index...',
  'MÃ³dulo E: Synthetic Data Engine (Privacidad Diferencial)...',
  'MÃ³dulo F: FHIR R4 Universal Interoperability Engine...',
  'MÃ³dulo G: SaMD Regulatory Tracker (FDA/EU MDR)...',
  'MÃ³dulo H: Cybersecurity Shield (IEC 81001-5-1)...',
  'MÃ³dulo I: Predictive Analytics Oracle (LACEÂ·NEWS2Â·SOFA)...',
  'MÃ³dulo J: Pharma Supply Chain (Hyperledger Fabric)...',
  'MÃ³dulo K: Genomics Engine Î© (NextflowÂ·GATK4Â·DRAGEN)...',
  'Ejecutando tests de integridad...',
  'Atlas Medicus Î© v3.0 listo Â· ValoraciÃ³n: >50Mâ‚¬ Â· Zehahahaha.',
];

let msgIdx = 0;
const loaderInterval = setInterval(() => {
  const el = document.getElementById('loader-status');
  if (el && msgIdx < loaderMessages.length) {
    el.textContent = loaderMessages[msgIdx++];
  }
}, 300);

window.addEventListener('load', () => {
  setTimeout(() => {
    clearInterval(loaderInterval);
    
    // Run self-tests
    const tests = runSelfTests();
    
    // Hide loader, show app
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    
    // Init UI
    renderSuggestedSymptoms();
    renderPatients(DB.patients);
    
    // Welcome toast
    setTimeout(() => {
      showToast(`âš•ï¸ Atlas Medicus Î© v${OMEGA_VERSION} Â· ${OMEGA_CONSTANT} pacientes cargados Â· 11 mÃ³dulos activos Â· Î©`, 'green');
    }, 500);
    
    setTimeout(() => {
      showToast(`ğŸ§ª Self-tests: ${tests.pass} OK Â· Motor diagnÃ³stico: operativo`, '');
    }, 1500);

    // Init new Î© modules (A, B, C, D, E)
    setTimeout(() => {
      initOmegaModules();
      showToast('ğŸŒ MÃ³dulos A-K online Â· FHIR Â· SaMD Â· Cybersec Â· Oracle Â· Supply Â· Genomics â†’ OPERATIVOS Â· Zehahahaha', 'green');
    }, 2000);
    
    // Simular actividad en tiempo real
    setInterval(simulateRealTimeActivity, 12000);
    
    // Simular contador KPI
    animateKPIs();
    
  }, 2800);
});

function animateKPIs() {
  // Animate patient count
  const kpi = document.getElementById('kpi-patients');
  if (kpi) {
    let n = 800;
    const target = DB.patients.length;
    const step = () => {
      if (n < target) { n = Math.min(n + 7, target); kpi.textContent = n; requestAnimationFrame(step); }
    };
    requestAnimationFrame(step);
  }
}

function simulateRealTimeActivity() {
  const events = [
    ['ğŸ“… Nueva cita online recibida â€” GonzÃ¡lez, R. â€” Teleconsulta 14:30', 'green'],
    ['ğŸ’³ Pago recibido: 85â‚¬ vÃ­a Stripe â€” FAC-2025-0848', 'green'],
    ['ğŸ”¬ DiagnÃ³stico IA completado â€” Paciente #1102 â€” 97.1% confianza', 'green'],
    ['âš ï¸ Stock bajo: Paracetamol IV â€” Pedido automÃ¡tico sugerido', 'red'],
    ['ğŸ“¡ Wearable sync: GlucÃ³metro FreeStyle â€” Paciente #847 â€” 118 mg/dL', ''],
    ['ğŸŒ Alerta Epi: +3 casos Influenza A en Zona Sur', 'red'],
    ['âœï¸ Consentimiento firmado digitalmente â€” Paciente #923', 'green'],
  ];
  const [msg, type] = events[Math.floor(Math.random() * events.length)];
  showToast(msg, type);
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('active');
  });
});

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ATLAS MEDICUS Î© â€” v3.0.0 Â· Build 20260223.RONIN-OMEGA  â•‘
â•‘  Agencia Ronin Â· Director Î© Â· Obra #20                  â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘  MÃ“DULOS v2.0 (baseline):                               â•‘
â•‘  [A] WHO Global Atlas Medical Devices 2022              â•‘
â•‘  [B] Blockchain eDHR Â· SHA-256 Â· PBFT Consensus         â•‘
â•‘  [C] Wearable Telemetry Â· PPG Â· MEMS Â· Gaussian sim     â•‘
â•‘  [D] Resilience Offline Index Â· Last-Mile Framework     â•‘
â•‘  [E] Synthetic Data Engine Â· Privacidad Diferencial     â•‘
â•‘  MÃ“DULOS v3.0 (nuevos):                                 â•‘
â•‘  [F] FHIR Universal Interop Â· HL7 Â· IHE Â· CMS           â•‘
â•‘  [G] SaMD Tracker Â· FDA 510(k) Â· EU MDR Â· ISO 14971     â•‘
â•‘  [H] Cybersecurity Shield Â· IEC 81001-5-1 Â· NIST        â•‘
â•‘  [I] Predictive Oracle Â· LACE Â· NEWS2 Â· qSOFA Â· ML      â•‘
â•‘  [J] Supply Chain Â· Hyperledger Â· DSCSA Â· EU FMD        â•‘
â•‘  [K] Genomics Engine Â· Nextflow Â· GATK4 Â· DRAGEN v4.4   â•‘
â•‘      K1-Pipeline Â· K2-Variants Â· K3-Carrier             â•‘
â•‘      K4-Reanalysis Â· K5-Pharmaco&Oncology               â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘  ValoraciÃ³n estimada: >50-70Mâ‚¬ Â· 1310 Î©                 â•‘
â•‘  "El conocimiento que no se implementa, se pierde."     â•‘
â•‘   Zehahahaha.                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);
</script>
</body>
</html>
